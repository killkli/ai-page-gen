import{r,j as e}from"./react-vendor-CKBOTALK.js";import{l as n,s as V}from"./app-services-2y2dLhqm.js";import{H as S,l as b,A as v,k as P,L as W,E as I,m as z}from"./interactive-components-Bz66s04f.js";import{b as B}from"./index-C3TG8Xrl.js";import"./vendor-D_G8XHYM.js";import"./ai-vendor-DJy2VIy7.js";import"./ui-utilities-SaSpuDSU.js";import"./teacher-components-h4c49MD4.js";const q=()=>{const[i,N]=r.useState([]),[A,c]=r.useState(!0),[y,m]=r.useState(null),[l,$]=r.useState(""),[t,h]=r.useState(null),[D,w]=r.useState("list"),[d,f]=r.useState(null),[L,E]=r.useState(null);r.useEffect(()=>{const s=localStorage.getItem("gemini_api_key");E(s),o()},[]);const o=async()=>{try{c(!0),m(null),await n.init();const s=await n.getAllLessonPlans();N(s)}catch(s){console.error("載入教案失敗:",s),m("載入教案失敗，請重試。")}finally{c(!1)}},k=async()=>{if(!l.trim()){await o();return}try{c(!0);const s=await n.searchLessonPlans(l);N(s)}catch(s){console.error("搜索失敗:",s),m("搜索失敗，請重試。")}finally{c(!1)}},M=async s=>{h(s),w("view");try{await n.updateLastAccessed(s.id)}catch(a){console.error("更新訪問時間失敗:",a)}},C=async s=>{if(!L){alert("請先設定 API Key 才能分享教案。");return}f(s.id);try{const a={...s.content,topic:s.topic,selectedLevel:s.content.selectedLevel||null,selectedVocabularyLevel:s.content.selectedVocabularyLevel||null},u=await V(a),j=`${window.location.origin}/ai-page-gen/share?binId=${u}`;if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(j),alert("分享連結已複製到剪貼簿！");else{const x=document.createElement("textarea");x.value=j,document.body.appendChild(x),x.select(),document.execCommand("copy"),document.body.removeChild(x),alert(`分享連結已複製！\\n${j}`)}await n.updateLastAccessed(s.id)}catch(a){console.error("分享失敗:",a),alert("分享失敗，請稍後再試。")}finally{f(null)}},K=async s=>{if(confirm(`確定要刪除教案「${s.topic}」嗎？此操作無法復原。`))try{await n.deleteLessonPlan(s.id),await o()}catch(a){console.error("刪除失敗:",a),alert("刪除失敗，請重試。")}},g=s=>new Date(s).toLocaleString("zh-TW",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),p=l.trim()?i.filter(s=>s.topic.toLowerCase().includes(l.toLowerCase())):i;return D==="view"&&t?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b sticky top-0 z-10",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>{w("list"),h(null)},className:"flex items-center gap-2 px-3 py-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})}),"返回教案列表"]}),e.jsxs("a",{href:"/ai-page-gen/",className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(S,{className:"w-4 h-4"}),"返回首頁"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:t.topic}),e.jsxs("p",{className:"text-sm text-gray-600",children:["創建於 ",g(t.createdAt)]})]}),e.jsxs("button",{onClick:()=>C(t),disabled:d===t.id,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[d===t.id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(b,{className:"w-4 h-4"}),"分享教案"]})]})})}),e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:e.jsx(B,{content:t.content,topic:t.topic,selectedLevel:t.content.selectedLevel||null,selectedVocabularyLevel:t.content.selectedVocabularyLevel||null,apiKey:L||void 0,onContentUpdate:async s=>{const a={...t,content:s,lastAccessedAt:new Date().toISOString()};h(a);try{await n.saveLessonPlan(a),console.log("教案已更新到 IndexedDB")}catch(u){console.error("更新教案到 IndexedDB 失敗:",u)}}})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"w-8 h-8 text-indigo-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"我的教案庫"})]}),e.jsxs("a",{href:"/ai-page-gen/",className:"flex items-center gap-2 px-4 py-2 text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-lg hover:bg-indigo-100 transition-colors",children:[e.jsx(S,{className:"w-5 h-5"}),"返回首頁"]})]}),e.jsx("p",{className:"text-gray-600",children:"管理您之前生成的所有教案，隨時查看和分享"})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:l,onChange:s=>$(s.target.value),placeholder:"搜索教案主題...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",onKeyPress:s=>s.key==="Enter"&&k()}),e.jsx("button",{onClick:k,className:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"搜索"}),e.jsx("button",{onClick:o,className:"px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"重置"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-indigo-100 rounded-lg",children:e.jsx(v,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.length}),e.jsx("p",{className:"text-gray-600",children:"總教案數"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(P,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.metadata?.hasQuiz).length}),e.jsx("p",{className:"text-gray-600",children:"包含測驗"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-purple-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.metadata?.hasWriting).length}),e.jsx("p",{className:"text-gray-600",children:"包含寫作"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:l.trim()?`搜索結果 (${p.length})`:"所有教案"})}),A?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(W,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"載入中..."})]}):y?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:y}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"重試"})]}):p.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(v,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg mb-2",children:l.trim()?"未找到匹配的教案":"還沒有保存的教案"}),e.jsx("p",{className:"text-gray-500",children:l.trim()?"嘗試其他關鍵詞":"生成第一個教案來開始使用！"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:p.map(s=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.topic}),s.metadata?.isShared&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(b,{className:"w-3 h-3"}),"分享的教案"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-4 h-4"}),"創建：",g(s.createdAt)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-4 h-4"}),"訪問：",g(s.lastAccessedAt)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full",children:[s.metadata?.totalSections||0," 個部分"]}),s.metadata?.hasQuiz&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:"包含測驗"}),s.metadata?.hasWriting&&e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs font-medium rounded-full",children:"包含寫作"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs("button",{onClick:()=>M(s),className:"flex items-center gap-2 px-3 py-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:[e.jsx(I,{className:"w-4 h-4"}),"查看"]}),e.jsxs("a",{href:`/ai-page-gen/teacher-interactive-prep?contentId=${s.id}`,className:"flex items-center gap-2 px-3 py-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",target:"_blank",rel:"noopener noreferrer",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a6.759 6.759 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),"準備互動教材"]}),e.jsxs("button",{onClick:()=>C(s),disabled:d===s.id,className:"flex items-center gap-2 px-3 py-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[d===s.id?e.jsx("div",{className:"w-4 h-4 border-2 border-green-600 border-t-transparent rounded-full animate-spin"}):e.jsx(b,{className:"w-4 h-4"}),"分享"]}),e.jsxs("button",{onClick:()=>K(s),className:"flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),"刪除"]})]})]})},s.id))})]})]})]})};export{q as default};
