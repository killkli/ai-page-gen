import{r as d,j as e,u as V,R as f}from"./react-vendor-CKBOTALK.js";import{I as W,J,K as X}from"./app-services-Cu0omW9W.js";import{Q as i,L as Y,a as _,e as q}from"./index-BPrdf4XG.js";import{j as T,A as F,e as B,H as ee,h as se,g as te,F as ae,f as re,T as le,L as ne}from"./interactive-components-KenSvHOs.js";import"./vendor-D_G8XHYM.js";import"./ai-vendor-DJy2VIy7.js";import"./ui-utilities-SaSpuDSU.js";import"./teacher-components-rNDJYygQ.js";const ie=({quiz:u,topic:c,apiKey:w,supportsDiagnostic:m=!1,quizBinId:v})=>{const[a,M]=d.useState(i.Easy),[C,A]=d.useState([]),[D,b]=d.useState(!1),[x,L]=d.useState(""),[g,Z]=d.useState(!1),[o,h]=d.useState(""),[p,Q]=d.useState(!1),[K,z]=d.useState(!1),H=d.useCallback((s,t,l,n,r,k)=>{if(!m)return;const S=`${a}-${s}-${t}`,y={questionId:S,questionType:s,difficulty:a.toLowerCase(),userAnswer:l,correctAnswer:n,isCorrect:r,responseTime:k,attempts:1};A(I=>{const R=I.findIndex(N=>N.questionId===S);if(R>=0){const N=[...I];return N[R]={...N[R],userAnswer:l,isCorrect:r,attempts:(N[R].attempts||1)+1},N}return[...I,y]})},[a,m]),U=(s,t)=>{switch(s){case"trueFalse":return t.isTrue;case"multipleChoice":return t.options[t.correctAnswerIndex];case"fillInTheBlanks":return t.correctAnswers;case"sentenceScramble":return t.originalSentence;case"memoryCardGame":return t.pairs;default:return null}},j=()=>{const s=a.toLowerCase();return C.filter(t=>t.difficulty===s)},E=d.useCallback(async()=>{const t=(()=>{const l=a.toLowerCase();return C.filter(n=>n.difficulty===l)})();if(t.length===0){alert("è«‹å…ˆå®Œæˆä¸€äº›é¡Œç›®å†åˆ†äº«çµæœï¼");return}if(!x.trim()){Q(!0);return}Z(!0);try{const l=W(t),n=a===i.Easy?"ç°¡å–®":a===i.Normal?"æ™®é€š":"å›°é›£",r=u?.[a]||{},k=await J({studentName:x.trim(),topic:c,difficulty:n,responses:t,overallScore:l,completedAt:new Date().toISOString(),quizBinId:v,quizContent:r,metadata:{totalQuestions:t.length,correctAnswers:t.filter(I=>I.isCorrect).length,selectedDifficulty:a}}),y=`${window.location.origin}/ai-page-gen/student-results?binId=${k}`;h(y),navigator.clipboard&&window.isSecureContext?(await navigator.clipboard.writeText(y),alert("ä½œç­”çµæœå·²åˆ†äº«ï¼é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼Œå¯ä»¥å‚³é€çµ¦è€å¸«ã€‚")):alert("ä½œç­”çµæœå·²åˆ†äº«ï¼è«‹è¤‡è£½ä¸‹æ–¹é€£çµå‚³é€çµ¦è€å¸«ã€‚")}catch(l){console.error("åˆ†äº«å¤±æ•—:",l),alert("åˆ†äº«å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚")}finally{Z(!1)}},[C,x,c,a,v,u]);if(D&&m&&w&&j().length>0)return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(T,{className:"w-8 h-8 text-indigo-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"å­¸ç¿’è¨ºæ–·å ±å‘Š"}),e.jsxs("span",{className:"px-3 py-1 bg-indigo-100 text-indigo-800 text-sm font-medium rounded-full",children:[a===i.Easy?"ç°¡å–®":a===i.Normal?"æ™®é€š":"å›°é›£"," é›£åº¦"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-medium",children:c})]})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(Y,{topic:`${c} (${a===i.Easy?"ç°¡å–®":a===i.Normal?"æ™®é€š":"å›°é›£"}é›£åº¦)`,apiKey:w,mode:"student",initialResponses:j(),onClose:()=>b(!1),onRetakeQuiz:()=>{const s=a.toLowerCase();A(t=>t.filter(l=>l.difficulty!==s)),b(!1)},onContinueLearning:()=>b(!1)})})]});if(!u)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 text-lg",children:"æ²’æœ‰å¯ç”¨çš„æ¸¬é©—è³‡æ–™"})]});const $=u[a],O=[{key:i.Easy,label:"ç°¡å–®",color:"bg-green-500 hover:bg-green-600"},{key:i.Normal,label:"æ™®é€š",color:"bg-yellow-500 hover:bg-yellow-600"},{key:i.Hard,label:"å›°é›£",color:"bg-red-500 hover:bg-red-600"}],P={trueFalse:"æ˜¯éé¡Œ",multipleChoice:"é¸æ“‡é¡Œ",fillInTheBlanks:"å¡«ç©ºé¡Œ",sentenceScramble:"å¥å­é‡çµ„",memoryCardGame:"ç¿»å¡ç‰Œè¨˜æ†¶éŠæˆ²"},G=(s,t)=>{if(!t||!Array.isArray(t)||t.length===0)return null;const l=n=>m?(r,k,S)=>{const y=U(s,t[n]);H(s,n,r,y,k,S)}:void 0;switch(s){case"trueFalse":return e.jsx("div",{className:"space-y-4",children:t.map((n,r)=>e.jsx(le,{question:n,itemNumber:r+1,onAnswer:l(r)},`${a}-tf-${r}`))});case"multipleChoice":return e.jsx("div",{className:"space-y-4",children:t.map((n,r)=>e.jsx(re,{question:n,itemNumber:r+1,onAnswer:l(r)},`${a}-mc-${r}`))});case"fillInTheBlanks":return e.jsx("div",{className:"space-y-4",children:t.map((n,r)=>e.jsx(ae,{question:n,itemNumber:r+1,onAnswer:l(r)},`${a}-fb-${r}`))});case"sentenceScramble":return e.jsx("div",{className:"space-y-4",children:t.map((n,r)=>e.jsx(te,{question:n,itemNumber:r+1,onAnswer:l(r)},`${a}-ss-${r}`))});case"memoryCardGame":return e.jsx("div",{className:"space-y-4",children:t.map((n,r)=>e.jsx(se,{question:n,itemNumber:r+1,onAnswer:l(r)},`${a}-mcg-${r}`))});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-8 h-8 text-indigo-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"äº’å‹•æ¸¬é©—"})]}),e.jsxs("a",{href:"/ai-page-gen/",className:"flex items-center gap-2 px-4 py-2 text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-lg hover:bg-indigo-100 transition-colors",children:[e.jsx(ee,{className:"w-4 h-4"}),"è¿”å›é¦–é "]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-medium",children:c}),m&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"æ”¯æ´ AI è¨ºæ–·"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[m&&j().length>0&&e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(T,{className:"w-5 h-5"}),"æŸ¥çœ‹å­¸ç¿’è¨ºæ–· (",j().length,")"]}),j().length>0&&e.jsxs("button",{onClick:E,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-11.314a2.25 2.25 0 1 0 3.935-2.186 2.25 2.25 0 0 0-3.935 2.186Z"})}),g?"åˆ†äº«ä¸­...":`åˆ†äº«çµæœçµ¦è€å¸« (${j().length})`]})]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[m&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(T,{className:"w-5 h-5 text-blue-400 mt-0.5"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"æ­¤æ¸¬é©—æ”¯æ´ AI å­¸ç¿’è¨ºæ–·åŠŸèƒ½"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"å®Œæˆé¡Œç›®å¾Œå¯æŸ¥çœ‹å€‹äººåŒ–å­¸ç¿’å»ºè­°ã€‚æ‚¨çš„ç­”é¡Œè³‡æ–™åƒ…ç”¨æ–¼ç”Ÿæˆå­¸ç¿’è¨ºæ–·å ±å‘Šã€‚"})]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"é¸æ“‡é›£åº¦ç­‰ç´š"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:O.map(({key:s,label:t,color:l})=>e.jsx("button",{onClick:()=>M(s),className:`px-6 py-3 rounded-lg text-white font-medium transition-all transform hover:scale-105 shadow-md
                  ${a===s?`${l} ring-4 ring-opacity-50`:"bg-gray-400 hover:bg-gray-500"}
                `,children:t},s))})]}),$&&e.jsx("div",{className:"space-y-8",children:Object.keys(P).map(s=>{const t=$[s],l=G(s,t??[]);return l?e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"w-3 h-3 bg-indigo-500 rounded-full"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:P[s]})]}),l]},s):null})}),(!$||Object.values($).every(s=>!s||s.length===0))&&e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[e.jsx(B,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 text-lg",children:"æ­¤é›£åº¦ç­‰ç´šæš«ç„¡æ¸¬é©—é¡Œç›®"}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:"è«‹é¸æ“‡å…¶ä»–é›£åº¦ç­‰ç´š"})]})})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:s=>{s.target===s.currentTarget&&Q(!1)},children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"åˆ†äº«ä½œç­”çµæœçµ¦è€å¸«"}),e.jsx("button",{onClick:()=>Q(!1),className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"é—œé–‰",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"è«‹è¼¸å…¥æ‚¨çš„å§“åï¼Œè®“è€å¸«çŸ¥é“é€™æ˜¯èª°çš„ä½œç­”çµæœï¼š"}),e.jsx("input",{type:"text",value:x,onChange:s=>L(s.target.value),placeholder:"è«‹è¼¸å…¥å§“å",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",onKeyPress:s=>s.key==="Enter"&&E()}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>Q(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:E,disabled:!x.trim()||g,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:g?"åˆ†äº«ä¸­...":"åˆ†äº«çµæœ"})]})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:s=>{s.target===s.currentTarget&&(h(""),z(!1))},children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"âœ… ä½œç­”çµæœå·²åˆ†äº«æˆåŠŸï¼"}),e.jsx("button",{onClick:()=>{h(""),z(!1)},className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"é—œé–‰",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"è«‹å°‡ä¸‹æ–¹é€£çµå‚³é€çµ¦æ‚¨çš„è€å¸«ï¼Œè€å¸«å¯ä»¥æŸ¥çœ‹æ‚¨çš„ä½œç­”çµæœä¸¦æä¾›å­¸ç¿’å»ºè­°ï¼š"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:o,readOnly:!0,className:"w-full px-3 py-2 bg-white border border-gray-300 rounded text-sm"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:async()=>{navigator.clipboard&&window.isSecureContext&&(await navigator.clipboard.writeText(o),alert("é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼"))},className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors",children:"è¤‡è£½é€£çµ"}),e.jsxs("button",{onClick:()=>z(!K),className:"flex-1 px-3 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors flex items-center justify-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5H8.25v1.5H13.5V13.5ZM13.5 16.5H8.25V18H13.5v-1.5ZM16.5 16.5h1.5V18h-1.5v-1.5ZM16.5 13.5h1.5v1.5h-1.5v-1.5Z"})]}),"é¡¯ç¤º QR Code"]})]})]})}),K&&e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx(_,{url:o,title:"ä½œç­”çµæœåˆ†äº« QR Code",size:200,className:"bg-white"})}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["ğŸ’¡ ",e.jsx("strong",{children:"çµ¦è€å¸«çš„èªªæ˜ï¼š"}),e.jsx("br",{}),"è€å¸«æ‰“é–‹é€£çµå¾Œå¯ä»¥çœ‹åˆ° ",x," åœ¨ã€Œ",c,"ã€(",a===i.Easy?"ç°¡å–®":a===i.Normal?"æ™®é€š":"å›°é›£","é›£åº¦) çš„ä½œç­”çµæœï¼Œä¸¦å¯ä½¿ç”¨ AI é€²è¡Œè©³ç´°çš„å­¸ç¿’åˆ†æã€‚"]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>{h(""),z(!1)},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"é—œé–‰"})})]})}),e.jsx("footer",{className:"bg-white border-t mt-12 py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"ç”± AI å­¸ç¿’é é¢ç”¢ç”Ÿå™¨å‰µå»º â€¢ ç¥ä½ å­¸ç¿’æ„‰å¿«ï¼"})})})]})},fe=()=>{const[u]=V(),c=u.get("binId"),[w,m]=f.useState(null),[v,a]=f.useState(""),[M,C]=f.useState(""),[A,D]=f.useState(!1),[b,x]=f.useState(!1),[L,g]=f.useState("");return f.useEffect(()=>{if(!c){g("ç¼ºå°‘æ¸¬é©—IDåƒæ•¸");return}(async()=>{x(!0);try{const o=await X(c);m(o.quiz),a(o.topic);let h=o.apiKey||"";try{const p=await q(u);p&&(h=p,console.log("ä½¿ç”¨ URL ä¸­çš„ API Key é€²è¡Œå­¸ç¿’è¨ºæ–·"))}catch(p){console.warn("è§£æ URL API Key å¤±æ•—:",p)}C(h),D(!!h)}catch(o){g(o.message||"è¼‰å…¥æ¸¬é©—å¤±æ•—")}finally{x(!1)}})()},[c,u]),b?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"è¼‰å…¥æ¸¬é©—ä¸­..."})]})}):L?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md mx-4 text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"æ¸¬é©—è¼‰å…¥å¤±æ•—"}),e.jsx("p",{className:"text-gray-600 mb-4",children:L}),e.jsx("p",{className:"text-sm text-gray-500",children:"è«‹ç¢ºèªé€£çµæ˜¯å¦æ­£ç¢ºï¼Œæˆ–è¯ç¹«æ‚¨çš„è€å¸«"})]})}):!w||!v?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md mx-4 text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ğŸ”"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"æ‰¾ä¸åˆ°æ¸¬é©—å…§å®¹"}),e.jsx("p",{className:"text-gray-600",children:"è«‹æª¢æŸ¥é€£çµæ˜¯å¦æ­£ç¢º"})]})}):e.jsx(ie,{quiz:w,topic:v,apiKey:M,supportsDiagnostic:A,quizBinId:c??void 0})};export{fe as default};
