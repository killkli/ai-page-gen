const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/QuizPage-DWRkQIgt.js","assets/react-vendor-CKBOTALK.js","assets/vendor-D_G8XHYM.js","assets/app-services-Cu0omW9W.js","assets/ai-vendor-DJy2VIy7.js","assets/interactive-components-KenSvHOs.js","assets/ui-utilities-SaSpuDSU.js","assets/teacher-components-rNDJYygQ.js","assets/StudentWritingPage-Bjg4Gm8o.js","assets/StudentResultsPage-BMuDH8rj.js","assets/LessonPlanManager-D4w6aZ38.js","assets/StudentInteractivePage-DmEjUApz.js","assets/ConversationPrepPage-Dn6qj9No.js","assets/ConversationDisplay-4kzDTPmK.js","assets/ConversationPracticePage-1UDTixki.js","assets/MathGenerator-tShdTM05.js","assets/ObjectivesReview-DXHdrlBD.js","assets/EnglishGenerator-DBW7WoTq.js"])))=>i.map(i=>d[i]);
import{j as e,R as A,r as h,B as _e,a as Ve,b as F,L as ge,u as He,c as Ge}from"./react-vendor-CKBOTALK.js";import{e as Fe,f as Ze,h as Qe,j as Ue,u as Ke,k as ne,m as ce,n as Je,r as Ye,s as pe,P as R,o as Xe,G as es,O as ss,p as G,q as U,v as ts,w as se,E as be,x as J,y as rs,z as as,A as ns,B as ls,C as is,D as os,F as ds,l as ee,H as cs,g as ms,_ as Q}from"./app-services-Cu0omW9W.js";import{A as re,B as le,a as ie,b as xs,C as me,P as hs,S as us,c as gs,d as ps,X as bs,L as oe,e as fe,T as fs,f as js,F as vs,g as ys,h as ws,i as Ns,H as Le}from"./interactive-components-KenSvHOs.js";import{Q as je}from"./ui-utilities-SaSpuDSU.js";import{W as ks}from"./teacher-components-rNDJYygQ.js";import"./vendor-D_G8XHYM.js";import"./ai-vendor-DJy2VIy7.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const m of a)if(m.type==="childList")for(const c of m.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function i(a){const m={};return a.integrity&&(m.integrity=a.integrity),a.referrerPolicy&&(m.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?m.credentials="include":a.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(a){if(a.ep)return;a.ep=!0;const m=i(a);fetch(a.href,m)}})();const Ss=({topic:s,setTopic:t,onGenerate:i,onGenerateWithLevels:l,isLoading:a})=>{const m=x=>{x.preventDefault(),!a&&s.trim()&&i()},c=x=>{x.preventDefault(),!a&&s.trim()&&l&&l()};return e.jsxs("form",{onSubmit:m,className:"mb-8 p-6 bg-white shadow-lg rounded-xl",children:[e.jsx("label",{htmlFor:"topic-input",className:"block text-xl font-semibold text-slate-700 mb-3",children:"è¼¸å…¥å­¸ç¿’ä¸»é¡Œ"}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsx("input",{id:"topic-input",type:"text",value:s,onChange:x=>t(x.target.value),placeholder:"ä¾‹å¦‚ï¼šå…‰åˆä½œç”¨ã€JavaScript Promisesã€æ³•åœ‹å¤§é©å‘½",className:"w-full p-3 border border-slate-400 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-600 transition-shadow bg-slate-50 text-slate-800 placeholder-slate-500",disabled:a,"aria-label":"å­¸ç¿’ä¸»é¡Œè¼¸å…¥æ¬„ä½"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[l&&e.jsx("button",{type:"button",onClick:c,disabled:a||!s.trim(),className:"flex-1 px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center justify-center",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"ç”¢ç”Ÿä¸­..."]}):"ğŸ¯ é¸æ“‡ç¨‹åº¦å¾Œç”¢ç”Ÿ"}),e.jsx("button",{type:"submit",disabled:a||!s.trim(),className:"flex-1 px-6 py-3 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center justify-center","aria-live":"polite",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"ç”¢ç”Ÿä¸­..."]}):"âš¡ ç›´æ¥ç”¢ç”Ÿå…§å®¹"})]}),l&&e.jsxs("div",{className:"text-sm text-slate-600 bg-slate-50 p-3 rounded-lg",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ğŸ¯ é¸æ“‡ç¨‹åº¦å¾Œç”¢ç”Ÿï¼š"})," å…ˆç²å¾—å­¸ç¿’ç¨‹åº¦å»ºè­°ï¼Œé¸æ“‡åˆé©ç¨‹åº¦å¾Œç”¢ç”Ÿé‡å°æ€§å…§å®¹"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"âš¡ ç›´æ¥ç”¢ç”Ÿå…§å®¹ï¼š"})," ç«‹å³ç”¢ç”ŸåŒ…å«æ‰€æœ‰ç¨‹åº¦çš„å®Œæ•´å­¸ç¿’å…§å®¹"]})]})]})]})},Cs=s=>`
    <div class="tabs">
      <button class="tab-btn active" data-tab-target="easy-quiz-content" data-difficulty="easy">ç°¡å–®</button>
      <button class="tab-btn" data-tab-target="normal-quiz-content" data-difficulty="normal">æ™®é€š</button>
      <button class="tab-btn" data-tab-target="hard-quiz-content" data-difficulty="hard">å›°é›£</button>
    </div>
    <div id="easy-quiz-content" class="tab-content active">
      <!-- Content rendered by JS -->
      <div class="quiz-items-container" data-difficulty="easy"></div>
    </div>
    <div id="normal-quiz-content" class="tab-content">
      <!-- Content rendered by JS -->
      <div class="quiz-items-container" data-difficulty="normal"></div>
    </div>
    <div id="hard-quiz-content" class="tab-content">
      <!-- Content rendered by JS -->
      <div class="quiz-items-container" data-difficulty="hard"></div>
    </div>
    <script type="application/json" id="quizDataStore">
      ${s}
    <\/script>
  `,Ls=(s,t)=>{const i=s.learningObjectives&&s.learningObjectives.length>0?s.learningObjectives.map(o=>`
        <div class="objective-item" style="margin-bottom:20px; padding:16px; background:#f0fdf4; border-left:4px solid #10b981; border-radius:6px;">
          <h3 style="color:#059669; margin-bottom:8px; font-size:1.1em; font-weight:600;">${o.objective}</h3>
          <p style="color:#047857; margin-bottom:8px; line-height:1.6;">${o.description}</p>
          ${o.teachingExample?`
            <div style="background:#ecfdf5; border:1px solid #a7f3d0; padding:12px; border-radius:4px; margin-top:8px;">
              <strong style="color:#065f46; font-size:0.85em; display:block; margin-bottom:4px;">æ•™å­¸ç¤ºä¾‹</strong>
              <span style="color:#047857; font-size:0.9em;">${o.teachingExample}</span>
            </div>`:""}
        </div>`).join(""):"<p>æ²’æœ‰æä¾›æ•™å­¸ç›®æ¨™ã€‚</p>",l=s.contentBreakdown&&s.contentBreakdown.length>0?s.contentBreakdown.map(o=>`
        <div class="breakdown-item" style="margin-bottom:24px; padding-bottom:20px; border-bottom:1px solid #e2e8f0;">
          <h3 style="color:#0369a1; margin-bottom:8px;">${o.topic}</h3>
          <p style="margin-bottom:12px; color:#475569;">${o.details}</p>
          
          ${o.coreConcept?`
            <div style="background:#eff6ff; border-left:4px solid #3b82f6; padding:12px; border-radius:4px; margin-bottom:12px;">
              <strong style="color:#1e40af; font-size:0.85em; display:block; margin-bottom:4px;">æ ¸å¿ƒæ¦‚å¿µ</strong>
              <span style="color:#1e3a8a; font-size:0.9em;">${o.coreConcept}</span>
            </div>`:""}
          
          ${o.teachingSentences&&o.teachingSentences.length>0?`
            <div style="background:#eef2ff; border-left:4px solid #6366f1; padding:12px; border-radius:4px; margin-bottom:12px;">
              <strong style="color:#4338ca; font-size:0.85em; display:block; margin-bottom:8px;">æ•™å­¸ä¾‹å¥</strong>
              <div style="line-height:1.6;">
                ${o.teachingSentences.map((n,u)=>`
                  <div style="color:#312e81; font-size:0.9em; margin-bottom:4px;">
                    <span style="color:#6366f1; font-family:monospace;">${u+1}.</span> ${n}
                  </div>
                `).join("")}
              </div>
            </div>`:""}
          
          ${o.teachingTips?`
            <div style="background:#faf5ff; border-left:4px solid #8b5cf6; padding:12px; border-radius:4px; margin-bottom:12px;">
              <strong style="color:#7c3aed; font-size:0.85em; display:block; margin-bottom:4px;">æ•™å­¸è¦é»æç¤º</strong>
              <span style="color:#6b21a8; font-size:0.9em;">${o.teachingTips}</span>
            </div>`:""}
          
          ${o.teachingExample?`
            <div style="background:#f0f9ff; border-left:4px solid #0ea5e9; padding:12px; border-radius:4px;">
              <strong style="color:#0284c7; font-size:0.85em; display:block; margin-bottom:4px;">æ•™å­¸ç¤ºä¾‹</strong>
              <span style="color:#0c4a6e; font-size:0.9em;">${o.teachingExample}</span>
            </div>`:""}
        </div>`).join(""):"<p>æ²’æœ‰æä¾›å…§å®¹åˆ†è§£ã€‚</p>",a=s.confusingPoints&&s.confusingPoints.length>0?s.confusingPoints.map(o=>`
        <div class="confusing-point-item" style="border:1px solid #e2e8f0; border-radius:8px; padding:20px; margin-bottom:24px; background:#fefefe;">
          <h3 style="color:#b91c1c; margin-bottom:12px; font-size:1.3em; font-weight:600;">${o.point}</h3>
          <p style="margin-bottom:16px; color:#475569; line-height:1.6;">${o.clarification}</p>
          
          ${o.errorType?`
          <div style="background:#fff7ed; border-left:4px solid #f97316; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#c2410c; font-size:0.8em; display:block; margin-bottom:4px;">èª¤å€é¡å‹</strong>
            <span style="color:#9a3412; font-size:0.9em;">${o.errorType}</span>
          </div>`:""}
          
          ${o.commonErrors&&o.commonErrors.length>0?`
          <div style="background:#fef2f2; border-left:4px solid #ef4444; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#dc2626; font-size:0.8em; display:block; margin-bottom:8px;">å¸¸è¦‹éŒ¯èª¤ç¤ºä¾‹</strong>
            <div style="margin-left:0;">
              ${o.commonErrors.map((n,u)=>`
                <div style="color:#991b1b; font-size:0.9em; margin-bottom:4px;">
                  <span style="color:#dc2626; font-family:monospace; margin-right:6px;">${u+1}.</span>${n}
                </div>
              `).join("")}
            </div>
          </div>`:""}
          
          ${o.correctVsWrong&&o.correctVsWrong.length>0?`
          <div style="background:#fefce8; border-left:4px solid #eab308; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#a16207; font-size:0.8em; display:block; margin-bottom:8px;">æ­£ç¢ºèˆ‡éŒ¯èª¤å°æ¯”</strong>
            ${o.correctVsWrong.map((n,u)=>`
              <div style="border:1px solid #fde047; background:#fffbeb; padding:12px; margin-bottom:8px; border-radius:6px;">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:8px;">
                  <div style="background:#f0fdf4; padding:10px; border-radius:4px; border:1px solid #bbf7d0;">
                    <strong style="color:#166534; font-size:0.8em; display:block; margin-bottom:4px;">âœ“ æ­£ç¢º</strong>
                    <span style="color:#15803d; font-size:0.9em;">${n.correct}</span>
                  </div>
                  <div style="background:#fef2f2; padding:10px; border-radius:4px; border:1px solid #fecaca;">
                    <strong style="color:#dc2626; font-size:0.8em; display:block; margin-bottom:4px;">âœ— éŒ¯èª¤</strong>
                    <span style="color:#991b1b; font-size:0.9em;">${n.wrong}</span>
                  </div>
                </div>
                <div style="background:#eff6ff; padding:10px; border-radius:4px; border:1px solid #bfdbfe;">
                  <strong style="color:#1d4ed8; font-size:0.8em; display:block; margin-bottom:4px;">èªªæ˜</strong>
                  <span style="color:#1e40af; font-size:0.9em;">${n.explanation}</span>
                </div>
              </div>
            `).join("")}
          </div>`:""}
          
          ${o.preventionStrategy?`
          <div style="background:#eff6ff; border-left:4px solid #3b82f6; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#1d4ed8; font-size:0.8em; display:block; margin-bottom:4px;">é é˜²ç­–ç•¥</strong>
            <span style="color:#1e40af; font-size:0.9em;">${o.preventionStrategy}</span>
          </div>`:""}
          
          ${o.correctionMethod?`
          <div style="background:#faf5ff; border-left:4px solid #a855f7; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#7c3aed; font-size:0.8em; display:block; margin-bottom:4px;">ç³¾æ­£æ–¹æ³•</strong>
            <span style="color:#6b21a8; font-size:0.9em;">${o.correctionMethod}</span>
          </div>`:""}
          
          ${o.practiceActivities&&o.practiceActivities.length>0?`
          <div style="background:#f0f9ff; border-left:4px solid #6366f1; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#4338ca; font-size:0.8em; display:block; margin-bottom:8px;">ç·´ç¿’å»ºè­°</strong>
            <div style="margin-left:0;">
              ${o.practiceActivities.map((n,u)=>`
                <div style="color:#312e81; font-size:0.9em; margin-bottom:4px;">
                  <span style="color:#4338ca; font-family:monospace; margin-right:6px;">${u+1}.</span>${n}
                </div>
              `).join("")}
            </div>
          </div>`:""}
          
          ${o.teachingExample?`
          <div style="background:#f9fafb; border-left:4px solid #6b7280; padding:12px; border-radius:4px;">
            <strong style="color:#374151; font-size:0.8em; display:block; margin-bottom:4px;">æ•™å­¸ç¤ºä¾‹</strong>
            <span style="color:#111827; font-size:0.9em;">${o.teachingExample}</span>
          </div>`:""}
        </div>`).join(""):"<p>æ²’æœ‰æä¾›æ˜“æ··æ·†é»ã€‚</p>",m=s.classroomActivities&&s.classroomActivities.length>0?s.classroomActivities.map(o=>`
        <div class="activity-item" style="border:1px solid #e0e7ef; border-radius:6px; padding:16px; margin-bottom:16px; background:#f8fafc;">
          <h3 style="color:#2563eb; margin-bottom:8px; font-size:1.2em;">${o.title}</h3>
          <p style="margin-bottom:12px; color:#475569;">${o.description}</p>
          
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px;">
            ${o.objective?`
              <div>
                <strong style="color:#0f172a;">å­¸ç¿’ç›®æ¨™ï¼š</strong>
                <p style="margin:4px 0 0 0; font-size:0.9em;">${o.objective}</p>
              </div>`:""}
            ${o.timing?`
              <div>
                <strong style="color:#0f172a;">ä½¿ç”¨æ™‚æ©Ÿï¼š</strong>
                <p style="margin:4px 0 0 0; font-size:0.9em;">${o.timing}</p>
              </div>`:""}
            ${o.materials?`
            <div>
              <strong style="color:#0f172a;">æ‰€éœ€æ•™å…·ï¼š</strong>
              <p style="margin:4px 0 0 0; font-size:0.9em;">${o.materials}</p>
            </div>`:""}
            ${o.environment?`
            <div>
              <strong style="color:#0f172a;">ç’°å¢ƒè¦æ±‚ï¼š</strong>
              <p style="margin:4px 0 0 0; font-size:0.9em;">${o.environment}</p>
            </div>`:""}
          </div>
          
          ${o.steps&&o.steps.length>0?`
            <div style="margin-bottom:12px;">
              <strong style="color:#0f172a;">æ´»å‹•æ­¥é©Ÿï¼š</strong>
              <ol style="margin:8px 0 0 20px; padding:0;">
                ${o.steps.map(n=>`<li style="margin-bottom:4px; font-size:0.9em;">${n}</li>`).join("")}
              </ol>
            </div>`:""}
          
          ${o.assessmentPoints&&o.assessmentPoints.length>0?`
            <div>
              <strong style="color:#0f172a;">è©•ä¼°é‡é»ï¼š</strong>
              <ul style="margin:8px 0 0 20px; padding:0;">
                ${o.assessmentPoints.map(n=>`<li style="margin-bottom:4px; font-size:0.9em;">${n}</li>`).join("")}
              </ul>
            </div>`:""}
        </div>
      `).join(""):"<p>æ²’æœ‰æä¾›èª²å ‚æ´»å‹•ã€‚</p>",c=s.englishConversation&&s.englishConversation.length>0?s.englishConversation.map(o=>`
        <div class="dialogue-line ${o.speaker==="Speaker A"?"speakerA":"speakerB"}">
          <span class="speaker">${o.speaker}:</span> ${o.line}
        </div>`).join("")+"<p><small><em>æ³¨æ„ï¼šäº’å‹•å¼èªéŸ³æœ—è®€å’Œç·´ç¿’åŠŸèƒ½åƒ…åœ¨ç·šä¸Šæ‡‰ç”¨ç¨‹å¼ä¸­æä¾›ã€‚</em></small></p>":"<p>æ²’æœ‰æä¾›è‹±æ–‡å°è©±å…§å®¹ã€‚</p>",x=s.learningLevels&&s.learningLevels.suggestedLevels&&s.learningLevels.suggestedLevels.length>0?s.learningLevels.suggestedLevels.sort((o,n)=>o.order-n.order).map(o=>`
          <div class="level-item" style="border:1px solid #e0e7ef; border-radius:8px; padding:16px; margin-bottom:12px; background:${o.id===s.learningLevels?.defaultLevelId?"#eff8ff":"#f8fafc"}; border-left: 4px solid ${o.id===s.learningLevels?.defaultLevelId?"#0ea5e9":"#e2e8f0"};">
            <div style="display:flex; align-items:center; margin-bottom:8px;">
              <div style="width:32px; height:32px; border-radius:50%; background-color:${o.id===s.learningLevels?.defaultLevelId?"#0ea5e9":"#94a3b8"}; color:white; display:flex; align-items:center; justify-content:center; font-weight:bold; margin-right:12px;">${o.order}</div>
              <h3 style="margin:0; color:${o.id===s.learningLevels?.defaultLevelId?"#0c4a6e":"#334155"};">${o.name}</h3>
              ${o.id===s.learningLevels?.defaultLevelId?'<span style="background:#dcfce7; color:#166534; padding:2px 8px; border-radius:4px; font-size:0.8em; margin-left:8px;">é è¨­</span>':""}
            </div>
            <p style="margin:0; color:#64748b; line-height:1.5;">${o.description}</p>
          </div>
        `).join(""):"<p>æ²’æœ‰æä¾›å­¸ç¿’ç¨‹åº¦å»ºè­°ã€‚</p>",g=JSON.stringify(s.onlineInteractiveQuiz||{}),d=Cs(g),f=`
    <!DOCTYPE html>
    <html lang="zh-Hant">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>å­¸ç¿’è¨ˆç•«ï¼š${t}</title>
      <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; margin: 0; padding: 20px; line-height: 1.6; background-color: #f4f7f9; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #3498db; margin-top: 30px; border-bottom: 1px solid #eee; padding-bottom: 8px;}
        h3 { color: #2980b9; margin-top: 20px; }
        h4 { color: #16a085; margin-top:15px; font-size: 1.1em; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed #bdc3c7;}
        ul { list-style-type: disc; padding-left: 20px; }
        li { margin-bottom: 8px; }
        p { margin-bottom: 10px; }
        .section { margin-bottom: 25px; }
        .breakdown-item, .confusing-point-item { border-left: 3px solid #3498db; padding-left: 15px; margin-bottom: 15px; background-color: #fdfdfe; padding:10px; border-radius: 0 4px 4px 0;}
        .dialogue-line { margin-bottom: 8px; padding: 10px; border-radius: 5px; }
        .dialogue-line .speaker { font-weight: bold; color: #0056b3; }
        .dialogue-line.speakerA { background-color: #e7f3ff; border-left: 3px solid #79a6dc; }
        .dialogue-line.speakerB { background-color: #e6fff0; border-left: 3px solid #68d19a; }
        
        .tabs { display: flex; margin-bottom: 0; border-bottom: 1px solid #ccc;}
        .tabs button { padding: 10px 15px; cursor: pointer; border: 1px solid #ccc; background-color: #f0f0f0; margin-right: 0px; border-bottom: none; border-radius: 5px 5px 0 0; font-size: 1em;}
        .tabs button.active { background-color: #fff; border-bottom: 1px solid #fff; color: #3498db; font-weight: bold; position:relative; top:1px;}
        .tab-content { display: none; padding: 15px; border: 1px solid #ccc; border-top: none; background-color:#fff; border-radius: 0 0 5px 5px;}
        .tab-content.active { display: block; }

        .quiz-item { border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 15px; border-radius: 5px; background: #f9f9f9; }
        .quiz-question { font-weight: 500; margin-bottom: 8px; color: #333; }
        .quiz-item p:first-child { margin-top: 0; }
        .quiz-feedback { padding: 8px; margin-top: 10px; border-radius: 4px; font-size: 0.9em; }
        .quiz-feedback.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .quiz-feedback.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .quiz-feedback em { color: #555;}
        
        .tf-options button { margin-right: 10px; padding: 8px 12px; border-radius: 4px; border: 1px solid #ccc; cursor: pointer; }
        .tf-options button.selected.correct, .tf-options button.correct { background-color: #28a745; color: white; border-color: #28a745; }
        .tf-options button.selected.incorrect, .tf-options button.incorrect { background-color: #dc3545; color: white; border-color: #dc3545; }
        .tf-options button:disabled { opacity: 0.7; cursor: not-allowed; }

        .mc-options label { display: block; margin-bottom: 8px; padding: 8px; border: 1px solid #eee; border-radius: 4px; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; }
        .mc-options label:hover { background-color: #f0f8ff; }
        .mc-options input[type="radio"] { margin-right: 8px; }
        .mc-options label.selected { background-color: #e0f0ff; border-color: #79a6dc; }
        .mc-options label.correct-answer { background-color: #d4edda !important; border-color: #c3e6cb !important; color: #155724;}
        .mc-options label.incorrect-selection { background-color: #f8d7da !important; border-color: #f5c6cb !important; color: #721c24;}
        .mc-options label.disabled { cursor: not-allowed; opacity: 0.7; }


        .fb-input { padding: 6px; border: 1px solid #ccc; border-radius: 4px; margin: 0 5px; min-width:100px; }
        .fb-input:disabled { background-color: #eee; }

        .ss-word-bank, .ss-constructed-sentence-area { display: flex; flex-wrap: wrap; gap: 8px; padding: 10px; border: 1px dashed #ccc; border-radius: 4px; min-height: 40px; margin-bottom: 10px; }
        .ss-word-bank { background-color: #f0f8ff; }
        .ss-constructed-sentence-area { background-color: #e6fff0; }
        .ss-word-bank button, .ss-constructed-sentence-area button { padding: 5px 10px; background-color: #add8e6; border: none; border-radius: 4px; cursor: pointer; font-size: 0.95em;}
        .ss-word-bank button:hover, .ss-constructed-sentence-area button:hover { background-color: #90cce0; }
        .ss-constructed-sentence-area button { background-color: #a2d2ff; }


        .quiz-item button.check-answer-btn, .quiz-item button.ss-action-btn {
          background-color: #3498db; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em; margin-top: 10px; transition: background-color 0.2s;
        }
        .quiz-item button.check-answer-btn:hover, .quiz-item button.ss-action-btn:hover { background-color: #2980b9; }
        .quiz-item button.ss-action-btn.ss-clear { background-color: #e74c3c; margin-left: 5px;}
        .quiz-item button.ss-action-btn.ss-clear:hover { background-color: #c0392b; }
        .quiz-item button:disabled, .quiz-item button.check-answer-btn:disabled, .quiz-item button.ss-action-btn:disabled { background-color: #bdc3c7; cursor: not-allowed; opacity: 0.7;}
        
        footer { text-align: center; margin-top: 30px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 0.9em; color: #777; }
      </style>
    </head>
    <body>
      <div class="container">
        <h1>å­¸ç¿’è¨ˆç•«ï¼š${t}</h1>

        <div class="section">
          <h2>å­¸ç¿’ç¨‹åº¦å»ºè­°</h2>
          ${x}
        </div>

        <div class="section">
          <h2>æ•™å­¸ç›®æ¨™è¨­å®š</h2>
          ${i}
        </div>

        <div class="section">
          <h2>åˆ†è§£å­¸ç¿’å…§å®¹</h2>
          ${l}
        </div>

        <div class="section">
          <h2>æ˜“æ··æ·†é»è­˜åˆ¥</h2>
          ${a}
        </div>

        <div class="section">
          <h2>èª²å ‚æ´»å‹•èˆ‡éŠæˆ²è¨­è¨ˆ</h2>
          ${m}
        </div>
        
        <div class="section">
          <h2>è‹±æ–‡å°è©±ç·´ç¿’</h2>
          ${c}
        </div>

        <div class="section">
          <h2>ç·šä¸Šäº’å‹•æ¸¬é©—</h2>
          ${d}
        </div>
        
        <footer>
          <p>æ­¤å­¸ç¿’è¨ˆç•«ç”± AI ç”¢ç”Ÿã€‚åŒ¯å‡ºæ™‚é–“ï¼š${new Date().toLocaleString()}</p>
        </footer>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const quizData = JSON.parse(document.getElementById('quizDataStore').textContent || '{}');
          let sentenceScrambleStates = {}; // To store dynamic state for sentence scramble

          const normalizeText = (str) => {
            if (typeof str !== 'string') return '';
            // Corrected regex for multiple spaces: \\s+ instead of \\s+
            return str.toLowerCase().replace(/[.,!?;:'"â€˜'""]/g, '').replace(/\\s+/g, ' ').trim();
          };

          const renderQuizzesForDifficulty = (difficulty) => {
            const container = document.querySelector(\`.quiz-items-container[data-difficulty="\${difficulty}"]\`);
            if (!container) return;
            container.innerHTML = ''; 
            sentenceScrambleStates[difficulty] = {}; // Reset states for this difficulty

            const difficultyData = quizData[difficulty];
            if (!difficultyData || Object.keys(difficultyData).every(type => !difficultyData[type] || difficultyData[type].length === 0)) {
              container.innerHTML = '<p>æ­¤é›£åº¦æ²’æœ‰æ¸¬é©—è³‡æ–™ã€‚</p>';
              return;
            }

            let itemGlobalIndex = 0;
            const typeLabels = { trueFalse: "æ˜¯éé¡Œ", multipleChoice: "é¸æ“‡é¡Œ", fillInTheBlanks: "å¡«ç©ºé¡Œ", sentenceScramble: "å¥å­é‡çµ„"};

            const createHtml = (type, q, index) => {
              const questionId = \`\${difficulty}-\${type}-\${index}\`;
              let itemHtml = \`<div class="quiz-item \${type}-item" id="item-\${questionId}">\`;
              
              if (type === 'trueFalse') {
                itemHtml += \`<p class="quiz-question">\${itemGlobalIndex + 1}. \${q.statement}</p>\`;
                itemHtml += \`<div class="tf-options">\`;
                itemHtml += \`<button data-value="true" data-question-id="\${questionId}">æ˜¯ (True)</button>\`;
                itemHtml += \`<button data-value="false" data-question-id="\${questionId}">é (False)</button>\`;
                itemHtml += \`</div>\`;
              } else if (type === 'multipleChoice') {
                itemHtml += \`<p class="quiz-question">\${itemGlobalIndex + 1}. \${q.question}</p>\`;
                itemHtml += \`<div class="mc-options">\`;
                q.options.forEach((opt, optIndex) => {
                  itemHtml += \`<label><input type="radio" name="mc-\${questionId}" value="\${optIndex}"> \${String.fromCharCode(65 + optIndex)}. \${opt}</label>\`;
                });
                itemHtml += \`</div>\`;
                itemHtml += \`<button class="check-answer-btn mc-check" data-question-id="\${questionId}">æª¢æŸ¥ç­”æ¡ˆ</button>\`;
              } else if (type === 'fillInTheBlanks') {
                itemHtml += \`<p class="quiz-question">\${itemGlobalIndex + 1}. \${q.sentenceWithBlank.replace('____', '<input type="text" class="fb-input" id="fb-input-\${questionId}" placeholder="ç­”æ¡ˆ">')}</p>\`;
                itemHtml += \`<button class="check-answer-btn fb-check" data-question-id="\${questionId}">æª¢æŸ¥ç­”æ¡ˆ</button>\`;
              } else if (type === 'sentenceScramble') {
                sentenceScrambleStates[difficulty][questionId] = {
                    availableWords: q.scrambledWords.slice().sort(() => Math.random() - 0.5),
                    constructedWords: []
                };
                itemHtml += \`<p class="quiz-question">\${itemGlobalIndex + 1}. è«‹é‡çµ„ä»¥ä¸‹è©å½™ä¾†å½¢æˆä¸€å€‹æ­£ç¢ºçš„å¥å­ï¼š</p>\`;
                itemHtml += \`<p class="ss-instruction">é»æ“Šä¸‹æ–¹è©å½™å°‡å…¶åŠ å…¥æ‚¨çš„å¥å­ï¼Œæˆ–é»æ“Šæ‚¨å¥å­ä¸­çš„è©å½™å°‡å…¶ç§»å›è©å½™åº«ã€‚</p>\`
                itemHtml += \`<div class="ss-word-bank" id="ss-bank-\${questionId}">\`;
                sentenceScrambleStates[difficulty][questionId].availableWords.forEach(word => {
                   itemHtml += \`<button class="ss-word" data-word="\${word}" data-question-id="\${questionId}" data-source="bank">\${word}</button>\`;
                });
                itemHtml += \`</div>\`;
                itemHtml += \`<p class="quiz-question">æ‚¨çš„å¥å­ï¼š</p><div class="ss-constructed-sentence-area" id="ss-area-\${questionId}"></div>\`;
                itemHtml += \`<button class="check-answer-btn ss-check" data-question-id="\${questionId}">æª¢æŸ¥å¥å­</button>\`;
                itemHtml += \`<button class="ss-action-btn ss-clear" data-question-id="\${questionId}">æ¸…é™¤</button>\`;
              }
              itemHtml += \`<div class="quiz-feedback" id="feedback-\${questionId}"></div></div>\`;
              itemGlobalIndex++;
              return itemHtml;
            };
            
            const quizTypes = ['trueFalse', 'multipleChoice', 'fillInTheBlanks', 'sentenceScramble'];
            let hasContentForDifficulty = false;

            quizTypes.forEach(type => {
              if (difficultyData[type] && difficultyData[type].length > 0) {
                hasContentForDifficulty = true;
                const typeHeader = document.createElement('h4');
                typeHeader.textContent = typeLabels[type];
                container.appendChild(typeHeader);
                difficultyData[type].forEach((q, i) => {
                  const questionElement = document.createElement('div');
                  questionElement.innerHTML = createHtml(type, q, i);
                  container.appendChild(questionElement.firstChild);
                });
              }
            });
             if (!hasContentForDifficulty) {
                 container.innerHTML = '<p>æ­¤é›£åº¦æ²’æœ‰å¯ç”¨çš„æ¸¬é©—é¡Œç›®ã€‚</p>';
            }
          };

          const tabButtons = document.querySelectorAll('.tabs .tab-btn');
          const tabContents = document.querySelectorAll('.tab-content');

          tabButtons.forEach(button => {
            button.addEventListener('click', () => {
              tabButtons.forEach(btn => btn.classList.remove('active'));
              tabContents.forEach(content => content.classList.remove('active'));

              button.classList.add('active');
              const targetContentId = button.getAttribute('data-tab-target');
              document.getElementById(targetContentId).classList.add('active');
              
              const difficulty = button.getAttribute('data-difficulty');
              renderQuizzesForDifficulty(difficulty);
            });
          });
          
          // Initial render for the default active tab
          renderQuizzesForDifficulty('easy');


          // Event delegation for quiz interactions
          document.querySelector('.container').addEventListener('click', (event) => {
            const target = event.target;
            // Ensure target is an HTMLElement before trying to access attributes or match selectors
            if (!(target instanceof HTMLElement)) return;

            const questionId = target.getAttribute('data-question-id');
            if (!questionId) return;

            const [difficulty, type, indexStr] = questionId.split('-');
            const index = parseInt(indexStr);
            const questionData = quizData[difficulty]?.[type]?.[index];
            const feedbackEl = document.getElementById(\`feedback-\${questionId}\`);

            if (!questionData || !feedbackEl) return;

            // True/False
            if (target.matches('.tf-options button')) {
              const selectedValue = target.getAttribute('data-value') === 'true';
              const isCorrect = selectedValue === questionData.isTrue;
              feedbackEl.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
              let message = isCorrect ? 'ç­”å°äº†ï¼' : \`ç­”éŒ¯äº†ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š\${questionData.isTrue ? 'æ˜¯ (True)' : 'é (False)'}\`;
              if (questionData.explanation) message += \` <em>\${questionData.explanation}</em>\`;
              feedbackEl.innerHTML = message;
              
              target.classList.add('selected', isCorrect ? 'correct' : 'incorrect');
              Array.from(target.parentElement.children).forEach(btn => btn.disabled = true);
            }

            // Multiple Choice Check
            else if (target.matches('.mc-check')) {
              const selectedRadio = document.querySelector(\`input[name="mc-\${questionId}"]:checked\`);
              if (!selectedRadio) {
                feedbackEl.className = 'quiz-feedback incorrect';
                feedbackEl.textContent = 'è«‹é¸æ“‡ä¸€å€‹é¸é …ã€‚';
                return;
              }
              const selectedOptionIndex = parseInt(selectedRadio.value);
              const isCorrect = selectedOptionIndex === questionData.correctAnswerIndex;
              
              feedbackEl.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
              let message = isCorrect ? 'ç­”å°äº†ï¼' : \`ç­”éŒ¯äº†ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š\${String.fromCharCode(65 + questionData.correctAnswerIndex)}. \${questionData.options[questionData.correctAnswerIndex]}\`;
              feedbackEl.innerHTML = message;

              // Visually mark options
              const optionLabels = document.querySelectorAll(\`#item-\${questionId} .mc-options label\`);
              optionLabels.forEach((label, idx) => {
                label.classList.add('disabled');
                const radioInLabel = label.querySelector('input');
                if (radioInLabel) radioInLabel.disabled = true;

                if (idx === questionData.correctAnswerIndex) {
                    label.classList.add('correct-answer');
                }
                if (idx === selectedOptionIndex && !isCorrect) {
                    label.classList.add('incorrect-selection');
                }
                 if (idx === selectedOptionIndex) {
                    label.classList.add('selected');
                }
              });
              target.disabled = true;
            }

            // Fill in the Blanks Check
            else if (target.matches('.fb-check')) {
              const inputEl = document.getElementById(\`fb-input-\${questionId}\`);
              // Add null check for inputEl
              if (!inputEl) {
                  console.error('Fill-in-the-blanks input element not found for ID:', \`fb-input-\${questionId}\`);
                  feedbackEl.className = 'quiz-feedback incorrect';
                  feedbackEl.textContent = 'ç™¼ç”ŸéŒ¯èª¤ï¼šæ‰¾ä¸åˆ°è¼¸å…¥æ¬„ä½ã€‚';
                  return;
              }
              const userAnswer = inputEl.value.trim();
              if (userAnswer === '') {
                feedbackEl.className = 'quiz-feedback incorrect';
                feedbackEl.textContent = 'è«‹è¼¸å…¥ç­”æ¡ˆã€‚';
                return;
              }
              const isCorrect = normalizeText(userAnswer) === normalizeText(questionData.correctAnswer);
              feedbackEl.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
              feedbackEl.textContent = isCorrect ? 'ç­”å°äº†ï¼' : \`ç­”éŒ¯äº†ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š "\${questionData.correctAnswer}"\`;
              inputEl.disabled = true;
              target.disabled = true;
            }
            
            // Sentence Scramble
            else if (target.matches('.ss-word') || target.matches('.ss-check') || target.matches('.ss-clear')) {
                const state = sentenceScrambleStates[difficulty][questionId];
                if (!state) return; // Should not happen if initialized correctly

                const bankEl = document.getElementById(\`ss-bank-\${questionId}\`);
                const areaEl = document.getElementById(\`ss-area-\${questionId}\`);
                
                if(!bankEl || !areaEl) return;


                const redrawScramble = () => {
                    bankEl.innerHTML = '';
                    state.availableWords.forEach(w => {
                        bankEl.innerHTML += \`<button class="ss-word" data-word="\${w}" data-question-id="\${questionId}" data-source="bank">\${w}</button>\`;
                    });
                    areaEl.innerHTML = '';
                    state.constructedWords.forEach(w => {
                        areaEl.innerHTML += \`<button class="ss-word" data-word="\${w}" data-question-id="\${questionId}" data-source="area">\${w}</button>\`;
                    });
                };

                if (target.matches('.ss-word')) {
                    const word = target.getAttribute('data-word');
                    const source = target.getAttribute('data-source');
                    if (source === 'bank') {
                        state.constructedWords.push(word);
                        // Correctly remove only one instance of the word from availableWords
                        const wordIndexInBank = state.availableWords.indexOf(word);
                        if (wordIndexInBank > -1) {
                            state.availableWords.splice(wordIndexInBank, 1);
                        }
                    } else { // source === 'area'
                        state.availableWords.push(word);
                        // Correctly remove only one instance of the word from constructedWords
                        const wordIndexInArea = state.constructedWords.indexOf(word);
                        if (wordIndexInArea > -1) {
                            state.constructedWords.splice(wordIndexInArea, 1);
                        }
                    }
                    redrawScramble();
                    feedbackEl.textContent = '';
                    feedbackEl.className = 'quiz-feedback';
                } else if (target.matches('.ss-check')) {
                    const userAnswer = state.constructedWords.join(' ').trim();
                    const isCorrect = normalizeText(userAnswer) === normalizeText(questionData.originalSentence);
                    feedbackEl.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
                    feedbackEl.textContent = isCorrect ? 'ç­”å°äº†ï¼' : \`ç­”éŒ¯äº†ã€‚æ­£ç¢ºå¥å­æ˜¯ï¼š "\${questionData.originalSentence}"\`;
                    target.disabled = true;
                    const clearButton = document.querySelector(\`#item-\${questionId} .ss-clear\`);
                    if(clearButton) clearButton.disabled = true;
                    
                    bankEl.querySelectorAll('button').forEach(b => b.disabled = true);
                    areaEl.querySelectorAll('button').forEach(b => b.disabled = true);

                } else if (target.matches('.ss-clear')) {
                    state.availableWords = questionData.scrambledWords.slice().sort(() => Math.random() - 0.5);
                    state.constructedWords = [];
                    redrawScramble();
                    feedbackEl.textContent = '';
                    feedbackEl.className = 'quiz-feedback';
                }
            }

          });
        });
      <\/script>
    </body>
    </html>
  `,b=new Blob([f],{type:"text/html;charset=utf-8"}),j=URL.createObjectURL(b),r=document.createElement("a");r.href=j,r.download=`learning-plan-${t.replace(/\s+/g,"_")||"untitled"}.html`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(j)},Is=A.memo(({tabs:s,current:t,onChange:i,children:l})=>e.jsxs("div",{children:[e.jsx("div",{className:"flex border-b mb-4",children:s.map(a=>e.jsx("button",{className:`px-4 py-2 -mb-px border-b-2 font-medium transition-colors focus:outline-none ${t===a.key?"border-indigo-600 text-indigo-700 bg-white":"border-transparent text-slate-500 hover:text-indigo-600"}`,onClick:()=>i(a.key),type:"button",children:a.label},a.key))}),e.jsx("div",{children:l[s.findIndex(a=>a.key===t)]})]})),ae=({url:s,title:t="QR Code",size:i=256,className:l="",showDownload:a=!0,onError:m})=>{const[c,x]=h.useState(""),[g,d]=h.useState(!0),[f,b]=h.useState(null),j=h.useRef(null);h.useEffect(()=>{s&&(async()=>{try{d(!0),b(null);const u={width:i,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M"},y=await je.toDataURL(s,u);x(y),j.current&&await je.toCanvas(j.current,s,u)}catch(u){const y=u instanceof Error?u.message:"QR Code ç”Ÿæˆå¤±æ•—";b(y),m?.(y)}finally{d(!1)}})()},[s,i,m]);const r=()=>{if(j.current)try{const n=document.createElement("a");n.download=`qrcode-${Date.now()}.png`,n.href=j.current.toDataURL(),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(n){console.error("ä¸‹è¼‰ QR Code å¤±æ•—:",n)}},o=async()=>{if(j.current)try{j.current.toBlob(async n=>{if(n&&navigator.clipboard)try{await navigator.clipboard.write([new ClipboardItem({"image/png":n})]),alert("QR Code å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼")}catch(u){console.error("è¤‡è£½åœ–ç‰‡å¤±æ•—:",u),alert("è¤‡è£½åœ–ç‰‡å¤±æ•—ï¼Œè«‹ä½¿ç”¨ä¸‹è¼‰åŠŸèƒ½ã€‚")}})}catch(n){console.error("è¤‡è£½ QR Code å¤±æ•—:",n)}};return g?e.jsxs("div",{className:`flex flex-col items-center p-4 ${l}`,children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ç”Ÿæˆ QR Code ä¸­..."})]}):f?e.jsxs("div",{className:`flex flex-col items-center p-4 text-red-600 ${l}`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 mb-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),e.jsx("p",{className:"text-sm text-center",children:f})]}):e.jsxs("div",{className:`flex flex-col items-center ${l}`,children:[t&&e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3 text-center",children:t}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-md border",children:e.jsx("img",{src:c,alt:`QR Code for ${t}`,className:"block",style:{width:i,height:i}})}),e.jsx("canvas",{ref:j,style:{display:"none"},width:i,height:i}),e.jsx("div",{className:"mt-3 max-w-xs w-full",children:e.jsx("p",{className:"text-xs text-gray-500 text-center break-all",children:s})}),a&&e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"ä¸‹è¼‰"]}),e.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"})}),"è¤‡è£½"]})]})]})},Z=A.memo(({title:s,icon:t,children:i,className:l})=>e.jsxs("div",{className:`bg-white shadow-lg rounded-xl p-6 mb-6 ${l||""}`,children:[e.jsxs("h2",{className:"text-2xl font-semibold text-sky-700 mb-4 flex items-center",children:[t&&e.jsx("span",{className:"mr-3 text-sky-600",children:t}),s]}),e.jsx("div",{className:"text-slate-700 space-y-3",children:i})]})),Ps=({objectives:s})=>e.jsx(Z,{title:"æ•™å­¸ç›®æ¨™è¨­å®š",icon:e.jsx(re,{className:"w-7 h-7"}),children:s&&s.length>0?s.map((t,i)=>e.jsxs("div",{className:"mb-4 pb-4 border-b border-slate-200 last:border-b-0 last:pb-0",children:[e.jsx("h4",{className:"font-semibold text-lg text-green-800 mb-1",children:t.objective}),e.jsx("p",{className:"text-slate-700 mb-2",children:t.description}),t.teachingExample&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-400 p-3 rounded-md mt-2",children:[e.jsx("span",{className:"block text-xs font-semibold text-green-700 mb-1",children:"æ•™å­¸ç¤ºä¾‹"}),e.jsx("span",{className:"text-green-900 text-sm",children:t.teachingExample})]})]},i)):e.jsx("p",{children:"æ²’æœ‰æä¾›æ•™å­¸ç›®æ¨™ã€‚"})}),As=({breakdown:s})=>e.jsx(Z,{title:"åˆ†è§£å­¸ç¿’å…§å®¹",icon:e.jsx(le,{className:"w-7 h-7"}),children:s&&s.length>0?s.map((t,i)=>e.jsxs("div",{className:"mb-6 pb-6 border-b border-slate-200 last:border-b-0 last:pb-0",children:[e.jsx("h4",{className:"font-semibold text-lg text-sky-800 mb-1",children:t.topic}),e.jsx("p",{className:"text-slate-700 mb-3",children:t.details}),t.coreConcept&&e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-blue-700 mb-1",children:"æ ¸å¿ƒæ¦‚å¿µ"}),e.jsx("span",{className:"text-blue-900 text-sm",children:t.coreConcept})]}),t.teachingSentences&&t.teachingSentences.length>0&&e.jsxs("div",{className:"bg-indigo-50 border-l-4 border-indigo-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-indigo-700 mb-2",children:"æ•™å­¸ä¾‹å¥"}),e.jsx("div",{className:"space-y-1",children:t.teachingSentences.map((l,a)=>e.jsxs("div",{className:"text-indigo-900 text-sm",children:[e.jsxs("span",{className:"font-mono text-indigo-600",children:[a+1,"."]})," ",l]},a))})]}),t.teachingTips&&e.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-purple-700 mb-1",children:"æ•™å­¸è¦é»æç¤º"}),e.jsx("span",{className:"text-purple-900 text-sm",children:t.teachingTips})]}),t.teachingExample&&e.jsxs("div",{className:"bg-sky-50 border-l-4 border-sky-400 p-3 rounded-md",children:[e.jsx("span",{className:"block text-xs font-semibold text-sky-700 mb-1",children:"æ•™å­¸ç¤ºä¾‹"}),e.jsx("span",{className:"text-sky-900 text-sm",children:t.teachingExample})]})]},i)):e.jsx("p",{children:"æ²’æœ‰æä¾›å…§å®¹åˆ†è§£ã€‚"})}),Ms=({points:s})=>e.jsx(Z,{title:"æ˜“æ··æ·†é»è­˜åˆ¥",icon:e.jsx(ie,{className:"w-7 h-7"}),children:s&&s.length>0?s.map((t,i)=>e.jsxs("div",{className:"mb-6 pb-6 border-b border-slate-200 last:border-b-0 last:pb-0",children:[e.jsx("h4",{className:"font-semibold text-lg text-red-700 mb-2",children:t.point}),e.jsx("p",{className:"text-slate-700 mb-3",children:t.clarification}),t.errorType&&e.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-orange-700 mb-1",children:"èª¤å€é¡å‹"}),e.jsx("span",{className:"text-orange-900 text-sm",children:t.errorType})]}),t.commonErrors&&t.commonErrors.length>0&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-red-700 mb-2",children:"å¸¸è¦‹éŒ¯èª¤ç¤ºä¾‹"}),e.jsx("div",{className:"space-y-1",children:t.commonErrors.map((l,a)=>e.jsxs("div",{className:"text-red-900 text-sm",children:[e.jsxs("span",{className:"font-mono text-red-600",children:[a+1,"."]})," ",l]},a))})]}),t.correctVsWrong&&t.correctVsWrong.length>0&&e.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-yellow-700 mb-2",children:"æ­£ç¢ºèˆ‡éŒ¯èª¤å°æ¯”"}),e.jsx("div",{className:"space-y-3",children:t.correctVsWrong.map((l,a)=>e.jsxs("div",{className:"border border-yellow-200 rounded-md p-2 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-2",children:[e.jsxs("div",{className:"bg-green-50 p-2 rounded border border-green-200",children:[e.jsx("span",{className:"block text-xs font-semibold text-green-700 mb-1",children:"âœ“ æ­£ç¢º"}),e.jsx("span",{className:"text-green-900 text-sm",children:l.correct})]}),e.jsxs("div",{className:"bg-red-50 p-2 rounded border border-red-200",children:[e.jsx("span",{className:"block text-xs font-semibold text-red-700 mb-1",children:"âœ— éŒ¯èª¤"}),e.jsx("span",{className:"text-red-900 text-sm",children:l.wrong})]})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded border border-blue-200",children:[e.jsx("span",{className:"block text-xs font-semibold text-blue-700 mb-1",children:"èªªæ˜"}),e.jsx("span",{className:"text-blue-900 text-sm",children:l.explanation})]})]},a))})]}),t.preventionStrategy&&e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-blue-700 mb-1",children:"é é˜²ç­–ç•¥"}),e.jsx("span",{className:"text-blue-900 text-sm",children:t.preventionStrategy})]}),t.correctionMethod&&e.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-purple-700 mb-1",children:"ç³¾æ­£æ–¹æ³•"}),e.jsx("span",{className:"text-purple-900 text-sm",children:t.correctionMethod})]}),t.practiceActivities&&t.practiceActivities.length>0&&e.jsxs("div",{className:"bg-indigo-50 border-l-4 border-indigo-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-indigo-700 mb-2",children:"ç·´ç¿’å»ºè­°"}),e.jsx("div",{className:"space-y-1",children:t.practiceActivities.map((l,a)=>e.jsxs("div",{className:"text-indigo-900 text-sm",children:[e.jsxs("span",{className:"font-mono text-indigo-600",children:[a+1,"."]})," ",l]},a))})]}),t.teachingExample&&e.jsxs("div",{className:"bg-gray-50 border-l-4 border-gray-400 p-3 rounded-md",children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"æ•™å­¸ç¤ºä¾‹"}),e.jsx("span",{className:"text-gray-900 text-sm",children:t.teachingExample})]})]},i)):e.jsx("p",{children:"æ²’æœ‰æä¾›æ˜“æ··æ·†é»ã€‚"})}),Es=({activities:s})=>e.jsx(Z,{title:"èª²å ‚æ´»å‹•èˆ‡éŠæˆ²è¨­è¨ˆ",icon:e.jsx(xs,{className:"w-7 h-7"}),children:s&&s.length>0?e.jsx("div",{className:"space-y-6",children:s.map((t,i)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("div",{className:"bg-gradient-to-r from-sky-50 to-blue-50 px-6 py-4 border-b border-slate-200 rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-sky-500 text-white rounded-full font-bold text-sm",children:i+1}),e.jsx("h4",{className:"font-bold text-xl text-sky-800",children:t.title})]}),e.jsx("p",{className:"mt-3 text-slate-700 leading-relaxed",children:t.description})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[t.objective&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"font-semibold text-green-800 text-sm",children:"å­¸ç¿’ç›®æ¨™"})]}),e.jsx("p",{className:"text-green-900 text-sm leading-relaxed",children:t.objective})]}),t.timing&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"font-semibold text-purple-800 text-sm",children:"ä½¿ç”¨æ™‚æ©Ÿ"})]}),e.jsx("p",{className:"text-purple-900 text-sm leading-relaxed",children:t.timing})]}),t.materials&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),e.jsx("span",{className:"font-semibold text-orange-800 text-sm",children:"æ‰€éœ€æ•™å…·"})]}),e.jsx("p",{className:"text-orange-900 text-sm leading-relaxed",children:t.materials})]}),t.environment&&e.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-teal-500 rounded-full"}),e.jsx("span",{className:"font-semibold text-teal-800 text-sm",children:"ç’°å¢ƒè¦æ±‚"})]}),e.jsx("p",{className:"text-teal-900 text-sm leading-relaxed",children:t.environment})]})]}),t.steps&&t.steps.length>0&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-blue-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}),e.jsx("span",{className:"font-semibold text-blue-800",children:"æ´»å‹•æ­¥é©Ÿ"})]}),e.jsx("div",{className:"space-y-3",children:t.steps.map((l,a)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 bg-blue-500 text-white rounded-full font-semibold text-xs flex-shrink-0 mt-0.5",children:a+1}),e.jsx("p",{className:"text-blue-900 text-sm leading-relaxed flex-1",children:l})]},a))})]})}),t.assessmentPoints&&t.assessmentPoints.length>0&&e.jsx("div",{children:e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-indigo-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})}),e.jsx("span",{className:"font-semibold text-indigo-800",children:"è©•ä¼°é‡é»"})]}),e.jsx("div",{className:"space-y-2",children:t.assessmentPoints.map((l,a)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{className:"text-indigo-900 text-sm leading-relaxed",children:l})]},a))})]})})]})]},i))}):e.jsx("p",{children:"æ²’æœ‰æä¾›èª²å ‚æ´»å‹•ã€‚"})}),$s=({dialogue:s})=>{const[t,i]=h.useState(null),[l,a]=h.useState(null),[m,c]=h.useState(!1),[x,g]=h.useState(""),[d,f]=h.useState(null),[b,j]=h.useState(!1),[r,o]=h.useState({tts:!0,sr:!0}),n=h.useRef(null),u=h.useRef(null);h.useEffect(()=>{const C="speechSynthesis"in window,v="SpeechRecognition"in window||"webkitSpeechRecognition"in window,I=k=>k.toLowerCase().replace(/[.,!?;:"']/g,"").trim(),$=k=>{if(l===null)return;const S=s[l].line;I(k)===I(S)?f({type:"success",message:`å¤ªæ£’äº†ï¼ç™¼éŸ³æ­£ç¢º: "${k}"`}):f({type:"error",message:`å†è©¦ä¸€æ¬¡ã€‚æ‚¨èªªçš„æ˜¯: "${k}"ï¼Œåƒè€ƒå¥: "${S}"`})};if(o({tts:C,sr:v}),v){const k=window.SpeechRecognition||window.webkitSpeechRecognition;if(n.current=new k,n.current===null)throw new Error("èªéŸ³è¾¨è­˜åŠŸèƒ½åˆå§‹åŒ–å¤±æ•—ï¼");n.current.continuous=!1,n.current.interimResults=!1,n.current.lang="en-US",n.current.onresult=S=>{const L=S.results[0][0].transcript;g(L),$(L)},n.current.onerror=S=>{console.error("Speech recognition error:",S.error),f({type:"error",message:`èªéŸ³è¾¨è­˜éŒ¯èª¤: ${S.error==="no-speech"?"æœªåµæ¸¬åˆ°èªéŸ³":S.error==="audio-capture"?"éº¥å…‹é¢¨æ“·å–å¤±æ•—":S.error==="not-allowed"?"éº¥å…‹é¢¨æ¬Šé™æœªæˆäºˆ":"ç™¼ç”ŸéŒ¯èª¤"}`}),c(!1)},n.current.onend=()=>{c(!1)}}return()=>{window.speechSynthesis&&window.speechSynthesis.speaking&&window.speechSynthesis.cancel()}},[s,l]);const y=(C,v)=>{if(!r.tts||!C)return;window.speechSynthesis.speaking&&window.speechSynthesis.cancel();const I=new SpeechSynthesisUtterance(C);I.lang="en-US";const $=window.speechSynthesis.getVoices(),k=$.find(S=>S.lang.startsWith("en")&&S.name.includes("Google")&&S.localService)||$.find(S=>S.lang.startsWith("en")&&S.localService)||$.find(S=>S.lang.startsWith("en"));k&&(I.voice=k),I.onstart=()=>{j(!0),i(v)},I.onend=()=>{j(!1),i(null)},I.onerror=S=>{console.error("Speech synthesis error:",S),j(!1),i(null),f({type:"error",message:"èªéŸ³æ’­æ”¾å¤±æ•—ã€‚"})},u.current=I,window.speechSynthesis.speak(I)},N=C=>{if(!(!r.sr||!n.current||m)){a(C),g(""),f(null),c(!0);try{n.current.start()}catch(v){console.error("Error starting recognition: ",v),c(!1),f({type:"error",message:"ç„¡æ³•å•Ÿå‹•èªéŸ³è¾¨è­˜ã€‚"})}}},w=()=>{n.current&&m&&(n.current.stop(),c(!1))};return!s||s.length===0?e.jsx(Z,{title:"è‹±æ–‡å°è©±ç·´ç¿’",icon:e.jsx(me,{className:"w-7 h-7"}),children:e.jsx("p",{className:"text-slate-600",children:"ç›®å‰æ²’æœ‰å¯ç”¨çš„å°è©±å…§å®¹ã€‚"})}):e.jsxs(Z,{title:"è‹±æ–‡å°è©±ç·´ç¿’",icon:e.jsx(me,{className:"w-7 h-7"}),children:[!r.tts&&e.jsx("p",{className:"text-red-600 bg-red-100 p-2 rounded-md",children:"æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆ (TTS)ã€‚"}),!r.sr&&e.jsx("p",{className:"text-red-600 bg-red-100 p-2 rounded-md mt-2",children:"æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ (SR)ã€‚å»ºè­°ä½¿ç”¨æœ€æ–°ç‰ˆ Chrome æˆ– Edgeã€‚"}),e.jsx("div",{className:"space-y-4",children:s.map((C,v)=>e.jsxs("div",{className:`p-3 rounded-lg ${C.speaker==="Speaker A"?"bg-sky-50":"bg-indigo-50"} border ${C.speaker==="Speaker A"?"border-sky-200":"border-indigo-200"}`,children:[e.jsxs("p",{className:"font-semibold text-sm mb-1 ${item.speaker === 'Speaker A' ? 'text-sky-700' : 'text-indigo-700'}",children:[C.speaker,":"]}),e.jsx("p",{className:"text-slate-800 mb-2",children:C.line}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r.tts&&e.jsx("button",{onClick:()=>y(C.line,v),disabled:b&&t!==v,className:`p-1.5 rounded-full hover:bg-slate-200 transition-colors disabled:opacity-50 ${b&&t===v?"text-sky-500 animate-pulse":"text-slate-600"}`,"aria-label":`æ’­æ”¾ ${C.speaker} çš„è©±`,children:e.jsx(hs,{className:"w-5 h-5"})}),r.sr&&(m&&l===v?e.jsx("button",{onClick:w,className:"p-1.5 rounded-full text-red-600 hover:bg-red-100 transition-colors","aria-label":"åœæ­¢éŒ„éŸ³",children:e.jsx(us,{className:"w-5 h-5"})}):e.jsx("button",{onClick:()=>N(v),disabled:m||b,className:"p-1.5 rounded-full text-slate-600 hover:bg-slate-200 transition-colors disabled:opacity-50","aria-label":`ç·´ç¿’èªªå‡º ${C.speaker} çš„è©±`,children:e.jsx(gs,{className:"w-5 h-5"})}))]}),l===v&&x&&e.jsxs("p",{className:"mt-2 text-sm text-slate-600 italic",children:['æ‚¨èªªçš„æ˜¯: "',x,'"']}),l===v&&d&&e.jsxs("div",{className:`mt-2 p-2 rounded-md text-sm flex items-start ${d.type==="success"?"bg-green-100 text-green-700":d.type==="error"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:[d.type==="success"&&e.jsx(ps,{className:"w-5 h-5 mr-2 flex-shrink-0"}),d.type==="error"&&e.jsx(bs,{className:"w-5 h-5 mr-2 flex-shrink-0"}),e.jsx("span",{children:d.message})]})]},v))}),m&&e.jsx("p",{className:"mt-4 text-center text-sky-600 font-medium animate-pulse",children:"æ­£åœ¨è†è½..."})]})},zs=({englishConversation:s,learningObjectives:t,contentBreakdown:i,topic:l,apiKey:a,selectedLevel:m,selectedVocabularyLevel:c})=>{const[x,g]=A.useState(!1),[d,f]=A.useState(""),[b,j]=A.useState(""),[r,o]=A.useState(!1),n=A.useCallback(async()=>{if(!a){f("è«‹å…ˆè¨­å®š Gemini API é‡‘é‘°");return}if(!t||t.length===0){f("ç„¡æ³•ç”Ÿæˆå°è©±ç·´ç¿’ï¼šç¼ºå°‘å­¸ç¿’ç›®æ¨™");return}g(!0),f(""),j("");try{const u={topic:l,scenario:`Practice conversation based on learning objectives: ${t.map(v=>v.objective).join(", ")}`,difficulty:m?.name==="å…¥é–€"?"easy":m?.name==="é€²éš"?"hard":"normal",participantCount:2,duration:10,focusAreas:t.map(v=>v.objective),culturalContext:i?.map(v=>v.details).join("; ")},N={practice:await Fe.generateConversationPractice(u,a),metadata:{basedOnTopic:l,createdFrom:"lesson-plan",selectedLevel:m?.name,selectedVocabularyLevel:c?.name,createdAt:new Date().toISOString()}},w=await Ze(N),C=`${window.location.origin}/ai-page-gen/conversation-practice/${w}`;j(C)}catch(u){console.error("Failed to generate advanced conversation practice:",u),f(u.message||"ç”Ÿæˆé€²éšå°è©±ç·´ç¿’å¤±æ•—")}finally{g(!1)}},[a,t,i,l,m,c]);return e.jsx(Z,{title:"å°è©±ç·´ç¿’",icon:e.jsx(me,{className:"w-7 h-7"}),children:s&&s.length>0?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"åŸºç¤å°è©±ç·´ç¿’"}),e.jsx($s,{dialogue:s})]}),a&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"é€²éšäº’å‹•å°è©±ç·´ç¿’"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"åŸºæ–¼æ•™æ¡ˆå…§å®¹ç”Ÿæˆè±å¯Œçš„å°è©±ç·´ç¿’ï¼ŒåŒ…å«èªéŸ³è­˜åˆ¥å’ŒAIè©•ä¼°"})]}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2 text-sm",disabled:x||!a,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"ç”Ÿæˆä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})}),"ç”Ÿæˆé€²éšå°è©±ç·´ç¿’"]})})]}),d&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:d}),b&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-green-800 mb-1",children:"é€²éšå°è©±ç·´ç¿’å·²ç”Ÿæˆï¼"}),e.jsx("div",{className:"text-xs text-green-600",children:"å­¸ç”Ÿå¯ä½¿ç”¨æ­¤é€£çµé€²è¡Œäº’å‹•å°è©±ç·´ç¿’"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>navigator.clipboard.writeText(b),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"è¤‡è£½é€£çµ"}),e.jsx("button",{onClick:()=>o(!r),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"QR Code"})]})]}),r&&e.jsx("div",{className:"mt-4 pt-4 border-t border-green-200",children:e.jsx(ae,{url:b,title:`${l} - é€²éšå°è©±ç·´ç¿’`})})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"æ²’æœ‰æä¾›åŸºç¤å°è©±ç·´ç¿’ã€‚"}),a&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"æ‚¨å¯ä»¥åŸºæ–¼æ•™æ¡ˆå…§å®¹ç”Ÿæˆé€²éšå°è©±ç·´ç¿’"}),e.jsx("button",{onClick:n,className:"px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2 mx-auto",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"ç”Ÿæˆä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})}),"ç”Ÿæˆé€²éšå°è©±ç·´ç¿’"]})}),d&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm max-w-md mx-auto",children:d}),b&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg max-w-md mx-auto",children:[e.jsx("div",{className:"text-sm font-medium text-green-800 mb-2",children:"é€²éšå°è©±ç·´ç¿’å·²ç”Ÿæˆï¼"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>navigator.clipboard.writeText(b),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"è¤‡è£½é€£çµ"}),e.jsx("button",{onClick:()=>o(!r),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"QR Code"})]}),r&&e.jsx("div",{className:"mt-4 pt-4 border-t border-green-200",children:e.jsx(ae,{url:b,title:`${l} - é€²éšå°è©±ç·´ç¿’`})})]})]})]})})},he="AES-GCM",Ts=256,xe=12;async function Ie(s,t){const i=new TextEncoder,l=await crypto.subtle.importKey("raw",i.encode(s),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},l,{name:he,length:Ts},!1,["encrypt","decrypt"])}async function Rs(s,t="ai-page-gen-2024"){try{const l=new TextEncoder().encode(s),a=crypto.getRandomValues(new Uint8Array(16)),m=crypto.getRandomValues(new Uint8Array(xe)),c=await Ie(t,a),x=await crypto.subtle.encrypt({name:he,iv:m},c,l),g=new Uint8Array(a.length+m.length+x.byteLength);return g.set(a,0),g.set(m,a.length),g.set(new Uint8Array(x),a.length+m.length),Ds(g)}catch(i){throw console.error("åŠ å¯† API Key å¤±æ•—:",i),new Error("åŠ å¯†å¤±æ•—")}}async function Bs(s,t="ai-page-gen-2024"){try{const i=qs(s),l=i.slice(0,16),a=i.slice(16,16+xe),m=i.slice(16+xe),c=await Ie(t,l),x=await crypto.subtle.decrypt({name:he,iv:a},c,m);return new TextDecoder().decode(x)}catch(i){throw console.error("è§£å¯† API Key å¤±æ•—:",i),new Error("è§£å¯†å¤±æ•—æˆ–æ•¸æ“šå·²æå£")}}function Ds(s){const t=new Uint8Array(s);let i="";for(let l=0;l<t.byteLength;l++)i+=String.fromCharCode(t[l]);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function qs(s){const t="=".repeat((4-s.length%4)%4),i=s.replace(/-/g,"+").replace(/_/g,"/")+t,l=atob(i),a=new Uint8Array(l.length);for(let m=0;m<l.length;m++)a[m]=l.charCodeAt(m);return a}function Pe(){return typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof crypto.subtle.encrypt=="function"}async function Ae(s){if(!Pe())return console.warn("Web Crypto API ä¸æ”¯æ´ï¼Œå°‡ä½¿ç”¨æ˜æ–‡å‚³è¼¸ï¼ˆä¸å»ºè­°ï¼‰"),`apikey=${encodeURIComponent(s)}`;const t=await Rs(s);return`enckey=${encodeURIComponent(t)}`}async function vt(s){const t=s.get("enckey");if(t&&Pe())try{return await Bs(decodeURIComponent(t))}catch(l){console.error("è§£å¯† API Key å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨æ˜æ–‡åƒæ•¸:",l)}const i=s.get("apikey");return i?decodeURIComponent(i):null}const Os=({writingPractice:s,topic:t,apiKey:i,selectedLevel:l,selectedVocabularyLevel:a})=>{const[m,c]=A.useState(!1),[x,g]=A.useState(""),[d,f]=A.useState(""),[b,j]=A.useState(!1),r=A.useCallback(async()=>{if(c(!0),g(""),f(""),!s){g("æ²’æœ‰å¯åˆ†äº«çš„å¯«ä½œç·´ç¿’å…§å®¹"),c(!1);return}try{const o=await Qe({writingPractice:s,topic:t,metadata:{selectedLevel:l?.name,selectedVocabularyLevel:a?.name,createdAt:new Date().toISOString()}});let n=`${window.location.origin}/ai-page-gen/writing?binId=${o}`;if(i)try{const u=await Ae(i);n+=`&${u}`}catch(u){console.warn("åŠ å¯† API Key å¤±æ•—ï¼Œå°‡ä¸åŒ…å« API Key:",u)}f(n)}catch(o){g(o.message||"åˆ†äº«å¯«ä½œç·´ç¿’å¤±æ•—")}finally{c(!1)}},[s,t,i,l,a]);return e.jsx("div",{children:s?e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:r,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 text-sm",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"â³"}),"åˆ†äº«ä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.935-2.186 2.25 2.25 0 0 0-3.935 2.186Z"})}),"åˆ†äº«å¯«ä½œç·´ç¿’"]})})}),x&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg",children:x}),d&&e.jsxs("div",{className:"mb-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("p",{className:"text-sm text-purple-700",children:"å¯«ä½œç·´ç¿’åˆ†äº«é€£çµå·²ç”Ÿæˆï¼š"}),i&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"å« AI æ‰¹æ”¹"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:d,readOnly:!0,className:"w-full px-3 py-2 bg-white border border-purple-300 rounded text-sm",onClick:()=>navigator.clipboard.writeText(d)}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>navigator.clipboard.writeText(d),className:"flex-1 px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm transition-colors",children:"è¤‡è£½é€£çµ"}),e.jsxs("button",{onClick:()=>j(!b),className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm flex items-center justify-center gap-1 transition-colors",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5H8.25v1.5H13.5V13.5ZM13.5 16.5H8.25V18H13.5v-1.5ZM16.5 16.5h1.5V18h-1.5v-1.5ZM16.5 13.5h1.5v1.5h-1.5v-1.5Z"})]}),"é¡¯ç¤º QR Code"]})]})]}),b&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(ae,{url:d,title:"å¯«ä½œç·´ç¿’åˆ†äº« QR Code",size:200,className:"bg-white p-4 rounded-lg shadow-sm"})}),i&&e.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"ğŸ’¡ æ­¤é€£çµåŒ…å«æ‚¨çš„ API Keyï¼Œå­¸ç”Ÿå¯ç›´æ¥ä½¿ç”¨ AI æ‰¹æ”¹åŠŸèƒ½"})]}),e.jsx(ks,{content:s,apiKey:i,vocabularyLevel:a||void 0})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center border border-gray-200",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16 text-gray-400 mx-auto mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-700 mb-2",children:"æ²’æœ‰æä¾›å¯«ä½œç·´ç¿’"}),e.jsx("p",{className:"text-gray-500",children:"æ­¤ä¸»é¡Œæ²’æœ‰ç”Ÿæˆå¯«ä½œç·´ç¿’å…§å®¹"})]})})};var X=(s=>(s.Easy="easy",s.Normal="normal",s.Hard="hard",s))(X||{});const Me={easy:{trueFalse:5,multipleChoice:5,fillInTheBlanks:5,sentenceScramble:5,memoryCardGame:1},normal:{trueFalse:5,multipleChoice:5,fillInTheBlanks:5,sentenceScramble:5,memoryCardGame:1},hard:{trueFalse:5,multipleChoice:5,fillInTheBlanks:5,sentenceScramble:5,memoryCardGame:1}},ve={trueFalse:10,multipleChoice:10,fillInTheBlanks:10,sentenceScramble:10,memoryCardGame:2},Ws=({feedback:s,onContinueLearning:t,onRetakeQuiz:i,showActions:l=!0})=>{const a=d=>d>=80?"text-green-600 bg-green-100":d>=60?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",m=d=>d>=80?"border-green-200":d>=60?"border-yellow-200":"border-red-200",c=d=>{switch(d){case"advanced":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-green-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 0 1-.982-3.172M9.497 14.25a7.454 7.454 0 0 0 .981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 0 0 7.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25s4.544.16 6.75.471v1.515M7.73 9.728a6.726 6.726 0 0 0 2.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.228V2.721A48.133 48.133 0 0 0 12 2.25c-2.291 0-4.544.16-6.75.471v1.515M7.73 9.728l3.75.814.97 4.286c.078.348.14.699.185 1.053m8.272-6.842-3.75.814-.97 4.286a24.216 24.216 0 0 1-.185 1.053M12 19.5a2.25 2.25 0 0 1-2.25-2.25V14.25m4.5 5.25a2.25 2.25 0 0 1 2.25-2.25V14.25"})});case"intermediate":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-yellow-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"})});default:return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-blue-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443a55.381 55.381 0 0 1 5.25 2.882V15"})})}},x=d=>{switch(d){case"advanced":return"é«˜ç´šç¨‹åº¦";case"intermediate":return"ä¸­ç´šç¨‹åº¦";default:return"åˆç´šç¨‹åº¦"}},g=d=>{switch(d){case"advanced":return"ä½ å·²ç¶“æŒæ¡äº†å¤§éƒ¨åˆ†æ¦‚å¿µï¼Œè¡¨ç¾éå¸¸å‡ºè‰²ï¼";case"intermediate":return"ä½ æœ‰è‰¯å¥½çš„åŸºç¤ï¼Œç¹¼çºŒåŠªåŠ›å°±èƒ½æ›´ä¸Šä¸€å±¤æ¨“ï¼";default:return"é€™æ˜¯ä¸€å€‹å¾ˆå¥½çš„é–‹å§‹ï¼Œç¹¼çºŒå­¸ç¿’ä½ æœƒé€²æ­¥å¾ˆå¿«ï¼"}};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-xl shadow-lg",children:[e.jsxs("div",{className:`text-center mb-8 p-6 bg-white rounded-lg shadow-md border-2 ${m(s.overallScore)}`,children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[c(s.overallLevel),e.jsx("div",{className:"ml-4",children:e.jsxs("div",{className:`text-4xl font-bold px-4 py-2 rounded-full ${a(s.overallScore)}`,children:[s.overallScore,"åˆ†"]})})]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:x(s.overallLevel)}),e.jsx("p",{className:"text-lg text-gray-600",children:g(s.overallLevel)})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-blue-500 mt-1 flex-shrink-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),e.jsx("p",{className:"text-lg text-gray-700 leading-relaxed",children:s.encouragementMessage})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-green-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.745 3.745 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})}),"ğŸŒŸ ä½ çš„å¼·é …"]}),s.keyStrengths.length>0?e.jsx("ul",{className:"space-y-3",children:s.keyStrengths.map((d,f)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-500 mt-1.5",children:"âœ“"}),e.jsx("span",{className:"text-gray-700",children:d})]},f))}):e.jsx("p",{className:"text-gray-500 italic",children:"ç¹¼çºŒåŠªåŠ›ç™¼æ˜ä½ çš„å­¸ç¿’å¼·é …ï¼"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-orange-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),"ğŸ’¡ æˆé•·ç©ºé–“"]}),s.improvementAreas.length>0?e.jsx("ul",{className:"space-y-3",children:s.improvementAreas.map((d,f)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-500 mt-1.5",children:"â†’"}),e.jsx("span",{className:"text-gray-700",children:d})]},f))}):e.jsx("p",{className:"text-gray-500 italic",children:"ä½ çš„è¡¨ç¾å¾ˆå…¨é¢ï¼Œç¹¼çºŒä¿æŒï¼"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"})}),"ğŸ¯ ä¸‹ä¸€æ­¥è¡Œå‹•"]}),s.nextSteps.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.nextSteps.map((d,f)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:f+1}),e.jsx("span",{className:"text-gray-700",children:d})]},f))}):e.jsx("p",{className:"text-gray-500 italic",children:"ä½ å·²ç¶“æº–å‚™å¥½ç¹¼çºŒä¸‹ä¸€å€‹å­¸ç¿’éšæ®µäº†ï¼"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg shadow-md p-6 mb-6 border border-purple-200",children:[e.jsxs("h3",{className:"text-xl font-bold text-purple-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),"ğŸ’ å­¸ç¿’å°è²¼å£«"]}),s.studyTips.length>0?e.jsx("ul",{className:"space-y-2",children:s.studyTips.map((d,f)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-500 mt-1",children:"ğŸ’¡"}),e.jsx("span",{className:"text-gray-700",children:d})]},f))}):e.jsx("p",{className:"text-gray-500 italic",children:"ç¹¼çºŒä¿æŒä½ çš„å­¸ç¿’ç¿’æ…£ï¼"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg shadow-lg p-6 text-center text-white mb-6",children:[e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"})})}),e.jsxs("p",{className:"text-xl font-medium italic",children:['"',s.motivationalQuote,'"']})]}),l&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:t,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-md flex items-center justify-center gap-2 font-medium",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12l-7.5 7.5M3 12h16.5"})}),"ç¹¼çºŒå­¸ç¿’"]}),e.jsxs("button",{onClick:i,className:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all transform hover:scale-105 shadow-md flex items-center justify-center gap-2 font-medium",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),"é‡æ–°æ¸¬é©—"]})]})]})},_s=({report:s,onExportReport:t,onSaveReport:i,showExportOptions:l=!0})=>{const[a,m]=h.useState("overview"),c=r=>r>=80?"text-green-600 bg-green-50 border-green-200":r>=60?"text-yellow-600 bg-yellow-50 border-yellow-200":"text-red-600 bg-red-50 border-red-200",x=r=>{switch(r){case"high":return"text-red-600 bg-red-100 border-red-200";case"medium":return"text-yellow-600 bg-yellow-100 border-yellow-200";case"low":return"text-blue-600 bg-blue-100 border-blue-200"}},g=r=>{switch(r){case"outstanding":return"text-purple-600 bg-purple-100 border-purple-200";case"excellent":return"text-green-600 bg-green-100 border-green-200";case"good":return"text-blue-600 bg-blue-100 border-blue-200"}},d=r=>{switch(r){case"high":return"text-red-600 bg-red-50 border-l-red-500";case"medium":return"text-yellow-600 bg-yellow-50 border-l-yellow-500";case"low":return"text-green-600 bg-green-50 border-l-green-500"}},f=r=>({trueFalse:"æ˜¯éé¡Œ",multipleChoice:"é¸æ“‡é¡Œ",fillInTheBlanks:"å¡«ç©ºé¡Œ",sentenceScramble:"å¥å­é‡çµ„",memoryCardGame:"ç¿»å¡è¨˜æ†¶"})[r]||r,b=r=>new Date(r).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),j=[{key:"overview",label:"ç¸½è¦½",icon:"ğŸ“Š"},{key:"performance",label:"è¡¨ç¾è©³æƒ…",icon:"ğŸ“ˆ"},{key:"analysis",label:"å­¸ç¿’åˆ†æ",icon:"ğŸ”"},{key:"recommendations",label:"å€‹äººåŒ–å»ºè­°",icon:"ğŸ’¡"},{key:"teaching",label:"æ•™å­¸æŒ‡å°",icon:"ğŸ¯"}];return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"å­¸ç¿’è¨ºæ–·å ±å‘Š"}),e.jsxs("p",{className:"text-gray-600",children:["ä¸»é¡Œï¼š",e.jsx("span",{className:"font-semibold",children:s.topic})]}),e.jsxs("p",{className:"text-gray-600",children:["è©•ä¼°æ—¥æœŸï¼š",b(s.assessmentDate)]}),s.studentId&&e.jsxs("p",{className:"text-gray-600",children:["å­¸ç”ŸIDï¼š",e.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:s.studentId})]})]}),l&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:i,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"})}),"å„²å­˜å ±å‘Š"]}),e.jsxs("button",{onClick:t,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"åŒ¯å‡ºå ±å‘Š"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-700 mb-1",children:"æ•´é«”å¾—åˆ†"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[s.overallPerformance.totalScore,"åˆ†"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-purple-700 mb-1",children:"å­¸ç¿’æ°´æº–"}),e.jsx("p",{className:"text-lg font-semibold text-purple-600 capitalize",children:s.overallPerformance.level})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-700 mb-1",children:"å¼·é …æ•¸é‡"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:s.learningAnalysis.strengths.length})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-orange-700 mb-1",children:"æ”¹é€²é ˜åŸŸ"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:s.learningAnalysis.weaknesses.length})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md mb-6",children:e.jsx("div",{className:"flex overflow-x-auto",children:j.map(r=>e.jsxs("button",{onClick:()=>m(r.key),className:`flex-shrink-0 px-6 py-4 font-medium text-sm border-b-2 transition-colors ${a===r.key?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("span",{className:"mr-2",children:r.icon}),r.label]},r.key))})}),e.jsxs("div",{className:"space-y-6",children:[a==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"æ•´é«”è¡¨ç¾"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ç¸½åˆ†ï¼š"}),e.jsxs("span",{className:"font-semibold",children:[s.overallPerformance.totalScore,"/100"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"å­¸ç¿’æ°´æº–ï¼š"}),e.jsx("span",{className:"font-semibold capitalize",children:s.overallPerformance.level})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"å®Œæˆæ™‚é–“ï¼š"}),e.jsxs("span",{className:"font-semibold",children:[s.overallPerformance.timeSpent," åˆ†é˜"]})]}),s.overallPerformance.percentile&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ç™¾åˆ†ä½æ•¸ï¼š"}),e.jsxs("span",{className:"font-semibold",children:["å‰ ",100-s.overallPerformance.percentile,"%"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"èªçŸ¥åˆ†æ"}),e.jsxs("div",{className:"space-y-3",children:[s.learningAnalysis.learningStyle&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"å­¸ç¿’é¢¨æ ¼ï¼š"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.learningAnalysis.learningStyle})]}),s.learningAnalysis.cognitivePattern&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"èªçŸ¥æ¨¡å¼ï¼š"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.learningAnalysis.cognitivePattern})]}),e.jsx("div",{className:"pt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"åŸºæ–¼ç­”é¡Œæ¨¡å¼ã€åæ‡‰æ™‚é–“å’ŒéŒ¯èª¤é¡å‹çš„ç¶œåˆåˆ†æ"})})]})]})]}),a==="performance"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"å„é¡Œå‹è¡¨ç¾åˆ†æ"}),e.jsx("div",{className:"space-y-6",children:s.performanceByType.map(r=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:f(r.questionType)}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium border ${c(r.accuracy)}`,children:[r.accuracy,"% æ­£ç¢ºç‡"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ç¸½é¡Œæ•¸"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:r.totalQuestions})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ç­”å°é¡Œæ•¸"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.correctCount})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"å¹³å‡æ™‚é–“"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.averageTime?`${Math.round(r.averageTime/1e3)}ç§’`:"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-xs text-green-700 font-medium",children:"ç°¡å–®"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[r.difficultyBreakdown.easy.accuracy,"%"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[r.difficultyBreakdown.easy.correct,"/",r.difficultyBreakdown.easy.total]})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("p",{className:"text-xs text-yellow-700 font-medium",children:"æ™®é€š"}),e.jsxs("p",{className:"text-lg font-bold text-yellow-600",children:[r.difficultyBreakdown.normal.accuracy,"%"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[r.difficultyBreakdown.normal.correct,"/",r.difficultyBreakdown.normal.total]})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-xs text-red-700 font-medium",children:"å›°é›£"}),e.jsxs("p",{className:"text-lg font-bold text-red-600",children:[r.difficultyBreakdown.hard.accuracy,"%"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[r.difficultyBreakdown.hard.correct,"/",r.difficultyBreakdown.hard.total]})]})]}),r.commonErrors.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"å¸¸è¦‹éŒ¯èª¤æ¨¡å¼ï¼š"}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:r.commonErrors.map((o,n)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500 mt-1",children:"â€¢"}),o]},n))})]})]},r.questionType))})]}),a==="analysis"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-green-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 0 1-.982-3.172M9.497 14.25a7.454 7.454 0 0 0 .981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 0 0 7.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25s4.544.16 6.75.471v1.515M7.73 9.728a6.726 6.726 0 0 0 2.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.228V2.721A48.133 48.133 0 0 0 12 2.25c-2.291 0-4.544.16-6.75.471v1.515M7.73 9.728l3.75.814.97 4.286c.078.348.14.699.185 1.053m8.272-6.842-3.75.814-.97 4.286a24.216 24.216 0 0 1-.185 1.053M12 19.5a2.25 2.25 0 0 1-2.25-2.25V14.25m4.5 5.25a2.25 2.25 0 0 1 2.25-2.25V14.25"})}),"å­¸ç¿’å¼·é …"]}),e.jsx("div",{className:"space-y-4",children:s.learningAnalysis.strengths.map((r,o)=>e.jsxs("div",{className:`p-4 rounded-lg border ${g(r.level)}`,children:[e.jsx("h4",{className:"font-semibold mb-2",children:r.area}),e.jsx("p",{className:"text-sm mb-3",children:r.description}),r.examples.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"è¡¨ç¾å¯¦ä¾‹ï¼š"}),e.jsx("ul",{className:"text-xs space-y-1",children:r.examples.map((n,u)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"âœ“"}),n]},u))})]}),r.leverageOpportunities.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"é‹ç”¨æ©Ÿæœƒï¼š"}),e.jsx("ul",{className:"text-xs space-y-1",children:r.leverageOpportunities.map((n,u)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"â†’"}),n]},u))})]})]},o))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-red-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})}),"éœ€è¦åŠ å¼·çš„é ˜åŸŸ"]}),e.jsx("div",{className:"space-y-4",children:s.learningAnalysis.weaknesses.map((r,o)=>e.jsxs("div",{className:`p-4 rounded-lg border ${x(r.severity)}`,children:[e.jsx("h4",{className:"font-semibold mb-2",children:r.area}),e.jsx("p",{className:"text-sm mb-3",children:r.description}),r.affectedTopics.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"å½±éŸ¿ä¸»é¡Œï¼š"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.affectedTopics.map((n,u)=>e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-200 rounded-full",children:n},u))})]}),r.recommendedActions.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"å»ºè­°è¡Œå‹•ï¼š"}),e.jsx("ul",{className:"text-xs space-y-1",children:r.recommendedActions.map((n,u)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-orange-500 mt-1",children:"â€¢"}),n]},u))})]})]},o))})]})]}),a==="recommendations"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-6",children:"å€‹äººåŒ–å­¸ç¿’å»ºè­°"}),e.jsx("div",{className:"space-y-6",children:s.personalizedRecommendations.map((r,o)=>e.jsxs("div",{className:`p-6 rounded-lg border-l-4 ${d(r.priority)}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-1",children:r.title}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("span",{className:`px-2 py-1 rounded-full border ${r.category==="immediate"?"text-red-600 bg-red-100 border-red-200":r.category==="short-term"?"text-yellow-600 bg-yellow-100 border-yellow-200":"text-blue-600 bg-blue-100 border-blue-200"}`,children:r.category==="immediate"?"ç«‹å³":r.category==="short-term"?"çŸ­æœŸ":"é•·æœŸ"}),e.jsx("span",{className:`px-2 py-1 rounded-full border ${r.priority==="high"?"text-red-600 bg-red-100 border-red-200":r.priority==="medium"?"text-yellow-600 bg-yellow-100 border-yellow-200":"text-green-600 bg-green-100 border-green-200"}`,children:r.priority==="high"?"é«˜å„ªå…ˆ":r.priority==="medium"?"ä¸­å„ªå…ˆ":"ä½å„ªå…ˆ"})]})]}),e.jsx("span",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full",children:r.estimatedTime})]}),e.jsx("p",{className:"text-gray-700 mb-4",children:r.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"å…·é«”æ­¥é©Ÿï¼š"}),e.jsx("ol",{className:"text-sm space-y-1",children:r.actionSteps.map((n,u)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5",children:u+1}),n]},u))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"é æœŸæˆæœï¼š"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:r.expectedOutcome}),r.resources&&r.resources.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"æ¨è–¦è³‡æºï¼š"}),e.jsx("ul",{className:"text-sm space-y-1",children:r.resources.map((n,u)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"ğŸ“š"}),n]},u))})]})]})]})]},o))})]}),a==="teaching"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-red-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),"ç«‹å³ä»‹å…¥å»ºè­°"]}),e.jsx("ul",{className:"space-y-3",children:s.teachingRecommendations.immediateInterventions.map((r,o)=>e.jsxs("li",{className:"flex items-start gap-3 p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("span",{className:"bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:"!"}),e.jsx("span",{className:"text-gray-700",children:r})]},o))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443a55.381 55.381 0 0 1 5.25 2.882V15"})}),"å»ºè­°æ•™å­¸ç­–ç•¥"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.teachingRecommendations.instructionalStrategies.map((r,o)=>e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:o+1}),e.jsx("span",{className:"text-gray-700",children:r})]})},o))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-purple-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})}),"å·®ç•°åŒ–æ•™å­¸å»ºè­°"]}),e.jsx("ul",{className:"space-y-3",children:s.teachingRecommendations.differentiation.map((r,o)=>e.jsxs("li",{className:"flex items-start gap-3 p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:"â—†"}),e.jsx("span",{className:"text-gray-700",children:r})]},o))})]}),s.teachingRecommendations.parentGuidance&&s.teachingRecommendations.parentGuidance.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-green-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),"å®¶é•·æŒ‡å°å»ºè­°"]}),e.jsx("ul",{className:"space-y-3",children:s.teachingRecommendations.parentGuidance.map((r,o)=>e.jsxs("li",{className:"flex items-start gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("span",{className:"bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:"â™¥"}),e.jsx("span",{className:"text-gray-700",children:r})]},o))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-indigo-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"})}),"é€²åº¦è¿½è¹¤èˆ‡è©•ä¼°"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"é—œéµæŒ‡æ¨™"}),e.jsx("ul",{className:"text-sm space-y-1",children:s.progressTracking.keyMetrics.map((r,o)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-indigo-500 rounded-full"}),r]},o))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"æª¢æŸ¥é»"}),e.jsx("ul",{className:"text-sm space-y-1",children:s.progressTracking.checkpoints.map((r,o)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),r]},o))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"é‡æ–°è©•ä¼°"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.progressTracking.reassessmentSuggestion})]})]})]})]})]})]})},Vs=({topic:s,studentId:t,apiKey:i,mode:l="both",onClose:a,onRetakeQuiz:m,onContinueLearning:c,initialResponses:x=[],existingReport:g,resultsBinId:d,onReportSaved:f})=>{const[b,j]=h.useState(null),[r,o]=h.useState(!1),[n,u]=h.useState(null),[y,N]=h.useState(l==="teacher"?"teacher":"student"),[w,C]=h.useState(null),v=h.useCallback(async k=>{if(!i){u("éœ€è¦ API Key æ‰èƒ½ç”Ÿæˆè¨ºæ–·å ±å‘Š");return}o(!0),u(null);try{const L={...await Ue(k,i),generatedAt:new Date().toISOString(),resultsBinId:d};if(j(L),d)try{await Ke(d,L),console.log("è¨ºæ–·å ±å‘Šå·²è‡ªå‹•å„²å­˜åˆ°å­¸ç”Ÿä½œç­”çµæœ"),f?.(L)}catch(T){console.warn("å„²å­˜è¨ºæ–·å ±å‘Šå¤±æ•—ï¼Œä½†å ±å‘Šä»å¯æ­£å¸¸é¡¯ç¤º:",T)}}catch(S){console.error("ç”Ÿæˆè¨ºæ–·å ±å‘Šå¤±æ•—:",S),u(S instanceof Error?S.message:"ç”Ÿæˆè¨ºæ–·å ±å‘Šæ™‚ç™¼ç”ŸéŒ¯èª¤")}finally{o(!1)}},[i,d,f]);h.useEffect(()=>{if(g){j(g);const k=ne(s,t);k.responses=x,C(ce(k))}else if(s&&x.length>0){const k=ne(s,t);k.responses=x,C(ce(k)),v(k)}},[s,t,x,g,v]);const I=h.useCallback(()=>{if(!b)return;const k={studentFeedback:b.studentFeedback,teacherReport:b.teacherReport,exportDate:new Date().toISOString()},S=JSON.stringify(k,null,2),L="data:application/json;charset=utf-8,"+encodeURIComponent(S),T=`learning_diagnostic_${s}_${new Date().toISOString().split("T")[0]}.json`,P=document.createElement("a");P.setAttribute("href",L),P.setAttribute("download",T),P.click()},[b,s]),$=h.useCallback(()=>{if(!b)return;const k=JSON.parse(localStorage.getItem("learningDiagnosticReports")||"[]");k.push({id:`report_${Date.now()}`,topic:s,studentId:t,createdAt:new Date().toISOString(),result:b}),localStorage.setItem("learningDiagnosticReports",JSON.stringify(k)),alert("è¨ºæ–·å ±å‘Šå·²å„²å­˜è‡³æœ¬åœ°")},[b,s,t]);return r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(oe,{}),e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"æ­£åœ¨ç”Ÿæˆå­¸ç¿’è¨ºæ–·å ±å‘Š"}),e.jsx("p",{className:"text-gray-600",children:"AI æ­£åœ¨åˆ†ææ‚¨çš„ç­”é¡Œæƒ…æ³..."}),e.jsx("div",{className:"flex items-center justify-center space-x-1 mt-4",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]})]})}):n?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16 text-red-500 mx-auto mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"ç”Ÿæˆå ±å‘Šå¤±æ•—"}),e.jsx("p",{className:"text-gray-600 mb-6",children:n}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>w&&v(w),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"é‡æ–°ç”Ÿæˆ"}),a&&e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"é—œé–‰"})]})]})}):b?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"å­¸ç¿’è¨ºæ–·å ±å‘Š"}),l==="both"&&e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>N("student"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${y==="student"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"å­¸ç”Ÿç‰ˆ"}),e.jsx("button",{onClick:()=>N("teacher"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${y==="teacher"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"æ•™å¸«ç‰ˆ"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[y==="teacher"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:$,className:"px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"})}),"å„²å­˜"]}),e.jsxs("button",{onClick:I,className:"px-3 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"åŒ¯å‡º"]})]}),a&&e.jsx("button",{onClick:a,className:"px-3 py-2 text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"é—œé–‰"})]})]})})}),e.jsxs("div",{className:"py-8",children:[(l==="student"||l==="both"&&y==="student")&&e.jsx(Ws,{feedback:b.studentFeedback,onContinueLearning:c,onRetakeQuiz:m,showActions:l!=="both"}),(l==="teacher"||l==="both"&&y==="teacher")&&e.jsx(_s,{report:b.teacherReport,onExportReport:I,onSaveReport:$,showExportOptions:l!=="both"})]}),l==="both"&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs("button",{onClick:m,className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-2 font-medium",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),"é‡æ–°æ¸¬é©—"]}),e.jsxs("button",{onClick:c,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all flex items-center gap-2 font-medium",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12l-7.5 7.5M3 12h16.5"})}),"ç¹¼çºŒå­¸ç¿’"]})]})})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16 text-gray-400 mx-auto mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"ç­‰å¾…è¨ºæ–·æ•¸æ“š"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"è«‹å…ˆå®Œæˆæ¸¬é©—ä»¥ç”Ÿæˆå­¸ç¿’è¨ºæ–·å ±å‘Š"}),a&&e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"é—œé–‰"})]})})},Hs=({quizzes:s,topic:t,studentId:i,apiKey:l,onDiagnosticComplete:a,enableDiagnostic:m=!0})=>{const[c,x]=h.useState(X.Easy),[g,d]=h.useState(null),[f,b]=h.useState([]),[j,r]=h.useState(!1),[o,n]=h.useState(new Set),u=h.useRef(null);h.useEffect(()=>{if(m&&t&&!g){const P=ne(t,i);d(P),u.current=Date.now()}},[t,i,m,g]);const y=()=>{if(!s||!k)return 0;let P=0;return Object.values(k).forEach(E=>{Array.isArray(E)&&(P+=E.length)}),P},N=()=>{const P=c.toLowerCase();return f.filter(E=>E.difficulty===P).length},w=()=>{const P=c.toLowerCase();return f.filter(E=>E.difficulty===P)},C=h.useCallback((P,E,z,B,p,M)=>{if(!m||!g)return;const D=u.current?Date.now()-u.current:void 0,H={questionId:P,questionType:E,difficulty:z,userAnswer:B,correctAnswer:p,isCorrect:M,responseTime:D,attempts:1};b(K=>K.find(Y=>Y.questionId===P)?K.map(Y=>Y.questionId===P?{...H,attempts:(Y.attempts||0)+1}:Y):[...K,H]),n(K=>new Set([...K,P])),u.current=Date.now()},[m,g]),v=h.useCallback(()=>{if(!g||!m)return;const P=ce(g);P.responses=f,d(P),r(!0),a&&a({session:P,responses:f})},[g,f,m,a]),I=h.useCallback(()=>{r(!1);const P=c.toLowerCase();if(b(E=>E.filter(z=>z.difficulty!==P)),n(E=>{const z=new Set(E),B=c.toLowerCase();return Array.from(E).forEach(p=>{p.startsWith(`${B}-`)&&z.delete(p)}),z}),m){const E=ne(t,i);d(E),u.current=Date.now()}},[m,t,i,c]),$=h.useCallback(()=>{r(!1)},[]);if(j&&m){const P=c===X.Easy?"ç°¡å–®":c===X.Normal?"æ™®é€š":"å›°é›£";return e.jsx(Vs,{topic:`${t} (${P}é›£åº¦)`,studentId:i,apiKey:l,mode:"both",onRetakeQuiz:I,onContinueLearning:$,onClose:()=>r(!1),initialResponses:w()})}if(!s)return e.jsx(Z,{title:"ç·šä¸Šäº’å‹•æ¸¬é©—",icon:e.jsx(fe,{}),children:"æ²’æœ‰å¯ç”¨çš„æ¸¬é©—è³‡æ–™ã€‚"});const k=s[c],S=[{key:X.Easy,label:"ç°¡å–®"},{key:X.Normal,label:"æ™®é€š"},{key:X.Hard,label:"å›°é›£"}],L={trueFalse:"æ˜¯éé¡Œ",multipleChoice:"é¸æ“‡é¡Œ",fillInTheBlanks:"å¡«ç©ºé¡Œ",sentenceScramble:"å¥å­é‡çµ„",memoryCardGame:"ç¿»å¡ç‰Œè¨˜æ†¶éŠæˆ²"},T=()=>{const P=y(),E=N();return P>0?E/P*100:0};return e.jsxs(Z,{title:"ç·šä¸Šäº’å‹•æ¸¬é©—",icon:e.jsx(fe,{className:"w-7 h-7"}),children:[m&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"å­¸ç¿’è¨ºæ–·æ¨¡å¼"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["é€²åº¦: ",N()," / ",y()]}),e.jsxs("button",{onClick:v,disabled:N()===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2 text-sm",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.745 3.745 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})}),"ç”Ÿæˆå­¸ç¿’è¨ºæ–·"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-300 ease-out",style:{width:`${T()}%`}})}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"ğŸ’¡ å®Œæˆé¡Œç›®å¾Œé»æ“Šã€Œç”Ÿæˆå­¸ç¿’è¨ºæ–·ã€ç²å¾—å€‹äººåŒ–å­¸ç¿’å»ºè­°"})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex flex-wrap gap-2 border-b border-slate-300 pb-3 mb-4",children:S.map(({key:P,label:E})=>e.jsx("button",{onClick:()=>x(P),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors
                ${c===P?"bg-sky-600 text-white shadow-md":"bg-slate-200 text-slate-700 hover:bg-slate-300"}`,children:E},P))})}),k?Object.keys(L).map(P=>{if(!(P in k))return null;const E=k[P];return!E||!Array.isArray(E)||E.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsxs("h4",{className:"text-xl font-semibold text-slate-700 mb-3 border-b-2 border-sky-200 pb-1 flex items-center justify-between",children:[e.jsx("span",{children:L[P]}),m&&e.jsxs("span",{className:"text-sm text-gray-500 font-normal",children:["å·²ç­”: ",f.filter(z=>z.questionType===P&&z.difficulty===c).length," / ",E.length]})]}),P==="trueFalse"&&Array.isArray(E)&&E.map((z,B)=>{const p=`${c}-tf-${B}`;return e.jsx("div",{className:o.has(p)?"opacity-75":"",children:e.jsx(fs,{question:z,itemNumber:B+1,onAnswer:m?(M,D)=>{C(p,"trueFalse",c,M,z.isTrue,D)}:void 0})},p)}),P==="multipleChoice"&&Array.isArray(E)&&E.map((z,B)=>{const p=`${c}-mc-${B}`;return e.jsx("div",{className:o.has(p)?"opacity-75":"",children:e.jsx(js,{question:z,itemNumber:B+1,onAnswer:m?(M,D)=>{C(p,"multipleChoice",c,M,z.correctAnswerIndex,D)}:void 0})},p)}),P==="fillInTheBlanks"&&Array.isArray(E)&&E.map((z,B)=>{const p=`${c}-fb-${B}`;return e.jsx("div",{className:o.has(p)?"opacity-75":"",children:e.jsx(vs,{question:z,itemNumber:B+1,onAnswer:m?(M,D)=>{C(p,"fillInTheBlanks",c,M,z.correctAnswer,D)}:void 0})},p)}),P==="sentenceScramble"&&Array.isArray(E)&&E.map((z,B)=>{const p=`${c}-ss-${B}`;return e.jsx("div",{className:o.has(p)?"opacity-75":"",children:e.jsx(ys,{question:z,itemNumber:B+1,onAnswer:m?(M,D)=>{C(p,"sentenceScramble",c,M,z.originalSentence,D)}:void 0})},p)}),P==="memoryCardGame"&&Array.isArray(E)&&E.map((z,B)=>{const p=`${c}-mcg-${B}`;return e.jsx("div",{className:o.has(p)?"opacity-75":"",children:e.jsx(ws,{question:z,itemNumber:B+1,onAnswer:m?(M,D)=>{C(p,"memoryCardGame",c,M,z.pairs,D)}:void 0})},p)})]},`${c}-${P}`)}):e.jsx("p",{children:"æ­¤é›£åº¦ç´šåˆ¥æ²’æœ‰æ‰¾åˆ°æ¸¬é©—é¡Œç›®ã€‚"}),m&&N()>0&&e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-yellow-600 mt-0.5 flex-shrink-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-800 font-medium text-sm",children:"å­¸ç¿’è¨ºæ–·æç¤º"}),e.jsxs("p",{className:"text-yellow-700 text-sm mt-1",children:["æ‚¨å·²å®Œæˆ ",N()," é¡Œæ¸¬é©—ã€‚é»æ“Šä¸Šæ–¹çš„ã€Œç”Ÿæˆå­¸ç¿’è¨ºæ–·ã€æŒ‰éˆ•ï¼ŒAI å°‡ç‚ºæ‚¨åˆ†æå­¸ç¿’ç‹€æ³ä¸¦æä¾›å€‹äººåŒ–å»ºè­°ï¼"]})]})]})})]})},Gs=({config:s,onConfigChange:t,onRegenerate:i,isGenerating:l})=>{const a={trueFalse:"æ˜¯éé¡Œ",multipleChoice:"é¸æ“‡é¡Œ",fillInTheBlanks:"å¡«ç©ºé¡Œ",sentenceScramble:"å¥å­é‡çµ„",memoryCardGame:"ç¿»å¡è¨˜æ†¶"},m=(d,f)=>{const b=ve[d],j=Math.max(0,Math.min(b,f)),r={easy:{...s.easy,[d]:j},normal:{...s.normal,[d]:j},hard:{...s.hard,[d]:j}};t(r)},c=()=>{t(Me)},x=()=>{const d=Object.values(s.easy).reduce((j,r)=>j+r,0),f=Object.values(s.normal).reduce((j,r)=>j+r,0),b=Object.values(s.hard).reduce((j,r)=>j+r,0);return d+f+b},g=d=>s.easy[d]+s.normal[d]+s.hard[d];return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6 border border-indigo-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-indigo-600",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a6.759 6.759 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),"æ¸¬é©—é¡Œæ•¸çµ±ä¸€è¨­å®š"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ä¸€æ¬¡è¨­å®šæ‰€æœ‰é›£åº¦çš„é¡Œç›®æ•¸é‡ â€¢ ç¸½è¨ˆ: ",e.jsx("span",{className:"font-semibold text-indigo-600",children:x()})," é¡Œ"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:c,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:"é‡è¨­é è¨­"}),e.jsx("button",{onClick:i,disabled:l,className:"px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-105 shadow-md flex items-center gap-2 font-medium",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"â³"}),"é‡æ–°ç”Ÿæˆä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),"æ›´æ–°è¨­å®šä¸¦é‡æ–°å‡ºé¡Œ"]})})]})]}),e.jsx("div",{className:"space-y-6",children:Object.keys(a).map(d=>{const f=ve[d],b=s.easy[d],j=g(d);return e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-50 rounded-lg p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-indigo-500 rounded-full"}),e.jsx("h4",{className:"font-semibold text-lg text-gray-800",children:a[d]}),e.jsxs("span",{className:"text-sm text-gray-500 bg-white px-2 py-1 rounded-full border",children:["é™åˆ¶: 0-",f," é¡Œ"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["å„é›£åº¦: ",e.jsx("span",{className:"font-mono font-medium",children:b})," é¡Œ"]}),e.jsxs("div",{className:"text-xs text-indigo-600",children:["ç¸½è¨ˆ: ",e.jsx("span",{className:"font-semibold",children:j})," é¡Œ"]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>m(d,b-1),className:"w-10 h-10 rounded-full bg-red-100 hover:bg-red-200 flex items-center justify-center text-red-600 font-bold text-lg transition-colors shadow-sm",disabled:b<=0,children:"-"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-800 mb-1",children:b}),e.jsx("div",{className:"text-xs text-gray-500",children:"æ¯å€‹é›£åº¦"})]}),e.jsx("button",{onClick:()=>m(d,b+1),className:"w-10 h-10 rounded-full bg-green-100 hover:bg-green-200 flex items-center justify-center text-green-600 font-bold text-lg transition-colors shadow-sm",disabled:b>=f,children:"+"})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-700 text-sm font-semibold mb-1",children:s.easy[d]}),e.jsx("div",{className:"text-xs text-green-700",children:"ç°¡å–®"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-700 text-sm font-semibold mb-1",children:s.normal[d]}),e.jsx("div",{className:"text-xs text-yellow-700",children:"æ™®é€š"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center text-red-700 text-sm font-semibold mb-1",children:s.hard[d]}),e.jsx("div",{className:"text-xs text-red-700",children:"å›°é›£"})]})]})]},d)})}),e.jsx("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-blue-600 mt-0.5 flex-shrink-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"ğŸ“ ä½¿ç”¨èªªæ˜ï¼š"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"â€¢ çµ±ä¸€è¨­å®šæ¨¡å¼"}),e.jsx("p",{children:"èª¿æ•´é¡Œæ•¸æœƒåŒæ™‚å¥—ç”¨åˆ°ç°¡å–®ã€æ™®é€šã€å›°é›£ä¸‰ç¨®é›£åº¦"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"â€¢ é¡Œæ•¸é™åˆ¶"}),e.jsx("p",{children:"ä¸€èˆ¬é¡Œå‹: 0-10é¡Œ | ç¿»å¡è¨˜æ†¶: 0-2é¡Œ"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"â€¢ è·³éé¡Œå‹"}),e.jsx("p",{children:"è¨­å®šç‚º 0 é¡Œå¯å®Œå…¨è·³éè©²ç¨®é¡Œå‹"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"â€¢ è¨˜æ†¶å¡éŠæˆ²"}),e.jsx("p",{children:"æ¯é¡ŒåŒ…å«å¤šå°å¡ç‰‡ï¼Œå»ºè­° 1-2 é¡Œå³å¯"})]})]})]})]})})]})},Fs=({content:s,topic:t,apiKey:i,selectedLevel:l,selectedVocabularyLevel:a,onContentUpdate:m})=>{const[c,x]=A.useState(!1),[g,d]=A.useState(""),[f,b]=A.useState(""),[j,r]=A.useState(!1),[o,n]=A.useState(Me),[u,y]=A.useState(!1),[N,w]=A.useState(!1),C=A.useCallback(async()=>{if(x(!0),d(""),b(""),!s.onlineInteractiveQuiz){d("æ²’æœ‰å¯åˆ†äº«çš„æ¸¬é©—å…§å®¹"),x(!1);return}try{const I=await Je({quiz:s.onlineInteractiveQuiz,topic:t,apiKey:i,metadata:{selectedLevel:l?.name,selectedVocabularyLevel:a?.name,createdAt:new Date().toISOString(),supportsDiagnostic:!!i}});let $=`${window.location.origin}/ai-page-gen/quiz?binId=${I}`;if(i)try{const k=await Ae(i);$+=`&${k}`}catch(k){console.warn("åŠ å¯† API Key å¤±æ•—ï¼Œå°‡ä¸åŒ…å« API Key:",k)}b($)}catch(I){d(I.message||"åˆ†äº«æ¸¬é©—å¤±æ•—")}finally{x(!1)}},[s.onlineInteractiveQuiz,t,i,l,a]),v=A.useCallback(async()=>{if(!s.learningObjectives){alert("ç„¡æ³•é‡æ–°ç”Ÿæˆæ¸¬é©—ï¼šç¼ºå°‘å­¸ç¿’ç›®æ¨™");return}if(!(localStorage.getItem("gemini_api_key")||i)){alert("è«‹å…ˆè¨­å®š Gemini API é‡‘é‘°");return}y(!0);try{const $=await Ye(t,s.learningObjectives,o,l,a),k={...s,onlineInteractiveQuiz:$};m&&m(k),w(!1),alert("æ¸¬é©—å·²æˆåŠŸé‡æ–°ç”Ÿæˆï¼")}catch($){console.error("é‡æ–°ç”Ÿæˆæ¸¬é©—æ™‚ç™¼ç”ŸéŒ¯èª¤:",$),alert("é‡æ–°ç”Ÿæˆæ¸¬é©—å¤±æ•—: "+($.message||"æœªçŸ¥éŒ¯èª¤"))}finally{y(!1)}},[s,t,i,o,l,a,m]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap justify-end items-center gap-2 mb-4",children:[e.jsx("button",{onClick:C,className:"px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition-colors flex items-center text-sm disabled:opacity-60","aria-label":"åˆ†äº«æ¸¬é©—çµ¦å­¸ç”Ÿ",disabled:c,children:c?e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"animate-spin mr-2",children:"â³"})," åˆ†äº«ä¸­..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}),"åˆ†äº«æ¸¬é©—"]})}),e.jsxs("button",{onClick:()=>w(!N),className:"px-4 py-2 bg-teal-500 text-white rounded-md hover:bg-teal-600 transition-colors flex items-center text-sm","aria-label":"æ¸¬é©—è¨­å®š",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 mr-2",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a6.759 6.759 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),"æ¸¬é©—è¨­å®š"]})]}),g&&e.jsx("span",{className:"text-sm text-red-600",children:g}),f&&e.jsxs("div",{className:"mb-4 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("p",{className:"text-sm text-orange-700",children:"æ¸¬é©—åˆ†äº«é€£çµå·²ç”Ÿæˆï¼š"}),i&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"å« AI è¨ºæ–·"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:f,readOnly:!0,className:"w-full px-3 py-2 bg-white border border-orange-300 rounded text-sm",onClick:()=>navigator.clipboard.writeText(f)}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>navigator.clipboard.writeText(f),className:"flex-1 px-3 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 text-sm flex items-center justify-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"})}),"è¤‡è£½é€£çµ"]}),e.jsxs("button",{onClick:()=>r(!j),className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm flex items-center justify-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5H8.25v1.5H13.5V13.5ZM13.5 16.5H8.25V18H13.5v-1.5ZM16.5 16.5h1.5V18h-1.5v-1.5ZM16.5 13.5h1.5v1.5h-1.5v-1.5Z"})]}),"é¡¯ç¤º QR Code"]})]})]}),j&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(ae,{url:f,title:"æ¸¬é©—åˆ†äº« QR Code",size:200,className:"bg-white p-4 rounded-lg shadow-sm"})}),i&&e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:"ğŸ’¡ æ­¤é€£çµåŒ…å«æ‚¨çš„ API Keyï¼Œå­¸ç”Ÿå¯ç›´æ¥ä½¿ç”¨ AI å­¸ç¿’è¨ºæ–·åŠŸèƒ½"})]}),N&&e.jsx(Gs,{config:o,onConfigChange:n,onRegenerate:v,isGenerating:u}),e.jsx(Hs,{quizzes:s.onlineInteractiveQuiz,topic:t,apiKey:i,enableDiagnostic:!!i})]})},ye=[{key:"objectives",label:"æ•™å­¸ç›®æ¨™"},{key:"breakdown",label:"åˆ†è§£å…§å®¹"},{key:"confusing",label:"æ˜“æ··æ·†é»"},{key:"activities",label:"èª²å ‚æ´»å‹•"},{key:"conversation",label:"å°è©±ç·´ç¿’"},{key:"writing",label:"å¯«ä½œç·´ç¿’"},{key:"quiz",label:"äº’å‹•æ¸¬é©—"}],Ee=({content:s,topic:t,selectedLevel:i,selectedVocabularyLevel:l,apiKey:a,onContentUpdate:m})=>{const[c,x]=A.useState(""),[g,d]=A.useState(""),[f,b]=A.useState(ye[0].key),[j,r]=A.useState(!1),[o,n]=A.useState(""),[u,y]=A.useState(""),[N,w]=A.useState(!1),[C,v]=A.useState(""),[I,$]=A.useState(""),[k,S]=A.useState(!1),L=A.useCallback(()=>{navigator.clipboard.writeText(JSON.stringify(s,null,2)).then(()=>{x("JSON å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼"),setTimeout(()=>x(""),2e3)}).catch(z=>{x("è¤‡è£½å¤±æ•—ã€‚"),console.error("Failed to copy: ",z),setTimeout(()=>x(""),2e3)})},[s]),T=A.useCallback(()=>{try{Ls(s,t),d("HTML æª”æ¡ˆå·²é–‹å§‹ä¸‹è¼‰ï¼"),setTimeout(()=>d(""),3e3)}catch(z){console.error("Failed to export HTML:",z),d("åŒ¯å‡º HTML å¤±æ•—ã€‚"),setTimeout(()=>d(""),3e3)}},[s,t]),P=A.useCallback(async()=>{r(!0),n(""),y("");try{const z={...s,topic:t,selectedLevel:i,selectedVocabularyLevel:l,sharedAt:new Date().toISOString()},B=await pe(z),p=`${window.location.origin}/ai-page-gen/share?binId=${B}`;y(p)}catch(z){n(z.message||"åˆ†äº«å¤±æ•—")}finally{r(!1)}},[s,t,i,l]),E=A.useCallback(async()=>{w(!0),v(""),$("");try{const z={...s,topic:t,selectedLevel:i,selectedVocabularyLevel:l,sharedAt:new Date().toISOString()},B=await pe(z),p=`${window.location.origin}/ai-page-gen/teacher-interactive-prep?binId=${B}`;$(p)}catch(z){v(z.message||"åˆ†äº«æ•™ææº–å‚™å¤±æ•—")}finally{w(!1)}},[s,t,i,l]);return e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex flex-wrap justify-end items-center gap-2 mb-4",children:[e.jsxs("button",{onClick:L,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors flex items-center text-sm","aria-label":"è¤‡è£½ç”¢ç”Ÿçš„ JSON å…§å®¹",children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"})," è¤‡è£½ç”¢ç”Ÿçš„ JSON"]}),e.jsxs("button",{onClick:T,className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors flex items-center text-sm","aria-label":"å°‡å­¸ç¿’å…§å®¹åŒ¯å‡ºç‚º HTML æª”æ¡ˆ",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"åŒ¯å‡ºç‚º HTML"]}),e.jsx("button",{onClick:P,className:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition-colors flex items-center text-sm disabled:opacity-60","aria-label":"åˆ†äº«æ•™å­¸æ–¹æ¡ˆ",disabled:j,children:j?e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"animate-spin mr-2",children:"â³"})," åˆ†äº«ä¸­..."]}):e.jsx("span",{children:"åˆ†äº«æ–¹æ¡ˆ"})}),e.jsx("button",{onClick:E,className:"px-4 py-2 bg-emerald-500 text-white rounded-md hover:bg-emerald-600 transition-colors flex items-center text-sm disabled:opacity-60","aria-label":"åˆ†äº«æ•™ææº–å‚™",disabled:N,children:N?e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"animate-spin mr-2",children:"â³"})," åˆ†äº«ä¸­..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})}),"æ•™ææº–å‚™"]})}),c&&e.jsx("span",{className:"text-sm text-green-600",children:c}),g&&e.jsx("span",{className:"text-sm text-blue-600",children:g}),o&&e.jsx("span",{className:"text-sm text-red-600",children:o}),C&&e.jsx("span",{className:"text-sm text-red-600",children:C})]}),u&&e.jsxs("div",{className:"mb-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-2",children:"æ–¹æ¡ˆåˆ†äº«é€£çµå·²ç”Ÿæˆï¼š"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:u,readOnly:!0,className:"flex-1 px-3 py-2 bg-white border border-purple-300 rounded text-sm",onClick:()=>navigator.clipboard.writeText(u)}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(u),className:"px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm",children:"è¤‡è£½"})]})]}),I&&e.jsxs("div",{className:"mb-4 p-4 bg-emerald-50 border border-emerald-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-emerald-700 mb-2",children:"æ•™ææº–å‚™é€£çµå·²ç”Ÿæˆï¼š"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{type:"text",value:I,readOnly:!0,className:"flex-1 px-3 py-2 bg-white border border-emerald-300 rounded text-sm",onClick:()=>navigator.clipboard.writeText(I)}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(I),className:"px-3 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 text-sm",children:"è¤‡è£½"}),e.jsxs("button",{onClick:()=>S(!k),className:"px-3 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 text-sm flex items-center gap-1",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h.75v.75h-.75v-.75ZM13.5 19.5h.75v.75h-.75v-.75ZM19.5 13.5h.75v.75h-.75v-.75ZM19.5 19.5h.75v.75h-.75v-.75ZM16.5 16.5h.75v.75h-.75v-.75Z"})]}),"QR"]})]}),k&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(ae,{url:I,title:"æ•™ææº–å‚™åˆ†äº« QR Code",size:200,className:"bg-white p-4 rounded-lg shadow-sm"})}),e.jsx("div",{className:"text-xs text-emerald-600 bg-emerald-100 px-3 py-2 rounded-lg",children:"ğŸ’¡ æ•™å¸«å¯ä»¥é€šéæ­¤é€£çµæº–å‚™äº’å‹•æ•™æï¼ŒåŒ…å«å…§å®¹è½‰æ›ã€æª¢æŸ¥å’Œç™¼å¸ƒåŠŸèƒ½"})]}),e.jsx("div",{className:"mb-8 p-6 bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ie,{className:"w-5 h-5 text-indigo-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-indigo-600",children:"å­¸ç¿’ä¸»é¡Œ"})]}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-0 truncate",children:t})]}),(i||l)&&e.jsxs("div",{className:"flex gap-3 ml-6 flex-shrink-0",children:[i&&e.jsxs("div",{className:"bg-white px-3 py-2 rounded-lg shadow-sm border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(re,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"text-xs font-medium text-indigo-600",children:"å­¸ç¿’ç¨‹åº¦"})]}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:i.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-32",title:i.description,children:i.description.length>20?i.description.substring(0,20)+"...":i.description})]}),l&&e.jsxs("div",{className:"bg-white px-3 py-2 rounded-lg shadow-sm border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:"è©å½™ç¨‹åº¦"})]}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:l.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[l.wordCount," è©å½™"]})]})]})]})}),e.jsxs(Is,{tabs:ye,current:f,onChange:b,children:[e.jsx(Ps,{objectives:s.learningObjectives}),e.jsx(As,{breakdown:s.contentBreakdown}),e.jsx(Ms,{points:s.confusingPoints}),e.jsx(Es,{activities:s.classroomActivities}),e.jsx(zs,{englishConversation:s.englishConversation,learningObjectives:s.learningObjectives,contentBreakdown:s.contentBreakdown,topic:t,apiKey:a,selectedLevel:i,selectedVocabularyLevel:l}),e.jsx(Os,{writingPractice:s.writingPractice,topic:t,apiKey:a,selectedLevel:i,selectedVocabularyLevel:l}),e.jsx(Fs,{content:s,topic:t,apiKey:a,selectedLevel:i,selectedVocabularyLevel:l,onContentUpdate:m})]})]})},Zs=({learningLevels:s,onLevelSelect:t,onGenerateWithLevel:i,selectedLevelId:l,isLoading:a=!1})=>{const[m,c]=h.useState(l||s.defaultLevelId),x=d=>{c(d.id),t?.(d)},g=[...s.suggestedLevels].sort((d,f)=>d.order-f.order);return e.jsx(Z,{title:"å­¸ç¿’ç¨‹åº¦å»ºè­°",icon:e.jsx(re,{className:"w-7 h-7"}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"æ ¹æ“šå­¸ç¿’ä¸»é¡Œè‡ªå‹•ç”Ÿæˆçš„ç¨‹åº¦å»ºè­°ï¼Œé¸æ“‡æœ€é©åˆçš„å­¸ç¿’ç­‰ç´šï¼š"}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:g.map(d=>e.jsxs("div",{className:`
                relative p-4 rounded-lg border-2 cursor-pointer transition-all duration-200
                ${m===d.id?"border-sky-500 bg-sky-50 shadow-md":"border-slate-300 bg-white hover:border-sky-300 hover:shadow-sm"}
              `,onClick:()=>x(d),children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`
                  flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold
                  ${m===d.id?"bg-sky-500 text-white":"bg-slate-200 text-slate-700"}
                `,children:d.order}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`
                    text-lg font-semibold mb-2
                    ${m===d.id?"text-sky-700":"text-slate-700"}
                  `,children:d.name}),e.jsx("p",{className:`
                    text-sm leading-relaxed
                    ${m===d.id?"text-sky-600":"text-slate-600"}
                  `,children:d.description})]})]}),m===d.id&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-3 h-3 bg-sky-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})})})]},d.id))}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{children:["å·²é¸æ“‡ï¼š",e.jsx("strong",{children:g.find(d=>d.id===m)?.name})]})]})}),i&&e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:()=>{const d=g.find(f=>f.id===m);d&&i(d)},disabled:a,className:"px-8 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"ç”¢ç”Ÿå…§å®¹ä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"é–‹å§‹ç”¢ç”Ÿå­¸ç¿’å…§å®¹"]})})})]})]})})},te=[{id:"beginner",name:"åˆç´š (100-500è©)",wordCount:500,description:"é©åˆè‹±èªåˆå­¸è€…ï¼Œä½¿ç”¨æœ€åŸºæœ¬çš„æ—¥å¸¸è©å½™"},{id:"elementary",name:"åŸºç¤ (500-1000è©)",wordCount:1e3,description:"æŒæ¡åŸºæœ¬æœƒè©±è©å½™ï¼Œèƒ½é€²è¡Œç°¡å–®äº¤æµ"},{id:"pre-intermediate",name:"åˆä¸­ç´š (1000-2000è©)",wordCount:2e3,description:"èƒ½ç†è§£æ—¥å¸¸ç”Ÿæ´»å’Œå·¥ä½œä¸­çš„å¸¸è¦‹è©å½™"},{id:"intermediate",name:"ä¸­ç´š (2000-3500è©)",wordCount:3500,description:"èƒ½è™•ç†è¼ƒè¤‡é›œçš„æ–‡æœ¬å’Œå­¸è¡“å…§å®¹"},{id:"upper-intermediate",name:"ä¸­é«˜ç´š (3500-5000è©)",wordCount:5e3,description:"èƒ½ç†è§£å°ˆæ¥­æ–‡ç« å’Œè¼ƒè¤‡é›œçš„èªè¨€çµæ§‹"},{id:"advanced",name:"é«˜ç´š (5000-7000è©)",wordCount:7e3,description:"å…·å‚™é«˜æ°´å¹³çš„è‹±èªç†è§£å’Œè¡¨é”èƒ½åŠ›"}],Qs=({onVocabularyLevelSelect:s,selectedLevel:t,isVisible:i=!0})=>{const[l,a]=h.useState(t?.id||"intermediate"),m=c=>{a(c.id),s(c)};return i?e.jsx(Z,{title:"é¸æ“‡è‹±èªå–®å­—ç¨‹åº¦",icon:e.jsx(le,{className:"w-7 h-7"}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"è«‹é¸æ“‡æ‚¨çš„è‹±èªå–®å­—é‡ç¯„åœï¼Œç³»çµ±æœƒæ ¹æ“šæ­¤ç¨‹åº¦èª¿æ•´æ•™å­¸å…§å®¹çš„è¤‡é›œåº¦ï¼š"}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:te.map(c=>e.jsxs("div",{className:`
                relative p-4 rounded-lg border-2 cursor-pointer transition-all duration-200
                ${l===c.id?"border-green-500 bg-green-50 shadow-md":"border-slate-300 bg-white hover:border-green-300 hover:shadow-sm"}
              `,onClick:()=>m(c),children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`
                    flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                    ${l===c.id?"bg-green-500 text-white":"bg-slate-200 text-slate-700"}
                  `,children:c.wordCount>=1e3?`${c.wordCount/1e3}k`:c.wordCount}),e.jsx("h4",{className:`
                    text-sm font-semibold
                    ${l===c.id?"text-green-700":"text-slate-700"}
                  `,children:c.name})]}),e.jsx("p",{className:`
                  text-xs leading-relaxed
                  ${l===c.id?"text-green-600":"text-slate-600"}
                `,children:c.description})]}),l===c.id&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})})})]},c.id))}),e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-600",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsxs("span",{children:["å·²é¸æ“‡ï¼š",e.jsx("strong",{children:te.find(c=>c.id===l)?.name}),"ï¼ˆ",te.find(c=>c.id===l)?.wordCount," è©å½™ï¼‰"]})]})})]})}):null},$e=({isOpen:s,onSave:t,title:i="è¨­å®š AI Provider",message:l="è«‹é¸æ“‡ä¸¦è¨­å®šæ‚¨çš„ AI Provider ä»¥é–‹å§‹ä½¿ç”¨"})=>{const[a,m]=h.useState(R.GEMINI),[c,x]=h.useState(""),[g,d]=h.useState(!1),[f,b]=h.useState(""),[j,r]=h.useState(!1),[o,n]=h.useState(""),[u,y]=h.useState("gemini-2.5-flash"),[N,w]=h.useState("openai/gpt-4o"),[C,v]=h.useState(.7),I=()=>{x(""),b(""),n(""),v(.7),y("gemini-2.5-flash"),w("openai/gpt-4o"),r(!1)};h.useEffect(()=>{s&&I()},[s]),h.useEffect(()=>{j||n(a===R.GEMINI?"Gemini Provider":"OpenRouter Provider")},[a,j]);const $=async()=>{if(!c.trim()){b("è«‹è¼¸å…¥ API Key");return}d(!0),b("");try{const S={id:`${a}_${Date.now()}`,name:o||(a===R.GEMINI?"Gemini Provider":"OpenRouter Provider"),type:a,enabled:!0,apiKey:c.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};let L;a===R.GEMINI?L={...S,type:R.GEMINI,model:u,settings:{responseMimeType:"application/json",temperature:C,maxOutputTokens:8192}}:L={...S,type:R.OPENROUTER,model:N,settings:{temperature:C,max_tokens:4096,stream:!1}},await Xe(L),a===R.GEMINI&&localStorage.setItem("gemini_api_key",c.trim()),t(c.trim()),I()}catch(S){console.error("è¨­å®š Provider å¤±æ•—:",S),b(S instanceof Error?S.message:"è¨­å®šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢º")}finally{d(!1)}},k=async()=>{r(!1),await $()};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-lg w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:i}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"é¸æ“‡ AI Provider"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>m(R.GEMINI),className:`p-4 border-2 rounded-lg text-left transition-colors ${a===R.GEMINI?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"G"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Gemini"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Google AI"})]})]})}),e.jsx("button",{onClick:()=>m(R.OPENROUTER),className:`p-4 border-2 rounded-lg text-left transition-colors ${a===R.OPENROUTER?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"O"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"OpenRouter"}),e.jsx("div",{className:"text-xs text-gray-500",children:"çµ±ä¸€ API"})]})]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a===R.GEMINI?"Gemini API Key":"OpenRouter API Key"}),e.jsx("input",{type:"password",value:c,onChange:S=>x(S.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:a===R.GEMINI?"è¼¸å…¥æ‚¨çš„ Gemini API Key":"è¼¸å…¥æ‚¨çš„ OpenRouter API Key"}),e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:a===R.GEMINI?e.jsxs(e.Fragment,{children:["åœ¨ ",e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google AI Studio"})," ç²å– API Key"]}):e.jsxs(e.Fragment,{children:["åœ¨ ",e.jsx("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"OpenRouter"})," ç²å– API Key"]})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>r(!j),className:"flex items-center gap-2 text-sm text-indigo-600 hover:text-indigo-700",children:[e.jsx("svg",{className:`w-4 h-4 transition-transform ${j?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"é€²éšè¨­å®š"]})}),j&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provider åç¨±"}),e.jsx("input",{type:"text",value:o,onChange:S=>n(S.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"è‡ªè¨‚ Provider åç¨±"})]}),a===R.GEMINI&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"æ¨¡å‹"}),e.jsxs("select",{value:u,onChange:S=>y(S.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"gemini-2.5-flash",children:"Gemini 2.5 Flash (æ¨è–¦)"}),e.jsx("option",{value:"gemini-pro",children:"Gemini Pro"}),e.jsx("option",{value:"gemini-pro-vision",children:"Gemini Pro Vision"})]})]}),a===R.OPENROUTER&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"æ¨¡å‹"}),e.jsxs("select",{value:N,onChange:S=>w(S.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"openai/gpt-4o",children:"GPT-4o (æ¨è–¦)"}),e.jsx("option",{value:"anthropic/claude-3.5-sonnet",children:"Claude 3.5 Sonnet"}),e.jsx("option",{value:"google/gemini-2.5-pro",children:"Gemini 2.5 Pro"}),e.jsx("option",{value:"mistralai/mistral-large-2411",children:"Mistral Large"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["æº«åº¦ (Temperature): ",C]}),e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:C,onChange:S=>v(parseFloat(S.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"ä¿å®ˆ (0)"}),e.jsx("span",{children:"å¹³è¡¡ (1)"}),e.jsx("span",{children:"å‰µæ„ (2)"})]})]})]}),f&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:f})})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:j?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded hover:bg-gray-50",disabled:g,children:"ç°¡åŒ–è¨­å®š"}),e.jsx("button",{onClick:$,disabled:!c.trim()||g,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"è¨­å®šä¸­...":"å®Œæˆè¨­å®š"})]}):e.jsx("button",{onClick:k,disabled:!c.trim()||g,className:"px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"è¨­å®šä¸­...":"å¿«é€Ÿè¨­å®š"})})]})}):null},we=({provider:s,selectedModel:t,onModelChange:i,disabled:l=!1})=>{const[a,m]=h.useState([]),[c,x]=h.useState(!1),[g,d]=h.useState(null),f=h.useCallback(async()=>{x(!0),d(null);try{let r;if(s.type===R.GEMINI)r=new es(s);else if(s.type===R.OPENROUTER)r=new ss(s);else throw new Error("ä¸æ”¯æ´çš„ Provider é¡å‹");const n=(await r.getAvailableModels()).map(u=>({id:u.id,name:u.name||u.id,description:u.description,inputTokenLimit:u.inputTokenLimit||u.context_length,outputTokenLimit:u.outputTokenLimit||u.max_tokens}));m(n),n.length>0&&!n.some(u=>u.id===t)&&i(n[0].id)}catch(r){console.error("ç²å–æ¨¡å‹åˆ—è¡¨å¤±æ•—:",r),d(r instanceof Error?r.message:"ç²å–æ¨¡å‹åˆ—è¡¨å¤±æ•—"),m(b(s.type))}finally{x(!1)}},[s,t,i]);h.useEffect(()=>{s.apiKey&&s.apiKey.trim().length>10?f():(m([]),d(null))},[s.apiKey,s.type,f]);const b=r=>r===R.GEMINI?[{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash"},{id:"gemini-pro",name:"Gemini Pro"},{id:"gemini-pro-vision",name:"Gemini Pro Vision"}]:r===R.OPENROUTER?[{id:"openai/gpt-4o",name:"GPT-4o"},{id:"anthropic/claude-3.5-sonnet",name:"Claude 3.5 Sonnet"},{id:"google/gemini-2.5-pro",name:"Gemini 2.5 Pro"},{id:"mistralai/mistral-large-2411",name:"Mistral Large"}]:[],j=()=>{s.apiKey&&s.apiKey.trim().length>10&&f()};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"æ¨¡å‹"}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsx("div",{className:"w-4 h-4 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),e.jsx("button",{type:"button",onClick:j,disabled:c||l||!s.apiKey,className:"text-xs text-indigo-600 hover:text-indigo-700 disabled:text-gray-400 disabled:cursor-not-allowed",title:"é‡æ–°ç²å–æ¨¡å‹åˆ—è¡¨",children:"â†» é‡æ–°ç²å–"})]})]}),e.jsx("select",{value:t,onChange:r=>i(r.target.value),disabled:l||c||a.length===0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed",children:a.length===0?e.jsx("option",{value:"",children:s.apiKey?"è¼‰å…¥ä¸­...":"è«‹å…ˆè¼¸å…¥ API Key"}):a.map(r=>e.jsxs("option",{value:r.id,children:[r.name,r.description&&` - ${r.description.substring(0,50)}...`]},r.id))}),g&&e.jsxs("p",{className:"mt-1 text-xs text-red-600",children:[g,e.jsx("button",{type:"button",onClick:j,className:"ml-2 text-indigo-600 hover:text-indigo-700 underline",children:"é‡è©¦"})]}),a.length>0&&!c&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["æ‰¾åˆ° ",a.length," å€‹å¯ç”¨æ¨¡å‹",t&&e.jsxs(e.Fragment,{children:[" â€¢ å·²é¸æ“‡: ",e.jsx("span",{className:"font-medium",children:a.find(r=>r.id===t)?.name||t})]})]})]})},Ne=({isOpen:s,onClose:t,onSave:i,currentProviders:l})=>{const[a,m]=h.useState(l),[c,x]=h.useState(null),[g,d]=h.useState(!1),[f,b]=h.useState(new Map),[j,r]=h.useState(!1),[o,n]=h.useState(!1),[u,y]=h.useState(null),[N,w]=h.useState(void 0);h.useEffect(()=>{s&&(m([...l]),C())},[s,l]);const C=h.useCallback(async()=>{try{const M=(await G.getManager()).config;w(M?.defaultProviderId)}catch(p){console.error("è¼‰å…¥é è¨­ Provider ID å¤±æ•—:",p)}},[]),v=async()=>{try{const p=await G.getProviders();m(p),i(p),await C()}catch(p){console.error("è¼‰å…¥ Provider é…ç½®å¤±æ•—:",p)}},I=async p=>{try{await G.setDefaultProvider(p),w(p)}catch(M){console.error("è¨­ç½®é è¨­ Provider å¤±æ•—:",M),alert(`è¨­ç½®é è¨­ Provider å¤±æ•—: ${M instanceof Error?M.message:"æœªçŸ¥éŒ¯èª¤"}`)}},$=p=>{const M={id:`${p}_${Date.now()}`,name:`æ–° ${p===R.GEMINI?"Gemini":"OpenRouter"} Provider`,type:p,enabled:!0,apiKey:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return p===R.GEMINI?{...M,type:R.GEMINI,model:"gemini-2.5-flash",settings:{responseMimeType:"application/json",temperature:.7,maxOutputTokens:8192}}:{...M,type:R.OPENROUTER,model:"openai/gpt-4o",settings:{temperature:.7,max_tokens:4096,stream:!1}}},k=p=>{const M=$(p);x(M),d(!0)},S=p=>{x({...p}),d(!0)},L=async p=>{if(!(u||!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ Provider å—ï¼Ÿ"))){y(p);try{await G.removeProvider(p),m(M=>M.filter(D=>D.id!==p)),b(M=>{const D=new Map(M);return D.delete(p),D}),await v()}catch(M){console.error("åˆªé™¤ Provider å¤±æ•—:",M),alert(`åˆªé™¤å¤±æ•—: ${M instanceof Error?M.message:"æœªçŸ¥éŒ¯èª¤"}`)}finally{y(null)}}},T=async()=>{if(!(!c||o)){n(!0);try{c.updatedAt=new Date().toISOString();const p=a.findIndex(M=>M.id===c.id);p>=0?(await G.updateProvider(c),m(M=>M.map((D,H)=>H===p?c:D))):(await G.addProvider(c),m(M=>[...M,c])),x(null),d(!1),await v()}catch(p){console.error("ä¿å­˜ Provider å¤±æ•—:",p),alert(`ä¿å­˜å¤±æ•—: ${p instanceof Error?p.message:"æœªçŸ¥éŒ¯èª¤"}`)}finally{n(!1)}}},P=async p=>{try{b(H=>new Map(H.set(p.id,{providerId:p.id,status:U.TESTING,testedAt:new Date().toISOString()})));const D=await ts.getInstance({providers:[p],fallbackEnabled:!1,timeout:3e4,retryAttempts:1}).testProvider(p.id);b(H=>new Map(H.set(p.id,D)))}catch(M){b(D=>new Map(D.set(p.id,{providerId:p.id,status:U.ERROR,error:M instanceof Error?M.message:"æ¸¬è©¦å¤±æ•—",testedAt:new Date().toISOString()})))}},E=async()=>{r(!0);for(const p of a)p.enabled&&p.apiKey&&await P(p);r(!1)},z=p=>{const M=f.get(p);if(!M)return null;const D={[U.TESTING]:"text-yellow-600 bg-yellow-50",[U.ACTIVE]:"text-green-600 bg-green-50",[U.ERROR]:"text-red-600 bg-red-50",[U.INACTIVE]:"text-gray-600 bg-gray-50"},H={[U.TESTING]:"æ¸¬è©¦ä¸­...",[U.ACTIVE]:`æ­£å¸¸ (${M.responseTime}ms)`,[U.ERROR]:M.error||"éŒ¯èª¤",[U.INACTIVE]:"æœªå•Ÿç”¨"};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D[M.status]}`,children:H[M.status]})},B=()=>{i(a),t()};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"AI Provider è¨­å®š"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ç®¡ç†æ‚¨çš„ AI Provider é…ç½®å’Œ API é‡‘é‘°"})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex",children:[e.jsxs("div",{className:"w-1/2 border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Provider æ¸…å–®"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(R.GEMINI),disabled:o||u!==null,className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"+ Gemini"}),e.jsx("button",{onClick:()=>k(R.OPENROUTER),disabled:o||u!==null,className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"+ OpenRouter"})]})]}),e.jsx("button",{onClick:E,disabled:j,className:"mt-3 w-full px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 text-sm",children:j?"æ¸¬è©¦ä¸­...":"æ¸¬è©¦æ‰€æœ‰ Provider"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-4",children:[a.map(p=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${c?.id===p.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>S(p),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:p.name}),N===p.id&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"é è¨­"})]}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:p.type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[z(p.id),e.jsx("button",{onClick:M=>{M.stopPropagation(),P(p)},className:"p-1 text-gray-400 hover:text-gray-600",title:"æ¸¬è©¦é€£æ¥",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),p.enabled&&N!==p.id&&e.jsx("button",{onClick:M=>{M.stopPropagation(),I(p.id)},className:"p-1 text-blue-400 hover:text-blue-600",title:"è¨­ç‚ºé è¨­",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),L(p.id)},disabled:u===p.id,className:"p-1 text-red-400 hover:text-red-600 disabled:opacity-50 disabled:cursor-not-allowed",title:u===p.id?"åˆªé™¤ä¸­...":"åˆªé™¤",children:u===p.id?e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),p.enabled?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"å•Ÿç”¨"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"åœç”¨"})]},p.id)),a.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"å°šæœªè¨­å®šä»»ä½• Provider"}),e.jsx("p",{className:"text-sm mt-1",children:"é»æ“Šä¸Šæ–¹æŒ‰éˆ•æ·»åŠ æ–°çš„ Provider"})]})]})})]}),e.jsx("div",{className:"w-1/2 flex flex-col",children:g&&c?e.jsx(Us,{provider:c,onChange:x,onSave:T,onCancel:()=>{x(null),d(!1)},isSaving:o}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("svg",{className:"w-16 h-16 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("p",{children:"é¸æ“‡å·¦å´çš„ Provider é€²è¡Œç·¨è¼¯"}),e.jsx("p",{className:"text-sm mt-1",children:"æˆ–é»æ“Šä¸Šæ–¹æŒ‰éˆ•æ·»åŠ æ–°çš„ Provider"})]})})})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded hover:bg-gray-50",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:B,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"ä¿å­˜è¨­å®š"})]})]})}):null},Us=({provider:s,onChange:t,onSave:i,onCancel:l,isSaving:a=!1})=>{const m=x=>{t({...s,...x})},c=x=>{t({...s,settings:{...s.settings,...x}})};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[s.id.includes("_")&&s.id.split("_")[1]===Date.now().toString()?"æ–°å¢":"ç·¨è¼¯"," Provider"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"åŸºæœ¬è¨­å®š"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"åç¨±"}),e.jsx("input",{type:"text",value:s.name,onChange:x=>m({name:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"é¡å‹"}),e.jsxs("select",{value:s.type,onChange:x=>m({type:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:R.GEMINI,children:"Gemini"}),e.jsx("option",{value:R.OPENROUTER,children:"OpenRouter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),e.jsx("input",{type:"password",value:s.apiKey,onChange:x=>m({apiKey:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"è«‹è¼¸å…¥ API Key"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"æè¿° (å¯é¸)"}),e.jsx("textarea",{value:s.description||"",onChange:x=>m({description:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",rows:3,placeholder:"æè¿°é€™å€‹ Provider çš„ç”¨é€”..."})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:x=>m({enabled:x.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"å•Ÿç”¨æ­¤ Provider"})]})]})]}),s.type===R.GEMINI&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Gemini è¨­å®š"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(we,{provider:s,selectedModel:s.model,onModelChange:x=>m({model:x}),disabled:a}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"æº«åº¦ (Temperature)"}),e.jsx("input",{type:"number",min:"0",max:"2",step:"0.1",value:s.settings.temperature||.7,onChange:x=>c({temperature:parseFloat(x.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"æœ€å¤§è¼¸å‡º Tokens"}),e.jsx("input",{type:"number",min:"1",max:"32768",value:s.settings.maxOutputTokens||8192,onChange:x=>c({maxOutputTokens:parseInt(x.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]})]}),s.type===R.OPENROUTER&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"OpenRouter è¨­å®š"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(we,{provider:s,selectedModel:s.model,onModelChange:x=>m({model:x}),disabled:a}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"æº«åº¦ (Temperature)"}),e.jsx("input",{type:"number",min:"0",max:"2",step:"0.1",value:s.settings.temperature||.7,onChange:x=>c({temperature:parseFloat(x.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"æœ€å¤§ Tokens"}),e.jsx("input",{type:"number",min:"1",max:"200000",value:s.settings.max_tokens||4096,onChange:x=>c({max_tokens:parseInt(x.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.settings.stream||!1,onChange:x=>c({stream:x.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"å•Ÿç”¨ä¸²æµå›æ‡‰"})]})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:l,disabled:a,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"å–æ¶ˆ"}),e.jsxs("button",{onClick:i,disabled:a,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[a&&e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a?"ä¿å­˜ä¸­...":"ä¿å­˜"]})]})]})},Ks=({providers:s,selectedProviderId:t,onProviderSelect:i,onStrategyChange:l,usageStats:a=[],showStrategy:m=!1,className:c=""})=>{const[x,g]=h.useState(!1),[d,f]=h.useState(se.DEFAULT),b=s.filter(y=>y.enabled),j=s.find(y=>y.id===t),r=y=>a.find(N=>N.providerId===y),o=y=>{f(y),l?.(y)},n=y=>{const N=r(y.id);if(!N)return e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full",title:"æœªæ¸¬è©¦"});const w=N.totalRequests>0?N.successfulRequests/N.totalRequests*100:0;return w>=90?e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full",title:`æˆåŠŸç‡: ${w.toFixed(1)}%`}):w>=70?e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full",title:`æˆåŠŸç‡: ${w.toFixed(1)}%`}):e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full",title:`æˆåŠŸç‡: ${w.toFixed(1)}%`})},u=y=>{const N="w-4 h-4";switch(y.type){case"gemini":return e.jsx("div",{className:`${N} bg-blue-500 rounded-full flex items-center justify-center`,children:e.jsx("span",{className:"text-white text-xs font-bold",children:"G"})});case"openrouter":return e.jsx("div",{className:`${N} bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center`,children:e.jsx("span",{className:"text-white text-xs font-bold",children:"O"})});default:return e.jsx("div",{className:`${N} bg-gray-500 rounded-full flex items-center justify-center`,children:e.jsx("span",{className:"text-white text-xs font-bold",children:"?"})})}};return b.length===0?e.jsx("div",{className:`p-3 bg-yellow-50 border border-yellow-200 rounded-lg ${c}`,children:e.jsx("p",{className:"text-sm text-yellow-800",children:"å°šæœªè¨­å®šå¯ç”¨çš„ Provider"})}):e.jsxs("div",{className:`relative ${c}`,children:[m&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"é¸æ“‡ç­–ç•¥"}),e.jsxs("select",{value:d,onChange:y=>o(y.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:se.DEFAULT,children:"é è¨­ Provider"}),e.jsx("option",{value:se.FASTEST,children:"æœ€å¿«å›æ‡‰"}),e.jsx("option",{value:se.FALLBACK,children:"ä¾åºå˜—è©¦"}),e.jsx("option",{value:se.LOAD_BALANCE,children:"è² è¼‰å¹³è¡¡"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>g(!x),className:"w-full px-4 py-3 text-left bg-white border border-gray-300 rounded-lg hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:j?e.jsxs(e.Fragment,{children:[u(j),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:j.name}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:j.type})]}),n(j)]}):e.jsx("span",{className:"text-gray-500",children:"é¸æ“‡ Provider"})}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${x?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),x&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:[b.map(y=>{const N=r(y.id),w=y.id===t;return e.jsx("button",{onClick:()=>{i(y.id),g(!1)},className:`w-full px-4 py-3 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors ${w?"bg-indigo-50 border-r-2 border-indigo-500":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[u(y),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:y.name}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:y.type}),N&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["æˆåŠŸç‡: ",N.totalRequests>0?(N.successfulRequests/N.totalRequests*100).toFixed(1):0,"%",N.averageResponseTime>0&&e.jsxs("span",{className:"ml-2",children:["å¹³å‡: ",Math.round(N.averageResponseTime),"ms"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[n(y),w&&e.jsx("svg",{className:"w-4 h-4 text-indigo-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]})]})},y.id)}),e.jsx("div",{className:"border-t border-gray-200",children:e.jsx("button",{onClick:()=>{g(!1),window.dispatchEvent(new CustomEvent("openProviderSettings"))},className:"w-full px-4 py-3 text-left text-indigo-600 hover:bg-indigo-50 focus:outline-none focus:bg-indigo-50 transition-colors",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"text-sm font-medium",children:"ç®¡ç† Provider"})]})})})]})]}),j&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"ç•¶å‰é¸ä¸­:"}),e.jsx("span",{className:"font-medium text-gray-900",children:j.name})]}),j.description&&e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:j.description})]})]})},Js=({onProviderChange:s,showSelector:t=!0,compact:i=!1,className:l=""})=>{const[a,m]=h.useState([]),[c,x]=h.useState(""),[g,d]=h.useState([]),[f,b]=h.useState(!1),[j,r]=h.useState(!0),[o,n]=h.useState(null),u=h.useCallback(async()=>{try{r(!0),n(null);const[w,C,v]=await Promise.all([G.getProviders(),G.getUsageStats(),G.getManager()]);m(w),d(C);const $=v.config?.defaultProviderId;let k;$&&(k=w.find(S=>S.id===$&&S.enabled)),k||(k=w.find(S=>S.enabled)||w[0]),k&&!c&&(x(k.id),s?.(k))}catch(w){console.error("è¼‰å…¥ Provider æ•¸æ“šå¤±æ•—:",w),n(w instanceof Error?w.message:"è¼‰å…¥å¤±æ•—")}finally{r(!1)}},[c,s]);h.useEffect(()=>{u();const w=()=>{b(!0)};return window.addEventListener("openProviderSettings",w),()=>{window.removeEventListener("openProviderSettings",w)}},[u]);const y=w=>{x(w);const C=a.find(v=>v.id===w);s?.(C||null)},N=async w=>{try{m(w);const C=w.find(I=>I.id===c);if(!C||!C.enabled){const I=w.find($=>$.enabled);I?(x(I.id),s?.(I)):(x(""),s?.(null))}const v=await G.getUsageStats();d(v)}catch(C){console.error("æ›´æ–° Provider è¨­å®šå¤±æ•—:",C),n(C instanceof Error?C.message:"æ›´æ–°å¤±æ•—")}};if(i){const w=a.find(C=>C.id===c);return e.jsxs("div",{className:`flex items-center gap-3 ${l}`,children:[j?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-indigo-500 rounded-full animate-spin"}),e.jsx("span",{children:"è¼‰å…¥ä¸­..."})]}):o?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"è¼‰å…¥å¤±æ•—"})]}):a.length===0?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5l-6.928-12c-.77-.833-1.732-.833-2.502 0l-6.928 12c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{children:"å°šæœªè¨­å®š"})]}):e.jsx(e.Fragment,{children:w?e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:w.name})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),e.jsx("span",{children:"æœªé¸æ“‡"})]})}),e.jsx("button",{onClick:()=>b(!0),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Provider è¨­å®š",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx(Ne,{isOpen:f,onClose:()=>b(!1),onSave:N,currentProviders:a})]})}return e.jsxs("div",{className:`space-y-4 ${l}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Provider è¨­å®š"}),e.jsx("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"ç®¡ç† Provider"})]}),j&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-500",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-indigo-500 rounded-full animate-spin"}),e.jsx("span",{children:"è¼‰å…¥ Provider è¨­å®šä¸­..."})]})}),o&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium",children:"è¼‰å…¥å¤±æ•—"})]}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:o}),e.jsx("button",{onClick:u,className:"mt-3 px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700",children:"é‡è©¦"})]}),!j&&!o&&a.length===0&&e.jsxs("div",{className:"p-6 bg-yellow-50 border border-yellow-200 rounded-lg text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-yellow-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5l-6.928-12c-.77-.833-1.732-.833-2.502 0l-6.928 12c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("h4",{className:"text-lg font-medium text-yellow-800 mb-2",children:"å°šæœªè¨­å®š AI Provider"}),e.jsx("p",{className:"text-yellow-700 mb-4",children:"è«‹é»æ“Šä¸Šæ–¹çš„ã€Œç®¡ç† Providerã€æŒ‰éˆ•ä¾†æ·»åŠ  Gemini æˆ– OpenRouter Provider"}),e.jsx("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700",children:"ç«‹å³è¨­å®š"})]}),!j&&!o&&a.length>0&&t&&e.jsx(Ks,{providers:a,selectedProviderId:c,onProviderSelect:y,usageStats:g,showStrategy:!0}),!j&&!o&&g.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"ä½¿ç”¨çµ±è¨ˆ"}),e.jsx("div",{className:"space-y-2",children:g.slice(0,3).map(w=>{const C=a.find(I=>I.id===w.providerId);if(!C)return null;const v=w.totalRequests>0?w.successfulRequests/w.totalRequests*100:0;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:C.name}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-500",children:[e.jsxs("span",{children:["æˆåŠŸç‡: ",v.toFixed(1),"%"]}),e.jsxs("span",{children:["è«‹æ±‚æ•¸: ",w.totalRequests]}),w.averageResponseTime>0&&e.jsxs("span",{children:["å¹³å‡: ",Math.round(w.averageResponseTime),"ms"]})]})]},w.providerId)})})]}),e.jsx(Ne,{isOpen:f,onClose:()=>b(!1),onSave:N,currentProviders:a})]})},Ys=({isOpen:s,onClose:t,providers:i,onShareCreated:l})=>{const[a,m]=h.useState(""),[c,x]=h.useState(""),[g,d]=h.useState(""),[f,b]=h.useState([]),[j,r]=h.useState(!1),[o,n]=h.useState(""),[u,y]=h.useState("");A.useEffect(()=>{if(i.length>0&&f.length===0){const L=i.filter(T=>T.enabled&&T.apiKey);b(L.map(T=>T.id))}},[i,f.length]);const N=A.useMemo(()=>be.validatePasswordStrength(g),[g]),w=h.useCallback(()=>{const L=be.generateRandomPassword();d(L)},[]),C=h.useCallback(L=>{b(T=>T.includes(L)?T.filter(P=>P!==L):[...T,L])},[]),v=h.useCallback(async()=>{if(!a.trim()){y("è«‹è¼¸å…¥åˆ†äº«åç¨±");return}if(!g){y("è«‹è¨­å®šåˆ†äº«å¯†ç¢¼");return}if(!N.isValid){y("å¯†ç¢¼å¼·åº¦ä¸è¶³");return}if(f.length===0){y("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹ Provider");return}r(!0),y("");try{const L=i.filter(E=>f.includes(E.id)),T=await J.createEncryptedShare(L,a,g,c||void 0),P=J.generateShareUrl(T);n(P),l?.(P)}catch(L){y(L.message||"å‰µå»ºåˆ†äº«å¤±æ•—")}finally{r(!1)}},[a,g,c,f,i,N.isValid,l]),I=h.useCallback(async()=>{try{await navigator.clipboard.writeText(o)}catch(L){console.error("è¤‡è£½å¤±æ•—:",L)}},[o]),$=h.useCallback(async()=>{try{await navigator.clipboard.writeText(g)}catch(L){console.error("è¤‡è£½å¯†ç¢¼å¤±æ•—:",L)}},[g]);if(!s)return null;const k=i.filter(L=>L.enabled&&L.apiKey),S=J.generateShareStats(i.filter(L=>f.includes(L.id)));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"åˆ†äº« Provider é…ç½®"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"Ã—"})]}),o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"åˆ†äº«å‰µå»ºæˆåŠŸï¼"}),e.jsx("p",{className:"text-gray-600",children:"æ‚¨çš„ Provider é…ç½®å·²å®‰å…¨åŠ å¯†ä¸¦æº–å‚™åˆ†äº«"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åˆ†äº«é€£çµ"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,readOnly:!0,className:"flex-1 px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-sm"}),e.jsx("button",{onClick:I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"è¤‡è£½"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è§£å¯†å¯†ç¢¼"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:g,readOnly:!0,className:"flex-1 px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-sm font-mono"}),e.jsx("button",{onClick:$,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm font-medium",children:"è¤‡è£½"})]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800 mb-1",children:"é‡è¦æé†’"}),e.jsxs("ul",{className:"text-yellow-700 space-y-1",children:[e.jsx("li",{children:"â€¢ è«‹å°‡åˆ†äº«é€£çµå’Œå¯†ç¢¼åˆ†åˆ¥å‚³é€çµ¦æ¥æ”¶è€…"}),e.jsx("li",{children:"â€¢ å¯†ç¢¼åŒ…å«æ•æ„Ÿçš„ API Key ä¿¡æ¯ï¼Œè«‹å¦¥å–„ä¿ç®¡"}),e.jsx("li",{children:"â€¢ å»ºè­°é€šéå®‰å…¨é€šé“ï¼ˆå¦‚åŠ å¯†èŠå¤©ï¼‰åˆ†äº«å¯†ç¢¼"})]})]})]})}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium",children:"å®Œæˆ"})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åˆ†äº«åç¨± *"}),e.jsx("input",{type:"text",value:a,onChange:L=>m(L.target.value),placeholder:"ä¾‹å¦‚ï¼šæˆ‘çš„ AI åŠ©æ‰‹é…ç½®",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åˆ†äº«æè¿°ï¼ˆå¯é¸ï¼‰"}),e.jsx("textarea",{value:c,onChange:L=>x(L.target.value),placeholder:"æè¿°é€™å€‹é…ç½®çš„ç”¨é€”å’Œç‰¹é»...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åˆ†äº«å¯†ç¢¼ *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:g,onChange:L=>d(L.target.value),placeholder:"è¨­å®šä¸€å€‹å¼·å¯†ç¢¼ä¾†ä¿è­·æ‚¨çš„é…ç½®",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium",children:"ç”Ÿæˆ"}),e.jsx("button",{onClick:$,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium",children:"è¤‡è£½"})]}),g&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${N.score>=4?"bg-green-500":N.score>=3?"bg-yellow-500":"bg-red-500"}`,style:{width:`${N.score/5*100}%`}})}),e.jsx("span",{className:`text-sm font-medium ${N.score>=4?"text-green-600":N.score>=3?"text-yellow-600":"text-red-600"}`,children:N.score>=4?"å¼·":N.score>=3?"ä¸­":"å¼±"})]}),N.feedback.length>0&&e.jsx("ul",{className:"mt-1 text-xs text-gray-600",children:N.feedback.map((L,T)=>e.jsxs("li",{children:["â€¢ ",L]},T))})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"é¸æ“‡è¦åˆ†äº«çš„ Provider"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["å·²é¸æ“‡ ",f.length," / ",k.length]})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:k.map(L=>e.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:f.includes(L.id),onChange:()=>C(L.id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:L.name}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:L.type})]}),L.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:L.description})]})]},L.id))}),k.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"æ²’æœ‰å¯ç”¨çš„ Provider é…ç½®"}),e.jsx("p",{className:"text-sm mt-1",children:"è«‹å…ˆé…ç½®è‡³å°‘ä¸€å€‹ Provider ä¸¦ç¢ºä¿å·²å•Ÿç”¨"})]})]}),f.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"åˆ†äº«é è¦½"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Provider æ•¸é‡:"}),e.jsx("span",{className:"ml-2 font-medium",children:S.totalProviders})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"å®‰å…¨ç´šåˆ¥:"}),e.jsx("span",{className:"ml-2 font-medium text-green-600",children:S.securityLevel==="high"?"é«˜":"ä¸­"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-blue-700",children:"åŒ…å«é¡å‹:"}),e.jsx("span",{className:"ml-2",children:Object.keys(S.providerTypes).join(", ")})]})]})]}),u&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:u}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:v,disabled:j||f.length===0||!N.isValid,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:j?"å‰µå»ºä¸­...":"å‰µå»ºåˆ†äº«"})]})]})]})})})},ze=({binId:s,onProviderImported:t,onClose:i})=>{const[l,a]=h.useState(""),[m,c]=h.useState(!1),[x,g]=h.useState(""),[d,f]=h.useState(null),[b,j]=h.useState(null),[r,o]=h.useState(0),[n,u]=h.useState("preview");A.useEffect(()=>{(async()=>{try{c(!0);const I=await J.getSharePreview(s);f(I),u("password")}catch(I){g(I.message||"è¼‰å…¥åˆ†äº«ä¿¡æ¯å¤±æ•—")}finally{c(!1)}})()},[s]);const y=h.useCallback(async()=>{if(!l.trim()){g("è«‹è¼¸å…¥åˆ†äº«å¯†ç¢¼");return}c(!0),g("");try{const v=await J.loadEncryptedShare(s,l),I=J.validateShareData(v);if(!I.isValid)throw new Error(`åˆ†äº«æ•¸æ“šç„¡æ•ˆ: ${I.errors.join(", ")}`);j(v),u("import")}catch(v){g(v.message||"è§£å¯†å¤±æ•—ï¼Œè«‹æª¢æŸ¥å¯†ç¢¼æ˜¯å¦æ­£ç¢º")}finally{c(!1)}},[s,l]),N=h.useCallback(async()=>{if(b){c(!0),g("");try{const v=J.createProviderConfigsFromShare(b);let I=0;for(const $ of v)try{await G.addProvider($),I++}catch(k){console.error(`å°å…¥ Provider ${$.name} å¤±æ•—:`,k)}o(I),u("success"),t?.(I)}catch(v){g(v.message||"å°å…¥ Provider é…ç½®å¤±æ•—")}finally{c(!1)}}},[b,t]),w=v=>new Date(v).toLocaleString("zh-TW"),C=v=>{switch(v){case"gemini":return"Google Gemini";case"openrouter":return"OpenRouter";default:return v}};return n==="preview"&&m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"è¼‰å…¥åˆ†äº«ä¿¡æ¯ä¸­..."})]})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"æ¥æ”¶ Provider é…ç½®åˆ†äº«"}),e.jsx("p",{className:"text-gray-600",children:"å®‰å…¨åœ°å°å…¥ä»–äººåˆ†äº«çš„ AI Provider é…ç½®"})]}),x&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:x}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:`flex items-center gap-2 ${n==="password"?"text-blue-600":n==="import"||n==="success"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${n==="password"?"bg-blue-600 text-white":n==="import"||n==="success"?"bg-green-600 text-white":"bg-gray-300"}`,children:"1"}),e.jsx("span",{className:"text-sm font-medium",children:"è¼¸å…¥å¯†ç¢¼"})]}),e.jsx("div",{className:`w-12 h-0.5 ${n==="import"||n==="success"?"bg-green-600":"bg-gray-300"}`}),e.jsxs("div",{className:`flex items-center gap-2 ${n==="import"?"text-blue-600":n==="success"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${n==="import"?"bg-blue-600 text-white":n==="success"?"bg-green-600 text-white":"bg-gray-300"}`,children:"2"}),e.jsx("span",{className:"text-sm font-medium",children:"ç¢ºèªå°å…¥"})]}),e.jsx("div",{className:`w-12 h-0.5 ${n==="success"?"bg-green-600":"bg-gray-300"}`}),e.jsxs("div",{className:`flex items-center gap-2 ${n==="success"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${n==="success"?"bg-green-600 text-white":"bg-gray-300"}`,children:"3"}),e.jsx("span",{className:"text-sm font-medium",children:"å®Œæˆ"})]})]})}),d&&e.jsxs("div",{className:"mb-6 bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-3",children:"åˆ†äº«ä¿¡æ¯"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"åˆ†äº«åç¨±:"}),e.jsx("span",{className:"ml-2 font-medium",children:d.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Provider æ•¸é‡:"}),e.jsx("span",{className:"ml-2 font-medium",children:d.providerCount})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"åˆ†äº«æ™‚é–“:"}),e.jsx("span",{className:"ml-2",children:w(d.createdAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"å®‰å…¨æ€§:"}),e.jsx("span",{className:"ml-2 text-green-600 font-medium",children:d.hasEncryption?"âœ“ å·²åŠ å¯†":"âš ï¸ æœªåŠ å¯†"})]}),d.description&&e.jsxs("div",{className:"col-span-1 sm:col-span-2",children:[e.jsx("span",{className:"text-blue-700",children:"æè¿°:"}),e.jsx("p",{className:"ml-2 mt-1",children:d.description})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2",children:[e.jsx("span",{className:"text-blue-700",children:"åŒ…å«é¡å‹:"}),e.jsx("div",{className:"ml-2 mt-1 flex flex-wrap gap-1",children:d.providerTypes.map(v=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:C(v)},v))})]})]})]}),n==="password"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è«‹è¼¸å…¥åˆ†äº«å¯†ç¢¼"}),e.jsx("input",{type:"password",value:l,onChange:v=>a(v.target.value),placeholder:"è¼¸å…¥åˆ†äº«è€…æä¾›çš„å¯†ç¢¼",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:v=>v.key==="Enter"&&y()}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"å¯†ç¢¼ç”¨æ–¼è§£å¯† Provider é…ç½®ä¸­çš„ API Key ç­‰æ•æ„Ÿä¿¡æ¯"})]}),e.jsxs("div",{className:"flex gap-3",children:[i&&e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:y,disabled:m||!l.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:m?"è§£å¯†ä¸­...":"è§£å¯†ä¸¦é è¦½"})]})]}),n==="import"&&b&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"ç¢ºèªè¦å°å…¥çš„ Provider é…ç½®"}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:b.providers.map((v,I)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:C(v.type)}),e.jsx("span",{className:"font-medium",children:v.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",v.model,")"]})]}),v.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:v.description}),e.jsx("div",{className:"mt-2 text-xs text-green-600",children:"âœ“ API Key å·²åŒ…å«ä¸¦åŠ å¯†ä¿è­·"})]},I))})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800 mb-1",children:"å°å…¥èªªæ˜"}),e.jsxs("ul",{className:"text-yellow-700 space-y-1",children:[e.jsx("li",{children:"â€¢ é€™äº›é…ç½®å°‡æ·»åŠ åˆ°æ‚¨ç¾æœ‰çš„ Provider åˆ—è¡¨ä¸­"}),e.jsx("li",{children:'â€¢ å¦‚æœå·²å­˜åœ¨åŒåé…ç½®ï¼Œå°‡å‰µå»ºå¸¶æœ‰"åˆ†äº«çš„"å‰ç¶´çš„æ–°é…ç½®'}),e.jsx("li",{children:"â€¢ æ‚¨å¯ä»¥åœ¨å°å…¥å¾Œä¿®æ”¹æˆ–åˆªé™¤é€™äº›é…ç½®"})]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>u("password"),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"è¿”å›"}),e.jsx("button",{onClick:N,disabled:m,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:m?"å°å…¥ä¸­...":"ç¢ºèªå°å…¥"})]})]}),n==="success"&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"å°å…¥æˆåŠŸï¼"}),e.jsxs("p",{className:"text-gray-600",children:["å·²æˆåŠŸå°å…¥ ",r," å€‹ Provider é…ç½®"]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-green-700",children:"æ‚¨ç¾åœ¨å¯ä»¥åœ¨ Provider è¨­å®šä¸­æŸ¥çœ‹å’Œä½¿ç”¨é€™äº›æ–°é…ç½®ã€‚ å»ºè­°æ‚¨æª¢æŸ¥ä¸¦æ¸¬è©¦é€™äº›é…ç½®ä»¥ç¢ºä¿æ­£å¸¸å·¥ä½œã€‚"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("a",{href:"/ai-page-gen/",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-center",children:"è¿”å›é¦–é "}),i&&e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"é—œé–‰"})]})]})]})})})};class _ extends h.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,i){console.error("Error Boundary caught an error:",t,i),this.setState({error:t,errorInfo:i})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"æ‡‰ç”¨ç¨‹å¼ç™¼ç”ŸéŒ¯èª¤"}),e.jsx("p",{className:"text-sm text-gray-500",children:"å¾ˆæŠ±æ­‰ï¼Œé é¢é‡åˆ°äº†æœªé æœŸçš„éŒ¯èª¤"})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"éŒ¯èª¤è©³æƒ…ï¼š"}),e.jsx("p",{className:"text-sm text-red-700 font-mono break-all",children:this.state.error?.message||"æœªçŸ¥éŒ¯èª¤"})]}),this.state.errorInfo&&e.jsxs("details",{className:"mb-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 cursor-pointer hover:text-gray-900",children:"è©³ç´°éŒ¯èª¤å †ç–Š (é»æ“Šå±•é–‹)"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-600 bg-gray-50 p-3 rounded border overflow-auto max-h-40",children:this.state.errorInfo.componentStack})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"é‡æ–°è¼‰å…¥é é¢"}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"é‡è©¦"})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[e.jsx("p",{children:"å¦‚æœå•é¡ŒæŒçºŒç™¼ç”Ÿï¼Œè«‹æª¢æŸ¥ï¼š"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"ç€è¦½å™¨æ§åˆ¶å°æ˜¯å¦æœ‰å…¶ä»–éŒ¯èª¤è¨Šæ¯"}),e.jsx("li",{children:"ç¶²è·¯é€£æ¥æ˜¯å¦æ­£å¸¸"}),e.jsx("li",{children:"API è¨­å®šæ˜¯å¦æ­£ç¢º"})]})]})]})}):this.props.children}}const de="gemini_api_key";let ke=!1;const Xs=()=>{const[s,t]=h.useState(""),[i,l]=h.useState(null),[a,m]=h.useState(!1),[c,x]=h.useState(null),[g,d]=h.useState(null),[f,b]=h.useState(!1),[j,r]=h.useState(null),[o,n]=h.useState(!1),[u,y]=h.useState([]),[N,w]=h.useState(null),[C,v]=h.useState(null),[I,$]=h.useState(!1),[k,S]=h.useState(te[0]),[L,T]=h.useState(!1),[P,E]=h.useState(!1),[z,B]=h.useState(null),[p,M]=h.useState(!1);h.useEffect(()=>{(async()=>{const O=J.parseShareUrl();if(O.type==="legacy"&&O.value){localStorage.setItem(de,O.value),d(O.value),b(!1);const V=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,V);return}if(!ke)try{await os(),ke=!0}catch(V){console.error("Provider ç³»çµ±åˆå§‹åŒ–å¤±æ•—:",V)}if(O.type==="provider"&&O.value){B(O.value);try{const V=await G.getProviders();y(V)}catch(V){console.error("è¼‰å…¥ Providers å¤±æ•—:",V)}return}const W=localStorage.getItem(de);W?d(W):await ds().catch(()=>!1)||b(!0);try{const V=await G.getProviders();y(V)}catch(V){console.error("è¼‰å…¥ Providers å¤±æ•—:",V)}})()},[]);const D=q=>{localStorage.setItem(de,q),d(q),b(!1)},H=async(q,O)=>{try{await ee.init();const W=cs(O,q);await ee.saveLessonPlan(W)}catch(W){console.error("ä¿å­˜æ•™æ¡ˆåˆ°æœ¬åœ°å­˜å„²å¤±æ•—:",W)}},K=h.useCallback(async()=>{if(!s.trim()){x("è«‹è¼¸å…¥å­¸ç¿’ä¸»é¡Œã€‚");return}const q=await G.hasConfiguredProviders();if(!q&&!g){x("è«‹å…ˆé…ç½® AI Provider æˆ–è¨­å®š API é‡‘é‘°ã€‚"),b(!0);return}m(!0),x(null),w(null),l(null),v(null),S(te[0]),T(!1);const O=rs(s);E(O);try{const V=await as(s,q?"provider-system-placeholder-key":"");w(V),$(!0),O&&T(!0)}catch(W){console.error(W),x(W.message||"ç”¢ç”Ÿå­¸ç¿’ç¨‹åº¦å»ºè­°æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ã€‚")}finally{m(!1)}},[s,g]),ue=h.useCallback(async q=>{const O=await G.hasConfiguredProviders();if(!O&&!g){x("è«‹å…ˆé…ç½® AI Provider æˆ–è¨­å®š API é‡‘é‘°ã€‚"),b(!0);return}if(P&&!k){x("è«‹å…ˆé¸æ“‡è‹±èªå–®å­—ç¨‹åº¦ã€‚");return}m(!0),x(null),v(q),l(null);try{let W;const V=O?"provider-system-placeholder-key":g;if(V===null)throw new Error("ç„¡API KEY å¯ç”¨ï¼");P&&k?W=await ns(s,q,k,V):W=await ls(s,q,V),l(W),$(!1),T(!1),await H(W,s)}catch(W){console.error(W),x(W.message||"ç”¢ç”Ÿå­¸ç¿’å…§å®¹æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ã€‚")}finally{m(!1)}},[s,g,P,k]),Y=h.useCallback(async()=>{if(!s.trim()){x("è«‹è¼¸å…¥å­¸ç¿’ä¸»é¡Œã€‚");return}const q=await G.hasConfiguredProviders();if(!q&&!g){x("è«‹å…ˆé…ç½® AI Provider æˆ–è¨­å®š API é‡‘é‘°ã€‚"),b(!0);return}m(!0),x(null),l(null),$(!1),T(!1),E(!1);try{const W=await is(s,q?"provider-system-placeholder-key":"");l(W),await H(W,s)}catch(O){console.error(O),x(O.message||"ç”¢ç”Ÿå…§å®¹æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ã€‚"),l(null)}finally{m(!1)}},[s,g]),Re=h.useCallback(async(q,O)=>{l(q),t(O),await H(q,O),m(!1)},[]),Be=h.useCallback(async(q,O)=>{l(q),t(O),E(!0),await H(q,O),m(!1)},[]),De=async()=>{if(!g){r("è«‹å…ˆè¨­å®š API é‡‘é‘°");return}const q=J.createLegacyShare(g);try{await navigator.clipboard.writeText(q),r("å·²è¤‡è£½åˆ†äº«é€£çµï¼")}catch{r("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½")}setTimeout(()=>r(null),2e3)},qe=h.useCallback(()=>{n(!0)},[]),Oe=h.useCallback(q=>{r("Provider é…ç½®åˆ†äº«å·²å‰µå»ºï¼"),n(!1),setTimeout(()=>r(null),3e3)},[]),We=h.useCallback(q=>{console.log(`å·²å°å…¥ ${q} å€‹ Provider é…ç½®`),window.location.href=`${window.location.origin}/ai-page-gen/ `},[]);return{topic:s,setTopic:t,generatedContent:i,setGeneratedContent:l,isLoading:a,setIsLoading:m,error:c,setError:x,apiKey:g,setApiKey:d,showApiKeyModal:f,setShowApiKeyModal:b,copySuccess:j,setCopySuccess:r,showProviderShareModal:o,setShowProviderShareModal:n,availableProviders:u,setAvailableProviders:y,learningLevels:N,setLearningLevels:w,selectedLevel:C,setSelectedLevel:v,showingLevelSelection:I,setShowingLevelSelection:$,selectedVocabularyLevel:k,setSelectedVocabularyLevel:S,showingVocabularySelection:L,setShowingVocabularySelection:T,isEnglishTopic:P,setIsEnglishTopic:E,providerShareId:z,setProviderShareId:B,showGeneralGenerator:p,setShowGeneralGenerator:M,handleSaveApiKey:D,handleGenerateLevelSuggestions:K,handleGenerateContentWithLevel:ue,handleGenerateContent:Y,handleMathComplete:Re,handleEnglishComplete:Be,handleShareLink:De,handleProviderShare:qe,handleProviderShareCreated:Oe,handleProviderImported:We}},et=A.lazy(()=>Q(()=>import("./QuizPage-DWRkQIgt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),st=A.lazy(()=>Q(()=>import("./StudentWritingPage-Bjg4Gm8o.js"),__vite__mapDeps([8,1,2,5,3,4,7,6]))),tt=A.lazy(()=>Q(()=>import("./StudentResultsPage-BMuDH8rj.js"),__vite__mapDeps([9,1,2,3,4,5,6,7]))),rt=A.lazy(()=>Q(()=>import("./LessonPlanManager-D4w6aZ38.js"),__vite__mapDeps([10,1,2,3,4,5,6,7]))),at=A.lazy(()=>Q(()=>import("./interactive-components-KenSvHOs.js").then(s=>s.I),__vite__mapDeps([5,1,2,3,4]))),nt=A.lazy(()=>Q(()=>import("./teacher-components-rNDJYygQ.js").then(s=>s.T),__vite__mapDeps([7,1,2,3,4,5]))),lt=A.lazy(()=>Q(()=>import("./StudentInteractivePage-DmEjUApz.js"),__vite__mapDeps([11,1,2,3,4,5]))),it=A.lazy(()=>Q(()=>import("./ConversationPrepPage-Dn6qj9No.js"),__vite__mapDeps([12,1,2,3,4,5,13]))),ot=A.lazy(()=>Q(()=>import("./ConversationPracticePage-1UDTixki.js"),__vite__mapDeps([14,1,2,3,4,13,5]))),dt=A.lazy(()=>Q(()=>import("./MathGenerator-tShdTM05.js"),__vite__mapDeps([15,1,2,16,3,4]))),ct=A.lazy(()=>Q(()=>import("./EnglishGenerator-DBW7WoTq.js"),__vite__mapDeps([17,1,2,16,3,4]))),Se="gemini_api_key",Ce=()=>{const[s]=He(),t=s.get("binId"),i=s.get("provider_share"),[l,a]=A.useState(null),[m,c]=A.useState(!1),[x,g]=A.useState(""),[d,f]=A.useState(null),[b,j]=A.useState(!1);A.useEffect(()=>{if(!i){if(!t){g("ç¼ºå°‘ binId");return}c(!0),ms(t).then(n=>{a(n),r(n,t)}).catch(n=>g(n.message||"è®€å–å¤±æ•—")).finally(()=>c(!1))}},[t,i]);const r=async(n,u)=>{try{if(await ee.init(),await ee.getLessonPlan(`shared_${u} `)){await ee.updateLastAccessed(`shared_${u} `);return}const N={id:`shared_${u} `,topic:n.topic||"åˆ†äº«çš„æ•™æ¡ˆ",createdAt:new Date().toISOString(),lastAccessedAt:new Date().toISOString(),content:{learningObjectives:n.learningObjectives,contentBreakdown:n.contentBreakdown,confusingPoints:n.confusingPoints,classroomActivities:n.classroomActivities,quiz:n.onlineInteractiveQuiz,writingPractice:n.writingPractice},metadata:{totalSections:[n.learningObjectives,n.contentBreakdown,n.confusingPoints,n.classroomActivities,n.onlineInteractiveQuiz,n.writingPractice].filter(Boolean).length,hasQuiz:!!n.onlineInteractiveQuiz,hasWriting:!!n.writingPractice,isShared:!0,sharedBinId:u}};await ee.saveLessonPlan(N),console.log(`åˆ†äº«æ•™æ¡ˆå·²å„²å­˜åˆ°æœ¬åœ°: ${n.topic||"åˆ†äº«çš„æ•™æ¡ˆ"} (${u})`)}catch(y){console.error("å„²å­˜åˆ†äº«æ•™æ¡ˆåˆ°æœ¬åœ°å­˜å„²å¤±æ•—:",y)}};A.useEffect(()=>{const n=localStorage.getItem(Se);n?f(n):j(!0)},[]);const o=n=>{localStorage.setItem(Se,n),f(n),j(!1)};return m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center my-10",children:e.jsx(oe,{})})}):x?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"my-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg shadow-md",children:x})})}):i?e.jsx(_,{children:e.jsx(ze,{binId:i,onProviderImported:n=>{console.log(`å·²å°å…¥ ${n} å€‹ Provider é…ç½®`)}})}):l?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:[e.jsx($e,{isOpen:b,onSave:o}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("a",{href:"/ai-page-gen/ ",className:"inline-flex items-center gap-2 px-4 py-2 text-indigo-600 bg-white border border-indigo-200 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm",children:[e.jsx(Le,{className:"w-4 h-4"}),"è¿”å›é¦–é "]})}),!d&&!b&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-yellow-600 mt-0.5 flex-shrink-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m0 0c.652-.286 1.323-.443 2.25-.443 1.38 0 2.652.24 3.75.697v-6a6 6 0 0 0-6 2.243M12 15.75V21m0-5.25c1.38 0 2.652-.24 3.75-.697v6a6 6 0 0 1-3.75-2.243M12 15.75L9 12"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-800 font-medium text-sm",children:"éœ€è¦è¨­å®š API Key ä»¥ä½¿ç”¨åˆ†äº«åŠŸèƒ½"}),e.jsx("p",{className:"text-yellow-700 text-xs mt-1",children:"è¨­å®šå¾Œå¯åˆ†äº«æ¸¬é©—å’Œå¯«ä½œç·´ç¿’çµ¦å­¸ç”Ÿï¼ŒåŒ…å« AI åŠŸèƒ½"})]})]}),e.jsx("button",{onClick:()=>j(!0),className:"px-3 py-1 bg-yellow-600 text-white rounded hover:bg-yellow-700 text-sm",children:"è¨­å®š API Key"})]})}),e.jsx(_,{children:e.jsx(Ee,{content:l,topic:l.topic||"",selectedLevel:l.selectedLevel||null,selectedVocabularyLevel:l.selectedVocabularyLevel,apiKey:d||void 0,onContentUpdate:a})})]})]}):null},mt=()=>{const{topic:s,setTopic:t,generatedContent:i,setGeneratedContent:l,isLoading:a,error:m,setError:c,apiKey:x,showApiKeyModal:g,copySuccess:d,showProviderShareModal:f,setShowProviderShareModal:b,availableProviders:j,learningLevels:r,setLearningLevels:o,selectedLevel:n,setSelectedLevel:u,showingLevelSelection:y,setShowingLevelSelection:N,selectedVocabularyLevel:w,setSelectedVocabularyLevel:C,showingVocabularySelection:v,setShowingVocabularySelection:I,isEnglishTopic:$,providerShareId:k,showGeneralGenerator:S,setShowGeneralGenerator:L,handleSaveApiKey:T,handleGenerateLevelSuggestions:P,handleGenerateContentWithLevel:E,handleGenerateContent:z,handleMathComplete:B,handleEnglishComplete:p,handleShareLink:M,handleProviderShare:D,handleProviderShareCreated:H,handleProviderImported:K}=Xs();return k?e.jsx(_,{children:e.jsx(ze,{binId:k,onProviderImported:K,onClose:()=>{window.location.href=`${window.location.origin}/ai-page-gen/ `}})}):e.jsx(_e,{basename:"/ai-page-gen/",children:e.jsx(_,{children:e.jsx(A.Suspense,{fallback:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8 flex justify-center items-center",children:e.jsx(oe,{})}),children:e.jsxs(Ve,{children:[e.jsx(F,{path:"share",element:e.jsx(_,{children:e.jsx(Ce,{})})}),e.jsx(F,{path:"provider-share",element:e.jsx(_,{children:e.jsx(Ce,{})})}),e.jsx(F,{path:"quiz",element:e.jsx(_,{children:e.jsx(et,{})})}),e.jsx(F,{path:"writing",element:e.jsx(_,{children:e.jsx(st,{})})}),e.jsx(F,{path:"student-results",element:e.jsx(_,{children:e.jsx(tt,{})})}),e.jsx(F,{path:"lesson-plans",element:e.jsx(_,{children:e.jsx(rt,{})})}),e.jsx(F,{path:"interactive-learning",element:e.jsx(_,{children:e.jsx(at,{})})}),e.jsx(F,{path:"teacher-interactive-prep",element:e.jsx(_,{children:e.jsx(nt,{})})}),e.jsx(F,{path:"student-interactive",element:e.jsx(_,{children:e.jsx(lt,{})})}),e.jsx(F,{path:"conversation-prep",element:e.jsx(_,{children:e.jsx(it,{})})}),e.jsx(F,{path:"conversation-practice/:binId",element:e.jsx(_,{children:e.jsx(ot,{})})}),e.jsx(F,{path:"math",element:e.jsx(_,{children:e.jsx(dt,{onComplete:B,apiKey:x||""})})}),e.jsx(F,{path:"english",element:e.jsx(_,{children:e.jsx(ct,{onComplete:p,apiKey:x||""})})}),e.jsx(F,{path:"/",element:e.jsx(_,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:[e.jsx($e,{isOpen:g,onSave:T}),e.jsxs("header",{className:"text-center mb-10",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-extrabold text-sky-700 tracking-tight",children:["AI å­¸ç¿’é é¢ ",e.jsx("span",{className:"text-indigo-600",children:"ç”¢ç”Ÿå™¨"})]}),e.jsx("p",{className:"mt-3 text-lg text-slate-600 max-w-2xl mx-auto",children:"è¼¸å…¥ä¸€å€‹ä¸»é¡Œï¼Œè®“ AI ç‚ºæ‚¨æ‰“é€ åŒ…å«äº’å‹•æ¸¬é©—çš„çµæ§‹åŒ–å­¸ç¿’è¨ˆåŠƒï¼"}),e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto bg-yellow-50 border-l-4 border-yellow-400 rounded-lg p-4 text-left shadow-sm",children:[e.jsxs("div",{className:"flex items-start mb-2",children:[e.jsx("svg",{className:"w-6 h-6 text-yellow-500 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z"})}),e.jsx("span",{className:"font-semibold text-yellow-800 text-base",children:"ä½¿ç”¨æ³¨æ„äº‹é …"})]}),e.jsxs("ul",{className:"list-disc pl-8 text-yellow-900 text-sm space-y-1",children:[e.jsx("li",{children:"å…§å®¹å¯©æŸ¥ï¼šè«‹åœ¨åˆ†äº«AIç”Ÿæˆå…§å®¹çµ¦å­¸ç”Ÿå‰ä»”ç´°æª¢æŸ¥ï¼Œç¢ºä¿å…§å®¹é©åˆä¸”ç„¡èª¤"}),e.jsx("li",{children:"éš±ç§ä¿è­·ï¼šè«‹å‹¿è¼¸å…¥å­¸ç”Ÿå€‹äººè­˜åˆ¥è³‡è¨Š"})]})]})]}),e.jsx("div",{className:"max-w-6xl mx-auto mb-6",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(Js,{compact:!0})})}),e.jsx(Ys,{isOpen:f,onClose:()=>b(!1),providers:j,onShareCreated:H}),e.jsxs("main",{className:"max-w-4xl mx-auto",children:[!i&&!y&&!v&&e.jsx(e.Fragment,{children:S?e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("button",{onClick:()=>L(!1),className:"mb-4 flex items-center text-slate-500 hover:text-indigo-600 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})}),"è¿”å›åŠŸèƒ½é¸å–®"]}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"é€šç”¨ä¸»é¡Œæ•™æ¡ˆç”Ÿæˆ"}),e.jsx("p",{className:"text-slate-600",children:"è¼¸å…¥ä»»ä½•æ‚¨æƒ³æ•™å­¸çš„ä¸»é¡Œï¼ŒAI ç‚ºæ‚¨è¦åŠƒå®Œæ•´æ•™æ¡ˆ"})]}),e.jsx(Ss,{topic:s,setTopic:t,onGenerate:z,onGenerateWithLevels:P,isLoading:a})]}):e.jsxs("div",{className:"mt-8 animate-fade-in",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-6 text-center",children:"è«‹é¸æ“‡æ‚¨è¦ä½¿ç”¨çš„å­¸ç¿’å·¥å…·"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>L(!0),className:"flex items-center p-4 bg-white border border-indigo-100 rounded-xl hover:shadow-md hover:border-indigo-300 transition-all group text-left w-full",children:[e.jsx("div",{className:"p-3 bg-indigo-50 text-indigo-600 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-colors",children:e.jsx(ie,{className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:"é€šç”¨ä¸»é¡Œæ•™æ¡ˆ"}),e.jsx("p",{className:"text-sm text-slate-500",children:"è¼¸å…¥ä»»æ„ä¸»é¡Œç”¢ç”Ÿå®Œæ•´æ•™æ¡ˆ"})]})]}),e.jsxs(ge,{to:"/math",className:"flex items-center p-4 bg-white border border-blue-100 rounded-xl hover:shadow-md hover:border-blue-300 transition-all group",children:[e.jsx("div",{className:"p-3 bg-blue-50 text-blue-600 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:"æ•¸å­¸æ•™æç”Ÿæˆ"}),e.jsx("p",{className:"text-sm text-slate-500",children:"é é¸åšå¹¼æ•™å­¸ç›®æ¨™ç”¢ç”Ÿæ•™æ¡ˆæ•™æ"})]})]}),e.jsxs(ge,{to:"/english",className:"flex items-center p-4 bg-white border border-teal-100 rounded-xl hover:shadow-md hover:border-teal-300 transition-all group",children:[e.jsx("div",{className:"p-3 bg-teal-50 text-teal-600 rounded-lg group-hover:bg-teal-600 group-hover:text-white transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:"è‹±èªæ•™æç”Ÿæˆ"}),e.jsx("p",{className:"text-sm text-slate-500",children:"é é¸åšå¹¼æ•™å­¸ç›®æ¨™ç”¢ç”Ÿæ•™æ¡ˆæ•™æ"})]})]}),e.jsxs("a",{href:"/ai-page-gen/conversation-prep",className:"flex items-center p-4 bg-white border border-emerald-100 rounded-xl hover:shadow-md hover:border-emerald-300 transition-all group",children:[e.jsx("div",{className:"p-3 bg-emerald-50 text-emerald-600 rounded-lg group-hover:bg-emerald-600 group-hover:text-white transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:"è‹±æ–‡å°è©±ç·´ç¿’"}),e.jsx("p",{className:"text-sm text-slate-500",children:"æƒ…å¢ƒæ¨¡æ“¬å°è©±"})]})]}),e.jsxs("a",{href:"/ai-page-gen/lesson-plans",className:"flex items-center p-4 bg-white border border-indigo-100 rounded-xl hover:shadow-md hover:border-indigo-300 transition-all group",children:[e.jsx("div",{className:"p-3 bg-indigo-50 text-indigo-600 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-colors",children:e.jsx(re,{className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:"æˆ‘çš„æ•™æ¡ˆåº«"}),e.jsx("p",{className:"text-sm text-slate-500",children:"æŸ¥çœ‹å·²å„²å­˜çš„æ•™æ¡ˆ"})]})]})]}),e.jsxs("div",{className:"mt-12 flex justify-center gap-4",children:[e.jsxs("button",{onClick:D,className:"text-sm text-slate-500 hover:text-purple-600 flex items-center gap-1 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-11.314a2.25 2.25 0 1 0 3.935-2.186 2.25 2.25 0 0 0-3.935 2.186Z"})}),"åˆ†äº« Provider é…ç½®"]}),e.jsx("span",{className:"text-slate-300",children:"|"}),e.jsxs("button",{onClick:M,className:"text-sm text-slate-500 hover:text-indigo-600 flex items-center gap-1 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})}),"åˆ†äº«æ‡‰ç”¨ç¨‹å¼é€£çµ"]})]})]})}),m&&!a&&e.jsxs("div",{className:"my-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg shadow-md",children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center",children:[e.jsx(ie,{className:"w-6 h-6 mr-2 text-red-600"}),"ç”¢ç”Ÿå…§å®¹æ™‚ç™¼ç”ŸéŒ¯èª¤"]}),e.jsx("p",{children:m}),e.jsx("p",{className:"mt-2 text-sm",children:"è«‹å˜—è©¦ä¿®æ”¹æ‚¨çš„ä¸»é¡Œæˆ–é‡è©¦ã€‚å¦‚æœå•é¡ŒæŒçºŒå­˜åœ¨ï¼ŒAI æ¨¡å‹å¯èƒ½æš«æ™‚ä¸å¯ç”¨ï¼Œæˆ–è€… API é‡‘é‘°å¯èƒ½å­˜åœ¨å•é¡Œã€‚"}),e.jsx("button",{onClick:()=>{c(null),N(!1),I(!1)},className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"é‡è©¦"})]}),a&&e.jsxs("div",{className:"flex flex-col items-center justify-center my-20",children:[e.jsx(oe,{}),e.jsx("p",{className:"mt-4 text-slate-500 animate-pulse",children:"æ­£åœ¨ç‚ºæ‚¨ç²¾å¿ƒè£½ä½œæ•™æ¡ˆ..."})]}),y&&r&&!a&&!m&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"é¸æ“‡é©åˆçš„ç¨‹åº¦"}),e.jsx("button",{onClick:()=>N(!1),className:"text-slate-500 hover:text-slate-700 px-3 py-1 rounded hover:bg-slate-100 transition-colors",children:"è¿”å›ä¿®æ”¹ä¸»é¡Œ"})]}),e.jsx(Zs,{learningLevels:r,onLevelSelect:u,onGenerateWithLevel:E,selectedLevelId:n?.id,isLoading:a})]}),v&&$&&!a&&!m&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"é¸æ“‡å–®å­—é›£æ˜“åº¦"}),e.jsx("button",{onClick:()=>{I(!1),N(!0)},className:"text-slate-500 hover:text-slate-700 px-3 py-1 rounded hover:bg-slate-100 transition-colors",children:"è¿”å›ä¸Šä¸€æ­¥"})]}),e.jsx(Qs,{onVocabularyLevelSelect:C,selectedLevel:w,isVisible:!0}),e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx("button",{onClick:()=>E(n),className:"px-8 py-3 bg-indigo-600 text-white text-lg font-semibold rounded-full shadow-lg hover:bg-indigo-700 hover:shadow-xl transition-all transform hover:-translate-y-1",children:"é–‹å§‹ç”¢ç”Ÿæ•™æ¡ˆ"})})]}),i&&!a&&!m&&!y&&!v&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 text-indigo-600 rounded-lg",children:e.jsx(re,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-slate-800 text-lg",children:s}),e.jsxs("p",{className:"text-sm text-slate-500",children:[n?`${n.description} Â· `:"",new Date().toLocaleDateString()]})]})]}),e.jsxs("button",{onClick:()=>{l(null),t(""),o(null),u(null),L(!1)},className:"flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-700 font-medium rounded-lg hover:bg-slate-200 transition-colors",children:[e.jsx(Le,{className:"w-4 h-4"}),"å›é¦–é é‡æ–°ç”¢ç”Ÿ"]})]}),e.jsx(_,{children:e.jsx(Ee,{content:i,topic:s,selectedLevel:n,selectedVocabularyLevel:w,apiKey:x||void 0,onContentUpdate:l})})]})]}),e.jsxs("footer",{className:"text-center mt-12 py-6 border-t border-slate-300",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"ç”± Gemini API é©…å‹•ã€‚AI è¨­è¨ˆï¼Œç‚ºå­¸ç¿’è€Œç”Ÿã€‚"}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded shadow transition",onClick:M,disabled:!x,children:"ç”¢ç”Ÿåˆ†äº«é€£çµä¸¦è¤‡è£½"}),d&&e.jsx("div",{className:"mt-2 text-green-600 text-sm",children:d})]})]})})})]})})})})},Te=document.getElementById("root");if(!Te)throw new Error("Could not find root element to mount to");const xt=Ge.createRoot(Te);xt.render(e.jsx(A.StrictMode,{children:e.jsx(mt,{})}));export{Vs as L,X as Q,ae as a,Ee as b,vt as e};
