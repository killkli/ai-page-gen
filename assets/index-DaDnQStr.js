import{j as e,r as l,R as V,u as ke,a as Cs,b as Ls,B as Is,c as As,d as ae,e as Ps}from"./react-vendor-Bqsb6Ck2.js";import{Q as ee,d as Ze,D as ns,e as Ms,i as $s,g as Es,f as zs,h as Rs,j as Ts,k as Bs,l as Ds}from"./gemini-service-CW6fJVct.js";import{M as Os,N as Ws,O as Ce,P as Pe,K as Me,Q as Se,R as as,S as Hs,T as qs,F as Vs,U as K,V as Qs,W as Fs,X as re,Y as de,Z as Ks,_ as ve,$ as Gs,a0 as Zs,a1 as Us,a2 as _s,a3 as Js,J as ne,I as ls,a4 as pe,a5 as Ys,a6 as Ue,a7 as he,a8 as Xs}from"./app-services-PEsHNAmW.js";import{L as le,P as ye,T as Te,a as Be,F as is,S as os,b as De,C as $e,c as et,d as st,e as tt,f as Oe,X as We,g as rt,h as Ee,A as oe,B as Le,i as nt,j as be,H as ge,k as ze,l as Ae,E as _e,m as at,M as lt,I as it}from"./interactive-components-c2gJbTDH.js";import{W as cs,T as ot}from"./teacher-components-DTXFsltJ.js";import{Q as Je}from"./ui-utilities-DUI0gaaD.js";import"./vendor-5RHscoCd.js";import"./ai-vendor-U8uTsjnZ.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))u(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const t of o.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&u(t)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function u(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const ct=({topic:s,setTopic:c,onGenerate:r,onGenerateWithLevels:u,isLoading:n})=>{const o=m=>{m.preventDefault(),!n&&s.trim()&&r()},t=m=>{m.preventDefault(),!n&&s.trim()&&u&&u()};return e.jsxs("form",{onSubmit:o,className:"mb-8 p-6 bg-white shadow-lg rounded-xl",children:[e.jsx("label",{htmlFor:"topic-input",className:"block text-xl font-semibold text-slate-700 mb-3",children:"輸入學習主題"}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsx("input",{id:"topic-input",type:"text",value:s,onChange:m=>c(m.target.value),placeholder:"例如：光合作用、JavaScript Promises、法國大革命",className:"w-full p-3 border border-slate-400 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-600 transition-shadow bg-slate-50 text-slate-800 placeholder-slate-500",disabled:n,"aria-label":"學習主題輸入欄位"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[u&&e.jsx("button",{type:"button",onClick:t,disabled:n||!s.trim(),className:"flex-1 px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center justify-center",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"產生中..."]}):"🎯 選擇程度後產生"}),e.jsx("button",{type:"submit",disabled:n||!s.trim(),className:"flex-1 px-6 py-3 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center justify-center","aria-live":"polite",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"產生中..."]}):"⚡ 直接產生內容"})]}),u&&e.jsxs("div",{className:"text-sm text-slate-600 bg-slate-50 p-3 rounded-lg",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"🎯 選擇程度後產生："})," 先獲得學習程度建議，選擇合適程度後產生針對性內容"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"⚡ 直接產生內容："})," 立即產生包含所有程度的完整學習內容"]})]})]})]})},ie=({title:s,icon:c,children:r,className:u})=>e.jsxs("div",{className:`bg-white shadow-lg rounded-xl p-6 mb-6 ${u||""}`,children:[e.jsxs("h2",{className:"text-2xl font-semibold text-sky-700 mb-4 flex items-center",children:[c&&e.jsx("span",{className:"mr-3 text-sky-600",children:c}),s]}),e.jsx("div",{className:"text-slate-700 space-y-3",children:r})]}),dt=({feedback:s,onContinueLearning:c,onRetakeQuiz:r,showActions:u=!0})=>{const n=d=>d>=80?"text-green-600 bg-green-100":d>=60?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",o=d=>d>=80?"border-green-200":d>=60?"border-yellow-200":"border-red-200",t=d=>{switch(d){case"advanced":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-green-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 0 1-.982-3.172M9.497 14.25a7.454 7.454 0 0 0 .981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 0 0 7.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25s4.544.16 6.75.471v1.515M7.73 9.728a6.726 6.726 0 0 0 2.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.228V2.721A48.133 48.133 0 0 0 12 2.25c-2.291 0-4.544.16-6.75.471v1.515M7.73 9.728l3.75.814.97 4.286c.078.348.14.699.185 1.053m8.272-6.842-3.75.814-.97 4.286a24.216 24.216 0 0 1-.185 1.053M12 19.5a2.25 2.25 0 0 1-2.25-2.25V14.25m4.5 5.25a2.25 2.25 0 0 1 2.25-2.25V14.25"})});case"intermediate":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-yellow-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"})});default:return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-blue-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443a55.381 55.381 0 0 1 5.25 2.882V15"})})}},m=d=>{switch(d){case"advanced":return"高級程度";case"intermediate":return"中級程度";default:return"初級程度"}},h=d=>{switch(d){case"advanced":return"你已經掌握了大部分概念，表現非常出色！";case"intermediate":return"你有良好的基礎，繼續努力就能更上一層樓！";default:return"這是一個很好的開始，繼續學習你會進步很快！"}};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-xl shadow-lg",children:[e.jsxs("div",{className:`text-center mb-8 p-6 bg-white rounded-lg shadow-md border-2 ${o(s.overallScore)}`,children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[t(s.overallLevel),e.jsx("div",{className:"ml-4",children:e.jsxs("div",{className:`text-4xl font-bold px-4 py-2 rounded-full ${n(s.overallScore)}`,children:[s.overallScore,"分"]})})]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:m(s.overallLevel)}),e.jsx("p",{className:"text-lg text-gray-600",children:h(s.overallLevel)})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-blue-500 mt-1 flex-shrink-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),e.jsx("p",{className:"text-lg text-gray-700 leading-relaxed",children:s.encouragementMessage})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-green-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.745 3.745 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})}),"🌟 你的強項"]}),s.keyStrengths.length>0?e.jsx("ul",{className:"space-y-3",children:s.keyStrengths.map((d,b)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-500 mt-1.5",children:"✓"}),e.jsx("span",{className:"text-gray-700",children:d})]},b))}):e.jsx("p",{className:"text-gray-500 italic",children:"繼續努力發掘你的學習強項！"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-orange-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),"💡 成長空間"]}),s.improvementAreas.length>0?e.jsx("ul",{className:"space-y-3",children:s.improvementAreas.map((d,b)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-500 mt-1.5",children:"→"}),e.jsx("span",{className:"text-gray-700",children:d})]},b))}):e.jsx("p",{className:"text-gray-500 italic",children:"你的表現很全面，繼續保持！"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"})}),"🎯 下一步行動"]}),s.nextSteps.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.nextSteps.map((d,b)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:b+1}),e.jsx("span",{className:"text-gray-700",children:d})]},b))}):e.jsx("p",{className:"text-gray-500 italic",children:"你已經準備好繼續下一個學習階段了！"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg shadow-md p-6 mb-6 border border-purple-200",children:[e.jsxs("h3",{className:"text-xl font-bold text-purple-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),"💎 學習小貼士"]}),s.studyTips.length>0?e.jsx("ul",{className:"space-y-2",children:s.studyTips.map((d,b)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-500 mt-1",children:"💡"}),e.jsx("span",{className:"text-gray-700",children:d})]},b))}):e.jsx("p",{className:"text-gray-500 italic",children:"繼續保持你的學習習慣！"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg shadow-lg p-6 text-center text-white mb-6",children:[e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"})})}),e.jsxs("p",{className:"text-xl font-medium italic",children:['"',s.motivationalQuote,'"']})]}),u&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:c,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-md flex items-center justify-center gap-2 font-medium",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12l-7.5 7.5M3 12h16.5"})}),"繼續學習"]}),e.jsxs("button",{onClick:r,className:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all transform hover:scale-105 shadow-md flex items-center justify-center gap-2 font-medium",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),"重新測驗"]})]})]})},xt=({report:s,onExportReport:c,onSaveReport:r,showExportOptions:u=!0})=>{const[n,o]=l.useState("overview"),t=a=>a>=80?"text-green-600 bg-green-50 border-green-200":a>=60?"text-yellow-600 bg-yellow-50 border-yellow-200":"text-red-600 bg-red-50 border-red-200",m=a=>{switch(a){case"high":return"text-red-600 bg-red-100 border-red-200";case"medium":return"text-yellow-600 bg-yellow-100 border-yellow-200";case"low":return"text-blue-600 bg-blue-100 border-blue-200"}},h=a=>{switch(a){case"outstanding":return"text-purple-600 bg-purple-100 border-purple-200";case"excellent":return"text-green-600 bg-green-100 border-green-200";case"good":return"text-blue-600 bg-blue-100 border-blue-200"}},d=a=>{switch(a){case"high":return"text-red-600 bg-red-50 border-l-red-500";case"medium":return"text-yellow-600 bg-yellow-50 border-l-yellow-500";case"low":return"text-green-600 bg-green-50 border-l-green-500"}},b=a=>({trueFalse:"是非題",multipleChoice:"選擇題",fillInTheBlanks:"填空題",sentenceScramble:"句子重組",memoryCardGame:"翻卡記憶"})[a]||a,v=a=>new Date(a).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),y=[{key:"overview",label:"總覽",icon:"📊"},{key:"performance",label:"表現詳情",icon:"📈"},{key:"analysis",label:"學習分析",icon:"🔍"},{key:"recommendations",label:"個人化建議",icon:"💡"},{key:"teaching",label:"教學指導",icon:"🎯"}];return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"學習診斷報告"}),e.jsxs("p",{className:"text-gray-600",children:["主題：",e.jsx("span",{className:"font-semibold",children:s.topic})]}),e.jsxs("p",{className:"text-gray-600",children:["評估日期：",v(s.assessmentDate)]}),s.studentId&&e.jsxs("p",{className:"text-gray-600",children:["學生ID：",e.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:s.studentId})]})]}),u&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"})}),"儲存報告"]}),e.jsxs("button",{onClick:c,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"匯出報告"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-700 mb-1",children:"整體得分"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[s.overallPerformance.totalScore,"分"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-purple-700 mb-1",children:"學習水準"}),e.jsx("p",{className:"text-lg font-semibold text-purple-600 capitalize",children:s.overallPerformance.level})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-700 mb-1",children:"強項數量"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:s.learningAnalysis.strengths.length})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-orange-700 mb-1",children:"改進領域"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:s.learningAnalysis.weaknesses.length})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md mb-6",children:e.jsx("div",{className:"flex overflow-x-auto",children:y.map(a=>e.jsxs("button",{onClick:()=>o(a.key),className:`flex-shrink-0 px-6 py-4 font-medium text-sm border-b-2 transition-colors ${n===a.key?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("span",{className:"mr-2",children:a.icon}),a.label]},a.key))})}),e.jsxs("div",{className:"space-y-6",children:[n==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"整體表現"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"總分："}),e.jsxs("span",{className:"font-semibold",children:[s.overallPerformance.totalScore,"/100"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"學習水準："}),e.jsx("span",{className:"font-semibold capitalize",children:s.overallPerformance.level})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"完成時間："}),e.jsxs("span",{className:"font-semibold",children:[s.overallPerformance.timeSpent," 分鐘"]})]}),s.overallPerformance.percentile&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"百分位數："}),e.jsxs("span",{className:"font-semibold",children:["前 ",100-s.overallPerformance.percentile,"%"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"認知分析"}),e.jsxs("div",{className:"space-y-3",children:[s.learningAnalysis.learningStyle&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"學習風格："}),e.jsx("span",{className:"ml-2 font-semibold",children:s.learningAnalysis.learningStyle})]}),s.learningAnalysis.cognitivePattern&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"認知模式："}),e.jsx("span",{className:"ml-2 font-semibold",children:s.learningAnalysis.cognitivePattern})]}),e.jsx("div",{className:"pt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"基於答題模式、反應時間和錯誤類型的綜合分析"})})]})]})]}),n==="performance"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"各題型表現分析"}),e.jsx("div",{className:"space-y-6",children:s.performanceByType.map(a=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:b(a.questionType)}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium border ${t(a.accuracy)}`,children:[a.accuracy,"% 正確率"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"總題數"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:a.totalQuestions})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"答對題數"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.correctCount})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"平均時間"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.averageTime?`${Math.round(a.averageTime/1e3)}秒`:"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-xs text-green-700 font-medium",children:"簡單"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[a.difficultyBreakdown.easy.accuracy,"%"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[a.difficultyBreakdown.easy.correct,"/",a.difficultyBreakdown.easy.total]})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("p",{className:"text-xs text-yellow-700 font-medium",children:"普通"}),e.jsxs("p",{className:"text-lg font-bold text-yellow-600",children:[a.difficultyBreakdown.normal.accuracy,"%"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[a.difficultyBreakdown.normal.correct,"/",a.difficultyBreakdown.normal.total]})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-xs text-red-700 font-medium",children:"困難"}),e.jsxs("p",{className:"text-lg font-bold text-red-600",children:[a.difficultyBreakdown.hard.accuracy,"%"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[a.difficultyBreakdown.hard.correct,"/",a.difficultyBreakdown.hard.total]})]})]}),a.commonErrors.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"常見錯誤模式："}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:a.commonErrors.map((x,i)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500 mt-1",children:"•"}),x]},i))})]})]},a.questionType))})]}),n==="analysis"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-green-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 0 1-.982-3.172M9.497 14.25a7.454 7.454 0 0 0 .981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 0 0 7.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25s4.544.16 6.75.471v1.515M7.73 9.728a6.726 6.726 0 0 0 2.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.228V2.721A48.133 48.133 0 0 0 12 2.25c-2.291 0-4.544.16-6.75.471v1.515M7.73 9.728l3.75.814.97 4.286c.078.348.14.699.185 1.053m8.272-6.842-3.75.814-.97 4.286a24.216 24.216 0 0 1-.185 1.053M12 19.5a2.25 2.25 0 0 1-2.25-2.25V14.25m4.5 5.25a2.25 2.25 0 0 1 2.25-2.25V14.25"})}),"學習強項"]}),e.jsx("div",{className:"space-y-4",children:s.learningAnalysis.strengths.map((a,x)=>e.jsxs("div",{className:`p-4 rounded-lg border ${h(a.level)}`,children:[e.jsx("h4",{className:"font-semibold mb-2",children:a.area}),e.jsx("p",{className:"text-sm mb-3",children:a.description}),a.examples.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"表現實例："}),e.jsx("ul",{className:"text-xs space-y-1",children:a.examples.map((i,f)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"✓"}),i]},f))})]}),a.leverageOpportunities.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"運用機會："}),e.jsx("ul",{className:"text-xs space-y-1",children:a.leverageOpportunities.map((i,f)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"→"}),i]},f))})]})]},x))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-red-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})}),"需要加強的領域"]}),e.jsx("div",{className:"space-y-4",children:s.learningAnalysis.weaknesses.map((a,x)=>e.jsxs("div",{className:`p-4 rounded-lg border ${m(a.severity)}`,children:[e.jsx("h4",{className:"font-semibold mb-2",children:a.area}),e.jsx("p",{className:"text-sm mb-3",children:a.description}),a.affectedTopics.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"影響主題："}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.affectedTopics.map((i,f)=>e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-200 rounded-full",children:i},f))})]}),a.recommendedActions.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"建議行動："}),e.jsx("ul",{className:"text-xs space-y-1",children:a.recommendedActions.map((i,f)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-orange-500 mt-1",children:"•"}),i]},f))})]})]},x))})]})]}),n==="recommendations"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-6",children:"個人化學習建議"}),e.jsx("div",{className:"space-y-6",children:s.personalizedRecommendations.map((a,x)=>e.jsxs("div",{className:`p-6 rounded-lg border-l-4 ${d(a.priority)}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-1",children:a.title}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("span",{className:`px-2 py-1 rounded-full border ${a.category==="immediate"?"text-red-600 bg-red-100 border-red-200":a.category==="short-term"?"text-yellow-600 bg-yellow-100 border-yellow-200":"text-blue-600 bg-blue-100 border-blue-200"}`,children:a.category==="immediate"?"立即":a.category==="short-term"?"短期":"長期"}),e.jsx("span",{className:`px-2 py-1 rounded-full border ${a.priority==="high"?"text-red-600 bg-red-100 border-red-200":a.priority==="medium"?"text-yellow-600 bg-yellow-100 border-yellow-200":"text-green-600 bg-green-100 border-green-200"}`,children:a.priority==="high"?"高優先":a.priority==="medium"?"中優先":"低優先"})]})]}),e.jsx("span",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full",children:a.estimatedTime})]}),e.jsx("p",{className:"text-gray-700 mb-4",children:a.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"具體步驟："}),e.jsx("ol",{className:"text-sm space-y-1",children:a.actionSteps.map((i,f)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5",children:f+1}),i]},f))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"預期成果："}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.expectedOutcome}),a.resources&&a.resources.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"推薦資源："}),e.jsx("ul",{className:"text-sm space-y-1",children:a.resources.map((i,f)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"📚"}),i]},f))})]})]})]})]},x))})]}),n==="teaching"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-red-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),"立即介入建議"]}),e.jsx("ul",{className:"space-y-3",children:s.teachingRecommendations.immediateInterventions.map((a,x)=>e.jsxs("li",{className:"flex items-start gap-3 p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("span",{className:"bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:"!"}),e.jsx("span",{className:"text-gray-700",children:a})]},x))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443a55.381 55.381 0 0 1 5.25 2.882V15"})}),"建議教學策略"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.teachingRecommendations.instructionalStrategies.map((a,x)=>e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:x+1}),e.jsx("span",{className:"text-gray-700",children:a})]})},x))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-purple-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})}),"差異化教學建議"]}),e.jsx("ul",{className:"space-y-3",children:s.teachingRecommendations.differentiation.map((a,x)=>e.jsxs("li",{className:"flex items-start gap-3 p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:"◆"}),e.jsx("span",{className:"text-gray-700",children:a})]},x))})]}),s.teachingRecommendations.parentGuidance&&s.teachingRecommendations.parentGuidance.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-green-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),"家長指導建議"]}),e.jsx("ul",{className:"space-y-3",children:s.teachingRecommendations.parentGuidance.map((a,x)=>e.jsxs("li",{className:"flex items-start gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("span",{className:"bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:"♥"}),e.jsx("span",{className:"text-gray-700",children:a})]},x))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-indigo-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"})}),"進度追蹤與評估"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"關鍵指標"}),e.jsx("ul",{className:"text-sm space-y-1",children:s.progressTracking.keyMetrics.map((a,x)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-indigo-500 rounded-full"}),a]},x))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"檢查點"}),e.jsx("ul",{className:"text-sm space-y-1",children:s.progressTracking.checkpoints.map((a,x)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),a]},x))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"重新評估"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.progressTracking.reassessmentSuggestion})]})]})]})]})]})]})},He=({topic:s,studentId:c,apiKey:r,mode:u="both",onClose:n,onRetakeQuiz:o,onContinueLearning:t,initialResponses:m=[],existingReport:h,resultsBinId:d,onReportSaved:b})=>{const[v,y]=l.useState(null),[a,x]=l.useState(!1),[i,f]=l.useState(null),[A,L]=l.useState(u==="teacher"?"teacher":"student"),[P,$]=l.useState(null),w=l.useCallback(async S=>{if(!r){f("需要 API Key 才能生成診斷報告");return}x(!0),f(null);try{const R={...await Os(S),generatedAt:new Date().toISOString(),resultsBinId:d};if(y(R),d)try{await Ws(d,R),console.log("診斷報告已自動儲存到學生作答結果"),b?.(R)}catch(W){console.warn("儲存診斷報告失敗，但報告仍可正常顯示:",W)}}catch(z){console.error("生成診斷報告失敗:",z),f(z instanceof Error?z.message:"生成診斷報告時發生錯誤")}finally{x(!1)}},[r,d,b]);l.useEffect(()=>{if(h){y(h);const S=Ce(s,c);S.responses=m,$(Pe(S))}else if(s&&m.length>0){const S=Ce(s,c);S.responses=m,$(Pe(S)),w(S)}},[s,c,m,h,w]);const p=l.useCallback(()=>{if(!v)return;const S={studentFeedback:v.studentFeedback,teacherReport:v.teacherReport,exportDate:new Date().toISOString()},z=JSON.stringify(S,null,2),R="data:application/json;charset=utf-8,"+encodeURIComponent(z),W=`learning_diagnostic_${s}_${new Date().toISOString().split("T")[0]}.json`,C=document.createElement("a");C.setAttribute("href",R),C.setAttribute("download",W),C.click()},[v,s]),j=l.useCallback(()=>{if(!v)return;const S=JSON.parse(localStorage.getItem("learningDiagnosticReports")||"[]");S.push({id:`report_${Date.now()}`,topic:s,studentId:c,createdAt:new Date().toISOString(),result:v}),localStorage.setItem("learningDiagnosticReports",JSON.stringify(S)),alert("診斷報告已儲存至本地")},[v,s,c]);return a?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{}),e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"正在生成學習診斷報告"}),e.jsx("p",{className:"text-gray-600",children:"AI 正在分析您的答題情況..."}),e.jsx("div",{className:"flex items-center justify-center space-x-1 mt-4",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]})]})}):i?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16 text-red-500 mx-auto mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"生成報告失敗"}),e.jsx("p",{className:"text-gray-600 mb-6",children:i}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>P&&w(P),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"重新生成"}),n&&e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"關閉"})]})]})}):v?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"學習診斷報告"}),u==="both"&&e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>L("student"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${A==="student"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"學生版"}),e.jsx("button",{onClick:()=>L("teacher"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${A==="teacher"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"教師版"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[A==="teacher"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:j,className:"px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"})}),"儲存"]}),e.jsxs("button",{onClick:p,className:"px-3 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"匯出"]})]}),n&&e.jsx("button",{onClick:n,className:"px-3 py-2 text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"關閉"})]})]})})}),e.jsxs("div",{className:"py-8",children:[(u==="student"||u==="both"&&A==="student")&&e.jsx(dt,{feedback:v.studentFeedback,onContinueLearning:t,onRetakeQuiz:o,showActions:u!=="both"}),(u==="teacher"||u==="both"&&A==="teacher")&&e.jsx(xt,{report:v.teacherReport,onExportReport:p,onSaveReport:j,showExportOptions:u!=="both"})]}),u==="both"&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs("button",{onClick:o,className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-2 font-medium",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),"重新測驗"]}),e.jsxs("button",{onClick:t,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all flex items-center gap-2 font-medium",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12l-7.5 7.5M3 12h16.5"})}),"繼續學習"]})]})})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16 text-gray-400 mx-auto mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"等待診斷數據"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"請先完成測驗以生成學習診斷報告"}),n&&e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"關閉"})]})})},mt=({quizzes:s,topic:c,studentId:r,apiKey:u,onDiagnosticComplete:n,enableDiagnostic:o=!0})=>{const[t,m]=l.useState(ee.Easy),[h,d]=l.useState(null),[b,v]=l.useState([]),[y,a]=l.useState(!1),[x,i]=l.useState(new Set),f=l.useRef(null);l.useEffect(()=>{if(o&&c&&!h){const C=Ce(c,r);d(C),f.current=Date.now()}},[c,r,o,h]);const A=()=>{if(!s||!S)return 0;let C=0;return Object.values(S).forEach(g=>{Array.isArray(g)&&(C+=g.length)}),C},L=()=>{const C=t.toLowerCase();return b.filter(g=>g.difficulty===C).length},P=()=>{const C=t.toLowerCase();return b.filter(g=>g.difficulty===C)},$=l.useCallback((C,g,T,O,N,M)=>{if(!o||!h)return;const I=f.current?Date.now()-f.current:void 0,E={questionId:C,questionType:g,difficulty:T,userAnswer:O,correctAnswer:N,isCorrect:M,responseTime:I,attempts:1};v(q=>q.find(F=>F.questionId===C)?q.map(F=>F.questionId===C?{...E,attempts:(F.attempts||0)+1}:F):[...q,E]),i(q=>new Set([...q,C])),f.current=Date.now()},[o,h]),w=l.useCallback(()=>{if(!h||!o)return;const C=Pe(h);C.responses=b,d(C),a(!0),n&&n({session:C,responses:b})},[h,b,o,n]),p=l.useCallback(()=>{a(!1);const C=t.toLowerCase();if(v(g=>g.filter(T=>T.difficulty!==C)),i(g=>{const T=new Set(g),O=t.toLowerCase();return Array.from(g).forEach(N=>{N.startsWith(`${O}-`)&&T.delete(N)}),T}),o){const g=Ce(c,r);d(g),f.current=Date.now()}},[o,c,r,t]),j=l.useCallback(()=>{a(!1)},[]);if(y&&o){const C=t===ee.Easy?"簡單":t===ee.Normal?"普通":"困難";return e.jsx(He,{topic:`${c} (${C}難度)`,studentId:r,apiKey:u,mode:"both",onRetakeQuiz:p,onContinueLearning:j,onClose:()=>a(!1),initialResponses:P()})}if(!s)return e.jsx(ie,{title:"線上互動測驗",icon:e.jsx(ye,{}),children:"沒有可用的測驗資料。"});const S=s[t],z=[{key:ee.Easy,label:"簡單"},{key:ee.Normal,label:"普通"},{key:ee.Hard,label:"困難"}],R={trueFalse:"是非題",multipleChoice:"選擇題",fillInTheBlanks:"填空題",sentenceScramble:"句子重組",memoryCardGame:"翻卡牌記憶遊戲"},W=()=>{const C=A(),g=L();return C>0?g/C*100:0};return e.jsxs(ie,{title:"線上互動測驗",icon:e.jsx(ye,{className:"w-7 h-7"}),children:[o&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"學習診斷模式"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["進度: ",L()," / ",A()]}),e.jsxs("button",{onClick:w,disabled:L()===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2 text-sm",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.745 3.745 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})}),"生成學習診斷"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-300 ease-out",style:{width:`${W()}%`}})}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"💡 完成題目後點擊「生成學習診斷」獲得個人化學習建議"})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex flex-wrap gap-2 border-b border-slate-300 pb-3 mb-4",children:z.map(({key:C,label:g})=>e.jsx("button",{onClick:()=>m(C),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors
                ${t===C?"bg-sky-600 text-white shadow-md":"bg-slate-200 text-slate-700 hover:bg-slate-300"}`,children:g},C))})}),S?Object.keys(R).map(C=>{if(!(C in S))return null;const g=S[C];return!g||!Array.isArray(g)||g.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsxs("h4",{className:"text-xl font-semibold text-slate-700 mb-3 border-b-2 border-sky-200 pb-1 flex items-center justify-between",children:[e.jsx("span",{children:R[C]}),o&&e.jsxs("span",{className:"text-sm text-gray-500 font-normal",children:["已答: ",b.filter(T=>T.questionType===C&&T.difficulty===t).length," / ",g.length]})]}),C==="trueFalse"&&Array.isArray(g)&&g.map((T,O)=>{const N=`${t}-tf-${O}`;return e.jsx("div",{className:x.has(N)?"opacity-75":"",children:e.jsx(Te,{question:T,itemNumber:O+1,onAnswer:o?(M,I)=>{$(N,"trueFalse",t,M,T.isTrue,I)}:void 0})},N)}),C==="multipleChoice"&&Array.isArray(g)&&g.map((T,O)=>{const N=`${t}-mc-${O}`;return e.jsx("div",{className:x.has(N)?"opacity-75":"",children:e.jsx(Be,{question:T,itemNumber:O+1,onAnswer:o?(M,I)=>{$(N,"multipleChoice",t,M,T.correctAnswerIndex,I)}:void 0})},N)}),C==="fillInTheBlanks"&&Array.isArray(g)&&g.map((T,O)=>{const N=`${t}-fb-${O}`;return e.jsx("div",{className:x.has(N)?"opacity-75":"",children:e.jsx(is,{question:T,itemNumber:O+1,onAnswer:o?(M,I)=>{$(N,"fillInTheBlanks",t,M,T.correctAnswer,I)}:void 0})},N)}),C==="sentenceScramble"&&Array.isArray(g)&&g.map((T,O)=>{const N=`${t}-ss-${O}`;return e.jsx("div",{className:x.has(N)?"opacity-75":"",children:e.jsx(os,{question:T,itemNumber:O+1,onAnswer:o?(M,I)=>{$(N,"sentenceScramble",t,M,T.originalSentence,I)}:void 0})},N)}),C==="memoryCardGame"&&Array.isArray(g)&&g.map((T,O)=>{const N=`${t}-mcg-${O}`;return e.jsx("div",{className:x.has(N)?"opacity-75":"",children:e.jsx(De,{question:T,itemNumber:O+1,onAnswer:o?(M,I)=>{$(N,"memoryCardGame",t,M,T.pairs,I)}:void 0})},N)})]},`${t}-${C}`)}):e.jsx("p",{children:"此難度級別沒有找到測驗題目。"}),o&&L()>0&&e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-yellow-600 mt-0.5 flex-shrink-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-800 font-medium text-sm",children:"學習診斷提示"}),e.jsxs("p",{className:"text-yellow-700 text-sm mt-1",children:["您已完成 ",L()," 題測驗。點擊上方的「生成學習診斷」按鈕，AI 將為您分析學習狀況並提供個人化建議！"]})]})]})})]})},ht=({dialogue:s})=>{const[c,r]=l.useState(null),[u,n]=l.useState(null),[o,t]=l.useState(!1),[m,h]=l.useState(""),[d,b]=l.useState(null),[v,y]=l.useState(!1),[a,x]=l.useState({tts:!0,sr:!0}),i=l.useRef(null),f=l.useRef(null);l.useEffect(()=>{const $="speechSynthesis"in window,w="SpeechRecognition"in window||"webkitSpeechRecognition"in window,p=S=>S.toLowerCase().replace(/[.,!?;:"']/g,"").trim(),j=S=>{if(u===null)return;const z=s[u].line;p(S)===p(z)?b({type:"success",message:`太棒了！發音正確: "${S}"`}):b({type:"error",message:`再試一次。您說的是: "${S}"，參考句: "${z}"`})};if(x({tts:$,sr:w}),w){const S=window.SpeechRecognition||window.webkitSpeechRecognition;if(i.current=new S,i.current===null)throw new Error("語音辨識功能初始化失敗！");i.current.continuous=!1,i.current.interimResults=!1,i.current.lang="en-US",i.current.onresult=z=>{const R=z.results[0][0].transcript;h(R),j(R)},i.current.onerror=z=>{console.error("Speech recognition error:",z.error),b({type:"error",message:`語音辨識錯誤: ${z.error==="no-speech"?"未偵測到語音":z.error==="audio-capture"?"麥克風擷取失敗":z.error==="not-allowed"?"麥克風權限未授予":"發生錯誤"}`}),t(!1)},i.current.onend=()=>{t(!1)}}return()=>{window.speechSynthesis&&window.speechSynthesis.speaking&&window.speechSynthesis.cancel()}},[s,u]);const A=($,w)=>{if(!a.tts||!$)return;window.speechSynthesis.speaking&&window.speechSynthesis.cancel();const p=new SpeechSynthesisUtterance($);p.lang="en-US";const j=window.speechSynthesis.getVoices(),S=j.find(z=>z.lang.startsWith("en")&&z.name.includes("Google")&&z.localService)||j.find(z=>z.lang.startsWith("en")&&z.localService)||j.find(z=>z.lang.startsWith("en"));S&&(p.voice=S),p.onstart=()=>{y(!0),r(w)},p.onend=()=>{y(!1),r(null)},p.onerror=z=>{console.error("Speech synthesis error:",z),y(!1),r(null),b({type:"error",message:"語音播放失敗。"})},f.current=p,window.speechSynthesis.speak(p)},L=$=>{if(!(!a.sr||!i.current||o)){n($),h(""),b(null),t(!0);try{i.current.start()}catch(w){console.error("Error starting recognition: ",w),t(!1),b({type:"error",message:"無法啟動語音辨識。"})}}},P=()=>{i.current&&o&&(i.current.stop(),t(!1))};return!s||s.length===0?e.jsx(ie,{title:"英文對話練習",icon:e.jsx($e,{className:"w-7 h-7"}),children:e.jsx("p",{className:"text-slate-600",children:"目前沒有可用的對話內容。"})}):e.jsxs(ie,{title:"英文對話練習",icon:e.jsx($e,{className:"w-7 h-7"}),children:[!a.tts&&e.jsx("p",{className:"text-red-600 bg-red-100 p-2 rounded-md",children:"您的瀏覽器不支援語音合成 (TTS)。"}),!a.sr&&e.jsx("p",{className:"text-red-600 bg-red-100 p-2 rounded-md mt-2",children:"您的瀏覽器不支援語音辨識 (SR)。建議使用最新版 Chrome 或 Edge。"}),e.jsx("div",{className:"space-y-4",children:s.map(($,w)=>e.jsxs("div",{className:`p-3 rounded-lg ${$.speaker==="Speaker A"?"bg-sky-50":"bg-indigo-50"} border ${$.speaker==="Speaker A"?"border-sky-200":"border-indigo-200"}`,children:[e.jsxs("p",{className:"font-semibold text-sm mb-1 ${item.speaker === 'Speaker A' ? 'text-sky-700' : 'text-indigo-700'}",children:[$.speaker,":"]}),e.jsx("p",{className:"text-slate-800 mb-2",children:$.line}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a.tts&&e.jsx("button",{onClick:()=>A($.line,w),disabled:v&&c!==w,className:`p-1.5 rounded-full hover:bg-slate-200 transition-colors disabled:opacity-50 ${v&&c===w?"text-sky-500 animate-pulse":"text-slate-600"}`,"aria-label":`播放 ${$.speaker} 的話`,children:e.jsx(et,{className:"w-5 h-5"})}),a.sr&&(o&&u===w?e.jsx("button",{onClick:P,className:"p-1.5 rounded-full text-red-600 hover:bg-red-100 transition-colors","aria-label":"停止錄音",children:e.jsx(st,{className:"w-5 h-5"})}):e.jsx("button",{onClick:()=>L(w),disabled:o||v,className:"p-1.5 rounded-full text-slate-600 hover:bg-slate-200 transition-colors disabled:opacity-50","aria-label":`練習說出 ${$.speaker} 的話`,children:e.jsx(tt,{className:"w-5 h-5"})}))]}),u===w&&m&&e.jsxs("p",{className:"mt-2 text-sm text-slate-600 italic",children:['您說的是: "',m,'"']}),u===w&&d&&e.jsxs("div",{className:`mt-2 p-2 rounded-md text-sm flex items-start ${d.type==="success"?"bg-green-100 text-green-700":d.type==="error"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:[d.type==="success"&&e.jsx(Oe,{className:"w-5 h-5 mr-2 flex-shrink-0"}),d.type==="error"&&e.jsx(We,{className:"w-5 h-5 mr-2 flex-shrink-0"}),e.jsx("span",{children:d.message})]})]},w))}),o&&e.jsx("p",{className:"mt-4 text-center text-sky-600 font-medium animate-pulse",children:"正在聆聽..."})]})},gt=s=>`
    <div class="tabs">
      <button class="tab-btn active" data-tab-target="easy-quiz-content" data-difficulty="easy">簡單</button>
      <button class="tab-btn" data-tab-target="normal-quiz-content" data-difficulty="normal">普通</button>
      <button class="tab-btn" data-tab-target="hard-quiz-content" data-difficulty="hard">困難</button>
    </div>
    <div id="easy-quiz-content" class="tab-content active">
      <!-- Content rendered by JS -->
      <div class="quiz-items-container" data-difficulty="easy"></div>
    </div>
    <div id="normal-quiz-content" class="tab-content">
      <!-- Content rendered by JS -->
      <div class="quiz-items-container" data-difficulty="normal"></div>
    </div>
    <div id="hard-quiz-content" class="tab-content">
      <!-- Content rendered by JS -->
      <div class="quiz-items-container" data-difficulty="hard"></div>
    </div>
    <script type="application/json" id="quizDataStore">
      ${s}
    <\/script>
  `,ut=(s,c)=>{const r=s.learningObjectives&&s.learningObjectives.length>0?s.learningObjectives.map(x=>`
        <div class="objective-item" style="margin-bottom:20px; padding:16px; background:#f0fdf4; border-left:4px solid #10b981; border-radius:6px;">
          <h3 style="color:#059669; margin-bottom:8px; font-size:1.1em; font-weight:600;">${x.objective}</h3>
          <p style="color:#047857; margin-bottom:8px; line-height:1.6;">${x.description}</p>
          ${x.teachingExample?`
            <div style="background:#ecfdf5; border:1px solid #a7f3d0; padding:12px; border-radius:4px; margin-top:8px;">
              <strong style="color:#065f46; font-size:0.85em; display:block; margin-bottom:4px;">教學示例</strong>
              <span style="color:#047857; font-size:0.9em;">${x.teachingExample}</span>
            </div>`:""}
        </div>`).join(""):"<p>沒有提供教學目標。</p>",u=s.contentBreakdown&&s.contentBreakdown.length>0?s.contentBreakdown.map(x=>`
        <div class="breakdown-item" style="margin-bottom:24px; padding-bottom:20px; border-bottom:1px solid #e2e8f0;">
          <h3 style="color:#0369a1; margin-bottom:8px;">${x.topic}</h3>
          <p style="margin-bottom:12px; color:#475569;">${x.details}</p>
          
          ${x.coreConcept?`
            <div style="background:#eff6ff; border-left:4px solid #3b82f6; padding:12px; border-radius:4px; margin-bottom:12px;">
              <strong style="color:#1e40af; font-size:0.85em; display:block; margin-bottom:4px;">核心概念</strong>
              <span style="color:#1e3a8a; font-size:0.9em;">${x.coreConcept}</span>
            </div>`:""}
          
          ${x.teachingSentences&&x.teachingSentences.length>0?`
            <div style="background:#eef2ff; border-left:4px solid #6366f1; padding:12px; border-radius:4px; margin-bottom:12px;">
              <strong style="color:#4338ca; font-size:0.85em; display:block; margin-bottom:8px;">教學例句</strong>
              <div style="line-height:1.6;">
                ${x.teachingSentences.map((i,f)=>`
                  <div style="color:#312e81; font-size:0.9em; margin-bottom:4px;">
                    <span style="color:#6366f1; font-family:monospace;">${f+1}.</span> ${i}
                  </div>
                `).join("")}
              </div>
            </div>`:""}
          
          ${x.teachingTips?`
            <div style="background:#faf5ff; border-left:4px solid #8b5cf6; padding:12px; border-radius:4px; margin-bottom:12px;">
              <strong style="color:#7c3aed; font-size:0.85em; display:block; margin-bottom:4px;">教學要點提示</strong>
              <span style="color:#6b21a8; font-size:0.9em;">${x.teachingTips}</span>
            </div>`:""}
          
          ${x.teachingExample?`
            <div style="background:#f0f9ff; border-left:4px solid #0ea5e9; padding:12px; border-radius:4px;">
              <strong style="color:#0284c7; font-size:0.85em; display:block; margin-bottom:4px;">教學示例</strong>
              <span style="color:#0c4a6e; font-size:0.9em;">${x.teachingExample}</span>
            </div>`:""}
        </div>`).join(""):"<p>沒有提供內容分解。</p>",n=s.confusingPoints&&s.confusingPoints.length>0?s.confusingPoints.map(x=>`
        <div class="confusing-point-item" style="border:1px solid #e2e8f0; border-radius:8px; padding:20px; margin-bottom:24px; background:#fefefe;">
          <h3 style="color:#b91c1c; margin-bottom:12px; font-size:1.3em; font-weight:600;">${x.point}</h3>
          <p style="margin-bottom:16px; color:#475569; line-height:1.6;">${x.clarification}</p>
          
          ${x.errorType?`
          <div style="background:#fff7ed; border-left:4px solid #f97316; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#c2410c; font-size:0.8em; display:block; margin-bottom:4px;">誤區類型</strong>
            <span style="color:#9a3412; font-size:0.9em;">${x.errorType}</span>
          </div>`:""}
          
          ${x.commonErrors&&x.commonErrors.length>0?`
          <div style="background:#fef2f2; border-left:4px solid #ef4444; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#dc2626; font-size:0.8em; display:block; margin-bottom:8px;">常見錯誤示例</strong>
            <div style="margin-left:0;">
              ${x.commonErrors.map((i,f)=>`
                <div style="color:#991b1b; font-size:0.9em; margin-bottom:4px;">
                  <span style="color:#dc2626; font-family:monospace; margin-right:6px;">${f+1}.</span>${i}
                </div>
              `).join("")}
            </div>
          </div>`:""}
          
          ${x.correctVsWrong&&x.correctVsWrong.length>0?`
          <div style="background:#fefce8; border-left:4px solid #eab308; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#a16207; font-size:0.8em; display:block; margin-bottom:8px;">正確與錯誤對比</strong>
            ${x.correctVsWrong.map((i,f)=>`
              <div style="border:1px solid #fde047; background:#fffbeb; padding:12px; margin-bottom:8px; border-radius:6px;">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:8px;">
                  <div style="background:#f0fdf4; padding:10px; border-radius:4px; border:1px solid #bbf7d0;">
                    <strong style="color:#166534; font-size:0.8em; display:block; margin-bottom:4px;">✓ 正確</strong>
                    <span style="color:#15803d; font-size:0.9em;">${i.correct}</span>
                  </div>
                  <div style="background:#fef2f2; padding:10px; border-radius:4px; border:1px solid #fecaca;">
                    <strong style="color:#dc2626; font-size:0.8em; display:block; margin-bottom:4px;">✗ 錯誤</strong>
                    <span style="color:#991b1b; font-size:0.9em;">${i.wrong}</span>
                  </div>
                </div>
                <div style="background:#eff6ff; padding:10px; border-radius:4px; border:1px solid #bfdbfe;">
                  <strong style="color:#1d4ed8; font-size:0.8em; display:block; margin-bottom:4px;">說明</strong>
                  <span style="color:#1e40af; font-size:0.9em;">${i.explanation}</span>
                </div>
              </div>
            `).join("")}
          </div>`:""}
          
          ${x.preventionStrategy?`
          <div style="background:#eff6ff; border-left:4px solid #3b82f6; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#1d4ed8; font-size:0.8em; display:block; margin-bottom:4px;">預防策略</strong>
            <span style="color:#1e40af; font-size:0.9em;">${x.preventionStrategy}</span>
          </div>`:""}
          
          ${x.correctionMethod?`
          <div style="background:#faf5ff; border-left:4px solid #a855f7; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#7c3aed; font-size:0.8em; display:block; margin-bottom:4px;">糾正方法</strong>
            <span style="color:#6b21a8; font-size:0.9em;">${x.correctionMethod}</span>
          </div>`:""}
          
          ${x.practiceActivities&&x.practiceActivities.length>0?`
          <div style="background:#f0f9ff; border-left:4px solid #6366f1; padding:12px; margin-bottom:12px; border-radius:4px;">
            <strong style="color:#4338ca; font-size:0.8em; display:block; margin-bottom:8px;">練習建議</strong>
            <div style="margin-left:0;">
              ${x.practiceActivities.map((i,f)=>`
                <div style="color:#312e81; font-size:0.9em; margin-bottom:4px;">
                  <span style="color:#4338ca; font-family:monospace; margin-right:6px;">${f+1}.</span>${i}
                </div>
              `).join("")}
            </div>
          </div>`:""}
          
          ${x.teachingExample?`
          <div style="background:#f9fafb; border-left:4px solid #6b7280; padding:12px; border-radius:4px;">
            <strong style="color:#374151; font-size:0.8em; display:block; margin-bottom:4px;">教學示例</strong>
            <span style="color:#111827; font-size:0.9em;">${x.teachingExample}</span>
          </div>`:""}
        </div>`).join(""):"<p>沒有提供易混淆點。</p>",o=s.classroomActivities&&s.classroomActivities.length>0?s.classroomActivities.map(x=>`
        <div class="activity-item" style="border:1px solid #e0e7ef; border-radius:6px; padding:16px; margin-bottom:16px; background:#f8fafc;">
          <h3 style="color:#2563eb; margin-bottom:8px; font-size:1.2em;">${x.title}</h3>
          <p style="margin-bottom:12px; color:#475569;">${x.description}</p>
          
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px;">
            ${x.objective?`
              <div>
                <strong style="color:#0f172a;">學習目標：</strong>
                <p style="margin:4px 0 0 0; font-size:0.9em;">${x.objective}</p>
              </div>`:""}
            ${x.timing?`
              <div>
                <strong style="color:#0f172a;">使用時機：</strong>
                <p style="margin:4px 0 0 0; font-size:0.9em;">${x.timing}</p>
              </div>`:""}
            ${x.materials?`
            <div>
              <strong style="color:#0f172a;">所需教具：</strong>
              <p style="margin:4px 0 0 0; font-size:0.9em;">${x.materials}</p>
            </div>`:""}
            ${x.environment?`
            <div>
              <strong style="color:#0f172a;">環境要求：</strong>
              <p style="margin:4px 0 0 0; font-size:0.9em;">${x.environment}</p>
            </div>`:""}
          </div>
          
          ${x.steps&&x.steps.length>0?`
            <div style="margin-bottom:12px;">
              <strong style="color:#0f172a;">活動步驟：</strong>
              <ol style="margin:8px 0 0 20px; padding:0;">
                ${x.steps.map(i=>`<li style="margin-bottom:4px; font-size:0.9em;">${i}</li>`).join("")}
              </ol>
            </div>`:""}
          
          ${x.assessmentPoints&&x.assessmentPoints.length>0?`
            <div>
              <strong style="color:#0f172a;">評估重點：</strong>
              <ul style="margin:8px 0 0 20px; padding:0;">
                ${x.assessmentPoints.map(i=>`<li style="margin-bottom:4px; font-size:0.9em;">${i}</li>`).join("")}
              </ul>
            </div>`:""}
        </div>
      `).join(""):"<p>沒有提供課堂活動。</p>",t=s.englishConversation&&s.englishConversation.length>0?s.englishConversation.map(x=>`
        <div class="dialogue-line ${x.speaker==="Speaker A"?"speakerA":"speakerB"}">
          <span class="speaker">${x.speaker}:</span> ${x.line}
        </div>`).join("")+"<p><small><em>注意：互動式語音朗讀和練習功能僅在線上應用程式中提供。</em></small></p>":"<p>沒有提供英文對話內容。</p>",m=s.learningLevels&&s.learningLevels.suggestedLevels&&s.learningLevels.suggestedLevels.length>0?s.learningLevels.suggestedLevels.sort((x,i)=>x.order-i.order).map(x=>`
          <div class="level-item" style="border:1px solid #e0e7ef; border-radius:8px; padding:16px; margin-bottom:12px; background:${x.id===s.learningLevels?.defaultLevelId?"#eff8ff":"#f8fafc"}; border-left: 4px solid ${x.id===s.learningLevels?.defaultLevelId?"#0ea5e9":"#e2e8f0"};">
            <div style="display:flex; align-items:center; margin-bottom:8px;">
              <div style="width:32px; height:32px; border-radius:50%; background-color:${x.id===s.learningLevels?.defaultLevelId?"#0ea5e9":"#94a3b8"}; color:white; display:flex; align-items:center; justify-content:center; font-weight:bold; margin-right:12px;">${x.order}</div>
              <h3 style="margin:0; color:${x.id===s.learningLevels?.defaultLevelId?"#0c4a6e":"#334155"};">${x.name}</h3>
              ${x.id===s.learningLevels?.defaultLevelId?'<span style="background:#dcfce7; color:#166534; padding:2px 8px; border-radius:4px; font-size:0.8em; margin-left:8px;">預設</span>':""}
            </div>
            <p style="margin:0; color:#64748b; line-height:1.5;">${x.description}</p>
          </div>
        `).join(""):"<p>沒有提供學習程度建議。</p>",h=JSON.stringify(s.onlineInteractiveQuiz||{}),d=gt(h),b=`
    <!DOCTYPE html>
    <html lang="zh-Hant">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>學習計畫：${c}</title>
      <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; margin: 0; padding: 20px; line-height: 1.6; background-color: #f4f7f9; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #3498db; margin-top: 30px; border-bottom: 1px solid #eee; padding-bottom: 8px;}
        h3 { color: #2980b9; margin-top: 20px; }
        h4 { color: #16a085; margin-top:15px; font-size: 1.1em; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed #bdc3c7;}
        ul { list-style-type: disc; padding-left: 20px; }
        li { margin-bottom: 8px; }
        p { margin-bottom: 10px; }
        .section { margin-bottom: 25px; }
        .breakdown-item, .confusing-point-item { border-left: 3px solid #3498db; padding-left: 15px; margin-bottom: 15px; background-color: #fdfdfe; padding:10px; border-radius: 0 4px 4px 0;}
        .dialogue-line { margin-bottom: 8px; padding: 10px; border-radius: 5px; }
        .dialogue-line .speaker { font-weight: bold; color: #0056b3; }
        .dialogue-line.speakerA { background-color: #e7f3ff; border-left: 3px solid #79a6dc; }
        .dialogue-line.speakerB { background-color: #e6fff0; border-left: 3px solid #68d19a; }
        
        .tabs { display: flex; margin-bottom: 0; border-bottom: 1px solid #ccc;}
        .tabs button { padding: 10px 15px; cursor: pointer; border: 1px solid #ccc; background-color: #f0f0f0; margin-right: 0px; border-bottom: none; border-radius: 5px 5px 0 0; font-size: 1em;}
        .tabs button.active { background-color: #fff; border-bottom: 1px solid #fff; color: #3498db; font-weight: bold; position:relative; top:1px;}
        .tab-content { display: none; padding: 15px; border: 1px solid #ccc; border-top: none; background-color:#fff; border-radius: 0 0 5px 5px;}
        .tab-content.active { display: block; }

        .quiz-item { border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 15px; border-radius: 5px; background: #f9f9f9; }
        .quiz-question { font-weight: 500; margin-bottom: 8px; color: #333; }
        .quiz-item p:first-child { margin-top: 0; }
        .quiz-feedback { padding: 8px; margin-top: 10px; border-radius: 4px; font-size: 0.9em; }
        .quiz-feedback.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .quiz-feedback.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .quiz-feedback em { color: #555;}
        
        .tf-options button { margin-right: 10px; padding: 8px 12px; border-radius: 4px; border: 1px solid #ccc; cursor: pointer; }
        .tf-options button.selected.correct, .tf-options button.correct { background-color: #28a745; color: white; border-color: #28a745; }
        .tf-options button.selected.incorrect, .tf-options button.incorrect { background-color: #dc3545; color: white; border-color: #dc3545; }
        .tf-options button:disabled { opacity: 0.7; cursor: not-allowed; }

        .mc-options label { display: block; margin-bottom: 8px; padding: 8px; border: 1px solid #eee; border-radius: 4px; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; }
        .mc-options label:hover { background-color: #f0f8ff; }
        .mc-options input[type="radio"] { margin-right: 8px; }
        .mc-options label.selected { background-color: #e0f0ff; border-color: #79a6dc; }
        .mc-options label.correct-answer { background-color: #d4edda !important; border-color: #c3e6cb !important; color: #155724;}
        .mc-options label.incorrect-selection { background-color: #f8d7da !important; border-color: #f5c6cb !important; color: #721c24;}
        .mc-options label.disabled { cursor: not-allowed; opacity: 0.7; }


        .fb-input { padding: 6px; border: 1px solid #ccc; border-radius: 4px; margin: 0 5px; min-width:100px; }
        .fb-input:disabled { background-color: #eee; }

        .ss-word-bank, .ss-constructed-sentence-area { display: flex; flex-wrap: wrap; gap: 8px; padding: 10px; border: 1px dashed #ccc; border-radius: 4px; min-height: 40px; margin-bottom: 10px; }
        .ss-word-bank { background-color: #f0f8ff; }
        .ss-constructed-sentence-area { background-color: #e6fff0; }
        .ss-word-bank button, .ss-constructed-sentence-area button { padding: 5px 10px; background-color: #add8e6; border: none; border-radius: 4px; cursor: pointer; font-size: 0.95em;}
        .ss-word-bank button:hover, .ss-constructed-sentence-area button:hover { background-color: #90cce0; }
        .ss-constructed-sentence-area button { background-color: #a2d2ff; }


        .quiz-item button.check-answer-btn, .quiz-item button.ss-action-btn {
          background-color: #3498db; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em; margin-top: 10px; transition: background-color 0.2s;
        }
        .quiz-item button.check-answer-btn:hover, .quiz-item button.ss-action-btn:hover { background-color: #2980b9; }
        .quiz-item button.ss-action-btn.ss-clear { background-color: #e74c3c; margin-left: 5px;}
        .quiz-item button.ss-action-btn.ss-clear:hover { background-color: #c0392b; }
        .quiz-item button:disabled, .quiz-item button.check-answer-btn:disabled, .quiz-item button.ss-action-btn:disabled { background-color: #bdc3c7; cursor: not-allowed; opacity: 0.7;}
        
        footer { text-align: center; margin-top: 30px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 0.9em; color: #777; }
      </style>
    </head>
    <body>
      <div class="container">
        <h1>學習計畫：${c}</h1>

        <div class="section">
          <h2>學習程度建議</h2>
          ${m}
        </div>

        <div class="section">
          <h2>教學目標設定</h2>
          ${r}
        </div>

        <div class="section">
          <h2>分解學習內容</h2>
          ${u}
        </div>

        <div class="section">
          <h2>易混淆點識別</h2>
          ${n}
        </div>

        <div class="section">
          <h2>課堂活動與遊戲設計</h2>
          ${o}
        </div>
        
        <div class="section">
          <h2>英文對話練習</h2>
          ${t}
        </div>

        <div class="section">
          <h2>線上互動測驗</h2>
          ${d}
        </div>
        
        <footer>
          <p>此學習計畫由 AI 產生。匯出時間：${new Date().toLocaleString()}</p>
        </footer>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const quizData = JSON.parse(document.getElementById('quizDataStore').textContent || '{}');
          let sentenceScrambleStates = {}; // To store dynamic state for sentence scramble

          const normalizeText = (str) => {
            if (typeof str !== 'string') return '';
            // Corrected regex for multiple spaces: \\s+ instead of \\s+
            return str.toLowerCase().replace(/[.,!?;:'"‘'""]/g, '').replace(/\\s+/g, ' ').trim();
          };

          const renderQuizzesForDifficulty = (difficulty) => {
            const container = document.querySelector(\`.quiz-items-container[data-difficulty="\${difficulty}"]\`);
            if (!container) return;
            container.innerHTML = ''; 
            sentenceScrambleStates[difficulty] = {}; // Reset states for this difficulty

            const difficultyData = quizData[difficulty];
            if (!difficultyData || Object.keys(difficultyData).every(type => !difficultyData[type] || difficultyData[type].length === 0)) {
              container.innerHTML = '<p>此難度沒有測驗資料。</p>';
              return;
            }

            let itemGlobalIndex = 0;
            const typeLabels = { trueFalse: "是非題", multipleChoice: "選擇題", fillInTheBlanks: "填空題", sentenceScramble: "句子重組"};

            const createHtml = (type, q, index) => {
              const questionId = \`\${difficulty}-\${type}-\${index}\`;
              let itemHtml = \`<div class="quiz-item \${type}-item" id="item-\${questionId}">\`;
              
              if (type === 'trueFalse') {
                itemHtml += \`<p class="quiz-question">\${itemGlobalIndex + 1}. \${q.statement}</p>\`;
                itemHtml += \`<div class="tf-options">\`;
                itemHtml += \`<button data-value="true" data-question-id="\${questionId}">是 (True)</button>\`;
                itemHtml += \`<button data-value="false" data-question-id="\${questionId}">非 (False)</button>\`;
                itemHtml += \`</div>\`;
              } else if (type === 'multipleChoice') {
                itemHtml += \`<p class="quiz-question">\${itemGlobalIndex + 1}. \${q.question}</p>\`;
                itemHtml += \`<div class="mc-options">\`;
                q.options.forEach((opt, optIndex) => {
                  itemHtml += \`<label><input type="radio" name="mc-\${questionId}" value="\${optIndex}"> \${String.fromCharCode(65 + optIndex)}. \${opt}</label>\`;
                });
                itemHtml += \`</div>\`;
                itemHtml += \`<button class="check-answer-btn mc-check" data-question-id="\${questionId}">檢查答案</button>\`;
              } else if (type === 'fillInTheBlanks') {
                itemHtml += \`<p class="quiz-question">\${itemGlobalIndex + 1}. \${q.sentenceWithBlank.replace('____', '<input type="text" class="fb-input" id="fb-input-\${questionId}" placeholder="答案">')}</p>\`;
                itemHtml += \`<button class="check-answer-btn fb-check" data-question-id="\${questionId}">檢查答案</button>\`;
              } else if (type === 'sentenceScramble') {
                sentenceScrambleStates[difficulty][questionId] = {
                    availableWords: q.scrambledWords.slice().sort(() => Math.random() - 0.5),
                    constructedWords: []
                };
                itemHtml += \`<p class="quiz-question">\${itemGlobalIndex + 1}. 請重組以下詞彙來形成一個正確的句子：</p>\`;
                itemHtml += \`<p class="ss-instruction">點擊下方詞彙將其加入您的句子，或點擊您句子中的詞彙將其移回詞彙庫。</p>\`
                itemHtml += \`<div class="ss-word-bank" id="ss-bank-\${questionId}">\`;
                sentenceScrambleStates[difficulty][questionId].availableWords.forEach(word => {
                   itemHtml += \`<button class="ss-word" data-word="\${word}" data-question-id="\${questionId}" data-source="bank">\${word}</button>\`;
                });
                itemHtml += \`</div>\`;
                itemHtml += \`<p class="quiz-question">您的句子：</p><div class="ss-constructed-sentence-area" id="ss-area-\${questionId}"></div>\`;
                itemHtml += \`<button class="check-answer-btn ss-check" data-question-id="\${questionId}">檢查句子</button>\`;
                itemHtml += \`<button class="ss-action-btn ss-clear" data-question-id="\${questionId}">清除</button>\`;
              }
              itemHtml += \`<div class="quiz-feedback" id="feedback-\${questionId}"></div></div>\`;
              itemGlobalIndex++;
              return itemHtml;
            };
            
            const quizTypes = ['trueFalse', 'multipleChoice', 'fillInTheBlanks', 'sentenceScramble'];
            let hasContentForDifficulty = false;

            quizTypes.forEach(type => {
              if (difficultyData[type] && difficultyData[type].length > 0) {
                hasContentForDifficulty = true;
                const typeHeader = document.createElement('h4');
                typeHeader.textContent = typeLabels[type];
                container.appendChild(typeHeader);
                difficultyData[type].forEach((q, i) => {
                  const questionElement = document.createElement('div');
                  questionElement.innerHTML = createHtml(type, q, i);
                  container.appendChild(questionElement.firstChild);
                });
              }
            });
             if (!hasContentForDifficulty) {
                 container.innerHTML = '<p>此難度沒有可用的測驗題目。</p>';
            }
          };

          const tabButtons = document.querySelectorAll('.tabs .tab-btn');
          const tabContents = document.querySelectorAll('.tab-content');

          tabButtons.forEach(button => {
            button.addEventListener('click', () => {
              tabButtons.forEach(btn => btn.classList.remove('active'));
              tabContents.forEach(content => content.classList.remove('active'));

              button.classList.add('active');
              const targetContentId = button.getAttribute('data-tab-target');
              document.getElementById(targetContentId).classList.add('active');
              
              const difficulty = button.getAttribute('data-difficulty');
              renderQuizzesForDifficulty(difficulty);
            });
          });
          
          // Initial render for the default active tab
          renderQuizzesForDifficulty('easy');


          // Event delegation for quiz interactions
          document.querySelector('.container').addEventListener('click', (event) => {
            const target = event.target;
            // Ensure target is an HTMLElement before trying to access attributes or match selectors
            if (!(target instanceof HTMLElement)) return;

            const questionId = target.getAttribute('data-question-id');
            if (!questionId) return;

            const [difficulty, type, indexStr] = questionId.split('-');
            const index = parseInt(indexStr);
            const questionData = quizData[difficulty]?.[type]?.[index];
            const feedbackEl = document.getElementById(\`feedback-\${questionId}\`);

            if (!questionData || !feedbackEl) return;

            // True/False
            if (target.matches('.tf-options button')) {
              const selectedValue = target.getAttribute('data-value') === 'true';
              const isCorrect = selectedValue === questionData.isTrue;
              feedbackEl.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
              let message = isCorrect ? '答對了！' : \`答錯了。正確答案是：\${questionData.isTrue ? '是 (True)' : '非 (False)'}\`;
              if (questionData.explanation) message += \` <em>\${questionData.explanation}</em>\`;
              feedbackEl.innerHTML = message;
              
              target.classList.add('selected', isCorrect ? 'correct' : 'incorrect');
              Array.from(target.parentElement.children).forEach(btn => btn.disabled = true);
            }

            // Multiple Choice Check
            else if (target.matches('.mc-check')) {
              const selectedRadio = document.querySelector(\`input[name="mc-\${questionId}"]:checked\`);
              if (!selectedRadio) {
                feedbackEl.className = 'quiz-feedback incorrect';
                feedbackEl.textContent = '請選擇一個選項。';
                return;
              }
              const selectedOptionIndex = parseInt(selectedRadio.value);
              const isCorrect = selectedOptionIndex === questionData.correctAnswerIndex;
              
              feedbackEl.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
              let message = isCorrect ? '答對了！' : \`答錯了。正確答案是：\${String.fromCharCode(65 + questionData.correctAnswerIndex)}. \${questionData.options[questionData.correctAnswerIndex]}\`;
              feedbackEl.innerHTML = message;

              // Visually mark options
              const optionLabels = document.querySelectorAll(\`#item-\${questionId} .mc-options label\`);
              optionLabels.forEach((label, idx) => {
                label.classList.add('disabled');
                const radioInLabel = label.querySelector('input');
                if (radioInLabel) radioInLabel.disabled = true;

                if (idx === questionData.correctAnswerIndex) {
                    label.classList.add('correct-answer');
                }
                if (idx === selectedOptionIndex && !isCorrect) {
                    label.classList.add('incorrect-selection');
                }
                 if (idx === selectedOptionIndex) {
                    label.classList.add('selected');
                }
              });
              target.disabled = true;
            }

            // Fill in the Blanks Check
            else if (target.matches('.fb-check')) {
              const inputEl = document.getElementById(\`fb-input-\${questionId}\`);
              // Add null check for inputEl
              if (!inputEl) {
                  console.error('Fill-in-the-blanks input element not found for ID:', \`fb-input-\${questionId}\`);
                  feedbackEl.className = 'quiz-feedback incorrect';
                  feedbackEl.textContent = '發生錯誤：找不到輸入欄位。';
                  return;
              }
              const userAnswer = inputEl.value.trim();
              if (userAnswer === '') {
                feedbackEl.className = 'quiz-feedback incorrect';
                feedbackEl.textContent = '請輸入答案。';
                return;
              }
              const isCorrect = normalizeText(userAnswer) === normalizeText(questionData.correctAnswer);
              feedbackEl.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
              feedbackEl.textContent = isCorrect ? '答對了！' : \`答錯了。正確答案是： "\${questionData.correctAnswer}"\`;
              inputEl.disabled = true;
              target.disabled = true;
            }
            
            // Sentence Scramble
            else if (target.matches('.ss-word') || target.matches('.ss-check') || target.matches('.ss-clear')) {
                const state = sentenceScrambleStates[difficulty][questionId];
                if (!state) return; // Should not happen if initialized correctly

                const bankEl = document.getElementById(\`ss-bank-\${questionId}\`);
                const areaEl = document.getElementById(\`ss-area-\${questionId}\`);
                
                if(!bankEl || !areaEl) return;


                const redrawScramble = () => {
                    bankEl.innerHTML = '';
                    state.availableWords.forEach(w => {
                        bankEl.innerHTML += \`<button class="ss-word" data-word="\${w}" data-question-id="\${questionId}" data-source="bank">\${w}</button>\`;
                    });
                    areaEl.innerHTML = '';
                    state.constructedWords.forEach(w => {
                        areaEl.innerHTML += \`<button class="ss-word" data-word="\${w}" data-question-id="\${questionId}" data-source="area">\${w}</button>\`;
                    });
                };

                if (target.matches('.ss-word')) {
                    const word = target.getAttribute('data-word');
                    const source = target.getAttribute('data-source');
                    if (source === 'bank') {
                        state.constructedWords.push(word);
                        // Correctly remove only one instance of the word from availableWords
                        const wordIndexInBank = state.availableWords.indexOf(word);
                        if (wordIndexInBank > -1) {
                            state.availableWords.splice(wordIndexInBank, 1);
                        }
                    } else { // source === 'area'
                        state.availableWords.push(word);
                        // Correctly remove only one instance of the word from constructedWords
                        const wordIndexInArea = state.constructedWords.indexOf(word);
                        if (wordIndexInArea > -1) {
                            state.constructedWords.splice(wordIndexInArea, 1);
                        }
                    }
                    redrawScramble();
                    feedbackEl.textContent = '';
                    feedbackEl.className = 'quiz-feedback';
                } else if (target.matches('.ss-check')) {
                    const userAnswer = state.constructedWords.join(' ').trim();
                    const isCorrect = normalizeText(userAnswer) === normalizeText(questionData.originalSentence);
                    feedbackEl.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
                    feedbackEl.textContent = isCorrect ? '答對了！' : \`答錯了。正確句子是： "\${questionData.originalSentence}"\`;
                    target.disabled = true;
                    const clearButton = document.querySelector(\`#item-\${questionId} .ss-clear\`);
                    if(clearButton) clearButton.disabled = true;
                    
                    bankEl.querySelectorAll('button').forEach(b => b.disabled = true);
                    areaEl.querySelectorAll('button').forEach(b => b.disabled = true);

                } else if (target.matches('.ss-clear')) {
                    state.availableWords = questionData.scrambledWords.slice().sort(() => Math.random() - 0.5);
                    state.constructedWords = [];
                    redrawScramble();
                    feedbackEl.textContent = '';
                    feedbackEl.className = 'quiz-feedback';
                }
            }

          });
        });
      <\/script>
    </body>
    </html>
  `,v=new Blob([b],{type:"text/html;charset=utf-8"}),y=URL.createObjectURL(v),a=document.createElement("a");a.href=y,a.download=`learning-plan-${c.replace(/\s+/g,"_")||"untitled"}.html`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(y)},qe="AES-GCM",pt=256,Re=12;async function ds(s,c){const r=new TextEncoder,u=await crypto.subtle.importKey("raw",r.encode(s),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:c,iterations:1e5,hash:"SHA-256"},u,{name:qe,length:pt},!1,["encrypt","decrypt"])}async function bt(s,c="ai-page-gen-2024"){try{const u=new TextEncoder().encode(s),n=crypto.getRandomValues(new Uint8Array(16)),o=crypto.getRandomValues(new Uint8Array(Re)),t=await ds(c,n),m=await crypto.subtle.encrypt({name:qe,iv:o},t,u),h=new Uint8Array(n.length+o.length+m.byteLength);return h.set(n,0),h.set(o,n.length),h.set(new Uint8Array(m),n.length+o.length),jt(h)}catch(r){throw console.error("加密 API Key 失敗:",r),new Error("加密失敗")}}async function ft(s,c="ai-page-gen-2024"){try{const r=vt(s),u=r.slice(0,16),n=r.slice(16,16+Re),o=r.slice(16+Re),t=await ds(c,u),m=await crypto.subtle.decrypt({name:qe,iv:n},t,o);return new TextDecoder().decode(m)}catch(r){throw console.error("解密 API Key 失敗:",r),new Error("解密失敗或數據已損壞")}}function jt(s){const c=new Uint8Array(s);let r="";for(let u=0;u<c.byteLength;u++)r+=String.fromCharCode(c[u]);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function vt(s){const c="=".repeat((4-s.length%4)%4),r=s.replace(/-/g,"+").replace(/_/g,"/")+c,u=atob(r),n=new Uint8Array(u.length);for(let o=0;o<u.length;o++)n[o]=u.charCodeAt(o);return n}function xs(){return typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof crypto.subtle.encrypt=="function"}async function Ye(s){if(!xs())return console.warn("Web Crypto API 不支援，將使用明文傳輸（不建議）"),`apikey=${encodeURIComponent(s)}`;const c=await bt(s);return`enckey=${encodeURIComponent(c)}`}async function ms(s){const c=s.get("enckey");if(c&&xs())try{return await ft(decodeURIComponent(c))}catch(u){console.error("解密 API Key 失敗，嘗試使用明文參數:",u)}const r=s.get("apikey");return r?decodeURIComponent(r):null}const yt=({tabs:s,current:c,onChange:r,children:u})=>e.jsxs("div",{children:[e.jsx("div",{className:"flex border-b mb-4",children:s.map(n=>e.jsx("button",{className:`px-4 py-2 -mb-px border-b-2 font-medium transition-colors focus:outline-none ${c===n.key?"border-indigo-600 text-indigo-700 bg-white":"border-transparent text-slate-500 hover:text-indigo-600"}`,onClick:()=>r(n.key),type:"button",children:n.label},n.key))}),e.jsx("div",{children:u[s.findIndex(n=>n.key===c)]})]}),Nt=({config:s,onConfigChange:c,onRegenerate:r,isGenerating:u})=>{const n={trueFalse:"是非題",multipleChoice:"選擇題",fillInTheBlanks:"填空題",sentenceScramble:"句子重組",memoryCardGame:"翻卡記憶"},o=(d,b)=>{const v=Ze[d],y=Math.max(0,Math.min(v,b)),a={easy:{...s.easy,[d]:y},normal:{...s.normal,[d]:y},hard:{...s.hard,[d]:y}};c(a)},t=()=>{c(ns)},m=()=>{const d=Object.values(s.easy).reduce((y,a)=>y+a,0),b=Object.values(s.normal).reduce((y,a)=>y+a,0),v=Object.values(s.hard).reduce((y,a)=>y+a,0);return d+b+v},h=d=>s.easy[d]+s.normal[d]+s.hard[d];return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6 border border-indigo-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-indigo-600",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a6.759 6.759 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),"測驗題數統一設定"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["一次設定所有難度的題目數量 • 總計: ",e.jsx("span",{className:"font-semibold text-indigo-600",children:m()})," 題"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:t,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:"重設預設"}),e.jsx("button",{onClick:r,disabled:u,className:"px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-105 shadow-md flex items-center gap-2 font-medium",children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⏳"}),"重新生成中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),"更新設定並重新出題"]})})]})]}),e.jsx("div",{className:"space-y-6",children:Object.keys(n).map(d=>{const b=Ze[d],v=s.easy[d],y=h(d);return e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-50 rounded-lg p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-indigo-500 rounded-full"}),e.jsx("h4",{className:"font-semibold text-lg text-gray-800",children:n[d]}),e.jsxs("span",{className:"text-sm text-gray-500 bg-white px-2 py-1 rounded-full border",children:["限制: 0-",b," 題"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["各難度: ",e.jsx("span",{className:"font-mono font-medium",children:v})," 題"]}),e.jsxs("div",{className:"text-xs text-indigo-600",children:["總計: ",e.jsx("span",{className:"font-semibold",children:y})," 題"]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>o(d,v-1),className:"w-10 h-10 rounded-full bg-red-100 hover:bg-red-200 flex items-center justify-center text-red-600 font-bold text-lg transition-colors shadow-sm",disabled:v<=0,children:"-"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-800 mb-1",children:v}),e.jsx("div",{className:"text-xs text-gray-500",children:"每個難度"})]}),e.jsx("button",{onClick:()=>o(d,v+1),className:"w-10 h-10 rounded-full bg-green-100 hover:bg-green-200 flex items-center justify-center text-green-600 font-bold text-lg transition-colors shadow-sm",disabled:v>=b,children:"+"})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-700 text-sm font-semibold mb-1",children:s.easy[d]}),e.jsx("div",{className:"text-xs text-green-700",children:"簡單"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-700 text-sm font-semibold mb-1",children:s.normal[d]}),e.jsx("div",{className:"text-xs text-yellow-700",children:"普通"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center text-red-700 text-sm font-semibold mb-1",children:s.hard[d]}),e.jsx("div",{className:"text-xs text-red-700",children:"困難"})]})]})]},d)})}),e.jsx("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-blue-600 mt-0.5 flex-shrink-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"📝 使用說明："}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"• 統一設定模式"}),e.jsx("p",{children:"調整題數會同時套用到簡單、普通、困難三種難度"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"• 題數限制"}),e.jsx("p",{children:"一般題型: 0-10題 | 翻卡記憶: 0-2題"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"• 跳過題型"}),e.jsx("p",{children:"設定為 0 題可完全跳過該種題型"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"• 記憶卡遊戲"}),e.jsx("p",{children:"每題包含多對卡片，建議 1-2 題即可"})]})]})]})]})})]})},ue=({url:s,title:c="QR Code",size:r=256,className:u="",showDownload:n=!0,onError:o})=>{const[t,m]=l.useState(""),[h,d]=l.useState(!0),[b,v]=l.useState(null),y=l.useRef(null);l.useEffect(()=>{s&&(async()=>{try{d(!0),v(null);const f={width:r,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M"},A=await Je.toDataURL(s,f);m(A),y.current&&await Je.toCanvas(y.current,s,f)}catch(f){const A=f instanceof Error?f.message:"QR Code 生成失敗";v(A),o?.(A)}finally{d(!1)}})()},[s,r,o]);const a=()=>{if(y.current)try{const i=document.createElement("a");i.download=`qrcode-${Date.now()}.png`,i.href=y.current.toDataURL(),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(i){console.error("下載 QR Code 失敗:",i)}},x=async()=>{if(y.current)try{y.current.toBlob(async i=>{if(i&&navigator.clipboard)try{await navigator.clipboard.write([new ClipboardItem({"image/png":i})]),alert("QR Code 已複製到剪貼簿！")}catch(f){console.error("複製圖片失敗:",f),alert("複製圖片失敗，請使用下載功能。")}})}catch(i){console.error("複製 QR Code 失敗:",i)}};return h?e.jsxs("div",{className:`flex flex-col items-center p-4 ${u}`,children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"生成 QR Code 中..."})]}):b?e.jsxs("div",{className:`flex flex-col items-center p-4 text-red-600 ${u}`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 mb-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),e.jsx("p",{className:"text-sm text-center",children:b})]}):e.jsxs("div",{className:`flex flex-col items-center ${u}`,children:[c&&e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3 text-center",children:c}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-md border",children:e.jsx("img",{src:t,alt:`QR Code for ${c}`,className:"block",style:{width:r,height:r}})}),e.jsx("canvas",{ref:y,style:{display:"none"},width:r,height:r}),e.jsx("div",{className:"mt-3 max-w-xs w-full",children:e.jsx("p",{className:"text-xs text-gray-500 text-center break-all",children:s})}),n&&e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"下載"]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"})}),"複製"]})]})]})},Xe=[{key:"objectives",label:"教學目標"},{key:"breakdown",label:"分解內容"},{key:"confusing",label:"易混淆點"},{key:"activities",label:"課堂活動"},{key:"conversation",label:"對話練習"},{key:"writing",label:"寫作練習"},{key:"quiz",label:"互動測驗"}],Ve=({content:s,topic:c,selectedLevel:r,selectedVocabularyLevel:u,apiKey:n,onContentUpdate:o})=>{const[t,m]=V.useState(""),[h,d]=V.useState(""),[b,v]=V.useState(Xe[0].key),[y,a]=V.useState(!1),[x,i]=V.useState(""),[f,A]=V.useState(""),[L,P]=V.useState(!1),[$,w]=V.useState(""),[p,j]=V.useState(""),[S,z]=V.useState(!1),[R,W]=V.useState(!1),[C,g]=V.useState(""),[T,O]=V.useState(""),[N,M]=V.useState(!1),[I,E]=V.useState(!1),[q,J]=V.useState(""),[F,U]=V.useState(""),[Z,k]=V.useState(!1),[D,H]=V.useState(!1),[Q,Y]=V.useState(""),[X,xe]=V.useState(""),[ce,Ie]=V.useState(!1),[me,fe]=V.useState(ns),[bs,Qe]=V.useState(!1),[Fe,Ke]=V.useState(!1),fs=()=>{navigator.clipboard.writeText(JSON.stringify(s,null,2)).then(()=>{m("JSON 已複製到剪貼簿！"),setTimeout(()=>m(""),2e3)}).catch(B=>{m("複製失敗。"),console.error("Failed to copy: ",B),setTimeout(()=>m(""),2e3)})},js=()=>{try{ut(s,c),d("HTML 檔案已開始下載！"),setTimeout(()=>d(""),3e3)}catch(B){console.error("Failed to export HTML:",B),d("匯出 HTML 失敗。"),setTimeout(()=>d(""),3e3)}},vs=async()=>{a(!0),i(""),A("");try{const B={...s,topic:c,selectedLevel:r,selectedVocabularyLevel:u,sharedAt:new Date().toISOString()},_=await Me(B),G=`${window.location.origin}/ai-page-gen/share?binId=${_}`;A(G)}catch(B){i(B.message||"分享失敗")}finally{a(!1)}},ys=async()=>{if(P(!0),w(""),j(""),!s.onlineInteractiveQuiz){w("沒有可分享的測驗內容"),P(!1);return}try{const B=await qs({quiz:s.onlineInteractiveQuiz,topic:c,apiKey:n,metadata:{selectedLevel:r?.name,selectedVocabularyLevel:u?.name,createdAt:new Date().toISOString(),supportsDiagnostic:!!n}});let _=`${window.location.origin}/ai-page-gen/quiz?binId=${B}`;if(n)try{const G=await Ye(n);_+=`&${G}`}catch(G){console.warn("加密 API Key 失敗，將不包含 API Key:",G)}j(_)}catch(B){w(B.message||"分享測驗失敗")}finally{P(!1)}},Ns=async()=>{if(W(!0),g(""),O(""),!s.writingPractice){g("沒有可分享的寫作練習內容"),W(!1);return}try{const B=await Hs({writingPractice:s.writingPractice,topic:c,metadata:{selectedLevel:r?.name,selectedVocabularyLevel:u?.name,createdAt:new Date().toISOString()}});let _=`${window.location.origin}/ai-page-gen/writing?binId=${B}`;if(n)try{const G=await Ye(n);_+=`&${G}`}catch(G){console.warn("加密 API Key 失敗，將不包含 API Key:",G)}O(_)}catch(B){g(B.message||"分享寫作練習失敗")}finally{W(!1)}},ws=async()=>{E(!0),J(""),U("");try{const B={...s,topic:c,selectedLevel:r,selectedVocabularyLevel:u,sharedAt:new Date().toISOString()},_=await Me(B),G=`${window.location.origin}/ai-page-gen/teacher-interactive-prep?binId=${_}`;U(G)}catch(B){J(B.message||"分享教材準備失敗")}finally{E(!1)}},ks=async()=>{if(!s.learningObjectives){alert("無法重新生成測驗：缺少學習目標");return}if(!(localStorage.getItem("gemini_api_key")||n)){alert("請先設定 Gemini API 金鑰");return}Qe(!0);try{const _=await Vs(c,s.learningObjectives,me,r,u),G={...s,onlineInteractiveQuiz:_};o&&o(G),Ke(!1),alert("測驗已成功重新生成！")}catch(_){console.error("重新生成測驗時發生錯誤:",_),alert("重新生成測驗失敗: "+(_.message||"未知錯誤"))}finally{Qe(!1)}},Ge=async()=>{if(!n){Y("請先設定 Gemini API 金鑰");return}if(!s.learningObjectives||s.learningObjectives.length===0){Y("無法生成對話練習：缺少學習目標");return}H(!0),Y(""),xe("");try{const B={topic:c,scenario:`Practice conversation based on learning objectives: ${s.learningObjectives.map(je=>je.objective).join(", ")}`,difficulty:r?.name==="入門"?"easy":r?.name==="進階"?"hard":"normal",participantCount:2,duration:10,focusAreas:s.learningObjectives.map(je=>je.objective),culturalContext:s.contentBreakdown?.map(je=>je.details).join("; ")},G={practice:await Se.generateConversationPractice(B),metadata:{basedOnTopic:c,createdFrom:"lesson-plan",selectedLevel:r?.name,selectedVocabularyLevel:u?.name,createdAt:new Date().toISOString()}},se=await as(G),Ss=`${window.location.origin}/ai-page-gen/conversation-practice/${se}`;xe(Ss)}catch(B){console.error("Failed to generate advanced conversation practice:",B),Y(B.message||"生成進階對話練習失敗")}finally{H(!1)}};return e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex flex-wrap justify-end items-center gap-2 mb-4",children:[e.jsxs("button",{onClick:fs,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors flex items-center text-sm","aria-label":"複製產生的 JSON 內容",children:[e.jsx(rt,{className:"w-4 h-4 mr-2"})," 複製產生的 JSON"]}),e.jsxs("button",{onClick:js,className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors flex items-center text-sm","aria-label":"將學習內容匯出為 HTML 檔案",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"匯出為 HTML"]}),e.jsx("button",{onClick:vs,className:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition-colors flex items-center text-sm disabled:opacity-60","aria-label":"分享教學方案",disabled:y,children:y?e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"animate-spin mr-2",children:"⏳"})," 分享中..."]}):e.jsx("span",{children:"分享方案"})}),e.jsx("button",{onClick:ws,className:"px-4 py-2 bg-emerald-500 text-white rounded-md hover:bg-emerald-600 transition-colors flex items-center text-sm disabled:opacity-60","aria-label":"分享教材準備",disabled:I,children:I?e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"animate-spin mr-2",children:"⏳"})," 分享中..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})}),"教材準備"]})}),t&&e.jsx("span",{className:"text-sm text-green-600",children:t}),h&&e.jsx("span",{className:"text-sm text-blue-600",children:h}),x&&e.jsx("span",{className:"text-sm text-red-600",children:x}),q&&e.jsx("span",{className:"text-sm text-red-600",children:q})]}),f&&e.jsxs("div",{className:"mb-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-2",children:"方案分享連結已生成："}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:f,readOnly:!0,className:"flex-1 px-3 py-2 bg-white border border-purple-300 rounded text-sm",onClick:()=>navigator.clipboard.writeText(f)}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(f),className:"px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm",children:"複製"})]})]}),F&&e.jsxs("div",{className:"mb-4 p-4 bg-emerald-50 border border-emerald-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-emerald-700 mb-2",children:"教材準備連結已生成："}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{type:"text",value:F,readOnly:!0,className:"flex-1 px-3 py-2 bg-white border border-emerald-300 rounded text-sm",onClick:()=>navigator.clipboard.writeText(F)}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(F),className:"px-3 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 text-sm",children:"複製"}),e.jsxs("button",{onClick:()=>k(!Z),className:"px-3 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 text-sm flex items-center gap-1",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h.75v.75h-.75v-.75ZM13.5 19.5h.75v.75h-.75v-.75ZM19.5 13.5h.75v.75h-.75v-.75ZM19.5 19.5h.75v.75h-.75v-.75ZM16.5 16.5h.75v.75h-.75v-.75Z"})]}),"QR"]})]}),Z&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(ue,{url:F,title:"教材準備分享 QR Code",size:200,className:"bg-white p-4 rounded-lg shadow-sm"})}),e.jsx("div",{className:"text-xs text-emerald-600 bg-emerald-100 px-3 py-2 rounded-lg",children:"💡 教師可以通過此連結準備互動教材，包含內容轉換、檢查和發布功能"})]}),e.jsx("div",{className:"mb-8 p-6 bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ee,{className:"w-5 h-5 text-indigo-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-indigo-600",children:"學習主題"})]}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-0 truncate",children:c})]}),(r||u)&&e.jsxs("div",{className:"flex gap-3 ml-6 flex-shrink-0",children:[r&&e.jsxs("div",{className:"bg-white px-3 py-2 rounded-lg shadow-sm border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(oe,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"text-xs font-medium text-indigo-600",children:"學習程度"})]}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:r.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-32",title:r.description,children:r.description.length>20?r.description.substring(0,20)+"...":r.description})]}),u&&e.jsxs("div",{className:"bg-white px-3 py-2 rounded-lg shadow-sm border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Le,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:"詞彙程度"})]}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:u.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[u.wordCount," 詞彙"]})]})]})]})}),e.jsxs(yt,{tabs:Xe,current:b,onChange:v,children:[e.jsx(ie,{title:"教學目標設定",icon:e.jsx(oe,{className:"w-7 h-7"}),children:s.learningObjectives&&s.learningObjectives.length>0?s.learningObjectives.map((B,_)=>e.jsxs("div",{className:"mb-4 pb-4 border-b border-slate-200 last:border-b-0 last:pb-0",children:[e.jsx("h4",{className:"font-semibold text-lg text-green-800 mb-1",children:B.objective}),e.jsx("p",{className:"text-slate-700 mb-2",children:B.description}),B.teachingExample&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-400 p-3 rounded-md mt-2",children:[e.jsx("span",{className:"block text-xs font-semibold text-green-700 mb-1",children:"教學示例"}),e.jsx("span",{className:"text-green-900 text-sm",children:B.teachingExample})]})]},_)):e.jsx("p",{children:"沒有提供教學目標。"})}),e.jsx(ie,{title:"分解學習內容",icon:e.jsx(Le,{className:"w-7 h-7"}),children:s.contentBreakdown&&s.contentBreakdown.length>0?s.contentBreakdown.map((B,_)=>e.jsxs("div",{className:"mb-6 pb-6 border-b border-slate-200 last:border-b-0 last:pb-0",children:[e.jsx("h4",{className:"font-semibold text-lg text-sky-800 mb-1",children:B.topic}),e.jsx("p",{className:"text-slate-700 mb-3",children:B.details}),B.coreConcept&&e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-blue-700 mb-1",children:"核心概念"}),e.jsx("span",{className:"text-blue-900 text-sm",children:B.coreConcept})]}),B.teachingSentences&&B.teachingSentences.length>0&&e.jsxs("div",{className:"bg-indigo-50 border-l-4 border-indigo-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-indigo-700 mb-2",children:"教學例句"}),e.jsx("div",{className:"space-y-1",children:B.teachingSentences.map((G,se)=>e.jsxs("div",{className:"text-indigo-900 text-sm",children:[e.jsxs("span",{className:"font-mono text-indigo-600",children:[se+1,"."]})," ",G]},se))})]}),B.teachingTips&&e.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-purple-700 mb-1",children:"教學要點提示"}),e.jsx("span",{className:"text-purple-900 text-sm",children:B.teachingTips})]}),B.teachingExample&&e.jsxs("div",{className:"bg-sky-50 border-l-4 border-sky-400 p-3 rounded-md",children:[e.jsx("span",{className:"block text-xs font-semibold text-sky-700 mb-1",children:"教學示例"}),e.jsx("span",{className:"text-sky-900 text-sm",children:B.teachingExample})]})]},_)):e.jsx("p",{children:"沒有提供內容分解。"})}),e.jsx(ie,{title:"易混淆點識別",icon:e.jsx(Ee,{className:"w-7 h-7"}),children:s.confusingPoints&&s.confusingPoints.length>0?s.confusingPoints.map((B,_)=>e.jsxs("div",{className:"mb-6 pb-6 border-b border-slate-200 last:border-b-0 last:pb-0",children:[e.jsx("h4",{className:"font-semibold text-lg text-red-700 mb-2",children:B.point}),e.jsx("p",{className:"text-slate-700 mb-3",children:B.clarification}),B.errorType&&e.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-orange-700 mb-1",children:"誤區類型"}),e.jsx("span",{className:"text-orange-900 text-sm",children:B.errorType})]}),B.commonErrors&&B.commonErrors.length>0&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-red-700 mb-2",children:"常見錯誤示例"}),e.jsx("div",{className:"space-y-1",children:B.commonErrors.map((G,se)=>e.jsxs("div",{className:"text-red-900 text-sm",children:[e.jsxs("span",{className:"font-mono text-red-600",children:[se+1,"."]})," ",G]},se))})]}),B.correctVsWrong&&B.correctVsWrong.length>0&&e.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-yellow-700 mb-2",children:"正確與錯誤對比"}),e.jsx("div",{className:"space-y-3",children:B.correctVsWrong.map((G,se)=>e.jsxs("div",{className:"border border-yellow-200 rounded-md p-2 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-2",children:[e.jsxs("div",{className:"bg-green-50 p-2 rounded border border-green-200",children:[e.jsx("span",{className:"block text-xs font-semibold text-green-700 mb-1",children:"✓ 正確"}),e.jsx("span",{className:"text-green-900 text-sm",children:G.correct})]}),e.jsxs("div",{className:"bg-red-50 p-2 rounded border border-red-200",children:[e.jsx("span",{className:"block text-xs font-semibold text-red-700 mb-1",children:"✗ 錯誤"}),e.jsx("span",{className:"text-red-900 text-sm",children:G.wrong})]})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded border border-blue-200",children:[e.jsx("span",{className:"block text-xs font-semibold text-blue-700 mb-1",children:"說明"}),e.jsx("span",{className:"text-blue-900 text-sm",children:G.explanation})]})]},se))})]}),B.preventionStrategy&&e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-blue-700 mb-1",children:"預防策略"}),e.jsx("span",{className:"text-blue-900 text-sm",children:B.preventionStrategy})]}),B.correctionMethod&&e.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-purple-700 mb-1",children:"糾正方法"}),e.jsx("span",{className:"text-purple-900 text-sm",children:B.correctionMethod})]}),B.practiceActivities&&B.practiceActivities.length>0&&e.jsxs("div",{className:"bg-indigo-50 border-l-4 border-indigo-400 p-3 rounded-md mb-3",children:[e.jsx("span",{className:"block text-xs font-semibold text-indigo-700 mb-2",children:"練習建議"}),e.jsx("div",{className:"space-y-1",children:B.practiceActivities.map((G,se)=>e.jsxs("div",{className:"text-indigo-900 text-sm",children:[e.jsxs("span",{className:"font-mono text-indigo-600",children:[se+1,"."]})," ",G]},se))})]}),B.teachingExample&&e.jsxs("div",{className:"bg-gray-50 border-l-4 border-gray-400 p-3 rounded-md",children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"教學示例"}),e.jsx("span",{className:"text-gray-900 text-sm",children:B.teachingExample})]})]},_)):e.jsx("p",{children:"沒有提供易混淆點。"})}),e.jsx(ie,{title:"課堂活動與遊戲設計",icon:e.jsx(nt,{className:"w-7 h-7"}),children:s.classroomActivities&&s.classroomActivities.length>0?e.jsx("div",{className:"space-y-6",children:s.classroomActivities.map((B,_)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("div",{className:"bg-gradient-to-r from-sky-50 to-blue-50 px-6 py-4 border-b border-slate-200 rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-sky-500 text-white rounded-full font-bold text-sm",children:_+1}),e.jsx("h4",{className:"font-bold text-xl text-sky-800",children:B.title})]}),e.jsx("p",{className:"mt-3 text-slate-700 leading-relaxed",children:B.description})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[B.objective&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"font-semibold text-green-800 text-sm",children:"學習目標"})]}),e.jsx("p",{className:"text-green-900 text-sm leading-relaxed",children:B.objective})]}),B.timing&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"font-semibold text-purple-800 text-sm",children:"使用時機"})]}),e.jsx("p",{className:"text-purple-900 text-sm leading-relaxed",children:B.timing})]}),B.materials&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),e.jsx("span",{className:"font-semibold text-orange-800 text-sm",children:"所需教具"})]}),e.jsx("p",{className:"text-orange-900 text-sm leading-relaxed",children:B.materials})]}),B.environment&&e.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-teal-500 rounded-full"}),e.jsx("span",{className:"font-semibold text-teal-800 text-sm",children:"環境要求"})]}),e.jsx("p",{className:"text-teal-900 text-sm leading-relaxed",children:B.environment})]})]}),B.steps&&B.steps.length>0&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-blue-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}),e.jsx("span",{className:"font-semibold text-blue-800",children:"活動步驟"})]}),e.jsx("div",{className:"space-y-3",children:B.steps.map((G,se)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 bg-blue-500 text-white rounded-full font-semibold text-xs flex-shrink-0 mt-0.5",children:se+1}),e.jsx("p",{className:"text-blue-900 text-sm leading-relaxed flex-1",children:G})]},se))})]})}),B.assessmentPoints&&B.assessmentPoints.length>0&&e.jsx("div",{children:e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-indigo-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})}),e.jsx("span",{className:"font-semibold text-indigo-800",children:"評估重點"})]}),e.jsx("div",{className:"space-y-2",children:B.assessmentPoints.map((G,se)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{className:"text-indigo-900 text-sm leading-relaxed",children:G})]},se))})]})})]})]},_))}):e.jsx("p",{children:"沒有提供課堂活動。"})}),e.jsx(ie,{title:"對話練習",icon:e.jsx($e,{className:"w-7 h-7"}),children:s.englishConversation&&s.englishConversation.length>0?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"基礎對話練習"}),e.jsx(ht,{dialogue:s.englishConversation})]}),n&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"進階互動對話練習"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"基於教案內容生成豐富的對話練習，包含語音識別和AI評估"})]}),e.jsx("button",{onClick:Ge,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2 text-sm",disabled:D||!n,children:D?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"生成中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})}),"生成進階對話練習"]})})]}),Q&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:Q}),X&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-green-800 mb-1",children:"進階對話練習已生成！"}),e.jsx("div",{className:"text-xs text-green-600",children:"學生可使用此連結進行互動對話練習"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>navigator.clipboard.writeText(X),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"複製連結"}),e.jsx("button",{onClick:()=>Ie(!ce),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"QR Code"})]})]}),ce&&e.jsx("div",{className:"mt-4 pt-4 border-t border-green-200",children:e.jsx(ue,{url:X,title:`${c} - 進階對話練習`})})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"沒有提供基礎對話練習。"}),n&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"您可以基於教案內容生成進階對話練習"}),e.jsx("button",{onClick:Ge,className:"px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2 mx-auto",disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"生成中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})}),"生成進階對話練習"]})}),Q&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm max-w-md mx-auto",children:Q}),X&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg max-w-md mx-auto",children:[e.jsx("div",{className:"text-sm font-medium text-green-800 mb-2",children:"進階對話練習已生成！"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>navigator.clipboard.writeText(X),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"複製連結"}),e.jsx("button",{onClick:()=>Ie(!ce),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"QR Code"})]}),ce&&e.jsx("div",{className:"mt-4 pt-4 border-t border-green-200",children:e.jsx(ue,{url:X,title:`${c} - 進階對話練習`})})]})]})]})}),s.writingPractice?e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:Ns,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 text-sm",disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⏳"}),"分享中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.935-2.186 2.25 2.25 0 0 0-3.935 2.186Z"})}),"分享寫作練習"]})})}),C&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg",children:C}),T&&e.jsxs("div",{className:"mb-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("p",{className:"text-sm text-purple-700",children:"寫作練習分享連結已生成："}),n&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"含 AI 批改"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:T,readOnly:!0,className:"w-full px-3 py-2 bg-white border border-purple-300 rounded text-sm",onClick:()=>navigator.clipboard.writeText(T)}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>navigator.clipboard.writeText(T),className:"flex-1 px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm transition-colors",children:"複製連結"}),e.jsxs("button",{onClick:()=>M(!N),className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm flex items-center justify-center gap-1 transition-colors",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5H8.25v1.5H13.5V13.5ZM13.5 16.5H8.25V18H13.5v-1.5ZM16.5 16.5h1.5V18h-1.5v-1.5ZM16.5 13.5h1.5v1.5h-1.5v-1.5Z"})]}),"顯示 QR Code"]})]})]}),N&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(ue,{url:T,title:"寫作練習分享 QR Code",size:200,className:"bg-white p-4 rounded-lg shadow-sm"})}),n&&e.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"💡 此連結包含您的 API Key，學生可直接使用 AI 批改功能"})]}),e.jsx(cs,{content:s.writingPractice,apiKey:n,vocabularyLevel:u||void 0})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center border border-gray-200",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16 text-gray-400 mx-auto mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-700 mb-2",children:"沒有提供寫作練習"}),e.jsx("p",{className:"text-gray-500",children:"此主題沒有生成寫作練習內容"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap justify-end items-center gap-2 mb-4",children:[e.jsx("button",{onClick:ys,className:"px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition-colors flex items-center text-sm disabled:opacity-60","aria-label":"分享測驗給學生",disabled:L,children:L?e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"animate-spin mr-2",children:"⏳"})," 分享中..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}),"分享測驗"]})}),e.jsxs("button",{onClick:()=>Ke(!Fe),className:"px-4 py-2 bg-teal-500 text-white rounded-md hover:bg-teal-600 transition-colors flex items-center text-sm","aria-label":"測驗設定",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 mr-2",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a6.759 6.759 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),"測驗設定"]})]}),$&&e.jsx("span",{className:"text-sm text-red-600",children:$}),p&&e.jsxs("div",{className:"mb-4 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("p",{className:"text-sm text-orange-700",children:"測驗分享連結已生成："}),n&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"含 AI 診斷"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:p,readOnly:!0,className:"w-full px-3 py-2 bg-white border border-orange-300 rounded text-sm",onClick:()=>navigator.clipboard.writeText(p)}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>navigator.clipboard.writeText(p),className:"flex-1 px-3 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 text-sm flex items-center justify-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"})}),"複製連結"]}),e.jsxs("button",{onClick:()=>z(!S),className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm flex items-center justify-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5H8.25v1.5H13.5V13.5ZM13.5 16.5H8.25V18H13.5v-1.5ZM16.5 16.5h1.5V18h-1.5v-1.5ZM16.5 13.5h1.5v1.5h-1.5v-1.5Z"})]}),"顯示 QR Code"]})]})]}),S&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(ue,{url:p,title:"測驗分享 QR Code",size:200,className:"bg-white p-4 rounded-lg shadow-sm"})}),n&&e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:"💡 此連結包含您的 API Key，學生可直接使用 AI 學習診斷功能"})]}),Fe&&e.jsx(Nt,{config:me,onConfigChange:fe,onRegenerate:ks,isGenerating:bs}),e.jsx(mt,{quizzes:s.onlineInteractiveQuiz,topic:c,apiKey:n,enableDiagnostic:!!n})]})]})]})},wt=({learningLevels:s,onLevelSelect:c,onGenerateWithLevel:r,selectedLevelId:u,isLoading:n=!1})=>{const[o,t]=l.useState(u||s.defaultLevelId),m=d=>{t(d.id),c?.(d)},h=[...s.suggestedLevels].sort((d,b)=>d.order-b.order);return e.jsx(ie,{title:"學習程度建議",icon:e.jsx(oe,{className:"w-7 h-7"}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"根據學習主題自動生成的程度建議，選擇最適合的學習等級："}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:h.map(d=>e.jsxs("div",{className:`
                relative p-4 rounded-lg border-2 cursor-pointer transition-all duration-200
                ${o===d.id?"border-sky-500 bg-sky-50 shadow-md":"border-slate-300 bg-white hover:border-sky-300 hover:shadow-sm"}
              `,onClick:()=>m(d),children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`
                  flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold
                  ${o===d.id?"bg-sky-500 text-white":"bg-slate-200 text-slate-700"}
                `,children:d.order}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`
                    text-lg font-semibold mb-2
                    ${o===d.id?"text-sky-700":"text-slate-700"}
                  `,children:d.name}),e.jsx("p",{className:`
                    text-sm leading-relaxed
                    ${o===d.id?"text-sky-600":"text-slate-600"}
                  `,children:d.description})]})]}),o===d.id&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-3 h-3 bg-sky-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})})})]},d.id))}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{children:["已選擇：",e.jsx("strong",{children:h.find(d=>d.id===o)?.name})]})]})}),r&&e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:()=>{const d=h.find(b=>b.id===o);d&&r(d)},disabled:n,className:"px-8 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"產生內容中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"開始產生學習內容"]})})})]})]})})},Ne=[{id:"beginner",name:"初級 (100-500詞)",wordCount:500,description:"適合英語初學者，使用最基本的日常詞彙"},{id:"elementary",name:"基礎 (500-1000詞)",wordCount:1e3,description:"掌握基本會話詞彙，能進行簡單交流"},{id:"pre-intermediate",name:"初中級 (1000-2000詞)",wordCount:2e3,description:"能理解日常生活和工作中的常見詞彙"},{id:"intermediate",name:"中級 (2000-3500詞)",wordCount:3500,description:"能處理較複雜的文本和學術內容"},{id:"upper-intermediate",name:"中高級 (3500-5000詞)",wordCount:5e3,description:"能理解專業文章和較複雜的語言結構"},{id:"advanced",name:"高級 (5000-7000詞)",wordCount:7e3,description:"具備高水平的英語理解和表達能力"}],kt=({onVocabularyLevelSelect:s,selectedLevel:c,isVisible:r=!0})=>{const[u,n]=l.useState(c?.id||"intermediate"),o=t=>{n(t.id),s(t)};return r?e.jsx(ie,{title:"選擇英語單字程度",icon:e.jsx(Le,{className:"w-7 h-7"}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"請選擇您的英語單字量範圍，系統會根據此程度調整教學內容的複雜度："}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:Ne.map(t=>e.jsxs("div",{className:`
                relative p-4 rounded-lg border-2 cursor-pointer transition-all duration-200
                ${u===t.id?"border-green-500 bg-green-50 shadow-md":"border-slate-300 bg-white hover:border-green-300 hover:shadow-sm"}
              `,onClick:()=>o(t),children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`
                    flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                    ${u===t.id?"bg-green-500 text-white":"bg-slate-200 text-slate-700"}
                  `,children:t.wordCount>=1e3?`${t.wordCount/1e3}k`:t.wordCount}),e.jsx("h4",{className:`
                    text-sm font-semibold
                    ${u===t.id?"text-green-700":"text-slate-700"}
                  `,children:t.name})]}),e.jsx("p",{className:`
                  text-xs leading-relaxed
                  ${u===t.id?"text-green-600":"text-slate-600"}
                `,children:t.description})]}),u===t.id&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})})})]},t.id))}),e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-600",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsxs("span",{children:["已選擇：",e.jsx("strong",{children:Ne.find(t=>t.id===u)?.name}),"（",Ne.find(t=>t.id===u)?.wordCount," 詞彙）"]})]})})]})}):null},hs=({isOpen:s,onSave:c,title:r="設定 AI Provider",message:u="請選擇並設定您的 AI Provider 以開始使用"})=>{const[n,o]=l.useState(K.GEMINI),[t,m]=l.useState(""),[h,d]=l.useState(!1),[b,v]=l.useState(""),[y,a]=l.useState(!1),[x,i]=l.useState(""),[f,A]=l.useState("gemini-2.5-flash"),[L,P]=l.useState("openai/gpt-4o"),[$,w]=l.useState(.7),p=()=>{m(""),v(""),i(""),w(.7),A("gemini-2.5-flash"),P("openai/gpt-4o"),a(!1)};l.useEffect(()=>{s&&p()},[s]),l.useEffect(()=>{y||i(n===K.GEMINI?"Gemini Provider":"OpenRouter Provider")},[n,y]);const j=async()=>{if(!t.trim()){v("請輸入 API Key");return}d(!0),v("");try{const z={id:`${n}_${Date.now()}`,name:x||(n===K.GEMINI?"Gemini Provider":"OpenRouter Provider"),type:n,enabled:!0,apiKey:t.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};let R;n===K.GEMINI?R={...z,type:K.GEMINI,model:f,settings:{responseMimeType:"application/json",temperature:$,maxOutputTokens:8192}}:R={...z,type:K.OPENROUTER,model:L,settings:{temperature:$,max_tokens:4096,stream:!1}},await Ms(R),n===K.GEMINI&&localStorage.setItem("gemini_api_key",t.trim()),c(t.trim()),p()}catch(z){console.error("設定 Provider 失敗:",z),v(z instanceof Error?z.message:"設定失敗，請檢查 API Key 是否正確")}finally{d(!1)}},S=async()=>{a(!1),await j()};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-lg w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:r}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:u})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"選擇 AI Provider"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>o(K.GEMINI),className:`p-4 border-2 rounded-lg text-left transition-colors ${n===K.GEMINI?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"G"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Gemini"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Google AI"})]})]})}),e.jsx("button",{onClick:()=>o(K.OPENROUTER),className:`p-4 border-2 rounded-lg text-left transition-colors ${n===K.OPENROUTER?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"O"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"OpenRouter"}),e.jsx("div",{className:"text-xs text-gray-500",children:"統一 API"})]})]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n===K.GEMINI?"Gemini API Key":"OpenRouter API Key"}),e.jsx("input",{type:"password",value:t,onChange:z=>m(z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:n===K.GEMINI?"輸入您的 Gemini API Key":"輸入您的 OpenRouter API Key"}),e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:n===K.GEMINI?e.jsxs(e.Fragment,{children:["在 ",e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google AI Studio"})," 獲取 API Key"]}):e.jsxs(e.Fragment,{children:["在 ",e.jsx("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"OpenRouter"})," 獲取 API Key"]})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>a(!y),className:"flex items-center gap-2 text-sm text-indigo-600 hover:text-indigo-700",children:[e.jsx("svg",{className:`w-4 h-4 transition-transform ${y?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"進階設定"]})}),y&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provider 名稱"}),e.jsx("input",{type:"text",value:x,onChange:z=>i(z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"自訂 Provider 名稱"})]}),n===K.GEMINI&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"模型"}),e.jsxs("select",{value:f,onChange:z=>A(z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"gemini-2.5-flash",children:"Gemini 2.5 Flash (推薦)"}),e.jsx("option",{value:"gemini-pro",children:"Gemini Pro"}),e.jsx("option",{value:"gemini-pro-vision",children:"Gemini Pro Vision"})]})]}),n===K.OPENROUTER&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"模型"}),e.jsxs("select",{value:L,onChange:z=>P(z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"openai/gpt-4o",children:"GPT-4o (推薦)"}),e.jsx("option",{value:"anthropic/claude-3.5-sonnet",children:"Claude 3.5 Sonnet"}),e.jsx("option",{value:"google/gemini-2.5-pro",children:"Gemini 2.5 Pro"}),e.jsx("option",{value:"mistralai/mistral-large-2411",children:"Mistral Large"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["溫度 (Temperature): ",$]}),e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:$,onChange:z=>w(parseFloat(z.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"保守 (0)"}),e.jsx("span",{children:"平衡 (1)"}),e.jsx("span",{children:"創意 (2)"})]})]})]}),b&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:b})})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:y?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded hover:bg-gray-50",disabled:h,children:"簡化設定"}),e.jsx("button",{onClick:j,disabled:!t.trim()||h,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"設定中...":"完成設定"})]}):e.jsx("button",{onClick:S,disabled:!t.trim()||h,className:"px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"設定中...":"快速設定"})})]})}):null},es=({provider:s,selectedModel:c,onModelChange:r,disabled:u=!1})=>{const[n,o]=l.useState([]),[t,m]=l.useState(!1),[h,d]=l.useState(null),b=l.useCallback(async()=>{m(!0),d(null);try{let a;if(s.type===K.GEMINI)a=new Qs(s);else if(s.type===K.OPENROUTER)a=new Fs(s);else throw new Error("不支援的 Provider 類型");const i=(await a.getAvailableModels()).map(f=>({id:f.id,name:f.name||f.id,description:f.description,inputTokenLimit:f.inputTokenLimit||f.context_length,outputTokenLimit:f.outputTokenLimit||f.max_tokens}));o(i),i.length>0&&!i.some(f=>f.id===c)&&r(i[0].id)}catch(a){console.error("獲取模型列表失敗:",a),d(a instanceof Error?a.message:"獲取模型列表失敗"),o(v(s.type))}finally{m(!1)}},[s,c,r]);l.useEffect(()=>{s.apiKey&&s.apiKey.trim().length>10?b():(o([]),d(null))},[s.apiKey,s.type,b]);const v=a=>a===K.GEMINI?[{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash"},{id:"gemini-pro",name:"Gemini Pro"},{id:"gemini-pro-vision",name:"Gemini Pro Vision"}]:a===K.OPENROUTER?[{id:"openai/gpt-4o",name:"GPT-4o"},{id:"anthropic/claude-3.5-sonnet",name:"Claude 3.5 Sonnet"},{id:"google/gemini-2.5-pro",name:"Gemini 2.5 Pro"},{id:"mistralai/mistral-large-2411",name:"Mistral Large"}]:[],y=()=>{s.apiKey&&s.apiKey.trim().length>10&&b()};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"模型"}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("div",{className:"w-4 h-4 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),e.jsx("button",{type:"button",onClick:y,disabled:t||u||!s.apiKey,className:"text-xs text-indigo-600 hover:text-indigo-700 disabled:text-gray-400 disabled:cursor-not-allowed",title:"重新獲取模型列表",children:"↻ 重新獲取"})]})]}),e.jsx("select",{value:c,onChange:a=>r(a.target.value),disabled:u||t||n.length===0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed",children:n.length===0?e.jsx("option",{value:"",children:s.apiKey?"載入中...":"請先輸入 API Key"}):n.map(a=>e.jsxs("option",{value:a.id,children:[a.name,a.description&&` - ${a.description.substring(0,50)}...`]},a.id))}),h&&e.jsxs("p",{className:"mt-1 text-xs text-red-600",children:[h,e.jsx("button",{type:"button",onClick:y,className:"ml-2 text-indigo-600 hover:text-indigo-700 underline",children:"重試"})]}),n.length>0&&!t&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["找到 ",n.length," 個可用模型",c&&e.jsxs(e.Fragment,{children:[" • 已選擇: ",e.jsx("span",{className:"font-medium",children:n.find(a=>a.id===c)?.name||c})]})]})]})},ss=({isOpen:s,onClose:c,onSave:r,currentProviders:u})=>{const[n,o]=l.useState(u),[t,m]=l.useState(null),[h,d]=l.useState(!1),[b,v]=l.useState(new Map),[y,a]=l.useState(!1),[x,i]=l.useState(!1),[f,A]=l.useState(null),[L,P]=l.useState(void 0);l.useEffect(()=>{s&&(o([...u]),$())},[s,u]);const $=l.useCallback(async()=>{try{const M=(await re.getManager()).config;P(M?.defaultProviderId)}catch(N){console.error("載入預設 Provider ID 失敗:",N)}},[]),w=async()=>{try{const N=await re.getProviders();o(N),r(N),await $()}catch(N){console.error("載入 Provider 配置失敗:",N)}},p=async N=>{try{await re.setDefaultProvider(N),P(N)}catch(M){console.error("設置預設 Provider 失敗:",M),alert(`設置預設 Provider 失敗: ${M instanceof Error?M.message:"未知錯誤"}`)}},j=N=>{const M={id:`${N}_${Date.now()}`,name:`新 ${N===K.GEMINI?"Gemini":"OpenRouter"} Provider`,type:N,enabled:!0,apiKey:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return N===K.GEMINI?{...M,type:K.GEMINI,model:"gemini-2.5-flash",settings:{responseMimeType:"application/json",temperature:.7,maxOutputTokens:8192}}:{...M,type:K.OPENROUTER,model:"openai/gpt-4o",settings:{temperature:.7,max_tokens:4096,stream:!1}}},S=N=>{const M=j(N);m(M),d(!0)},z=N=>{m({...N}),d(!0)},R=async N=>{if(!(f||!confirm("確定要刪除這個 Provider 嗎？"))){A(N);try{await re.removeProvider(N),o(M=>M.filter(I=>I.id!==N)),v(M=>{const I=new Map(M);return I.delete(N),I}),await w()}catch(M){console.error("刪除 Provider 失敗:",M),alert(`刪除失敗: ${M instanceof Error?M.message:"未知錯誤"}`)}finally{A(null)}}},W=async()=>{if(!(!t||x)){i(!0);try{t.updatedAt=new Date().toISOString();const N=n.findIndex(M=>M.id===t.id);N>=0?(await re.updateProvider(t),o(M=>M.map((I,E)=>E===N?t:I))):(await re.addProvider(t),o(M=>[...M,t])),m(null),d(!1),await w()}catch(N){console.error("保存 Provider 失敗:",N),alert(`保存失敗: ${N instanceof Error?N.message:"未知錯誤"}`)}finally{i(!1)}}},C=async N=>{try{v(E=>new Map(E.set(N.id,{providerId:N.id,status:de.TESTING,testedAt:new Date().toISOString()})));const I=await Ks.getInstance({providers:[N],fallbackEnabled:!1,timeout:3e4,retryAttempts:1}).testProvider(N.id);v(E=>new Map(E.set(N.id,I)))}catch(M){v(I=>new Map(I.set(N.id,{providerId:N.id,status:de.ERROR,error:M instanceof Error?M.message:"測試失敗",testedAt:new Date().toISOString()})))}},g=async()=>{a(!0);for(const N of n)N.enabled&&N.apiKey&&await C(N);a(!1)},T=N=>{const M=b.get(N);if(!M)return null;const I={[de.TESTING]:"text-yellow-600 bg-yellow-50",[de.ACTIVE]:"text-green-600 bg-green-50",[de.ERROR]:"text-red-600 bg-red-50",[de.INACTIVE]:"text-gray-600 bg-gray-50"},E={[de.TESTING]:"測試中...",[de.ACTIVE]:`正常 (${M.responseTime}ms)`,[de.ERROR]:M.error||"錯誤",[de.INACTIVE]:"未啟用"};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${I[M.status]}`,children:E[M.status]})},O=()=>{r(n),c()};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"AI Provider 設定"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"管理您的 AI Provider 配置和 API 金鑰"})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex",children:[e.jsxs("div",{className:"w-1/2 border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Provider 清單"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S(K.GEMINI),disabled:x||f!==null,className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"+ Gemini"}),e.jsx("button",{onClick:()=>S(K.OPENROUTER),disabled:x||f!==null,className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"+ OpenRouter"})]})]}),e.jsx("button",{onClick:g,disabled:y,className:"mt-3 w-full px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 text-sm",children:y?"測試中...":"測試所有 Provider"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-4",children:[n.map(N=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${t?.id===N.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>z(N),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:N.name}),L===N.id&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"預設"})]}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:N.type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[T(N.id),e.jsx("button",{onClick:M=>{M.stopPropagation(),C(N)},className:"p-1 text-gray-400 hover:text-gray-600",title:"測試連接",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),N.enabled&&L!==N.id&&e.jsx("button",{onClick:M=>{M.stopPropagation(),p(N.id)},className:"p-1 text-blue-400 hover:text-blue-600",title:"設為預設",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),R(N.id)},disabled:f===N.id,className:"p-1 text-red-400 hover:text-red-600 disabled:opacity-50 disabled:cursor-not-allowed",title:f===N.id?"刪除中...":"刪除",children:f===N.id?e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),N.enabled?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"啟用"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"停用"})]},N.id)),n.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"尚未設定任何 Provider"}),e.jsx("p",{className:"text-sm mt-1",children:"點擊上方按鈕添加新的 Provider"})]})]})})]}),e.jsx("div",{className:"w-1/2 flex flex-col",children:h&&t?e.jsx(St,{provider:t,onChange:m,onSave:W,onCancel:()=>{m(null),d(!1)},isSaving:x}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("svg",{className:"w-16 h-16 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("p",{children:"選擇左側的 Provider 進行編輯"}),e.jsx("p",{className:"text-sm mt-1",children:"或點擊上方按鈕添加新的 Provider"})]})})})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:O,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"保存設定"})]})]})}):null},St=({provider:s,onChange:c,onSave:r,onCancel:u,isSaving:n=!1})=>{const o=m=>{c({...s,...m})},t=m=>{c({...s,settings:{...s.settings,...m}})};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[s.id.includes("_")&&s.id.split("_")[1]===Date.now().toString()?"新增":"編輯"," Provider"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"基本設定"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"名稱"}),e.jsx("input",{type:"text",value:s.name,onChange:m=>o({name:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"類型"}),e.jsxs("select",{value:s.type,onChange:m=>o({type:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:K.GEMINI,children:"Gemini"}),e.jsx("option",{value:K.OPENROUTER,children:"OpenRouter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),e.jsx("input",{type:"password",value:s.apiKey,onChange:m=>o({apiKey:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"請輸入 API Key"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"描述 (可選)"}),e.jsx("textarea",{value:s.description||"",onChange:m=>o({description:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",rows:3,placeholder:"描述這個 Provider 的用途..."})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:m=>o({enabled:m.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"啟用此 Provider"})]})]})]}),s.type===K.GEMINI&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Gemini 設定"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(es,{provider:s,selectedModel:s.model,onModelChange:m=>o({model:m}),disabled:n}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"溫度 (Temperature)"}),e.jsx("input",{type:"number",min:"0",max:"2",step:"0.1",value:s.settings.temperature||.7,onChange:m=>t({temperature:parseFloat(m.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"最大輸出 Tokens"}),e.jsx("input",{type:"number",min:"1",max:"32768",value:s.settings.maxOutputTokens||8192,onChange:m=>t({maxOutputTokens:parseInt(m.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]})]}),s.type===K.OPENROUTER&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"OpenRouter 設定"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(es,{provider:s,selectedModel:s.model,onModelChange:m=>o({model:m}),disabled:n}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"溫度 (Temperature)"}),e.jsx("input",{type:"number",min:"0",max:"2",step:"0.1",value:s.settings.temperature||.7,onChange:m=>t({temperature:parseFloat(m.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"最大 Tokens"}),e.jsx("input",{type:"number",min:"1",max:"200000",value:s.settings.max_tokens||4096,onChange:m=>t({max_tokens:parseInt(m.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.settings.stream||!1,onChange:m=>t({stream:m.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"啟用串流回應"})]})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:u,disabled:n,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"取消"}),e.jsxs("button",{onClick:r,disabled:n,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[n&&e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n?"保存中...":"保存"]})]})]})},Ct=({providers:s,selectedProviderId:c,onProviderSelect:r,onStrategyChange:u,usageStats:n=[],showStrategy:o=!1,className:t=""})=>{const[m,h]=l.useState(!1),[d,b]=l.useState(ve.DEFAULT),v=s.filter(A=>A.enabled),y=s.find(A=>A.id===c),a=A=>n.find(L=>L.providerId===A),x=A=>{b(A),u?.(A)},i=A=>{const L=a(A.id);if(!L)return e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full",title:"未測試"});const P=L.totalRequests>0?L.successfulRequests/L.totalRequests*100:0;return P>=90?e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full",title:`成功率: ${P.toFixed(1)}%`}):P>=70?e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full",title:`成功率: ${P.toFixed(1)}%`}):e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full",title:`成功率: ${P.toFixed(1)}%`})},f=A=>{const L="w-4 h-4";switch(A.type){case"gemini":return e.jsx("div",{className:`${L} bg-blue-500 rounded-full flex items-center justify-center`,children:e.jsx("span",{className:"text-white text-xs font-bold",children:"G"})});case"openrouter":return e.jsx("div",{className:`${L} bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center`,children:e.jsx("span",{className:"text-white text-xs font-bold",children:"O"})});default:return e.jsx("div",{className:`${L} bg-gray-500 rounded-full flex items-center justify-center`,children:e.jsx("span",{className:"text-white text-xs font-bold",children:"?"})})}};return v.length===0?e.jsx("div",{className:`p-3 bg-yellow-50 border border-yellow-200 rounded-lg ${t}`,children:e.jsx("p",{className:"text-sm text-yellow-800",children:"尚未設定可用的 Provider"})}):e.jsxs("div",{className:`relative ${t}`,children:[o&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"選擇策略"}),e.jsxs("select",{value:d,onChange:A=>x(A.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:ve.DEFAULT,children:"預設 Provider"}),e.jsx("option",{value:ve.FASTEST,children:"最快回應"}),e.jsx("option",{value:ve.FALLBACK,children:"依序嘗試"}),e.jsx("option",{value:ve.LOAD_BALANCE,children:"負載平衡"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>h(!m),className:"w-full px-4 py-3 text-left bg-white border border-gray-300 rounded-lg hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:y?e.jsxs(e.Fragment,{children:[f(y),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:y.name}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:y.type})]}),i(y)]}):e.jsx("span",{className:"text-gray-500",children:"選擇 Provider"})}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${m?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),m&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:[v.map(A=>{const L=a(A.id),P=A.id===c;return e.jsx("button",{onClick:()=>{r(A.id),h(!1)},className:`w-full px-4 py-3 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors ${P?"bg-indigo-50 border-r-2 border-indigo-500":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[f(A),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:A.name}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:A.type}),L&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["成功率: ",L.totalRequests>0?(L.successfulRequests/L.totalRequests*100).toFixed(1):0,"%",L.averageResponseTime>0&&e.jsxs("span",{className:"ml-2",children:["平均: ",Math.round(L.averageResponseTime),"ms"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[i(A),P&&e.jsx("svg",{className:"w-4 h-4 text-indigo-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]})]})},A.id)}),e.jsx("div",{className:"border-t border-gray-200",children:e.jsx("button",{onClick:()=>{h(!1),window.dispatchEvent(new CustomEvent("openProviderSettings"))},className:"w-full px-4 py-3 text-left text-indigo-600 hover:bg-indigo-50 focus:outline-none focus:bg-indigo-50 transition-colors",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"text-sm font-medium",children:"管理 Provider"})]})})})]})]}),y&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"當前選中:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.name})]}),y.description&&e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:y.description})]})]})},Lt=({onProviderChange:s,showSelector:c=!0,compact:r=!1,className:u=""})=>{const[n,o]=l.useState([]),[t,m]=l.useState(""),[h,d]=l.useState([]),[b,v]=l.useState(!1),[y,a]=l.useState(!0),[x,i]=l.useState(null),f=l.useCallback(async()=>{try{a(!0),i(null);const[P,$,w]=await Promise.all([re.getProviders(),re.getUsageStats(),re.getManager()]);o(P),d($);const j=w.config?.defaultProviderId;let S;j&&(S=P.find(z=>z.id===j&&z.enabled)),S||(S=P.find(z=>z.enabled)||P[0]),S&&!t&&(m(S.id),s?.(S))}catch(P){console.error("載入 Provider 數據失敗:",P),i(P instanceof Error?P.message:"載入失敗")}finally{a(!1)}},[t,s]);l.useEffect(()=>{f();const P=()=>{v(!0)};return window.addEventListener("openProviderSettings",P),()=>{window.removeEventListener("openProviderSettings",P)}},[f]);const A=P=>{m(P);const $=n.find(w=>w.id===P);s?.($||null)},L=async P=>{try{o(P);const $=P.find(p=>p.id===t);if(!$||!$.enabled){const p=P.find(j=>j.enabled);p?(m(p.id),s?.(p)):(m(""),s?.(null))}const w=await re.getUsageStats();d(w)}catch($){console.error("更新 Provider 設定失敗:",$),i($ instanceof Error?$.message:"更新失敗")}};if(r){const P=n.find($=>$.id===t);return e.jsxs("div",{className:`flex items-center gap-3 ${u}`,children:[y?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-indigo-500 rounded-full animate-spin"}),e.jsx("span",{children:"載入中..."})]}):x?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"載入失敗"})]}):n.length===0?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5l-6.928-12c-.77-.833-1.732-.833-2.502 0l-6.928 12c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{children:"尚未設定"})]}):e.jsx(e.Fragment,{children:P?e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:P.name})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),e.jsx("span",{children:"未選擇"})]})}),e.jsx("button",{onClick:()=>v(!0),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Provider 設定",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx(ss,{isOpen:b,onClose:()=>v(!1),onSave:L,currentProviders:n})]})}return e.jsxs("div",{className:`space-y-4 ${u}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Provider 設定"}),e.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"管理 Provider"})]}),y&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-500",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-indigo-500 rounded-full animate-spin"}),e.jsx("span",{children:"載入 Provider 設定中..."})]})}),x&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium",children:"載入失敗"})]}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x}),e.jsx("button",{onClick:f,className:"mt-3 px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700",children:"重試"})]}),!y&&!x&&n.length===0&&e.jsxs("div",{className:"p-6 bg-yellow-50 border border-yellow-200 rounded-lg text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-yellow-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5l-6.928-12c-.77-.833-1.732-.833-2.502 0l-6.928 12c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("h4",{className:"text-lg font-medium text-yellow-800 mb-2",children:"尚未設定 AI Provider"}),e.jsx("p",{className:"text-yellow-700 mb-4",children:"請點擊上方的「管理 Provider」按鈕來添加 Gemini 或 OpenRouter Provider"}),e.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700",children:"立即設定"})]}),!y&&!x&&n.length>0&&c&&e.jsx(Ct,{providers:n,selectedProviderId:t,onProviderSelect:A,usageStats:h,showStrategy:!0}),!y&&!x&&h.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"使用統計"}),e.jsx("div",{className:"space-y-2",children:h.slice(0,3).map(P=>{const $=n.find(p=>p.id===P.providerId);if(!$)return null;const w=P.totalRequests>0?P.successfulRequests/P.totalRequests*100:0;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:$.name}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-500",children:[e.jsxs("span",{children:["成功率: ",w.toFixed(1),"%"]}),e.jsxs("span",{children:["請求數: ",P.totalRequests]}),P.averageResponseTime>0&&e.jsxs("span",{children:["平均: ",Math.round(P.averageResponseTime),"ms"]})]})]},P.providerId)})})]}),e.jsx(ss,{isOpen:b,onClose:()=>v(!1),onSave:L,currentProviders:n})]})},It=({quiz:s,topic:c,apiKey:r,supportsDiagnostic:u=!1,quizBinId:n})=>{const[o,t]=l.useState(ee.Easy),[m,h]=l.useState([]),[d,b]=l.useState(!1),[v,y]=l.useState(""),[a,x]=l.useState(!1),[i,f]=l.useState(""),[A,L]=l.useState(!1),[P,$]=l.useState(!1),w=l.useCallback((g,T,O,N,M,I)=>{if(!u)return;const E=`${o}-${g}-${T}`,q={questionId:E,questionType:g,difficulty:o.toLowerCase(),userAnswer:O,correctAnswer:N,isCorrect:M,responseTime:I,attempts:1};h(J=>{const F=J.findIndex(U=>U.questionId===E);if(F>=0){const U=[...J];return U[F]={...U[F],userAnswer:O,isCorrect:M,attempts:(U[F].attempts||1)+1},U}return[...J,q]})},[o,u]),p=(g,T)=>{switch(g){case"trueFalse":return T.isTrue;case"multipleChoice":return T.options[T.correctAnswerIndex];case"fillInTheBlanks":return T.correctAnswers;case"sentenceScramble":return T.originalSentence;case"memoryCardGame":return T.pairs;default:return null}},j=()=>{const g=o.toLowerCase();return m.filter(T=>T.difficulty===g)},S=l.useCallback(async()=>{const T=(()=>{const O=o.toLowerCase();return m.filter(N=>N.difficulty===O)})();if(T.length===0){alert("請先完成一些題目再分享結果！");return}if(!v.trim()){L(!0);return}x(!0);try{const O=Gs(T),N=o===ee.Easy?"簡單":o===ee.Normal?"普通":"困難",M=s?.[o]||{},I=await Zs({studentName:v.trim(),topic:c,difficulty:N,responses:T,overallScore:O,completedAt:new Date().toISOString(),quizBinId:n,quizContent:M,metadata:{totalQuestions:T.length,correctAnswers:T.filter(J=>J.isCorrect).length,selectedDifficulty:o}}),q=`${window.location.origin}/ai-page-gen/student-results?binId=${I}`;f(q),navigator.clipboard&&window.isSecureContext?(await navigator.clipboard.writeText(q),alert("作答結果已分享！連結已複製到剪貼簿，可以傳送給老師。")):alert("作答結果已分享！請複製下方連結傳送給老師。")}catch(O){console.error("分享失敗:",O),alert("分享失敗，請稍後再試。")}finally{x(!1)}},[m,v,c,o,n,s]);if(d&&u&&r&&j().length>0)return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(be,{className:"w-8 h-8 text-indigo-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"學習診斷報告"}),e.jsxs("span",{className:"px-3 py-1 bg-indigo-100 text-indigo-800 text-sm font-medium rounded-full",children:[o===ee.Easy?"簡單":o===ee.Normal?"普通":"困難"," 難度"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-medium",children:c})]})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(He,{topic:`${c} (${o===ee.Easy?"簡單":o===ee.Normal?"普通":"困難"}難度)`,apiKey:r,mode:"student",initialResponses:j(),onClose:()=>b(!1),onRetakeQuiz:()=>{const g=o.toLowerCase();h(T=>T.filter(O=>O.difficulty!==g)),b(!1)},onContinueLearning:()=>b(!1)})})]});if(!s)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 text-lg",children:"沒有可用的測驗資料"})]});const z=s[o],R=[{key:ee.Easy,label:"簡單",color:"bg-green-500 hover:bg-green-600"},{key:ee.Normal,label:"普通",color:"bg-yellow-500 hover:bg-yellow-600"},{key:ee.Hard,label:"困難",color:"bg-red-500 hover:bg-red-600"}],W={trueFalse:"是非題",multipleChoice:"選擇題",fillInTheBlanks:"填空題",sentenceScramble:"句子重組",memoryCardGame:"翻卡牌記憶遊戲"},C=(g,T)=>{if(!T||!Array.isArray(T)||T.length===0)return null;const O=N=>u?(M,I,E)=>{const q=p(g,T[N]);w(g,N,M,q,I,E)}:void 0;switch(g){case"trueFalse":return e.jsx("div",{className:"space-y-4",children:T.map((N,M)=>e.jsx(Te,{question:N,itemNumber:M+1,onAnswer:O(M)},`${o}-tf-${M}`))});case"multipleChoice":return e.jsx("div",{className:"space-y-4",children:T.map((N,M)=>e.jsx(Be,{question:N,itemNumber:M+1,onAnswer:O(M)},`${o}-mc-${M}`))});case"fillInTheBlanks":return e.jsx("div",{className:"space-y-4",children:T.map((N,M)=>e.jsx(is,{question:N,itemNumber:M+1,onAnswer:O(M)},`${o}-fb-${M}`))});case"sentenceScramble":return e.jsx("div",{className:"space-y-4",children:T.map((N,M)=>e.jsx(os,{question:N,itemNumber:M+1,onAnswer:O(M)},`${o}-ss-${M}`))});case"memoryCardGame":return e.jsx("div",{className:"space-y-4",children:T.map((N,M)=>e.jsx(De,{question:N,itemNumber:M+1,onAnswer:O(M)},`${o}-mcg-${M}`))});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-8 h-8 text-indigo-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"互動測驗"})]}),e.jsxs("a",{href:"/ai-page-gen/",className:"flex items-center gap-2 px-4 py-2 text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-lg hover:bg-indigo-100 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"返回首頁"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-medium",children:c}),u&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"支援 AI 診斷"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[u&&j().length>0&&e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(be,{className:"w-5 h-5"}),"查看學習診斷 (",j().length,")"]}),j().length>0&&e.jsxs("button",{onClick:S,disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-11.314a2.25 2.25 0 1 0 3.935-2.186 2.25 2.25 0 0 0-3.935 2.186Z"})}),a?"分享中...":`分享結果給老師 (${j().length})`]})]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[u&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(be,{className:"w-5 h-5 text-blue-400 mt-0.5"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"此測驗支援 AI 學習診斷功能"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"完成題目後可查看個人化學習建議。您的答題資料僅用於生成學習診斷報告。"})]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"選擇難度等級"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:R.map(({key:g,label:T,color:O})=>e.jsx("button",{onClick:()=>t(g),className:`px-6 py-3 rounded-lg text-white font-medium transition-all transform hover:scale-105 shadow-md
                  ${o===g?`${O} ring-4 ring-opacity-50`:"bg-gray-400 hover:bg-gray-500"}
                `,children:T},g))})]}),z&&e.jsx("div",{className:"space-y-8",children:Object.keys(W).map(g=>{const T=z[g],O=C(g,T??[]);return O?e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"w-3 h-3 bg-indigo-500 rounded-full"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:W[g]})]}),O]},g):null})}),(!z||Object.values(z).every(g=>!g||g.length===0))&&e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[e.jsx(ye,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 text-lg",children:"此難度等級暫無測驗題目"}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:"請選擇其他難度等級"})]})})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:g=>{g.target===g.currentTarget&&L(!1)},children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"分享作答結果給老師"}),e.jsx("button",{onClick:()=>L(!1),className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"關閉",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"請輸入您的姓名，讓老師知道這是誰的作答結果："}),e.jsx("input",{type:"text",value:v,onChange:g=>y(g.target.value),placeholder:"請輸入姓名",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",onKeyPress:g=>g.key==="Enter"&&S()}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>L(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"取消"}),e.jsx("button",{onClick:S,disabled:!v.trim()||a,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a?"分享中...":"分享結果"})]})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:g=>{g.target===g.currentTarget&&(f(""),$(!1))},children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"✅ 作答結果已分享成功！"}),e.jsx("button",{onClick:()=>{f(""),$(!1)},className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"關閉",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"請將下方連結傳送給您的老師，老師可以查看您的作答結果並提供學習建議："}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:i,readOnly:!0,className:"w-full px-3 py-2 bg-white border border-gray-300 rounded text-sm"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{onClick:async()=>{navigator.clipboard&&window.isSecureContext&&(await navigator.clipboard.writeText(i),alert("連結已複製到剪貼簿！"))},className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors",children:"複製連結"}),e.jsxs("button",{onClick:()=>$(!P),className:"flex-1 px-3 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors flex items-center justify-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5H8.25v1.5H13.5V13.5ZM13.5 16.5H8.25V18H13.5v-1.5ZM16.5 16.5h1.5V18h-1.5v-1.5ZM16.5 13.5h1.5v1.5h-1.5v-1.5Z"})]}),"顯示 QR Code"]})]})]})}),P&&e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx(ue,{url:i,title:"作答結果分享 QR Code",size:200,className:"bg-white"})}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["💡 ",e.jsx("strong",{children:"給老師的說明："}),e.jsx("br",{}),"老師打開連結後可以看到 ",v," 在「",c,"」(",o===ee.Easy?"簡單":o===ee.Normal?"普通":"困難","難度) 的作答結果，並可使用 AI 進行詳細的學習分析。"]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>{f(""),$(!1)},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"關閉"})})]})}),e.jsx("footer",{className:"bg-white border-t mt-12 py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"由 AI 學習頁面產生器創建 • 祝你學習愉快！"})})})]})},At=()=>{const[s]=ke(),c=s.get("binId"),[r,u]=V.useState(null),[n,o]=V.useState(""),[t,m]=V.useState(""),[h,d]=V.useState(!1),[b,v]=V.useState(!1),[y,a]=V.useState("");return V.useEffect(()=>{if(!c){a("缺少測驗ID參數");return}(async()=>{v(!0);try{const i=await Us(c);u(i.quiz),o(i.topic);let f=i.apiKey||"";try{const A=await ms(s);A&&(f=A,console.log("使用 URL 中的 API Key 進行學習診斷"))}catch(A){console.warn("解析 URL API Key 失敗:",A)}m(f),d(!!f)}catch(i){a(i.message||"載入測驗失敗")}finally{v(!1)}})()},[c,s]),b?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"載入測驗中..."})]})}):y?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md mx-4 text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"測驗載入失敗"}),e.jsx("p",{className:"text-gray-600 mb-4",children:y}),e.jsx("p",{className:"text-sm text-gray-500",children:"請確認連結是否正確，或聯繫您的老師"})]})}):!r||!n?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md mx-4 text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"🔍"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"找不到測驗內容"}),e.jsx("p",{className:"text-gray-600",children:"請檢查連結是否正確"})]})}):e.jsx(It,{quiz:r,topic:n,apiKey:t,supportsDiagnostic:h,quizBinId:c??void 0})},Pt=()=>{const[s]=ke(),[c,r]=l.useState(null),[u,n]=l.useState(!0),[o,t]=l.useState(null),[m,h]=l.useState(""),[d,b]=l.useState("manual"),v=s.get("binId");l.useEffect(()=>{(async()=>{if(!v){t("缺少內容 ID"),n(!1);return}try{n(!0);const x=await _s(v);r(x.writingPractice);try{const i=await ms(s);i&&(h(i),b("url"),localStorage.setItem("gemini_api_key",i),console.log("使用 URL 中的 API Key 進行 AI 批改"))}catch(i){console.warn("解析 URL API Key 失敗:",i)}}catch(x){console.error("載入分享內容失敗:",x),t("載入分享內容失敗，請檢查連結是否正確")}finally{n(!1)}})()},[v,s]),l.useEffect(()=>{if(!m){const a=localStorage.getItem("gemini_api_key");a&&(h(a),b("localStorage"))}},[m]);const y=a=>{a.preventDefault();const x=m.trim();x&&(localStorage.setItem("gemini_api_key",x),h(x),b("manual"))};return u?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"載入寫作練習內容中..."})]})}):o?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16 text-red-500 mx-auto mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"載入失敗"}),e.jsx("p",{className:"text-gray-600 mb-6",children:o}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"重新載入"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 text-blue-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"📝 寫作練習平台"}),e.jsx("p",{className:"text-gray-600",children:"完成練習後可獲得 AI 即時批改回饋"})]}),e.jsxs("a",{href:"/ai-page-gen/",className:"flex items-center gap-2 px-4 py-2 text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-lg hover:bg-indigo-100 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"返回首頁"]})]}),!m&&e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-yellow-600 mt-0.5 flex-shrink-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-800 mb-1",children:"設定 API Key 以使用 AI 批改功能"}),e.jsxs("p",{className:"text-sm text-yellow-700 mb-3",children:["輸入您的 Google Gemini API Key 來啟用 AI 自動批改功能。",e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"underline ml-1",children:"點此取得 API Key"})]})]})]}),e.jsxs("form",{onSubmit:y,className:"flex gap-3",children:[e.jsx("input",{type:"password",value:m,onChange:a=>h(a.target.value),placeholder:"請輸入您的 Gemini API Key",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{type:"submit",disabled:!m.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"設定"})]})]}),m&&e.jsx("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"API Key 已設定，可以使用 AI 批改功能"}),d==="url"&&e.jsxs("div",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[e.jsx("span",{children:"🔗"}),e.jsx("span",{children:"來自分享連結 - 老師已為您配置好 AI 功能"})]}),d==="localStorage"&&e.jsxs("div",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[e.jsx("span",{children:"💾"}),e.jsx("span",{children:"來自本地存儲"})]})]})]}),e.jsx("button",{onClick:()=>{localStorage.removeItem("gemini_api_key"),h(""),b("manual")},className:"text-sm text-green-600 hover:text-green-800 underline",children:"重新設定"})]})})]}),c&&e.jsx(cs,{content:c,apiKey:m,isStudentMode:!0}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-500",children:[e.jsx("p",{children:"🤖 本平台使用 Google Gemini AI 提供智能批改回饋"}),e.jsx("p",{className:"mt-1",children:"💡 建議：完成練習後點擊「獲得 AI 批改」按鈕，即可獲得詳細的學習建議"})]})]})})},Mt=({responses:s,quizContent:c})=>{const r=(t,m)=>{if(!c)return null;const h=t.questionType,d=c[h];if(!d||!Array.isArray(d))return null;let b=m;if(t.questionId&&typeof t.questionId=="string"){const v=t.questionId.match(/\d+$/);v&&(b=parseInt(v[0]))}return d[b]||null},u=(t,m)=>{if(!t)return e.jsx("div",{className:"text-gray-400 italic",children:"找不到原始題目"});switch(m){case"trueFalse":return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"📝 題目陳述:"}),e.jsx("div",{className:"bg-blue-50 p-3 rounded text-gray-800",children:t.statement}),t.explanation&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:"說明: "}),e.jsx("div",{children:t.explanation})]})]});case"multipleChoice":return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"❓ 題目:"}),e.jsx("div",{className:"bg-blue-50 p-3 rounded text-gray-800",children:t.question}),e.jsx("div",{className:"font-medium",children:"選項:"}),e.jsx("div",{className:"space-y-1",children:t.options?.map((h,d)=>e.jsxs("div",{className:`p-2 rounded text-sm ${d===t.correctAnswerIndex?"bg-green-100 border border-green-300":"bg-gray-50"}`,children:[String.fromCharCode(65+d),". ",h,d===t.correctAnswerIndex&&e.jsx("span",{className:"ml-2 text-green-600",children:"✓ 正確答案"})]},d))})]});case"fillInTheBlanks":return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"✏️ 填空題:"}),e.jsx("div",{className:"bg-blue-50 p-3 rounded text-gray-800",children:t.sentence}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("span",{className:"font-medium",children:"正確答案: "}),Array.isArray(t.correctAnswers)?t.correctAnswers.join(", "):t.correctAnswers]})]});case"sentenceScramble":return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"🔀 句子重組:"}),e.jsx("div",{className:"text-sm text-gray-600",children:"打亂的詞組:"}),e.jsx("div",{className:"bg-yellow-50 p-2 rounded text-sm",children:Array.isArray(t.scrambledWords)?t.scrambledWords.join(" | "):"無詞組資料"}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("span",{className:"font-medium",children:"正確順序: "}),t.correctSentence]})]});case"memoryCardGame":return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"🃏 記憶卡遊戲:"}),t.instructions&&e.jsx("div",{className:"text-sm text-sky-700 bg-sky-50 p-2 rounded",children:t.instructions}),e.jsx("div",{className:"space-y-1",children:t.pairs?.map((h,d)=>e.jsxs("div",{className:"flex items-center justify-between bg-purple-50 p-2 rounded text-sm",children:[e.jsxs("span",{children:["🃏 ",h.question]}),e.jsx("span",{className:"text-purple-600",children:"↔️"}),e.jsxs("span",{children:["🃊 ",h.answer]})]},d))})]});default:return e.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded",children:JSON.stringify(t,null,2)})}},n=(t,m)=>m==="memoryCardGame"&&typeof t=="number"?`完成遊戲，總嘗試次數: ${t}`:m==="multipleChoice"&&typeof t=="number"?`選項 ${String.fromCharCode(65+t)} (${t})`:typeof t=="object"?JSON.stringify(t,null,2):String(t),o={trueFalse:"是非題",multipleChoice:"選擇題",fillInTheBlanks:"填空題",sentenceScramble:"句子重組",memoryCardGame:"翽卡配對遊戲"};return e.jsx("div",{className:"space-y-6",children:s.map((t,m)=>{const h=r(t,m);return e.jsxs("div",{className:`p-6 rounded-lg border-2 ${t.isCorrect?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.isCorrect?e.jsx(Oe,{className:"w-5 h-5 text-green-600"}):e.jsx(We,{className:"w-5 h-5 text-red-600"}),e.jsxs("span",{className:"font-bold text-lg text-gray-800",children:["第 ",m+1," 題 - ",o[t.questionType]||t.questionType]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:t.attempts&&t.attempts>1&&`嘗試 ${t.attempts} 次`})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"📖 原始題目內容:"}),e.jsx("div",{className:"border-l-4 border-blue-300 pl-4",children:u(h,t.questionType)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"👨‍🎓 學生作答:"}),e.jsx("div",{className:"bg-white p-3 rounded border",children:n(t.userAnswer,t.questionType)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:t.isCorrect?"✅ 答題正確":"❌ 答題錯誤"}),e.jsx("div",{className:`p-3 rounded border ${t.isCorrect?"bg-green-100 border-green-300":"bg-red-100 border-red-300"}`,children:t.isCorrect?"學生答案正確！":"需要進一步指導"})]})]})]},t.questionId||m)})})},$t=()=>{const[s]=ke(),c=s.get("binId"),[r,u]=l.useState(null),[n,o]=l.useState(!0),[t,m]=l.useState(null),[h,d]=l.useState(""),[b,v]=l.useState(!1),[y,a]=l.useState(!1),[x,i]=l.useState(!1);l.useEffect(()=>{(async()=>{if(!c){m("缺少學生作答結果ID參數"),o(!1);return}try{o(!0);const j=await Js(c);u(j),v(!!j.diagnosticReport)}catch(j){console.error("載入學生作答結果失敗:",j),m(j instanceof Error?j.message:"載入學生作答結果失敗")}finally{o(!1)}})()},[c]),l.useEffect(()=>{const p=localStorage.getItem("gemini_api_key");p?(d(p),console.log("已從 localStorage 讀取 API Key")):console.log("未找到已存儲的 API Key")},[]);const f=p=>{p.preventDefault();const j=h.trim();j&&(localStorage.setItem("gemini_api_key",j),d(j),i(!1))},A=()=>{if(!h){i(!0);return}a(!0)},L=()=>{r?.diagnosticReport&&a(!0)};if(n)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"載入學生作答結果中..."})]})});if(t)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16 text-red-500 mx-auto mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"載入失敗"}),e.jsx("p",{className:"text-gray-600 mb-6",children:t}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"重新載入"})]})});if(y&&r)return e.jsx(He,{topic:`${r.topic} (${r.difficulty}難度) - ${r.studentName}`,apiKey:h,mode:"teacher",initialResponses:r.responses,existingReport:r.diagnosticReport,resultsBinId:c??void 0,onClose:()=>a(!1),onReportSaved:p=>{u(j=>j?{...j,diagnosticReport:p}:null),v(!0)}});if(!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16 text-gray-400 mx-auto mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"找不到學生作答結果"}),e.jsx("p",{className:"text-gray-600",children:"請檢查連結是否正確"})]})});const P=r.responses.filter(p=>p.isCorrect).length,$=r.responses.length,w=new Date(r.completedAt).toLocaleString("zh-TW");return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-8 h-8 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"學生作答結果檢視"})]}),e.jsxs("a",{href:"/ai-page-gen/",className:"flex items-center gap-2 px-4 py-2 text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-lg hover:bg-indigo-100 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"返回首頁"]})]}),e.jsx("div",{className:"flex items-center gap-2 text-gray-600",children:e.jsx("span",{className:"text-lg font-medium",children:"教師版分析工具"})})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:["📝 ",r.studentName||"匿名學生"," 的作答結果"]}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsxs("span",{children:["主題：",r.topic]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:["難度：",r.difficulty]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsxs("span",{children:["完成時間：",w]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:[r.overallScore,"%"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[P,"/",$," 答對"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:P}),e.jsx("div",{className:"text-sm text-green-600",children:"答對題數"})]})]})}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(We,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-700",children:$-P}),e.jsx("div",{className:"text-sm text-red-600",children:"答錯題數"})]})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-700",children:[r.overallScore,"%"]}),e.jsx("div",{className:"text-sm text-blue-600",children:"總體正確率"})]})]})})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[b?e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:L,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all font-medium",children:[e.jsx(be,{className:"w-5 h-5"}),"查看 AI 診斷報告"]}),e.jsx("button",{onClick:A,className:"flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all font-medium text-sm",children:"🔄 重新生成"})]}):e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all font-medium",children:[e.jsx(be,{className:"w-5 h-5"}),"生成 AI 學習診斷報告"]}),h?e.jsx("div",{className:"text-sm text-green-600 flex items-center gap-1",children:"✅ API Key 已設定，可使用 AI 診斷功能"}):e.jsx("div",{className:"text-sm text-amber-600 flex items-center gap-1",children:"⚠️ 需要設定 API Key 才能使用 AI 診斷功能"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:b?e.jsx("span",{children:"📊 已儲存診斷報告，可隨時查看或重新生成新的分析"}):h?e.jsx("span",{children:"💡 小提示：如需更更換 API Key，請點擊上方按鈕後在彈出視窗中重新設定"}):null})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"📋 詳細作答記錄 (含原始題目)"}),e.jsx(Mt,{responses:r.responses,quizContent:r.quizContent})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:p=>{p.target===p.currentTarget&&i(!1)},children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"設定 API Key"}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"關閉",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["要使用 AI 學習診斷功能，請輸入您的 Google Gemini API Key。",e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-600 ml-1",children:"點此取得 API Key"})]}),e.jsxs("form",{onSubmit:f,children:[e.jsx("input",{type:"password",value:h,onChange:p=>d(p.target.value),placeholder:"請輸入您的 Gemini API Key",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"取消"}),e.jsx("button",{type:"submit",disabled:!h.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"設定"})]})]})]})})]})},Et=()=>{const[s,c]=l.useState([]),[r,u]=l.useState(!0),[n,o]=l.useState(null),[t,m]=l.useState(""),[h,d]=l.useState(null),[b,v]=l.useState("list"),[y,a]=l.useState(null),[x,i]=l.useState(null);l.useEffect(()=>{const j=localStorage.getItem("gemini_api_key");i(j),f()},[]);const f=async()=>{try{u(!0),o(null),await ne.init();const j=await ne.getAllLessonPlans();c(j)}catch(j){console.error("載入教案失敗:",j),o("載入教案失敗，請重試。")}finally{u(!1)}},A=async()=>{if(!t.trim()){await f();return}try{u(!0);const j=await ne.searchLessonPlans(t);c(j)}catch(j){console.error("搜索失敗:",j),o("搜索失敗，請重試。")}finally{u(!1)}},L=async j=>{d(j),v("view");try{await ne.updateLastAccessed(j.id)}catch(S){console.error("更新訪問時間失敗:",S)}},P=async j=>{if(!x){alert("請先設定 API Key 才能分享教案。");return}a(j.id);try{const S={...j.content,topic:j.topic,selectedLevel:j.content.selectedLevel||null,selectedVocabularyLevel:j.content.selectedVocabularyLevel||null},z=await Me(S),R=`${window.location.origin}/ai-page-gen/share?binId=${z}`;if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(R),alert("分享連結已複製到剪貼簿！");else{const W=document.createElement("textarea");W.value=R,document.body.appendChild(W),W.select(),document.execCommand("copy"),document.body.removeChild(W),alert(`分享連結已複製！\\n${R}`)}await ne.updateLastAccessed(j.id)}catch(S){console.error("分享失敗:",S),alert("分享失敗，請稍後再試。")}finally{a(null)}},$=async j=>{if(confirm(`確定要刪除教案「${j.topic}」嗎？此操作無法復原。`))try{await ne.deleteLessonPlan(j.id),await f()}catch(S){console.error("刪除失敗:",S),alert("刪除失敗，請重試。")}},w=j=>new Date(j).toLocaleString("zh-TW",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),p=t.trim()?s.filter(j=>j.topic.toLowerCase().includes(t.toLowerCase())):s;return b==="view"&&h?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b sticky top-0 z-10",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>{v("list"),d(null)},className:"flex items-center gap-2 px-3 py-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})}),"返回教案列表"]}),e.jsxs("a",{href:"/ai-page-gen/",className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"返回首頁"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:h.topic}),e.jsxs("p",{className:"text-sm text-gray-600",children:["創建於 ",w(h.createdAt)]})]}),e.jsxs("button",{onClick:()=>P(h),disabled:y===h.id,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[y===h.id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ae,{className:"w-4 h-4"}),"分享教案"]})]})})}),e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:e.jsx(Ve,{content:h.content,topic:h.topic,selectedLevel:h.content.selectedLevel||null,selectedVocabularyLevel:h.content.selectedVocabularyLevel||null,apiKey:x||void 0,onContentUpdate:async j=>{const S={...h,content:j,lastAccessedAt:new Date().toISOString()};d(S);try{await ne.saveLessonPlan(S),console.log("教案已更新到 IndexedDB")}catch(z){console.error("更新教案到 IndexedDB 失敗:",z)}}})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-8 h-8 text-indigo-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"我的教案庫"})]}),e.jsxs("a",{href:"/ai-page-gen/",className:"flex items-center gap-2 px-4 py-2 text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-lg hover:bg-indigo-100 transition-colors",children:[e.jsx(ge,{className:"w-5 h-5"}),"返回首頁"]})]}),e.jsx("p",{className:"text-gray-600",children:"管理您之前生成的所有教案，隨時查看和分享"})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:t,onChange:j=>m(j.target.value),placeholder:"搜索教案主題...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",onKeyPress:j=>j.key==="Enter"&&A()}),e.jsx("button",{onClick:A,className:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"搜索"}),e.jsx("button",{onClick:f,className:"px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"重置"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-indigo-100 rounded-lg",children:e.jsx(oe,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.length}),e.jsx("p",{className:"text-gray-600",children:"總教案數"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(ze,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.filter(j=>j.metadata?.hasQuiz).length}),e.jsx("p",{className:"text-gray-600",children:"包含測驗"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-purple-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.filter(j=>j.metadata?.hasWriting).length}),e.jsx("p",{className:"text-gray-600",children:"包含寫作"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:t.trim()?`搜索結果 (${p.length})`:"所有教案"})}),r?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(le,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"載入中..."})]}):n?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"重試"})]}):p.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg mb-2",children:t.trim()?"未找到匹配的教案":"還沒有保存的教案"}),e.jsx("p",{className:"text-gray-500",children:t.trim()?"嘗試其他關鍵詞":"生成第一個教案來開始使用！"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:p.map(j=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:j.topic}),j.metadata?.isShared&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(Ae,{className:"w-3 h-3"}),"分享的教案"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),"創建：",w(j.createdAt)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"w-4 h-4"}),"訪問：",w(j.lastAccessedAt)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full",children:[j.metadata?.totalSections||0," 個部分"]}),j.metadata?.hasQuiz&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:"包含測驗"}),j.metadata?.hasWriting&&e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs font-medium rounded-full",children:"包含寫作"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs("button",{onClick:()=>L(j),className:"flex items-center gap-2 px-3 py-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),"查看"]}),e.jsxs("a",{href:`/ai-page-gen/teacher-interactive-prep?contentId=${j.id}`,className:"flex items-center gap-2 px-3 py-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",target:"_blank",rel:"noopener noreferrer",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a6.759 6.759 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),"準備互動教材"]}),e.jsxs("button",{onClick:()=>P(j),disabled:y===j.id,className:"flex items-center gap-2 px-3 py-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[y===j.id?e.jsx("div",{className:"w-4 h-4 border-2 border-green-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Ae,{className:"w-4 h-4"}),"分享"]}),e.jsxs("button",{onClick:()=>$(j),className:"flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(at,{className:"w-4 h-4"}),"刪除"]})]})]})},j.id))})]})]})]})},zt=()=>{const[s]=ke(),c=s.get("binId"),[r,u]=l.useState(null),[n,o]=l.useState(!0),[t,m]=l.useState(null),[h,d]=l.useState(null),[b,v]=l.useState(0),[y,a]=l.useState([]),[x,i]=l.useState(!1),[f,A]=l.useState(null);l.useEffect(()=>{c?(async()=>{try{o(!0),m(null);const E=await ls(c);if(!E.isInteractive)throw new Error("此內容尚未準備為互動教材");u(E),L(E)}catch(E){console.error("載入互動內容失敗:",E),m(E.message||"載入互動內容時發生錯誤")}finally{o(!1)}})():(m("缺少必要參數：binId"),o(!1))},[c]),l.useEffect(()=>{const I=E=>{const q=`student_interactive_${c}`;try{const J=localStorage.getItem(q);if(J){const F=JSON.parse(J);d(F);const U=F.progress.currentObjectiveIndex||0,Z=Math.min(Math.max(0,U),y.length-1);v(Z)}else{const F={contentId:c||"unknown",topic:E.topic||"互動學習",progress:{currentObjectiveIndex:0,completedObjectives:[],timeSpent:0,interactionCount:0,startTime:Date.now(),lastUpdateTime:Date.now(),completedActivities:[]},interactions:[],createdAt:Date.now(),updatedAt:Date.now()};d(F),localStorage.setItem(q,JSON.stringify(F))}}catch(J){console.error("初始化學習會話失敗:",J)}};r&&y.length>0&&I(r)},[r,y,c]);const L=I=>{const E=[],q=I.transformedData||{};console.log("Initial content:",I),console.log("Transformed data keys:",Object.keys(q)),console.log("Transformed data:",q),I.originalContent&&console.log("Original content from JSON:",I.originalContent);const J=Object.keys(q).sort((Z,k)=>{const D=parseInt(Z.replace("step_","")),H=parseInt(k.replace("step_",""));return D-H});console.log("Sorted step IDs:",J);const F=I.includedSteps||Object.keys(q);console.log("Included steps:",F);const U={};if(I.originalContent)console.log("Using originalContent from JSON for mapping"),Object.keys(I.originalContent).forEach(Z=>{const k=I.originalContent[Z];k&&F.includes(Z)&&(U[Z]={content:k.content,type:k.type,index:k.index||0})});else{console.log("Using fallback method to build original content mapping");const Z=[];I.learningObjectives&&I.learningObjectives.forEach((k,D)=>{Z.push({content:k,type:"objective",typeIndex:D})}),I.contentBreakdown&&I.contentBreakdown.forEach((k,D)=>{Z.push({content:k,type:"breakdown",typeIndex:D})}),I.confusingPoints&&I.confusingPoints.forEach((k,D)=>{Z.push({content:k,type:"confusing",typeIndex:D})}),console.log("All original content (fallback):",Z),F.forEach((k,D)=>{if(D<Z.length){const H=Z[D];U[k]={content:H.content,type:H.type,index:H.typeIndex},console.log(`Mapping ${k} to original content at index ${D}:`,H)}})}console.log("Original lookup:",U),J.forEach(Z=>{const k=q[Z],D=U[Z];if(k&&D){let H="",Q="",Y="";switch(D.type){case"objective":H=`📚 學習目標 ${D.index+1}`,Q="🎯",Y=k.objective?.length>50?`${k.objective.substring(0,50)}...`:k.objective||D.content.objective;break;case"breakdown":H=`🔍 深度學習 ${D.index+1}`,Q="📖",Y=k.title?.length>50?`${k.title.substring(0,50)}...`:k.title||D.content.topic;break;case"confusing":H=`⚡ 重要提醒 ${D.index+1}`,Q="💡",Y=k.title?.length>50?`${k.title.substring(0,50)}...`:k.title||D.content.point;break}console.log(`Creating step: ${Z}, type: ${D.type}, title: ${H}`),E.push({id:Z,title:H,type:D.type,icon:Q,description:Y,content:k,originalIndex:D.index})}}),E.length>0&&E.push({id:"summary",title:"🎯 學習完成",type:"summary",icon:"🏆",description:"恭喜完成學習，開始實踐應用！",content:null}),console.log("Final steps:",E),a(E)},P=I=>{const E=`student_interactive_${c}`;I.updatedAt=Date.now(),I.progress.lastUpdateTime=Date.now(),d(I),localStorage.setItem(E,JSON.stringify(I))},$=I=>{if(!h)return;const E={...h};E.progress.completedObjectives.includes(I)||(E.progress.completedObjectives.push(I),E.progress.interactionCount+=1),P(E)},w=I=>{if(I>=0&&I<y.length&&y[I]&&(v(I),window.scrollTo({top:0,behavior:"smooth"}),h)){const E={...h};E.progress.currentObjectiveIndex=I,P(E)}},p=()=>{b<y.length-1&&w(b+1)},j=()=>{b>0&&w(b-1)},S=()=>{const I=y[b];if(!I||!r?.stepQuizData)return;const E=r.stepQuizData[I.id];E&&(A(E),i(!0))},z=()=>{i(!1),A(null)},R=()=>{const I=y[b];return I&&r?.stepQuizData&&r.stepQuizData[I.id]},W=I=>I?[/#+\s/,/\*\*.*\*\*/,/\*.*\*/,/`.*`/,/^\s*[-*+]\s/m,/^\s*\d+\.\s/m,/\[.*\]\(.*\)/,/^\s*>/m,/```[\s\S]*?```/,/\n\s*\n/].some(q=>q.test(I)):!1,C=(I,E)=>W(I)?e.jsx(lt,{content:I,className:E}):e.jsx("span",{className:E,children:I});if(n)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center items-center min-h-[50vh]",children:e.jsx(le,{})})});if(t)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-md",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"載入錯誤"}),e.jsx("p",{children:t})]})})});if(!r||!h||y.length===0)return null;const g=y[b];if(!g)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg shadow-md",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"沒有可用的學習步驟"}),e.jsx("p",{children:"此互動教材可能還沒有轉換任何內容，或者內容載入有問題。"}),e.jsx("p",{className:"mt-2 text-sm",children:"請確認教師已經轉換並發布了學習內容。"})]})})});const T=h.progress.completedObjectives.length,O=y.length-1,N=O>0?T/O*100:0,M=()=>{const I=h.progress.completedObjectives.includes(g.id);switch(g.type){case"objective":return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-sky-500 rounded-3xl shadow-2xl p-12 text-white text-center",children:[e.jsx("div",{className:"text-6xl mb-6",children:"🎯"}),e.jsx("div",{className:"text-4xl font-bold mb-6 leading-tight",children:C(g.content.objective,"text-4xl font-bold leading-tight text-white")}),g.content.description&&e.jsx("div",{className:"text-xl text-indigo-100 leading-relaxed max-w-3xl mx-auto",children:C(g.content.description,"text-xl text-indigo-100 leading-relaxed")})]}),e.jsxs("div",{className:"space-y-6",children:[g.content.personalRelevance&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-purple-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"🌟"}),"這對你很重要"]}),e.jsx("div",{className:"bg-purple-50 rounded-xl p-6 text-lg leading-relaxed text-purple-900",children:C(g.content.personalRelevance,"text-lg leading-relaxed text-purple-900")})]}),g.content.teachingExample&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-green-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"📝"}),"實際應用"]}),e.jsx("div",{className:"bg-green-50 rounded-xl p-6 text-lg leading-relaxed text-green-900",children:C(g.content.teachingExample,"text-lg leading-relaxed text-green-900")})]}),g.content.encouragement&&e.jsxs("div",{className:"bg-gradient-to-r from-sky-50 to-indigo-50 rounded-2xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-sky-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"💪"}),"為你加油"]}),e.jsx("div",{className:"text-lg leading-relaxed text-sky-900 font-medium",children:C(g.content.encouragement,"text-lg leading-relaxed text-sky-900 font-medium")})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[I?e.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-2xl p-8",children:[e.jsx("div",{className:"text-5xl mb-4",children:"✅"}),e.jsx("h4",{className:"text-2xl font-bold text-green-700 mb-2",children:"太棒了！"}),e.jsx("p",{className:"text-green-600",children:"你已經掌握了這個學習目標！"})]}):e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-8",children:[e.jsx("h4",{className:"text-xl font-semibold text-slate-700 mb-4",children:"理解了嗎？"}),e.jsxs("button",{onClick:()=>$(g.id),className:"px-8 py-4 bg-green-500 hover:bg-green-600 text-white font-bold text-lg rounded-xl transition-colors flex items-center gap-3 mx-auto",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"我理解了！"]})]}),R()&&e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-2xl p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-orange-700 mb-3",children:"想測試一下你的理解嗎？"}),e.jsxs("button",{onClick:S,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-medium text-lg rounded-xl transition-colors flex items-center gap-2 mx-auto",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),"開始練習測驗"]})]})]})]});case"breakdown":return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-sky-500 to-blue-500 rounded-3xl shadow-2xl p-12 text-white text-center",children:[e.jsx("div",{className:"text-6xl mb-6",children:"📖"}),e.jsx("div",{className:"text-4xl font-bold mb-6 leading-tight",children:C(g.content.title||g.content.topic,"text-4xl font-bold leading-tight text-white")}),g.content.introduction&&e.jsx("div",{className:"text-xl text-sky-100 leading-relaxed max-w-3xl mx-auto",children:C(g.content.introduction,"text-xl text-sky-100 leading-relaxed")})]}),e.jsxs("div",{className:"space-y-6",children:[g.content.keyPoints&&g.content.keyPoints.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-indigo-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"💡"}),"重點概念"]}),e.jsx("div",{className:"bg-indigo-50 rounded-xl p-6",children:e.jsx("div",{className:"space-y-4",children:g.content.keyPoints.map((E,q)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 bg-indigo-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-4",children:q+1}),e.jsx("div",{className:"text-lg text-indigo-900 leading-relaxed",children:C(E,"text-lg text-indigo-900 leading-relaxed")})]},q))})})]}),g.content.realLifeExamples&&g.content.realLifeExamples.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-green-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"🌟"}),"生活中的例子"]}),e.jsx("div",{className:"bg-green-50 rounded-xl p-6",children:e.jsx("div",{className:"space-y-4",children:g.content.realLifeExamples.map((E,q)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-4",children:q+1}),e.jsx("div",{className:"text-lg text-green-900 leading-relaxed",children:C(E,"text-lg text-green-900 leading-relaxed")})]},q))})})]}),g.content.learningTips&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-purple-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"🎯"}),"學習小技巧"]}),e.jsx("div",{className:"bg-purple-50 rounded-xl p-6 text-lg leading-relaxed text-purple-900",children:C(g.content.learningTips,"text-lg leading-relaxed text-purple-900")})]}),g.content.nextSteps&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-orange-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"🚀"}),"下一步挑戰"]}),e.jsx("div",{className:"bg-orange-50 rounded-xl p-6 text-lg leading-relaxed text-orange-900",children:C(g.content.nextSteps,"text-lg leading-relaxed text-orange-900")})]}),g.content.encouragement&&e.jsxs("div",{className:"bg-gradient-to-r from-pink-50 to-rose-50 rounded-2xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-pink-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"💪"}),"給你的鼓勵"]}),e.jsx("div",{className:"text-lg leading-relaxed text-pink-900 font-medium",children:C(g.content.encouragement,"text-lg leading-relaxed text-pink-900 font-medium")})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[I?e.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-2xl p-8",children:[e.jsx("div",{className:"text-5xl mb-4",children:"✅"}),e.jsx("h4",{className:"text-2xl font-bold text-green-700 mb-2",children:"學會了！"}),e.jsx("p",{className:"text-green-600",children:"你已經理解了這個概念！"})]}):e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-8",children:[e.jsx("h4",{className:"text-xl font-semibold text-slate-700 mb-4",children:"掌握了這些概念嗎？"}),e.jsxs("button",{onClick:()=>$(g.id),className:"px-8 py-4 bg-blue-500 hover:bg-blue-600 text-white font-bold text-lg rounded-xl transition-colors flex items-center gap-3 mx-auto",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"我學會了！"]})]}),R()&&e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-2xl p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-orange-700 mb-3",children:"想測試一下你的理解嗎？"}),e.jsxs("button",{onClick:S,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-medium text-lg rounded-xl transition-colors flex items-center gap-2 mx-auto",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),"開始練習測驗"]})]})]})]});case"confusing":return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-amber-500 to-orange-500 rounded-3xl shadow-2xl p-12 text-white text-center",children:[e.jsx("div",{className:"text-6xl mb-6",children:"💡"}),e.jsx("div",{className:"text-4xl font-bold mb-6 leading-tight",children:C(g.content.title||g.content.point,"text-4xl font-bold leading-tight text-white")}),g.content.normalizeConfusion&&e.jsx("div",{className:"text-xl text-amber-100 leading-relaxed max-w-3xl mx-auto",children:C(g.content.normalizeConfusion,"text-xl text-amber-100 leading-relaxed")})]}),e.jsxs("div",{className:"space-y-6",children:[g.content.commonMistake&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-red-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"⚠️"}),"常見錯誤"]}),e.jsx("div",{className:"bg-red-50 rounded-xl p-6 text-lg leading-relaxed text-red-900",children:C(g.content.commonMistake,"text-lg leading-relaxed text-red-900")})]}),g.content.whyItHappens&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-amber-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"🤔"}),"為什麼會搞混？"]}),e.jsx("div",{className:"bg-amber-50 rounded-xl p-6 text-lg leading-relaxed text-amber-900",children:C(g.content.whyItHappens,"text-lg leading-relaxed text-amber-900")})]}),g.content.clearExplanation&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-green-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"✨"}),"正確的理解"]}),e.jsx("div",{className:"bg-green-50 rounded-xl p-6 text-lg leading-relaxed text-green-900",children:C(g.content.clearExplanation,"text-lg leading-relaxed text-green-900")})]}),g.content.practiceExamples&&g.content.practiceExamples.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-blue-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"📝"}),"練習範例"]}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6",children:e.jsx("div",{className:"space-y-6",children:g.content.practiceExamples.map((E,q)=>e.jsx("div",{className:"border-l-4 border-blue-400 pl-4",children:e.jsxs("div",{className:"flex items-start mb-3",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-4",children:q+1}),e.jsx("div",{className:"flex-1",children:typeof E=="string"?e.jsx("div",{className:"text-lg text-blue-900 leading-relaxed",children:C(E,"text-lg text-blue-900 leading-relaxed")}):e.jsxs("div",{className:"space-y-3",children:[E.situation&&e.jsxs("div",{children:[e.jsx("strong",{className:"text-blue-800",children:"情境："}),e.jsx("span",{className:"text-blue-900 ml-2",children:C(E.situation,"text-blue-900")})]}),E.wrongThinking&&e.jsxs("div",{children:[e.jsx("strong",{className:"text-red-600",children:"❌ 錯誤想法："}),e.jsx("span",{className:"text-red-700 ml-2",children:C(E.wrongThinking,"text-red-700")})]}),E.rightThinking&&e.jsxs("div",{children:[e.jsx("strong",{className:"text-green-600",children:"✅ 正確想法："}),e.jsx("span",{className:"text-green-700 ml-2",children:C(E.rightThinking,"text-green-700")})]}),E.explanation&&e.jsxs("div",{children:[e.jsx("strong",{className:"text-purple-600",children:"💡 解釋："}),e.jsx("span",{className:"text-purple-700 ml-2",children:C(E.explanation,"text-purple-700")})]})]})})]})},q))})})]}),g.content.rememberingTricks&&g.content.rememberingTricks.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-purple-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"🎯"}),"記憶小技巧"]}),e.jsx("div",{className:"bg-purple-50 rounded-xl p-6",children:e.jsx("div",{className:"space-y-4",children:g.content.rememberingTricks.map((E,q)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-4",children:q+1}),e.jsx("div",{className:"text-lg text-purple-900 leading-relaxed",children:C(E,"text-lg text-purple-900 leading-relaxed")})]},q))})})]}),g.content.confidenceBooster&&e.jsxs("div",{className:"bg-gradient-to-r from-sky-50 to-indigo-50 rounded-2xl p-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-sky-700 mb-6 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"💪"}),"你可以的！"]}),e.jsx("div",{className:"text-lg leading-relaxed text-sky-900 font-medium",children:C(g.content.confidenceBooster,"text-lg leading-relaxed text-sky-900 font-medium")})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[I?e.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-2xl p-8",children:[e.jsx("div",{className:"text-5xl mb-4",children:"✅"}),e.jsx("h4",{className:"text-2xl font-bold text-green-700 mb-2",children:"記住了！"}),e.jsx("p",{className:"text-green-600",children:"你已經掌握了這個重點！"})]}):e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-8",children:[e.jsx("h4",{className:"text-xl font-semibold text-slate-700 mb-4",children:"記住這些重點了嗎？"}),e.jsxs("button",{onClick:()=>$(g.id),className:"px-8 py-4 bg-amber-500 hover:bg-amber-600 text-white font-bold text-lg rounded-xl transition-colors flex items-center gap-3 mx-auto",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"我記住了！"]})]}),R()&&e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-2xl p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-orange-700 mb-3",children:"想測試一下你的記憶嗎？"}),e.jsxs("button",{onClick:S,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-medium text-lg rounded-xl transition-colors flex items-center gap-2 mx-auto",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),"開始練習測驗"]})]})]})]});case"summary":return e.jsxs("div",{className:"text-center space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-12",children:[e.jsx("div",{className:"text-6xl mb-6",children:"🎉"}),e.jsx("h3",{className:"text-3xl font-bold text-green-700 mb-4",children:"恭喜完成學習！"}),e.jsxs("p",{className:"text-lg text-slate-600 mb-8",children:["你已經完成了「",r.topic,"」的學習旅程"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md",children:[e.jsx("div",{className:"text-3xl text-indigo-600 mb-2",children:"📚"}),e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:T}),e.jsx("div",{className:"text-sm text-slate-600",children:"學習步驟完成"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md",children:[e.jsx("div",{className:"text-3xl text-sky-600 mb-2",children:"⏱️"}),e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:Math.round((Date.now()-h.progress.startTime)/6e4)}),e.jsx("div",{className:"text-sm text-slate-600",children:"分鐘學習時間"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md",children:[e.jsx("div",{className:"text-3xl text-green-600 mb-2",children:"🎯"}),e.jsxs("div",{className:"text-2xl font-bold text-slate-800",children:[Math.round(N),"%"]}),e.jsx("div",{className:"text-sm text-slate-600",children:"學習完成度"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-indigo-50 rounded-2xl p-8",children:[e.jsx("h4",{className:"text-2xl font-semibold text-purple-700 mb-6",children:"🚀 繼續挑戰自己"}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[r.onlineInteractiveQuiz&&e.jsxs("a",{href:`/ai-page-gen/quiz?binId=${c}`,className:"px-8 py-4 bg-orange-500 text-white font-medium rounded-xl hover:bg-orange-600 transition-colors flex items-center gap-3 text-lg",target:"_blank",rel:"noopener noreferrer",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),"挑戰互動測驗"]}),r.writingPractice&&e.jsxs("a",{href:`/ai-page-gen/writing?binId=${c}`,className:"px-8 py-4 bg-purple-500 text-white font-medium rounded-xl hover:bg-purple-600 transition-colors flex items-center gap-3 text-lg",target:"_blank",rel:"noopener noreferrer",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"練習寫作技能"]})]})]})]});default:return e.jsx("div",{children:"未知步驟類型"})}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-slate-200 shadow-sm",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-slate-800",children:r.topic}),e.jsxs("p",{className:"text-xs text-slate-500",children:["第 ",b+1," 步，共 ",y.length," 步"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Math.round((Date.now()-h.progress.startTime)/6e4)," 分鐘"]})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1.5 mb-1",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-sky-500 h-1.5 rounded-full transition-all duration-500 ease-out",style:{width:`${(b+1)/y.length*100}%`}})}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-xs text-slate-400",children:["完成 ",T,"/",O," • ",Math.round(N),"%"]})})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-5xl mb-4",children:g.icon}),e.jsx("h2",{className:"text-3xl font-bold text-slate-800 mb-2",children:g.title}),e.jsx("div",{className:"text-lg text-slate-600",children:C(g.description,"text-lg text-slate-600")})]}),e.jsx("div",{className:"mb-8",children:M()}),e.jsxs("div",{className:"flex items-center justify-between pt-8 border-t border-slate-200",children:[e.jsxs("button",{onClick:j,disabled:b===0,className:"flex items-center gap-2 px-6 py-3 bg-slate-500 text-white font-medium rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"上一步"]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-slate-600",children:[b+1," / ",y.length]})}),e.jsxs("button",{onClick:p,disabled:b===y.length-1,className:"flex items-center gap-2 px-6 py-3 bg-indigo-500 text-white font-medium rounded-lg hover:bg-indigo-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["下一步",e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})]}),x&&f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b p-6 flex items-center justify-between rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"📝 步驟練習測驗"}),e.jsx("button",{onClick:z,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-8",children:[f.trueFalse&&f.trueFalse.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"✓"})," 是非判斷題"]}),e.jsx("div",{className:"space-y-4",children:f.trueFalse.map((I,E)=>e.jsx(Te,{question:I,itemNumber:E+1},`tf-${E}`))})]}),f.multipleChoice&&f.multipleChoice.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📝"})," 選擇題"]}),e.jsx("div",{className:"space-y-4",children:f.multipleChoice.map((I,E)=>e.jsx(Be,{question:I,itemNumber:E+1},`mc-${E}`))})]}),f.memoryCardGame&&f.memoryCardGame.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"🧠"})," 記憶卡配對"]}),e.jsx("div",{className:"space-y-4",children:f.memoryCardGame.map((I,E)=>e.jsx(De,{question:I,itemNumber:E+1},`mcg-${E}`))})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-slate-50 p-6 border-t rounded-b-2xl",children:e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:z,className:"px-8 py-3 bg-indigo-500 hover:bg-indigo-600 text-white font-medium rounded-xl transition-colors",children:"完成練習"})})})]})})]})},gs=({turn:s,isCurrentTurn:c,isStudentTurn:r,onPlayComplete:u,showTranslation:n=!1,showHints:o=!1,voiceSettings:t={}})=>{const[m,h]=l.useState(!1),[d,b]=l.useState(!1),[v,y]=l.useState(n),[a,x]=l.useState(o),i=l.useCallback(async()=>{if(m){pe.stopSpeaking();return}try{h(!0),await pe.speak(s.text,{lang:"en-US",rate:.9,...t},void 0,()=>{h(!1),u?.()},L=>{console.error("Speech playback error:",L),h(!1)})}catch(L){console.error("Failed to play speech:",L),h(!1)}},[s.text,m,t,u]),f=L=>{switch(L){case"easy":return"text-green-600 bg-green-50 border-green-200";case"normal":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"hard":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},A=(L,P)=>{let $=L;return P.forEach(w=>{const p=new RegExp(`\\b(${w.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})\\b`,"gi");$=$.replace(p,'<mark class="bg-yellow-200 px-1 rounded">$1</mark>')}),$};return e.jsxs("div",{className:`
      relative rounded-lg border-2 transition-all duration-300 mb-4
      ${c?"border-blue-400 shadow-lg bg-blue-50":"border-gray-200 bg-white"}
      ${r&&c?"border-green-400 bg-green-50":""}
    `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`
            w-10 h-10 rounded-full flex items-center justify-center text-white font-medium
            ${r?"bg-green-500":s.speaker==="Teacher"||s.speaker==="老師"?"bg-blue-500":"bg-gray-500"}
          `,children:s.speaker.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s.speaker,r&&e.jsx("span",{className:"ml-2 text-sm text-green-600 font-normal",children:"(Your turn)"})]}),c&&e.jsx("div",{className:"text-sm text-blue-600",children:"Current conversation turn"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`
            px-2 py-1 text-xs font-medium rounded-full border
            ${f(s.difficulty)}
          `,children:s.difficulty}),e.jsx("button",{onClick:i,disabled:r,className:`
              p-2 rounded-full transition-colors
              ${r?"bg-gray-100 text-gray-400 cursor-not-allowed":m?"bg-red-500 text-white hover:bg-red-600":"bg-blue-500 text-white hover:bg-blue-600"}
            `,title:r?"It's your turn to speak":m?"Stop":"Play audio",children:m?e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}):e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsx("button",{onClick:()=>b(!d),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full",title:"Show/hide details",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"text-lg text-gray-900 leading-relaxed mb-3",children:s.keyWords?.length>0?e.jsx("div",{dangerouslySetInnerHTML:{__html:A(s.text,s.keyWords)}}):s.text}),e.jsx("div",{className:"flex items-center space-x-2 mb-3",children:e.jsx("button",{onClick:()=>y(!v),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:v?"隱藏翻譯":"顯示翻譯"})}),v&&e.jsx("div",{className:"text-gray-600 bg-gray-50 p-3 rounded-lg mb-3 border border-gray-200",children:s.translation}),r&&s.expectedResponseHints&&s.expectedResponseHints.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("button",{onClick:()=>x(!a),className:"text-sm text-green-600 hover:text-green-800 font-medium mb-2",children:a?"隱藏提示":"需要提示？"}),a&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm font-medium text-green-800 mb-2",children:"💡 Response hints:"}),e.jsx("ul",{className:"text-sm text-green-700 space-y-1",children:s.expectedResponseHints.map((L,P)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"•"}),e.jsx("span",{children:L})]},P))})]})]}),d&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"📚 Practice Point:"}),e.jsx("div",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded border border-blue-200",children:s.practicePoint})]}),s.keyWords?.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"🔑 Key Words:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.keyWords.map((L,P)=>e.jsx("span",{className:"px-2 py-1 text-sm bg-yellow-100 text-yellow-800 rounded-full border border-yellow-300",children:L},P))})]}),s.pronunciation&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"🔊 Pronunciation:"}),e.jsx("div",{className:"text-sm text-gray-600 font-mono bg-gray-50 p-2 rounded border border-gray-200",children:s.pronunciation})]})]})]}),c&&e.jsx("div",{className:"absolute -left-1 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-2 h-8 bg-blue-400 rounded-r"})}),r&&c&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"})})]})},Rt=()=>{const[s,c]=l.useState({topic:"",scenario:"",difficulty:"normal",participantCount:2,duration:10,focusAreas:[],culturalContext:""}),[r,u]=l.useState(""),[n,o]=l.useState(!1),[t,m]=l.useState(null),[h,d]=l.useState(null),[b,v]=l.useState(!1),[y,a]=l.useState(""),[x,i]=l.useState(0),f=Se.getConversationTemplates(),A=Se.getDifficultyLevels();l.useEffect(()=>{const p=localStorage.getItem("gemini_api_key");p&&u(p)},[]);const L=p=>{c({...s,topic:p.title,scenario:p.scenario,difficulty:p.suggestedDifficulty,participantCount:p.participants.length})},P=async()=>{if(!r.trim()){m("Please enter your Gemini API key");return}if(!s.topic.trim()||!s.scenario.trim()){m("Please provide both topic and scenario");return}o(!0),m(null);try{localStorage.setItem("gemini_api_key",r);const p=await Se.generateConversationPractice(s);d(p),i(0)}catch(p){console.error("Failed to generate conversation:",p),m("Failed to generate conversation. Please check your API key and try again.")}finally{o(!1)}},$=async()=>{if(h){v(!0),m(null);try{const p={practice:h,metadata:{createdBy:"AI Page Gen",generatedAt:new Date().toISOString()}},j=await as(p),S=`${window.location.origin}/ai-page-gen/conversation-practice/${j}`;a(S)}catch(p){console.error("Failed to share conversation:",p),m("Failed to create shareable link")}finally{v(!1)}}},w=()=>{navigator.clipboard.writeText(y)};return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"英文對話練習生成器"}),e.jsx("p",{className:"text-gray-600",children:"Create interactive English conversation practices for your students"})]}),e.jsxs("a",{href:"/ai-page-gen/",className:"flex items-center gap-2 px-4 py-2 text-indigo-600 bg-white border border-indigo-200 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm",children:[e.jsx(ge,{className:"w-4 h-4"}),"返回首頁"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"API Configuration"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gemini API Key"}),e.jsx("input",{type:"password",value:r,onChange:p=>u(p.target.value),placeholder:"Enter your Gemini API key",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Templates"}),e.jsx("div",{className:"space-y-4",children:f.map(p=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:p.category}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:p.scenarios.slice(0,2).map((j,S)=>e.jsxs("button",{onClick:()=>L(j),className:"text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:j.title}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[j.scenario.substring(0,60),"..."]})]},S))})]},p.category))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Conversation Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Topic *"}),e.jsx("input",{type:"text",value:s.topic,onChange:p=>c({...s,topic:p.target.value}),placeholder:"e.g., Ordering food at a restaurant",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scenario *"}),e.jsx("textarea",{value:s.scenario,onChange:p=>c({...s,scenario:p.target.value}),placeholder:"Detailed description of the conversation context",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty Level"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:A.map(p=>e.jsxs("button",{onClick:()=>c({...s,difficulty:p.level}),className:`p-3 rounded-lg border text-sm transition-colors ${s.difficulty===p.level?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium",children:p.level}),e.jsx("div",{className:"text-xs opacity-75 mt-1",children:p.description.split(" - ")[0]})]},p.level))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Participants"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>c({...s,participantCount:2}),className:`px-4 py-2 rounded-lg border transition-colors ${s.participantCount===2?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white hover:bg-gray-50"}`,children:"2 People"}),e.jsx("button",{onClick:()=>c({...s,participantCount:3}),className:`px-4 py-2 rounded-lg border transition-colors ${s.participantCount===3?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white hover:bg-gray-50"}`,children:"3 People"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Duration (minutes)"}),e.jsx("input",{type:"number",min:"5",max:"30",value:s.duration,onChange:p=>c({...s,duration:parseInt(p.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Focus Areas (optional)"}),e.jsx("input",{type:"text",value:s.focusAreas?.join(", ")||"",onChange:p=>c({...s,focusAreas:p.target.value.split(",").map(j=>j.trim()).filter(j=>j)}),placeholder:"e.g., pronunciation, grammar, vocabulary",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:P,disabled:n||!r.trim(),className:"w-full px-4 py-3 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors flex items-center justify-center space-x-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx("span",{children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),e.jsx("span",{children:"Generate Conversation"})]})})})]}),t&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("svg",{className:"w-5 h-5 text-red-400 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"text-sm text-red-700 mt-1",children:t})]})]})})]}),e.jsx("div",{className:"space-y-6",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Generated Conversation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Title"}),e.jsx("div",{className:"text-blue-700",children:h.title})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"Difficulty"}),e.jsx("div",{className:"text-green-700",children:h.difficulty})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"text-sm font-medium text-purple-800",children:"Duration"}),e.jsxs("div",{className:"text-purple-700",children:[h.duration," min"]})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg border border-orange-200",children:[e.jsx("div",{className:"text-sm font-medium text-orange-800",children:"Turns"}),e.jsx("div",{className:"text-orange-700",children:h.dialogue.length})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Participants"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:h.participants.map((p,j)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-sm",children:p},j))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("div",{className:"text-gray-600 text-sm",children:h.description})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Preview"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>i(Math.max(0,x-1)),disabled:x===0,className:"p-2 text-gray-500 hover:text-gray-700 disabled:text-gray-300 disabled:cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[x+1," / ",h.dialogue.length]}),e.jsx("button",{onClick:()=>i(Math.min(h.dialogue.length-1,x+1)),disabled:x===h.dialogue.length-1,className:"p-2 text-gray-500 hover:text-gray-700 disabled:text-gray-300 disabled:cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})})]})]}),e.jsx(gs,{turn:h.dialogue[x],isCurrentTurn:!0,isStudentTurn:!1,showTranslation:!0,showHints:!0})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Share with Students"}),y?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Shareable Link"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:y,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-l-lg bg-gray-50"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-r-lg",children:"Copy"})]}),e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"Students can use this link to practice the conversation"})]}):e.jsx("button",{onClick:$,disabled:b,className:"w-full px-4 py-3 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white font-medium rounded-lg transition-colors flex items-center justify-center space-x-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx("span",{children:"Creating Share Link..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.50-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92S19.61 16.08 18 16.08z"})}),e.jsx("span",{children:"Create Share Link"})]})})]})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"💬"}),e.jsx("div",{className:"text-gray-600",children:"Generate a conversation to see the preview"})]})})]})]})})},Tt=({targetText:s,onRecordingComplete:c,onRecordingStart:r,onRecordingStop:u,disabled:n=!1,language:o="en-US",placeholder:t="Click to start recording..."})=>{const[m,h]=l.useState(!1),[d,b]=l.useState(""),[v,y]=l.useState(0),[a,x]=l.useState(!0),[i,f]=l.useState(null),[A,L]=l.useState(0),P=l.useRef(null),$=l.useRef([]),w=l.useRef(0),p=l.useRef({text:"",confidence:0});l.useEffect(()=>{const W=pe.getSupportStatus();return x(W.sttSupported),W.sttSupported||f("Your browser does not support speech recognition"),()=>{w.current&&cancelAnimationFrame(w.current)}},[]);const j=async()=>{if(!(!a||n))try{f(null),b(""),y(0),$.current=[];const W=await navigator.mediaDevices.getUserMedia({audio:!0}),C=new MediaRecorder(W);P.current=C,C.ondataavailable=g=>{g.data.size>0&&$.current.push(g.data)},C.start(),await pe.startRecording({lang:o,continuous:!1,interimResults:!0},g=>{b(g.text),y(g.confidence),p.current={text:g.text,confidence:g.confidence},console.log("VoiceRecorder: Speech recognition result:",g)},g=>{console.error("Speech recognition error:",g),f("Speech recognition failed. Please try again."),S()},()=>{r?.(),h(!0)},()=>{h(!1),u?.(),setTimeout(()=>{const g=p.current.text,T=p.current.confidence;console.log("🔴 VoiceRecorder: Preparing callback with:",{finalText:g,finalConfidence:T}),console.log("🔴 VoiceRecorder: About to call onRecordingComplete"),console.log("🔴 VoiceRecorder: Triggering onRecordingComplete NOW"),c({text:g,confidence:T,audioBlob:void 0}),P.current&&P.current.state!=="inactive"&&(P.current.stop(),P.current.onstop=()=>{const O=$.current.length>0?new Blob($.current,{type:"audio/wav"}):void 0;O&&(console.log("VoiceRecorder: Updating with audio blob"),c({text:g,confidence:T,audioBlob:O}))})},200)}),z(W)}catch(W){console.error("Failed to start recording:",W),f("Failed to access microphone. Please check permissions.")}},S=()=>{m&&(pe.stopRecording(),L(0),w.current&&cancelAnimationFrame(w.current))},z=W=>{const C=new AudioContext,g=C.createAnalyser();C.createMediaStreamSource(W).connect(g),g.fftSize=256;const O=g.frequencyBinCount,N=new Uint8Array(O),M=()=>{if(!m)return;g.getByteFrequencyData(N);const I=N.reduce((E,q)=>E+q,0)/O;L(I/255),w.current=requestAnimationFrame(M)};M()},R=()=>{const W="relative flex items-center justify-center w-16 h-16 rounded-full transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-offset-2";return n?e.jsx("button",{className:`${W} bg-gray-300 cursor-not-allowed`,disabled:!0,children:e.jsx("svg",{className:"w-6 h-6 text-gray-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})})}):m?e.jsxs("button",{onClick:S,className:`${W} bg-red-500 hover:bg-red-600 text-white focus:ring-red-300 animate-pulse`,style:{transform:`scale(${1+A*.3})`},children:[e.jsx("div",{className:"w-4 h-4 bg-white rounded-sm"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-red-300",style:{transform:`scale(${1.2+A*.5})`,opacity:A*.7}})]}):e.jsx("button",{onClick:j,className:`${W} bg-blue-500 hover:bg-blue-600 text-white focus:ring-blue-300`,children:e.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})})})};return a?e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[R(),e.jsx("div",{className:"text-sm text-gray-600 text-center",children:m?e.jsx("span",{className:"text-red-600 font-medium",children:"Recording..."}):t})]}),d&&e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"You said:"}),e.jsxs("div",{className:"text-gray-900",children:['"',d,'"']}),v>0&&e.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Confidence:"}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${v>.8?"bg-green-500":v>.6?"bg-yellow-500":"bg-red-500"}`,style:{width:`${v*100}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(v*100),"%"]})]})]})}),i&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 px-3 py-2 rounded-lg border border-red-200",children:i}),s&&d&&e.jsxs("div",{className:"w-full max-w-md text-xs text-gray-500 bg-blue-50 p-3 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"font-medium mb-1",children:"Expected:"}),e.jsxs("div",{className:"text-blue-700",children:['"',s,'"']})]})]}):e.jsxs("div",{className:"flex flex-col items-center space-y-2 p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-red-600 text-sm font-medium",children:"Speech recognition not supported"}),e.jsx("div",{className:"text-red-500 text-xs text-center",children:"Please use Chrome, Edge, or Safari for voice recording"})]})},Bt=()=>{const{binId:s}=Cs(),c=Ls(),[r,u]=l.useState(null),[n,o]=l.useState(null),[t,m]=l.useState(!0),[h,d]=l.useState(null),[b,v]=l.useState(0),[y,a]=l.useState(!1),[x,i]=l.useState(null),[f,A]=l.useState(!1),[L,P]=l.useState(""),[$,w]=l.useState(""),[p,j]=l.useState(null),[S,z]=l.useState([]),[R,W]=l.useState(0),C=(k,D)=>{const H=me=>me.toLowerCase().replace(/[^\w\s]/g,"").trim(),Q=H(k).split(/\s+/),Y=H(D).split(/\s+/);if(Q.length===0||Y.length===0)return 0;let X=0;const xe=new Set(Q);Y.forEach(me=>{xe.has(me)?X++:Q.forEach(fe=>{fe.length>=3&&me.length>=3&&(fe.includes(me)||me.includes(fe))&&(X+=.5)})});const ce=Math.max(Q.length,Y.length);return Math.min(X/ce,1)},g=async k=>{try{await pe.speak(k,{lang:"en-US",rate:.8,pitch:1,volume:1})}catch(D){console.error("Failed to play demonstration:",D)}},T=()=>{p?.audioBlob&&new Audio(URL.createObjectURL(p.audioBlob)).play().catch(D=>{console.error("Failed to play recording:",D)})},O=k=>k>=.8?"text-green-600":k>=.6?"text-yellow-600":"text-red-600",N=k=>{const D=k.split(/[.!?]+/).filter(Y=>Y.trim().length>0),H=[];for(const Y of D){const X=Y.trim();if(X.length>50){const xe=X.split(",").filter(ce=>ce.trim().length>0);xe.length>1?H.push(...xe.map(ce=>ce.trim())):H.push(X)}else X.length>0&&H.push(X)}return H.length>0?H:[k.trim()]},M=l.useCallback(async()=>{if(!s){d("No practice ID provided"),m(!1);return}try{const k=await Ys(s);if(k.type!=="conversation-practice"){d("This is not a conversation practice link"),m(!1);return}u(k.practice),k.practice.participants.length>0&&P(k.practice.participants[0]),m(!1)}catch(k){console.error("Failed to load conversation practice:",k),d("Failed to load conversation practice"),m(!1)}},[s]);l.useEffect(()=>{M()},[M]),l.useEffect(()=>{const k=D=>{if(!r||!n)return;const H=r.dialogue[D];if(!H||H.speaker!==n.studentRole)return;const Q=N(H.text),Y=S.length===0||JSON.stringify(Q)!==JSON.stringify(S);z(Q),Y&&(W(0),Q.length>0&&w(Q[0]))};if(n&&r&&r.dialogue.length>0){const D=r.dialogue[b];D&&D.speaker===n.studentRole?k(b):(z([]),W(0),w(""))}},[S,n,r,b]);const I=()=>{if(!r||!L)return;const k={practiceId:r.id,startTime:Date.now(),currentTurnIndex:0,studentRole:L,responses:[],completed:!1};o(k),v(0),a(!1)},E=k=>!r||!n?!1:r.dialogue[k]?.speaker===n.studentRole,q=async k=>{const D=S.length>0?S[R]:$;if(!(!r||!n||!D)){A(!0);try{const H=C(D,k.text),Q={text:k.text,audioBlob:k.audioBlob,similarity:H};j(Q);const X={turnId:r.dialogue[b].id,text:k.text,confidence:k.confidence,audioBlob:k.audioBlob,timestamp:Date.now()},xe={...n,responses:[...n.responses,X]};o(xe)}catch(H){console.error("Failed to process student response:",H)}finally{A(!1)}}},J=()=>{if(!(!r||!n)){if(a(!1),i(null),R<S.length-1){const k=R+1,D=S[k];j(null),W(k),w(D);return}if(b<r.dialogue.length-1){const k=b+1;j(null),z([]),W(0),w(""),v(k)}else F()}},F=()=>{if(!n)return;const k={...n,completed:!0};o(k)};if(t)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{}),e.jsx("div",{className:"mt-4 text-gray-600",children:"Loading conversation practice..."})]})});if(h)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx("div",{className:"text-red-600 text-lg font-medium mb-2",children:"Error"}),e.jsx("div",{className:"text-gray-600 mb-4",children:h}),e.jsx("button",{onClick:()=>c("/"),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Back to Home"})]})});if(!r)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-gray-600",children:"No conversation found"})})});if(!n)return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:r.title}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:["難度：",r.difficulty==="easy"?"簡單":r.difficulty==="normal"?"普通":"困難"]}),e.jsxs("span",{children:[r.duration," 分鐘"]}),e.jsxs("span",{children:[r.dialogue.length," 個對話輪次"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"📖 情境說明"}),e.jsx("p",{className:"text-gray-700 mb-4",children:r.scenario}),e.jsx("p",{className:"text-gray-600",children:r.description})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"🎭 選擇您的角色"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.participants.map(k=>e.jsxs("button",{onClick:()=>P(k),className:`p-4 border rounded-lg text-left transition-all ${L===k?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:k}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["您將扮演 ",k," 的角色"]})]},k))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"🎯 學習目標"}),e.jsx("ul",{className:"space-y-2",children:r.practiceGoals.map((k,D)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-green-500 mr-2 mt-0.5",children:"✓"}),e.jsx("span",{className:"text-gray-700",children:k})]},D))})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:I,disabled:!L,className:`px-8 py-3 rounded-lg font-medium transition-colors ${L?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"開始練習"})})]})});if(n.completed)return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 text-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[e.jsx("div",{className:"text-green-600 text-6xl mb-4",children:"🎉"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"恭喜完成！"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"您已經完成了英文對話練習，表現很棒！"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.responses.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"回答次數"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Math.round((Date.now()-n.startTime)/1e3/60)}),e.jsx("div",{className:"text-sm text-gray-600",children:"練習分鐘"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r.difficulty==="easy"?"簡單":r.difficulty==="normal"?"普通":"困難"}),e.jsx("div",{className:"text-sm text-gray-600",children:"難度等級"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:n.studentRole}),e.jsx("div",{className:"text-sm text-gray-600",children:"扮演角色"})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsx("button",{onClick:()=>{o(null),v(0)},className:"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium",children:"再練習一次"}),e.jsx("button",{onClick:()=>c("/"),className:"px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium",children:"返回首頁"})]})]})})});const U=r.dialogue[b],Z=E(b);return e.jsx("div",{className:"min-h-screen bg-gray-50 py-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"font-semibold text-gray-900",children:r.title}),e.jsxs("span",{className:"text-sm text-gray-600",children:[b+1," / ",r.dialogue.length]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${(b+1)/r.dialogue.length*100}%`}})})]}),e.jsx(gs,{turn:U,isCurrentTurn:!0,isStudentTurn:Z,showTranslation:!1,showHints:Z}),Z?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"🎤 輪到您開口說話了"}),S.length>1&&e.jsxs("p",{className:"text-blue-600 text-sm mb-2",children:["第 ",R+1," 段 / 共 ",S.length," 段"]}),e.jsx("p",{className:"text-gray-600",children:"點擊下方句子練習發音，然後錄音"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-800 mb-3",children:"📝 請練習這個句子："}),S.length>1&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"完整句子："}),e.jsx("div",{className:"text-blue-900",children:U.text})]}),$?e.jsx("div",{className:"p-4 border-2 border-green-500 bg-green-50 rounded-lg cursor-pointer transition-colors",onClick:()=>w($),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-900 text-lg font-medium",children:$}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:k=>{k.stopPropagation(),g($)},className:"p-2 text-blue-500 hover:bg-blue-100 rounded-full transition-colors",title:"播放示範發音",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})})]})}):e.jsx("div",{className:"p-4 border-2 border-gray-300 bg-gray-50 rounded-lg",children:e.jsx("div",{className:"text-gray-500 text-center",children:"正在載入句子..."})}),U.translation&&e.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-yellow-700 mb-1",children:"💡 中文意思："}),e.jsx("div",{className:"text-yellow-900",children:U.translation})]})]}),$&&e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"🎙️ 開始錄音練習"}),e.jsx(Tt,{targetText:S.length>0?S[R]:$,onRecordingComplete:q,onRecordingStart:()=>{},onRecordingStop:()=>{},disabled:f,language:"en-US",placeholder:"點擊錄音按鈕開始練習"})]}),p&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"📝 您說的內容："}),p.audioBlob&&e.jsxs("button",{onClick:T,className:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),"播放錄音"]})]}),e.jsxs("div",{className:"text-gray-800 mb-3 p-2 bg-white rounded border",children:['"',p.text,'"']}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 mr-2",children:"發音準確度："}),e.jsxs("span",{className:`font-medium ${O(p.similarity||0)}`,children:[Math.round((p.similarity||0)*100),"%"]}),(p.similarity||0)>=.8&&e.jsx("span",{className:"ml-2",children:"🎉 很棒！"}),(p.similarity||0)>=.6&&(p.similarity||0)<.8&&e.jsx("span",{className:"ml-2",children:"👍 不錯！"}),(p.similarity||0)<.6&&e.jsx("span",{className:"ml-2",children:"💪 再加油！"})]}),!p.audioBlob&&e.jsx("div",{className:"text-xs text-red-500 mt-2",children:"錄音音頻不可用"})]}),p&&(p.similarity||0)>=.6&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:J,className:"px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-medium rounded-lg transition-colors flex items-center gap-2 mx-auto",children:[e.jsx("span",{children:"✅ 很好！"}),e.jsx("span",{children:(()=>{const k=R>=S.length-1,D=b>=(r?.dialogue.length||0)-1;return k?D?"完成所有練習":"完成這輪，繼續下一輪對話":`練習下一段 (${R+2}/${S.length})`})()})]})}),p&&(p.similarity||0)<.6&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-yellow-800 mb-3",children:"🎯 建議：請再次聽取示範發音，並嘗試更清楚地說出句子"}),e.jsx("button",{onClick:()=>j(null),className:"px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white text-sm rounded transition-colors",children:"🔄 重新錄音"})]})]})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["🎧 聆聽 ",U.speaker," 說話"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"請仔細聽對方的發音和語調，為下次練習做準備"}),e.jsxs("button",{onClick:J,className:"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium flex items-center gap-2 mx-auto",children:[e.jsx("span",{children:"👂 我聽清楚了"}),e.jsx("span",{children:"→"}),e.jsx("span",{children:"繼續"})]})]}),f&&e.jsxs("div",{className:"text-center mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(le,{}),e.jsx("div",{className:"text-sm text-blue-600 mt-2",children:"🔄 正在分析您的發音..."})]})]})})},Dt=({isOpen:s,onClose:c,providers:r,onShareCreated:u})=>{const[n,o]=l.useState(""),[t,m]=l.useState(""),[h,d]=l.useState(""),[b,v]=l.useState([]),[y,a]=l.useState(!1),[x,i]=l.useState(""),[f,A]=l.useState("");V.useEffect(()=>{if(r.length>0&&b.length===0){const R=r.filter(W=>W.enabled&&W.apiKey);v(R.map(W=>W.id))}},[r,b.length]);const L=V.useMemo(()=>Ue.validatePasswordStrength(h),[h]),P=l.useCallback(()=>{const R=Ue.generateRandomPassword();d(R)},[]),$=l.useCallback(R=>{v(W=>W.includes(R)?W.filter(C=>C!==R):[...W,R])},[]),w=l.useCallback(async()=>{if(!n.trim()){A("請輸入分享名稱");return}if(!h){A("請設定分享密碼");return}if(!L.isValid){A("密碼強度不足");return}if(b.length===0){A("請至少選擇一個 Provider");return}a(!0),A("");try{const R=r.filter(g=>b.includes(g.id)),W=await he.createEncryptedShare(R,n,h,t||void 0),C=he.generateShareUrl(W);i(C),u?.(C)}catch(R){A(R.message||"創建分享失敗")}finally{a(!1)}},[n,h,t,b,r,L.isValid,u]),p=l.useCallback(async()=>{try{await navigator.clipboard.writeText(x)}catch(R){console.error("複製失敗:",R)}},[x]),j=l.useCallback(async()=>{try{await navigator.clipboard.writeText(h)}catch(R){console.error("複製密碼失敗:",R)}},[h]);if(!s)return null;const S=r.filter(R=>R.enabled&&R.apiKey),z=he.generateShareStats(r.filter(R=>b.includes(R.id)));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"分享 Provider 配置"}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"×"})]}),x?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"分享創建成功！"}),e.jsx("p",{className:"text-gray-600",children:"您的 Provider 配置已安全加密並準備分享"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分享連結"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,readOnly:!0,className:"flex-1 px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-sm"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"複製"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"解密密碼"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,readOnly:!0,className:"flex-1 px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-sm font-mono"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm font-medium",children:"複製"})]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800 mb-1",children:"重要提醒"}),e.jsxs("ul",{className:"text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• 請將分享連結和密碼分別傳送給接收者"}),e.jsx("li",{children:"• 密碼包含敏感的 API Key 信息，請妥善保管"}),e.jsx("li",{children:"• 建議通過安全通道（如加密聊天）分享密碼"})]})]})]})}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium",children:"完成"})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分享名稱 *"}),e.jsx("input",{type:"text",value:n,onChange:R=>o(R.target.value),placeholder:"例如：我的 AI 助手配置",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分享描述（可選）"}),e.jsx("textarea",{value:t,onChange:R=>m(R.target.value),placeholder:"描述這個配置的用途和特點...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分享密碼 *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:h,onChange:R=>d(R.target.value),placeholder:"設定一個強密碼來保護您的配置",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{onClick:P,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium",children:"生成"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium",children:"複製"})]}),h&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${L.score>=4?"bg-green-500":L.score>=3?"bg-yellow-500":"bg-red-500"}`,style:{width:`${L.score/5*100}%`}})}),e.jsx("span",{className:`text-sm font-medium ${L.score>=4?"text-green-600":L.score>=3?"text-yellow-600":"text-red-600"}`,children:L.score>=4?"強":L.score>=3?"中":"弱"})]}),L.feedback.length>0&&e.jsx("ul",{className:"mt-1 text-xs text-gray-600",children:L.feedback.map((R,W)=>e.jsxs("li",{children:["• ",R]},W))})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"選擇要分享的 Provider"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["已選擇 ",b.length," / ",S.length]})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:S.map(R=>e.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:b.includes(R.id),onChange:()=>$(R.id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:R.name}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:R.type})]}),R.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:R.description})]})]},R.id))}),S.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"沒有可用的 Provider 配置"}),e.jsx("p",{className:"text-sm mt-1",children:"請先配置至少一個 Provider 並確保已啟用"})]})]}),b.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"分享預覽"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Provider 數量:"}),e.jsx("span",{className:"ml-2 font-medium",children:z.totalProviders})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"安全級別:"}),e.jsx("span",{className:"ml-2 font-medium text-green-600",children:z.securityLevel==="high"?"高":"中"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-blue-700",children:"包含類型:"}),e.jsx("span",{className:"ml-2",children:Object.keys(z.providerTypes).join(", ")})]})]})]}),f&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:f}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"取消"}),e.jsx("button",{onClick:w,disabled:y||b.length===0||!L.isValid,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:y?"創建中...":"創建分享"})]})]})]})})})},us=({binId:s,onProviderImported:c,onClose:r})=>{const[u,n]=l.useState(""),[o,t]=l.useState(!1),[m,h]=l.useState(""),[d,b]=l.useState(null),[v,y]=l.useState(null),[a,x]=l.useState(0),[i,f]=l.useState("preview");V.useEffect(()=>{(async()=>{try{t(!0);const p=await he.getSharePreview(s);b(p),f("password")}catch(p){h(p.message||"載入分享信息失敗")}finally{t(!1)}})()},[s]);const A=l.useCallback(async()=>{if(!u.trim()){h("請輸入分享密碼");return}t(!0),h("");try{const w=await he.loadEncryptedShare(s,u),p=he.validateShareData(w);if(!p.isValid)throw new Error(`分享數據無效: ${p.errors.join(", ")}`);y(w),f("import")}catch(w){h(w.message||"解密失敗，請檢查密碼是否正確")}finally{t(!1)}},[s,u]),L=l.useCallback(async()=>{if(v){t(!0),h("");try{const w=he.createProviderConfigsFromShare(v);let p=0;for(const j of w)try{await re.addProvider(j),p++}catch(S){console.error(`導入 Provider ${j.name} 失敗:`,S)}x(p),f("success"),c?.(p)}catch(w){h(w.message||"導入 Provider 配置失敗")}finally{t(!1)}}},[v,c]),P=w=>new Date(w).toLocaleString("zh-TW"),$=w=>{switch(w){case"gemini":return"Google Gemini";case"openrouter":return"OpenRouter";default:return w}};return i==="preview"&&o?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"載入分享信息中..."})]})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"接收 Provider 配置分享"}),e.jsx("p",{className:"text-gray-600",children:"安全地導入他人分享的 AI Provider 配置"})]}),m&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:m}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:`flex items-center gap-2 ${i==="password"?"text-blue-600":i==="import"||i==="success"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${i==="password"?"bg-blue-600 text-white":i==="import"||i==="success"?"bg-green-600 text-white":"bg-gray-300"}`,children:"1"}),e.jsx("span",{className:"text-sm font-medium",children:"輸入密碼"})]}),e.jsx("div",{className:`w-12 h-0.5 ${i==="import"||i==="success"?"bg-green-600":"bg-gray-300"}`}),e.jsxs("div",{className:`flex items-center gap-2 ${i==="import"?"text-blue-600":i==="success"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${i==="import"?"bg-blue-600 text-white":i==="success"?"bg-green-600 text-white":"bg-gray-300"}`,children:"2"}),e.jsx("span",{className:"text-sm font-medium",children:"確認導入"})]}),e.jsx("div",{className:`w-12 h-0.5 ${i==="success"?"bg-green-600":"bg-gray-300"}`}),e.jsxs("div",{className:`flex items-center gap-2 ${i==="success"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${i==="success"?"bg-green-600 text-white":"bg-gray-300"}`,children:"3"}),e.jsx("span",{className:"text-sm font-medium",children:"完成"})]})]})}),d&&e.jsxs("div",{className:"mb-6 bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-3",children:"分享信息"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"分享名稱:"}),e.jsx("span",{className:"ml-2 font-medium",children:d.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Provider 數量:"}),e.jsx("span",{className:"ml-2 font-medium",children:d.providerCount})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"分享時間:"}),e.jsx("span",{className:"ml-2",children:P(d.createdAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"安全性:"}),e.jsx("span",{className:"ml-2 text-green-600 font-medium",children:d.hasEncryption?"✓ 已加密":"⚠️ 未加密"})]}),d.description&&e.jsxs("div",{className:"col-span-1 sm:col-span-2",children:[e.jsx("span",{className:"text-blue-700",children:"描述:"}),e.jsx("p",{className:"ml-2 mt-1",children:d.description})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2",children:[e.jsx("span",{className:"text-blue-700",children:"包含類型:"}),e.jsx("div",{className:"ml-2 mt-1 flex flex-wrap gap-1",children:d.providerTypes.map(w=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:$(w)},w))})]})]})]}),i==="password"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"請輸入分享密碼"}),e.jsx("input",{type:"password",value:u,onChange:w=>n(w.target.value),placeholder:"輸入分享者提供的密碼",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:w=>w.key==="Enter"&&A()}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"密碼用於解密 Provider 配置中的 API Key 等敏感信息"})]}),e.jsxs("div",{className:"flex gap-3",children:[r&&e.jsx("button",{onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"取消"}),e.jsx("button",{onClick:A,disabled:o||!u.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:o?"解密中...":"解密並預覽"})]})]}),i==="import"&&v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"確認要導入的 Provider 配置"}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:v.providers.map((w,p)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:$(w.type)}),e.jsx("span",{className:"font-medium",children:w.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",w.model,")"]})]}),w.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:w.description}),e.jsx("div",{className:"mt-2 text-xs text-green-600",children:"✓ API Key 已包含並加密保護"})]},p))})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800 mb-1",children:"導入說明"}),e.jsxs("ul",{className:"text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• 這些配置將添加到您現有的 Provider 列表中"}),e.jsx("li",{children:'• 如果已存在同名配置，將創建帶有"分享的"前綴的新配置'}),e.jsx("li",{children:"• 您可以在導入後修改或刪除這些配置"})]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>f("password"),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"返回"}),e.jsx("button",{onClick:L,disabled:o,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:o?"導入中...":"確認導入"})]})]}),i==="success"&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"導入成功！"}),e.jsxs("p",{className:"text-gray-600",children:["已成功導入 ",a," 個 Provider 配置"]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-green-700",children:"您現在可以在 Provider 設定中查看和使用這些新配置。 建議您檢查並測試這些配置以確保正常工作。"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("a",{href:"/ai-page-gen/",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-center",children:"返回首頁"}),r&&e.jsx("button",{onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"關閉"})]})]})]})})})};class te extends l.Component{constructor(c){super(c),this.state={hasError:!1}}static getDerivedStateFromError(c){return{hasError:!0,error:c}}componentDidCatch(c,r){console.error("Error Boundary caught an error:",c,r),this.setState({error:c,errorInfo:r})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"應用程式發生錯誤"}),e.jsx("p",{className:"text-sm text-gray-500",children:"很抱歉，頁面遇到了未預期的錯誤"})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"錯誤詳情："}),e.jsx("p",{className:"text-sm text-red-700 font-mono break-all",children:this.state.error?.message||"未知錯誤"})]}),this.state.errorInfo&&e.jsxs("details",{className:"mb-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 cursor-pointer hover:text-gray-900",children:"詳細錯誤堆疊 (點擊展開)"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-600 bg-gray-50 p-3 rounded border overflow-auto max-h-40",children:this.state.errorInfo.componentStack})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"重新載入頁面"}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"重試"})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[e.jsx("p",{children:"如果問題持續發生，請檢查："}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"瀏覽器控制台是否有其他錯誤訊息"}),e.jsx("li",{children:"網路連接是否正常"}),e.jsx("li",{children:"API 設定是否正確"})]})]})]})}):this.props.children}}const we="gemini_api_key";let ts=!1;const rs=()=>{const[s]=ke(),c=s.get("binId"),r=s.get("provider_share"),[u,n]=V.useState(null),[o,t]=V.useState(!1),[m,h]=V.useState(""),[d,b]=V.useState(null),[v,y]=V.useState(!1);V.useEffect(()=>{if(!r){if(!c){h("缺少 binId");return}t(!0),ls(c).then(i=>{n(i),a(i,c)}).catch(i=>h(i.message||"讀取失敗")).finally(()=>t(!1))}},[c,r]);const a=async(i,f)=>{try{if(await ne.init(),await ne.getLessonPlan(`shared_${f}`)){await ne.updateLastAccessed(`shared_${f}`);return}const L={id:`shared_${f}`,topic:i.topic||"分享的教案",createdAt:new Date().toISOString(),lastAccessedAt:new Date().toISOString(),content:{learningObjectives:i.learningObjectives,contentBreakdown:i.contentBreakdown,confusingPoints:i.confusingPoints,classroomActivities:i.classroomActivities,quiz:i.onlineInteractiveQuiz,writingPractice:i.writingPractice},metadata:{totalSections:[i.learningObjectives,i.contentBreakdown,i.confusingPoints,i.classroomActivities,i.onlineInteractiveQuiz,i.writingPractice].filter(Boolean).length,hasQuiz:!!i.onlineInteractiveQuiz,hasWriting:!!i.writingPractice,isShared:!0,sharedBinId:f}};await ne.saveLessonPlan(L),console.log(`分享教案已儲存到本地: ${i.topic||"分享的教案"} (${f})`)}catch(A){console.error("儲存分享教案到本地存儲失敗:",A)}};V.useEffect(()=>{const i=localStorage.getItem(we);i?b(i):y(!0)},[]);const x=i=>{localStorage.setItem(we,i),b(i),y(!1)};return o?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center my-10",children:e.jsx(le,{})})}):m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"my-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg shadow-md",children:m})})}):r?e.jsx(te,{children:e.jsx(us,{binId:r,onProviderImported:i=>{console.log(`已導入 ${i} 個 Provider 配置`)}})}):u?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:[e.jsx(hs,{isOpen:v,onSave:x}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("a",{href:"/ai-page-gen/",className:"inline-flex items-center gap-2 px-4 py-2 text-indigo-600 bg-white border border-indigo-200 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm",children:[e.jsx(ge,{className:"w-4 h-4"}),"返回首頁"]})}),!d&&!v&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-yellow-600 mt-0.5 flex-shrink-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m0 0c.652-.286 1.323-.443 2.25-.443 1.38 0 2.652.24 3.75.697v-6a6 6 0 0 0-6 2.243M12 15.75V21m0-5.25c1.38 0 2.652-.24 3.75-.697v6a6 6 0 0 1-3.75-2.243M12 15.75L9 12"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-800 font-medium text-sm",children:"需要設定 API Key 以使用分享功能"}),e.jsx("p",{className:"text-yellow-700 text-xs mt-1",children:"設定後可分享測驗和寫作練習給學生，包含 AI 功能"})]})]}),e.jsx("button",{onClick:()=>y(!0),className:"px-3 py-1 bg-yellow-600 text-white rounded hover:bg-yellow-700 text-sm",children:"設定 API Key"})]})}),e.jsx(te,{children:e.jsx(Ve,{content:u,topic:u.topic||"",selectedLevel:u.selectedLevel||null,selectedVocabularyLevel:u.selectedVocabularyLevel,apiKey:d||void 0,onContentUpdate:n})})]})]}):null},Ot=()=>{const[s,c]=l.useState(""),[r,u]=l.useState(null),[n,o]=l.useState(!1),[t,m]=l.useState(null),[h,d]=l.useState(null),[b,v]=l.useState(!1),[y,a]=l.useState(null),[x,i]=l.useState(!1),[f,A]=l.useState([]),[L,P]=l.useState(null),[$,w]=l.useState(null),[p,j]=l.useState(!1),[S,z]=l.useState(Ne[0]),[R,W]=l.useState(!1),[C,g]=l.useState(!1),[T,O]=l.useState(null);V.useEffect(()=>{(async()=>{const D=he.parseShareUrl();if(D.type==="legacy"&&D.value){localStorage.setItem(we,D.value),d(D.value),v(!1);const Q=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,Q);return}if(!ts)try{await Bs(),ts=!0}catch(Q){console.error("Provider 系統初始化失敗:",Q)}if(D.type==="provider"&&D.value){O(D.value);try{const Q=await re.getProviders();A(Q)}catch(Q){console.error("載入 Providers 失敗:",Q)}return}const H=localStorage.getItem(we);H?d(H):await Ds().catch(()=>!1)||v(!0);try{const Q=await re.getProviders();A(Q)}catch(Q){console.error("載入 Providers 失敗:",Q)}})()},[]);const N=k=>{localStorage.setItem(we,k),d(k),v(!1)},M=async(k,D)=>{try{await ne.init();const H=Xs(D,k);await ne.saveLessonPlan(H)}catch(H){console.error("保存教案到本地存儲失敗:",H)}},I=l.useCallback(async()=>{if(!s.trim()){m("請輸入學習主題。");return}const k=await re.hasConfiguredProviders();if(!k&&!h){m("請先配置 AI Provider 或設定 API 金鑰。"),v(!0);return}o(!0),m(null),P(null),u(null),w(null),z(Ne[0]),W(!1);const D=$s(s);g(D);try{const Q=await Es(s,k?"provider-system-placeholder-key":"");P(Q),j(!0),D&&W(!0)}catch(H){console.error(H),m(H.message||"產生學習程度建議時發生未知錯誤。")}finally{o(!1)}},[s,h]),E=l.useCallback(async k=>{const D=await re.hasConfiguredProviders();if(!D&&!h){m("請先配置 AI Provider 或設定 API 金鑰。"),v(!0);return}if(C&&!S){m("請先選擇英語單字程度。");return}o(!0),m(null),w(k),u(null);try{let H;const Q=D?"provider-system-placeholder-key":h;if(Q===null)throw new Error("無API KEY 可用！");C&&S?H=await zs(s,k,S,Q):H=await Rs(s,k,Q),u(H),j(!1),W(!1),await M(H,s)}catch(H){console.error(H),m(H.message||"產生學習內容時發生未知錯誤。")}finally{o(!1)}},[s,h,C,S]),q=l.useCallback(async()=>{if(!s.trim()){m("請輸入學習主題。");return}const k=await re.hasConfiguredProviders();if(!k&&!h){m("請先配置 AI Provider 或設定 API 金鑰。"),v(!0);return}o(!0),m(null),u(null),j(!1),W(!1),g(!1);try{const H=await Ts(s,k?"provider-system-placeholder-key":"");u(H),await M(H,s)}catch(D){console.error(D),m(D.message||"產生內容時發生未知錯誤。"),u(null)}finally{o(!1)}},[s,h]),J=async()=>{if(!h){a("請先設定 API 金鑰");return}const k=he.createLegacyShare(h);try{await navigator.clipboard.writeText(k),a("已複製分享連結！")}catch{a("複製失敗，請手動複製")}setTimeout(()=>a(null),2e3)},F=l.useCallback(()=>{i(!0)},[]),U=l.useCallback(k=>{a("Provider 配置分享已創建！"),i(!1),setTimeout(()=>a(null),3e3)},[]),Z=l.useCallback(k=>{console.log(`已導入 ${k} 個 Provider 配置`),window.location.href=`${window.location.origin}/ai-page-gen/`},[]);return T?e.jsx(te,{children:e.jsx(us,{binId:T,onProviderImported:Z,onClose:()=>{window.location.href=`${window.location.origin}/ai-page-gen/`}})}):e.jsx(Is,{basename:"/ai-page-gen/",children:e.jsx(te,{children:e.jsxs(As,{children:[e.jsx(ae,{path:"share",element:e.jsx(te,{children:e.jsx(rs,{})})}),e.jsx(ae,{path:"provider-share",element:e.jsx(te,{children:e.jsx(rs,{})})}),e.jsx(ae,{path:"quiz",element:e.jsx(te,{children:e.jsx(At,{})})}),e.jsx(ae,{path:"writing",element:e.jsx(te,{children:e.jsx(Pt,{})})}),e.jsx(ae,{path:"student-results",element:e.jsx(te,{children:e.jsx($t,{})})}),e.jsx(ae,{path:"lesson-plans",element:e.jsx(te,{children:e.jsx(Et,{})})}),e.jsx(ae,{path:"interactive-learning",element:e.jsx(te,{children:e.jsx(it,{})})}),e.jsx(ae,{path:"teacher-interactive-prep",element:e.jsx(te,{children:e.jsx(ot,{})})}),e.jsx(ae,{path:"student-interactive",element:e.jsx(te,{children:e.jsx(zt,{})})}),e.jsx(ae,{path:"conversation-prep",element:e.jsx(te,{children:e.jsx(Rt,{})})}),e.jsx(ae,{path:"conversation-practice/:binId",element:e.jsx(te,{children:e.jsx(Bt,{})})}),e.jsx(ae,{path:"/",element:e.jsx(te,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:[e.jsx(hs,{isOpen:b,onSave:N}),e.jsxs("header",{className:"text-center mb-10",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-extrabold text-sky-700 tracking-tight",children:["AI 學習頁面 ",e.jsx("span",{className:"text-indigo-600",children:"產生器"})]}),e.jsx("p",{className:"mt-3 text-lg text-slate-600 max-w-2xl mx-auto",children:"輸入一個主題，讓 AI 為您打造包含互動測驗的結構化學習計劃！"}),e.jsxs("div",{className:"mt-6 max-w-2xl mx-auto bg-yellow-50 border-l-4 border-yellow-400 rounded-lg p-4 text-left shadow-sm",children:[e.jsxs("div",{className:"flex items-start mb-2",children:[e.jsx("svg",{className:"w-6 h-6 text-yellow-500 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z"})}),e.jsx("span",{className:"font-semibold text-yellow-800 text-base",children:"使用注意事項"})]}),e.jsxs("ul",{className:"list-disc pl-8 text-yellow-900 text-sm space-y-1",children:[e.jsx("li",{children:"內容審查：請在分享AI生成內容給學生前仔細檢查，確保內容適合且無誤"}),e.jsx("li",{children:"隱私保護：請勿輸入學生個人識別資訊"})]})]})]}),e.jsx("div",{className:"max-w-6xl mx-auto mb-6",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(Lt,{compact:!0})})}),e.jsxs("div",{className:"max-w-6xl mx-auto mb-8",children:[e.jsxs("div",{className:"flex justify-center gap-3 flex-wrap",children:[e.jsxs("a",{href:"/ai-page-gen/lesson-plans",className:"flex items-center gap-2 px-4 py-3 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors shadow-lg",children:[e.jsx(oe,{className:"w-5 h-5"}),"我的教案庫"]}),e.jsxs("a",{href:"/ai-page-gen/conversation-prep",className:"flex items-center gap-2 px-4 py-3 bg-emerald-600 text-white font-medium rounded-lg hover:bg-emerald-700 transition-colors shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})}),"英文對話練習"]}),e.jsxs("button",{onClick:F,className:"flex items-center gap-2 px-4 py-3 bg-purple-600 text-white font-medium rounded-lg hover:bg-purple-700 transition-colors shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-11.314a2.25 2.25 0 1 0 3.935-2.186 2.25 2.25 0 0 0-3.935 2.186Z"})}),"分享 Provider 配置"]}),e.jsxs("button",{onClick:J,className:"flex items-center gap-2 px-4 py-3 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})}),"分享應用程式連結"]})]}),y&&e.jsx("div",{className:"mt-3 text-center",children:e.jsx("p",{className:`text-sm ${y.includes("請先")?"text-red-600":"text-green-600"}`,children:y})})]}),e.jsx(Dt,{isOpen:x,onClose:()=>i(!1),providers:f,onShareCreated:U}),e.jsxs("main",{className:"max-w-4xl mx-auto",children:[e.jsx(ct,{topic:s,setTopic:c,onGenerate:q,onGenerateWithLevels:I,isLoading:n}),t&&!n&&e.jsxs("div",{className:"my-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg shadow-md",children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center",children:[e.jsx(Ee,{className:"w-6 h-6 mr-2 text-red-600"}),"產生內容時發生錯誤"]}),e.jsx("p",{children:t}),e.jsx("p",{className:"mt-2 text-sm",children:"請嘗試修改您的主題或重試。如果問題持續存在，AI 模型可能暫時不可用，或者 API 金鑰可能存在問題。"})]}),n&&e.jsx("div",{className:"flex justify-center my-10",children:e.jsx(le,{})}),p&&L&&!n&&!t&&e.jsx(wt,{learningLevels:L,onLevelSelect:w,onGenerateWithLevel:E,selectedLevelId:$?.id,isLoading:n}),R&&C&&!n&&!t&&e.jsx(kt,{onVocabularyLevelSelect:z,selectedLevel:S,isVisible:!0}),r&&!n&&!t&&!p&&!R&&e.jsx(te,{children:e.jsx(Ve,{content:r,topic:s,selectedLevel:$,selectedVocabularyLevel:S,apiKey:h||void 0,onContentUpdate:u})})]}),e.jsxs("footer",{className:"text-center mt-12 py-6 border-t border-slate-300",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"由 Gemini API 驅動。AI 設計，為學習而生。"}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded shadow transition",onClick:J,disabled:!h,children:"產生分享連結並複製"}),y&&e.jsx("div",{className:"mt-2 text-green-600 text-sm",children:y})]})]})})})]})})})},ps=document.getElementById("root");if(!ps)throw new Error("Could not find root element to mount to");const Wt=Ps.createRoot(ps);Wt.render(e.jsx(V.StrictMode,{children:e.jsx(Ot,{})}));
