import{r as c,j as e,u as We}from"./react-vendor-CKBOTALK.js";import{c as Ee,g as Me,l as de,t as se,a as te,b as ne,s as Oe,i as T,d as _e}from"./app-services-2y2dLhqm.js";import{L as Ge,M as Ve}from"./interactive-components-Bz66s04f.js";const Re=({content:d,apiKey:g,vocabularyLevel:v,isStudentMode:C=!1})=>{const[F,E]=c.useState("sentence"),[w,M]=c.useState({}),[Q,k]=c.useState({}),[L,f]=c.useState({}),O=c.useCallback((r,S)=>{M(N=>({...N,[r]:S}))},[]),m=c.useCallback(async(r,S)=>{if(!g){alert("éœ€è¦ API Key æ‰èƒ½ç²å¾— AI æ‰¹æ”¹å›é¥‹");return}const N=w[r.id];if(!N?.trim()){alert("è«‹å…ˆå®Œæˆæ‚¨çš„ä½œå“å†æäº¤æ‰¹æ”¹");return}f(p=>({...p,[r.id]:!0}));try{const p=await Ee(N,S,r,g,v);k(P=>({...P,[r.id]:p}))}catch(p){console.error("AI æ‰¹æ”¹å¤±æ•—:",p),alert("AI æ‰¹æ”¹å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå’Œ API Key è¨­å®š")}finally{f(p=>({...p,[r.id]:!1}))}},[g,w,v]),j=()=>e.jsx("div",{className:"space-y-6",children:d.sentencePractice.map((r,S)=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-blue-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:["é€ å¥ç·´ç¿’ ",S+1,e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full ${r.difficulty==="easy"?"bg-green-100 text-green-700":r.difficulty==="normal"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:r.difficulty==="easy"?"ç°¡å–®":r.difficulty==="normal"?"æ™®é€š":"å›°é›£"})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:r.instruction}),r.keywords.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"å¿…é ˆä½¿ç”¨çš„é—œéµè©ï¼š"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.keywords.map((N,p)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm",children:N},p))})]}),r.exampleSentence&&e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"ç¯„ä¾‹å¥å­ï¼š"}),e.jsx("p",{className:"text-gray-700 italic",children:r.exampleSentence})]}),r.hints&&r.hints.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"æç¤ºï¼š"}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:r.hints.map((N,p)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"â€¢"}),N]},p))})]})]})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ‚¨çš„é€ å¥ï¼š"}),e.jsx("textarea",{value:w[r.id]||"",onChange:N=>O(r.id,N.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„é€ å¥..."}),e.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["å­—æ•¸: ",(w[r.id]||"").length]}),g&&e.jsx("button",{onClick:()=>m(r,"sentence"),disabled:!w[r.id]?.trim()||L[r.id],className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:L[r.id]?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"â³"}),"AI æ‰¹æ”¹ä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),"ç²å¾— AI æ‰¹æ”¹"]})})]})]}),Q[r.id]&&e.jsx(xe,{feedback:Q[r.id]})]},r.id))}),B=()=>e.jsx("div",{className:"space-y-6",children:d.writingPractice.map(r=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-purple-200",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:[r.title,e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full ${r.difficulty==="easy"?"bg-green-100 text-green-700":r.difficulty==="normal"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:r.difficulty==="easy"?"ç°¡å–®":r.difficulty==="normal"?"æ™®é€š":"å›°é›£"})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:r.instruction}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-2",children:"å»ºè­°çµæ§‹ï¼š"}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:r.structure.map((S,N)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-500 mt-1",children:"â€¢"}),S]},N))})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-600 mb-2",children:["å­—æ•¸è¦æ±‚: ",r.minLength," - ",r.maxLength," å­—"]}),r.keywords&&r.keywords.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"å»ºè­°ä½¿ç”¨è©å½™ï¼š"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.keywords.map((S,N)=>e.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:S},N))})]})]})]}),r.exampleOutline&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"ç¯„ä¾‹å¤§ç¶±ï¼š"}),e.jsx("p",{className:"text-gray-700 text-sm",children:r.exampleOutline})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ‚¨çš„å¯«ä½œï¼š"}),e.jsx("textarea",{value:w[r.id]||"",onChange:S=>O(r.id,S.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:8,placeholder:"è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„æ–‡ç« ..."}),e.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("span",{children:["å­—æ•¸: ",(w[r.id]||"").length]}),e.jsx("span",{className:"ml-4",children:(w[r.id]||"").length<r.minLength?`é‚„éœ€ ${r.minLength-(w[r.id]||"").length} å­—`:(w[r.id]||"").length>r.maxLength?`è¶…å‡º ${(w[r.id]||"").length-r.maxLength} å­—`:"ç¬¦åˆå­—æ•¸è¦æ±‚"})]}),g&&e.jsx("button",{onClick:()=>m(r,"writing"),disabled:!w[r.id]?.trim()||L[r.id],className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:L[r.id]?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"â³"}),"AI æ‰¹æ”¹ä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),"ç²å¾— AI æ‰¹æ”¹"]})})]})]}),Q[r.id]&&e.jsx(xe,{feedback:Q[r.id]})]},r.id))});return e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-6 mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-blue-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"å¯«ä½œç·´ç¿’èˆ‡ AI æ‰¹æ”¹"}),e.jsx("p",{className:"text-gray-600 text-sm",children:d.instructions})]})]}),!C&&e.jsxs("div",{className:"text-sm text-gray-500 bg-white px-3 py-2 rounded-lg border",children:[e.jsxs("div",{children:["é€ å¥ç·´ç¿’: ",d.sentencePractice.length," é¡Œ"]}),e.jsxs("div",{children:["å¯«ä½œç·´ç¿’: ",d.writingPractice.length," é¡Œ"]})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 mb-6",children:[e.jsxs("button",{onClick:()=>E("sentence"),className:`px-6 py-3 font-medium text-sm border-b-2 transition-colors ${F==="sentence"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["æç¤ºé€ å¥ (",d.sentencePractice.length,")"]}),e.jsxs("button",{onClick:()=>E("writing"),className:`px-6 py-3 font-medium text-sm border-b-2 transition-colors ${F==="writing"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["æç¤ºå¯«ä½œ (",d.writingPractice.length,")"]})]}),F==="sentence"?j():B()]})},xe=({feedback:d})=>e.jsxs("div",{className:"mt-4 border-t pt-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-green-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.847a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.847.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z"})}),"AI æ‰¹æ”¹å›é¥‹",e.jsxs("div",{className:`ml-2 px-3 py-1 rounded-full text-sm font-bold ${d.score>=85?"bg-green-100 text-green-800":d.score>=70?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[d.score," åˆ†"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[d.strengths.length>0&&e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium text-green-700 mb-2",children:"âœ… å„ªé»"}),e.jsx("ul",{className:"space-y-1",children:d.strengths.map((g,v)=>e.jsxs("li",{className:"text-sm text-gray-700 flex items-start gap-2",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"â€¢"}),g]},v))})]}),d.improvements.length>0&&e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium text-orange-700 mb-2",children:"ğŸ’¡ æ”¹é€²å»ºè­°"}),e.jsx("ul",{className:"space-y-1",children:d.improvements.map((g,v)=>e.jsxs("li",{className:"text-sm text-gray-700 flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-500 mt-1",children:"â€¢"}),g]},v))})]})]}),d.grammarCorrections&&d.grammarCorrections.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("h6",{className:"font-medium text-yellow-800 mb-2",children:"ğŸ“ èªæ³•ä¿®æ­£"}),d.grammarCorrections.map((g,v)=>e.jsxs("div",{className:"mb-2 last:mb-0",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-red-600 line-through",children:g.original}),e.jsx("span",{className:"mx-2",children:"â†’"}),e.jsx("span",{className:"text-green-600 font-medium",children:g.corrected})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:g.explanation})]},v))]}),d.vocabularyTips&&d.vocabularyTips.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"font-medium text-blue-700 mb-2",children:"ğŸ“š è©å½™å»ºè­°"}),e.jsx("ul",{className:"space-y-1",children:d.vocabularyTips.map((g,v)=>e.jsxs("li",{className:"text-sm text-gray-700 flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"â€¢"}),g]},v))})]}),d.structureFeedback&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"font-medium text-purple-700 mb-2",children:"ğŸ—ï¸ çµæ§‹å›é¥‹"}),e.jsx("p",{className:"text-sm text-gray-700",children:d.structureFeedback})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsx("h6",{className:"font-medium text-gray-800 mb-2",children:"ğŸ“‹ æ•´é«”è©•èª"}),e.jsx("p",{className:"text-sm text-gray-700 bg-white p-3 rounded-lg border",children:d.overallComment})]})]}),qe=()=>{const[d]=We(),g=d.get("contentId"),v=d.get("binId"),[C,F]=c.useState(null),[E,w]=c.useState(!0),[M,Q]=c.useState(null),[k,L]=c.useState(0),[f,O]=c.useState([]),[m,j]=c.useState({}),[B,r]=c.useState("idle"),[S,N]=c.useState(""),[p,P]=c.useState("idle"),[_,G]=c.useState({current:0,total:0}),[z,V]=c.useState(new Set),[A,me]=c.useState([]),[q,ae]=c.useState(null),[re,R]=c.useState(!1),[ie,le]=c.useState(""),[he,H]=c.useState(!1),[U,ue]=c.useState(""),[D,J]=c.useState({trueFalse:3,multipleChoice:3,memoryCardGame:1}),[ge,K]=c.useState(!1),[y,fe]=c.useState(null),[je,be]=c.useState(""),X=()=>g||v;c.useEffect(()=>{(async()=>{try{w(!0),Q(null);let t;if(v)t=await Me(v);else if(g){await de.init();const a=await de.getLessonPlan(g);if(!a)throw new Error("æ‰¾ä¸åˆ°æŒ‡å®šçš„æ•™æ¡ˆ");t={topic:a.topic,learningObjectives:a.content.learningObjectives,contentBreakdown:a.content.contentBreakdown,confusingPoints:a.content.confusingPoints,classroomActivities:a.content.classroomActivities,onlineInteractiveQuiz:a.content.quiz,writingPractice:a.content.writingPractice,transformedData:{}}}else throw new Error("ç¼ºå°‘å¿…è¦åƒæ•¸ï¼šcontentId æˆ– binId");F(t),pe(t);const n=g||v;n&&await ee(n)}catch(t){console.error("è¼‰å…¥å…§å®¹å¤±æ•—:",t),Q(t.message||"è¼‰å…¥å…§å®¹æ™‚ç™¼ç”ŸéŒ¯èª¤")}finally{w(!1)}})()},[g,v]);const pe=s=>{const t=[],n={};s.learningObjectives&&s.learningObjectives.length>0&&s.learningObjectives.forEach((a,i)=>{const l=`step_${t.length}`;t.push({id:l,title:`å­¸ç¿’ç›®æ¨™ ${i+1}`,type:"objective",icon:"ğŸ¯",data:a,index:i}),n[l]={original:a,transformed:null,isTransformed:!1,isTransforming:!1,quiz:null,hasQuiz:!1,isGeneratingQuiz:!1}}),s.contentBreakdown&&s.contentBreakdown.length>0&&s.contentBreakdown.forEach((a,i)=>{const l=`step_${t.length}`;t.push({id:l,title:`æ·±åº¦å­¸ç¿’ ${i+1}`,type:"breakdown",icon:"ğŸ“–",data:a,index:i}),n[l]={original:a,transformed:null,isTransformed:!1,isTransforming:!1,quiz:null,hasQuiz:!1,isGeneratingQuiz:!1}}),s.confusingPoints&&s.confusingPoints.length>0&&s.confusingPoints.forEach((a,i)=>{const l=`step_${t.length}`;t.push({id:l,title:`æ˜“æ··æ·†é» ${i+1}`,type:"confusing",icon:"âš¡",data:a,index:i}),n[l]={original:a,transformed:null,isTransformed:!1,isTransforming:!1,quiz:null,hasQuiz:!1,isGeneratingQuiz:!1}}),O(t),j(n)},oe=()=>localStorage.getItem("gemini_api_key")||"",ce=async s=>{const t=oe();if(!t){alert("è«‹å…ˆè¨­å®š Gemini API é‡‘é‘°");return}const n=f.find(a=>a.id===s);if(n){j(a=>({...a,[s]:{...a[s],isTransforming:!0}}));try{let a=null;switch(n.type){case"objective":a=await ne(n.data,t);break;case"breakdown":a=await te(n.data,t);break;case"confusing":a=await se(n.data,t);break}j(i=>({...i,[s]:{...i[s],transformed:a,isTransformed:!0,isTransforming:!1}}))}catch(a){console.error("è½‰æ›å¤±æ•—:",a),j(i=>({...i,[s]:{...i[s],isTransforming:!1}})),alert("è½‰æ›å¤±æ•—ï¼Œè«‹é‡è©¦")}}},ve=s=>{j(t=>({...t,[s]:{...t[s],transformed:null,isTransformed:!1,quiz:null,hasQuiz:!1}}))},Y=s=>{ue(s),H(!0)},Ne=async(s,t)=>{if(!oe()){alert("è«‹å…ˆè¨­å®š Gemini API é‡‘é‘°");return}const a=parseInt(s.replace("step_","")),i=f[a],l=m[s];if(!i||!l?.isTransformed||!l.transformed){alert("è«‹å…ˆè½‰æ›å…§å®¹å¾Œå†ç”Ÿæˆæ¸¬é©—");return}j(o=>({...o,[s]:{...o[s],isGeneratingQuiz:!0}}));try{const o=t||D,u=await _e(l.transformed,i.type,o);j($=>({...$,[s]:{...$[s],quiz:u,hasQuiz:!0,isGeneratingQuiz:!1}})),H(!1)}catch(o){console.error("æ¸¬é©—ç”Ÿæˆå¤±æ•—:",o),j(u=>({...u,[s]:{...u[s],isGeneratingQuiz:!1}})),alert("æ¸¬é©—ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦")}},ye=s=>{const t=m[s];t?.hasQuiz&&t.quiz&&(fe(t.quiz),be(s),K(!0))},we=s=>{j(t=>({...t,[s]:{...t[s],quiz:null,hasQuiz:!1}}))},ke=async()=>{if(!C)return;const s=localStorage.getItem("gemini_api_key");if(!s){alert("è«‹å…ˆè¨­å®š Gemini API Key");return}P("running");const t=f.length;G({current:0,total:t});try{for(let n=0;n<f.length;n++){const a=f[n],i=`step_${n}`;if(G({current:n+1,total:t,currentStep:a.title}),!m[i]?.isTransformed){j(l=>({...l,[i]:{...l[i],isTransforming:!0}}));try{let l;switch(a.type){case"objective":l=await ne(a.data,s);break;case"breakdown":l=await te(a.data,s);break;case"confusing":l=await se(a.data,s);break}j(o=>({...o,[i]:{...o[i],transformed:l,isTransformed:!0,isTransforming:!1}}))}catch(l){console.error(`è½‰æ›æ­¥é©Ÿ ${a.title} å¤±æ•—:`,l),j(o=>({...o,[i]:{...o[i],isTransforming:!1}}))}await new Promise(l=>setTimeout(l,500))}}P("completed")}catch(n){console.error("æ‰¹æ¬¡è½‰æ›å¤±æ•—:",n),P("error")}},Se=s=>{V(t=>{const n=new Set(t);return n.has(s)?n.delete(s):n.add(s),n})},Ce=()=>{const s=f.map((t,n)=>`step_${n}`);V(new Set(s))},ze=()=>{V(new Set)},Te=async()=>{if(!C||z.size===0){alert("è«‹å…ˆé¸æ“‡è¦è½‰æ›çš„æ­¥é©Ÿ");return}const s=localStorage.getItem("gemini_api_key");if(!s){alert("è«‹å…ˆè¨­å®š Gemini API Key");return}P("running");const t=z.size;G({current:0,total:t});try{let n=0;for(let a=0;a<f.length;a++){const i=f[a],l=`step_${a}`;if(z.has(l)&&(n++,G({current:n,total:t,currentStep:i.title}),!m[l]?.isTransformed)){j(o=>({...o,[l]:{...o[l],isTransforming:!0}}));try{let o;switch(i.type){case"objective":o=await ne(i.data,s);break;case"breakdown":o=await te(i.data,s);break;case"confusing":o=await se(i.data,s);break}j(u=>({...u,[l]:{...u[l],transformed:o,isTransformed:!0,isTransforming:!1}}))}catch(o){console.error(`è½‰æ›æ­¥é©Ÿ ${i.title} å¤±æ•—:`,o),j(u=>({...u,[l]:{...u[l],isTransforming:!1}}))}await new Promise(o=>setTimeout(o,500))}}P("completed")}catch(n){console.error("æ‰¹æ¬¡è½‰æ›å¤±æ•—:",n),P("error")}},ee=async s=>{try{await T.init();const t=await T.getVersions(s);me(t)}catch(t){console.error("è¼‰å…¥ç¾æœ‰ç‰ˆæœ¬å¤±æ•—:",t)}},Le=async()=>{if(console.log("=== é–‹å§‹ä¿å­˜ç‰ˆæœ¬ ==="),console.log("content:",!!C),console.log("contentId:",g),console.log("transformations:",m),!C){console.log("âŒ ç¼ºå°‘ content"),alert("ç¼ºå°‘æ•™æ¡ˆå…§å®¹ï¼Œç„¡æ³•ä¿å­˜ç‰ˆæœ¬");return}const s=X();if(!s){console.log("âŒ ç„¡æ³•å–å¾—æœ‰æ•ˆçš„ contentId"),alert("ç„¡æ³•è­˜åˆ¥ç•¶å‰æ•™æ¡ˆï¼Œè«‹é‡æ–°é€²å…¥é é¢");return}console.log("ä½¿ç”¨çš„ contentId:",s);const t={},n={};if(Object.entries(m).forEach(([a,i])=>{console.log(`æª¢æŸ¥æ­¥é©Ÿ ${a}:`,{isTransformed:i.isTransformed,hasTransformed:!!i.transformed,hasQuiz:i.hasQuiz,hasQuizData:!!i.quiz}),i.isTransformed&&i.transformed&&(t[a]=i.transformed),i.hasQuiz&&i.quiz&&(n[a]=i.quiz)}),console.log("æ”¶é›†åˆ°çš„è³‡æ–™:",{transformedDataCount:Object.keys(t).length,quizDataCount:Object.keys(n).length,selectedStepsCount:z.size}),Object.keys(t).length===0){console.log("âŒ æ²’æœ‰å·²è½‰æ›çš„å…§å®¹"),alert("è«‹å…ˆè½‰æ›ä¸€äº›å…§å®¹å†ä¿å­˜ç‰ˆæœ¬");return}try{console.log("åˆå§‹åŒ– interactiveContentStorage..."),await T.init(),console.log("âœ… åˆå§‹åŒ–æˆåŠŸ");const a=ie||`ç‰ˆæœ¬ ${new Date().toLocaleString("zh-TW")}`,i={transformedData:t,quizData:n};console.log("æº–å‚™ä¿å­˜ç‰ˆæœ¬:",{actualContentId:s,topic:C.topic||"ç„¡æ¨™é¡Œæ•™æ¡ˆ",versionName:a,versionData:i,selectedSteps:Array.from(z)});const l=await T.saveVersion(s,C.topic||"ç„¡æ¨™é¡Œæ•™æ¡ˆ",i,Array.from(z),a,`åŒ…å« ${Object.keys(t).length} å€‹å·²è½‰æ›æ­¥é©Ÿï¼Œ${Object.keys(n).length} å€‹æ¸¬é©—`);console.log("âœ… ç‰ˆæœ¬ä¿å­˜æˆåŠŸï¼ŒID:",l),le(""),await ee(s),alert("ç‰ˆæœ¬ä¿å­˜æˆåŠŸï¼")}catch(a){console.error("âŒ ä¿å­˜ç‰ˆæœ¬å¤±æ•—:",a),console.error("éŒ¯èª¤å †æ£§:",a.stack),alert(`ä¿å­˜ç‰ˆæœ¬å¤±æ•—ï¼š${a.message||a}`)}console.log("=== ä¿å­˜ç‰ˆæœ¬çµæŸ ===")},Pe=async s=>{const t=X();if(t)try{await T.init();const n=await T.getVersion(t,s);if(n){j({});const a={};f.forEach((o,u)=>{const $=`step_${u}`;a[$]={original:o.data,transformed:null,isTransformed:!1,isTransforming:!1,quiz:null,hasQuiz:!1,isGeneratingQuiz:!1}});const i=n.transformedData?.transformedData||n.transformedData,l=n.transformedData?.quizData||{};Object.entries(i||{}).forEach(([o,u])=>{a[o]&&(a[o]={...a[o],transformed:u,isTransformed:!0})}),Object.entries(l||{}).forEach(([o,u])=>{a[o]&&(a[o]={...a[o],quiz:u,hasQuiz:!0})}),j(a),V(new Set(n.selectedSteps)),ae(s),R(!1),await T.updateLastAccessed(t)}}catch(n){console.error("è¼‰å…¥ç‰ˆæœ¬å¤±æ•—:",n),alert("è¼‰å…¥ç‰ˆæœ¬å¤±æ•—ï¼Œè«‹é‡è©¦")}},Qe=async s=>{const t=X();if(!t)return;const n=A.find(a=>a.id===s);if(n&&confirm(`ç¢ºå®šè¦åˆªé™¤ç‰ˆæœ¬ã€Œ${n.name}ã€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`))try{await T.init(),await T.deleteVersion(t,s),await ee(t),q===s&&ae(null)}catch(a){console.error("åˆªé™¤ç‰ˆæœ¬å¤±æ•—:",a),alert("åˆªé™¤ç‰ˆæœ¬å¤±æ•—ï¼Œè«‹é‡è©¦")}},Ae=s=>s?[/#+\s/,/\*\*.*\*\*/,/\*.*\*/,/`.*`/,/^\s*[-*+]\s/m,/^\s*\d+\.\s/m,/\[.*\]\(.*\)/,/^\s*>/m,/```[\s\S]*?```/,/\n\s*\n/].some(n=>n.test(s)):!1,b=(s,t)=>Ae(s)?e.jsx(Ve,{content:s,className:t}):e.jsx("span",{className:t,children:s}),Ie=async()=>{if(C){r("publishing");try{const s={},t={},n={};if(Object.entries(m).forEach(([o,u])=>{if(u.isTransformed&&u.transformed){s[o]=u.transformed,u.hasQuiz&&u.quiz&&(t[o]=u.quiz);const $=parseInt(o.replace("step_","")),W=f[$];if(W)switch(W.type){case"objective":n.learningObjectives||(n.learningObjectives=[]),n.learningObjectives.push(W.data);break;case"breakdown":n.contentBreakdown||(n.contentBreakdown=[]),n.contentBreakdown.push(W.data);break;case"confusing":n.confusingPoints||(n.confusingPoints=[]),n.confusingPoints.push(W.data);break}}}),Object.keys(s).length===0){alert("è«‹å…ˆè½‰æ›ä¸€äº›å…§å®¹å†ç™¼å¸ƒ"),r("idle");return}const a={...n,topic:C.topic,isInteractive:!0,transformedData:s,stepQuizData:t,includedSteps:Object.keys(s)},i=await Oe(a),l=`${window.location.origin}/ai-page-gen/student-interactive?binId=${i}`;N(l),r("published")}catch(s){console.error("ç™¼å¸ƒå¤±æ•—:",s),r("error")}}},$e=s=>{L(s)},Fe=()=>{k<f.length-1&&L(k+1)},Be=()=>{k>0&&L(k-1)};if(E)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center items-center min-h-[50vh]",children:e.jsx(Ge,{})})});if(M)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-md",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"è¼‰å…¥éŒ¯èª¤"}),e.jsx("p",{children:M})]})})});if(!C||f.length===0)return null;const x=f[k],De=`step_${k}`,h=m[De]||{transformed:null,isTransformed:!1},Z=Object.values(m).filter(s=>s.isTransformed).length,I=f.length;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/90 backdrop-blur-sm border-b border-slate-200",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:"äº’å‹•æ•™ææº–å‚™"}),e.jsx("h2",{className:"text-lg font-semibold text-indigo-600",children:C.topic}),e.jsxs("p",{className:"text-sm text-slate-600",children:["ç¬¬ ",k+1," æ­¥ï¼Œå…± ",I," æ­¥ â€¢ å·²è½‰æ›ï¼š",Z,"/",I]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[p==="running"&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600 animate-spin",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{className:"text-blue-800 font-medium",children:"æ‰¹æ¬¡è½‰æ›é€²è¡Œä¸­..."})]}),e.jsx("div",{className:"text-xs text-blue-700",children:_.currentStep&&`æ­£åœ¨è½‰æ›ï¼š${_.currentStep}`}),e.jsx("div",{className:"mt-1 bg-blue-200 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-600 h-1 rounded-full transition-all duration-300",style:{width:`${_.current/_.total*100}%`}})})]}),p==="completed"&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-green-800 font-medium text-sm",children:"æ‰¹æ¬¡è½‰æ›å®Œæˆï¼"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Te,disabled:p==="running"||z.size===0,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors flex items-center gap-2",children:p==="running"?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"è½‰æ›ä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"è½‰æ›é¸ä¸­é …ç›® (",z.size,")"]})}),e.jsx("button",{onClick:ke,disabled:p==="running"||Z===I,className:"px-3 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors flex items-center gap-2 text-sm",children:Z===I?"å…¨éƒ¨å·²è½‰æ›":"å…¨éƒ¨è½‰æ›"})]}),B==="published"&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-green-800 font-medium",children:"å·²ç™¼å¸ƒæˆåŠŸï¼"})]}),e.jsx("div",{className:"text-xs text-green-700",children:e.jsx("a",{href:S,target:"_blank",rel:"noopener noreferrer",className:"underline hover:no-underline",children:"æŸ¥çœ‹å­¸ç”Ÿå­¸ç¿’é é¢"})})]}),e.jsx("button",{onClick:Ie,disabled:B==="publishing"||Z===0,className:"px-6 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors flex items-center gap-2",children:B==="publishing"?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"ç™¼å¸ƒä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),"ç™¼å¸ƒäº’å‹•æ•™æ"]})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-sky-500 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${(k+1)/I*100}%`}})}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Ce,className:"text-xs text-indigo-600 hover:text-indigo-800 font-medium",children:"å…¨é¸"}),e.jsx("span",{className:"text-slate-300",children:"|"}),e.jsx("button",{onClick:ze,className:"text-xs text-slate-600 hover:text-slate-800 font-medium",children:"å…¨ä¸é¸"})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["å·²é¸æ“‡ ",z.size," / ",f.length," å€‹æ­¥é©Ÿ"]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[A.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"ç‰ˆæœ¬:"}),e.jsx("button",{onClick:()=>R(!re),className:"text-indigo-600 hover:text-indigo-800 font-medium",children:q?A.find(s=>s.id===q)?.name||"é¸æ“‡ç‰ˆæœ¬":`${A.length} å€‹å¯ç”¨`})]}),e.jsx("input",{type:"text",placeholder:"ç‰ˆæœ¬åç¨±",value:ie,onChange:s=>le(s.target.value),className:"px-2 py-1 text-xs border border-slate-300 rounded w-20"}),e.jsx("button",{onClick:()=>{console.log("ğŸ”´ ä¿å­˜ç‰ˆæœ¬æŒ‰éˆ•è¢«é»æ“Šäº†ï¼"),Le()},className:"text-green-600 hover:text-green-800 font-medium",children:"ä¿å­˜ç‰ˆæœ¬"})]})]}),e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:f.map((s,t)=>{const n=`step_${t}`;return e.jsx("div",{className:`
                      flex-shrink-0 p-2 rounded-lg border transition-all duration-200 bg-white
                      ${t===k?"border-indigo-500 bg-indigo-50":m[n]?.isTransformed?"border-green-200 bg-green-50":"border-slate-200"}
                    `,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z.has(n),onChange:()=>Se(n),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsxs("button",{onClick:()=>$e(t),className:"flex items-center gap-1 text-xs font-medium hover:text-indigo-600 transition-colors",children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.title}),m[n]?.isTransformed&&e.jsx("svg",{className:"w-3 h-3 text-green-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]}),m[n]?.isTransformed?e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx("button",{onClick:()=>ce(n),className:"text-xs text-blue-600 hover:text-blue-800 font-medium px-1 py-0.5 rounded hover:bg-blue-50",title:"é‡æ–°è½‰æ›",children:"ğŸ”„"}),e.jsx("button",{onClick:()=>ve(n),className:"text-xs text-red-600 hover:text-red-800 font-medium px-1 py-0.5 rounded hover:bg-red-50",title:"é‡ç½®",children:"ğŸ—‘ï¸"}),m[n]?.hasQuiz?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-orange-600",title:"å·²ç”Ÿæˆæ¸¬é©—",children:"ğŸ§ "}),e.jsx("button",{onClick:()=>ye(n),className:"text-xs text-blue-600 hover:text-blue-800 font-medium px-1 py-0.5 rounded hover:bg-blue-50",title:"é è¦½æ¸¬é©—",children:"ğŸ‘ï¸"}),e.jsx("button",{onClick:()=>Y(n),disabled:m[n]?.isGeneratingQuiz,className:"text-xs text-orange-600 hover:text-orange-800 font-medium px-1 py-0.5 rounded hover:bg-orange-50",title:"é‡æ–°ç”Ÿæˆæ¸¬é©—",children:m[n]?.isGeneratingQuiz?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-600 rounded-full animate-pulse"}),e.jsx("span",{children:"ç”Ÿæˆä¸­"})]}):"ğŸ”„"}),e.jsx("button",{onClick:()=>we(n),className:"text-xs text-red-600 hover:text-red-800 font-medium px-1 py-0.5 rounded hover:bg-red-50",title:"åˆªé™¤æ¸¬é©—",children:"ğŸ—‘ï¸"})]}):e.jsx("button",{onClick:()=>Y(n),disabled:m[n]?.isGeneratingQuiz,className:"text-xs text-orange-600 hover:text-orange-800 font-medium px-1 py-0.5 rounded hover:bg-orange-50 disabled:opacity-50",title:"ç”Ÿæˆæ¸¬é©—",children:m[n]?.isGeneratingQuiz?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs",children:"ç”Ÿæˆä¸­"})]}):"ğŸ§ "})]}):e.jsx("button",{onClick:()=>ce(n),disabled:m[n]?.isTransforming,className:"text-xs text-green-600 hover:text-green-800 font-medium px-2 py-0.5 rounded hover:bg-green-50 disabled:opacity-50 ml-2",children:m[n]?.isTransforming?"â³":"â–¶ï¸"})]})},s.id)})}),re&&A.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-slate-50 rounded-lg border",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-800 mb-3",children:"é¸æ“‡ç‰ˆæœ¬è¼‰å…¥"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:A.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border hover:bg-slate-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),q===s.id&&e.jsx("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded",children:"ç•¶å‰"})]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[s.description," â€¢ ",new Date(s.createdAt).toLocaleString("zh-TW")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Pe(s.id),className:"text-xs text-indigo-600 hover:text-indigo-800 font-medium",children:"è¼‰å…¥"}),e.jsx("button",{onClick:()=>Qe(s.id),className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"åˆªé™¤"})]})]},s.id))}),e.jsx("button",{onClick:()=>R(!1),className:"mt-3 text-xs text-slate-600 hover:text-slate-800",children:"é—œé–‰"})]})]})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-5xl mb-4",children:x.icon}),e.jsx("h2",{className:"text-3xl font-bold text-slate-800 mb-2",children:x.title}),e.jsxs("p",{className:"text-lg text-slate-600",children:[x.type==="objective"&&"å°‡å­¸ç¿’ç›®æ¨™è½‰æ›ç‚ºå­¸ç”Ÿå‹å¥½çš„èªè¨€",x.type==="breakdown"&&"å°‡å…§å®¹åˆ†è§£è½‰æ›ç‚ºæ˜“æ‡‚çš„å­¸ç¿’ææ–™",x.type==="confusing"&&"å°‡æ˜“æ··æ·†é»è½‰æ›ç‚ºæ”¯æŒæ€§æŒ‡å°"]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:h.isTransformed?"âœ…":"ğŸ”„"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-800",children:h.isTransformed?"å·²å®Œæˆè½‰æ›":"æº–å‚™è½‰æ›å…§å®¹"}),e.jsx("p",{className:"text-sm text-slate-600",children:h.isTransformed?"å…§å®¹å·²è½‰æ›ç‚ºå­¸ç”Ÿå‹å¥½æ ¼å¼ï¼Œå¯ä»¥é€²è¡Œé è¦½æˆ–é‡æ–°è½‰æ›":"é»æ“Šè½‰æ›æŒ‰éˆ•å°‡æ•™å¸«å°å‘å…§å®¹è½‰æ›ç‚ºå­¸ç”Ÿå‹å¥½æ ¼å¼"})]})]}),e.jsx("div",{className:"text-sm text-slate-500",children:"ä½¿ç”¨ä¸Šæ–¹å°èˆªæ¬„ä¸­çš„æ§åˆ¶æŒ‰éˆ•é€²è¡Œè½‰æ›æ“ä½œ"})]})}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ğŸ“„"}),"åŸå§‹å…§å®¹ï¼ˆæ•™å¸«å°å‘ï¼‰"]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-sm text-slate-700 max-h-96 overflow-y-auto",children:[x.type==="objective"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"ç›®æ¨™ï¼š"})," ",b(x.data.objective)]}),x.data.description&&e.jsxs("div",{children:[e.jsx("strong",{children:"æè¿°ï¼š"})," ",b(x.data.description)]}),x.data.teachingExample&&e.jsxs("div",{children:[e.jsx("strong",{children:"æ•™å­¸ç¯„ä¾‹ï¼š"})," ",b(x.data.teachingExample)]})]}),x.type==="breakdown"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"ä¸»é¡Œï¼š"})," ",b(x.data.topic)]}),x.data.details&&e.jsxs("div",{children:[e.jsx("strong",{children:"è©³ç´°èªªæ˜ï¼š"})," ",b(x.data.details)]}),x.data.teachingExample&&e.jsxs("div",{children:[e.jsx("strong",{children:"æ•™å­¸ç¯„ä¾‹ï¼š"})," ",b(x.data.teachingExample)]})]}),x.type==="confusing"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"æ˜“æ··æ·†é»ï¼š"})," ",b(x.data.point)]}),x.data.clarification&&e.jsxs("div",{children:[e.jsx("strong",{children:"æ¾„æ¸…èªªæ˜ï¼š"})," ",b(x.data.clarification)]}),x.data.teachingExample&&e.jsxs("div",{children:[e.jsx("strong",{children:"æ•™å­¸ç¯„ä¾‹ï¼š"})," ",b(x.data.teachingExample)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"âœ¨"}),"è½‰æ›å¾Œå…§å®¹ï¼ˆå­¸ç”Ÿå‹å¥½ï¼‰"]}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-blue-50 rounded-xl p-4 text-sm max-h-96 overflow-y-auto",children:h.isTransformed&&h.transformed?e.jsxs("div",{className:"space-y-4",children:[x.type==="objective"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-green-800",children:[e.jsx("strong",{children:"å­¸ç¿’ç›®æ¨™ï¼š"}),e.jsx("div",{className:"mt-1",children:b(h.transformed.objective)})]}),h.transformed.description&&e.jsxs("div",{className:"text-blue-800",children:[e.jsx("strong",{children:"ç‚ºä»€éº¼è¦å­¸ï¼š"}),e.jsx("div",{className:"mt-1",children:b(h.transformed.description)})]}),h.transformed.personalRelevance&&e.jsxs("div",{className:"text-purple-800",children:[e.jsx("strong",{children:"å°ä½ çš„æ„ç¾©ï¼š"}),e.jsx("div",{className:"mt-1",children:b(h.transformed.personalRelevance)})]}),h.transformed.encouragement&&e.jsxs("div",{className:"text-sky-800",children:[e.jsx("strong",{children:"çµ¦ä½ çš„é¼“å‹µï¼š"}),e.jsx("div",{className:"mt-1",children:b(h.transformed.encouragement)})]})]}),x.type==="breakdown"&&e.jsxs(e.Fragment,{children:[h.transformed.title&&e.jsxs("div",{className:"text-green-800",children:[e.jsx("strong",{children:"å­¸ç¿’ä¸»é¡Œï¼š"}),e.jsx("div",{className:"mt-1",children:b(h.transformed.title)})]}),h.transformed.introduction&&e.jsxs("div",{className:"text-blue-800",children:[e.jsx("strong",{children:"é–‹å§‹å­¸ç¿’ï¼š"}),e.jsx("div",{className:"mt-1",children:b(h.transformed.introduction)})]}),h.transformed.keyPoints&&e.jsxs("div",{className:"text-indigo-800",children:[e.jsx("strong",{children:"é‡é»æ¦‚å¿µï¼š"}),e.jsx("div",{className:"mt-1 space-y-1",children:h.transformed.keyPoints.map((s,t)=>e.jsxs("div",{children:["â€¢ ",b(s)]},t))})]})]}),x.type==="confusing"&&e.jsxs(e.Fragment,{children:[h.transformed.title&&e.jsxs("div",{className:"text-amber-800",children:[e.jsx("strong",{children:"å®¹æ˜“å›°æƒ‘çš„åœ°æ–¹ï¼š"}),e.jsx("div",{className:"mt-1",children:b(h.transformed.title)})]}),h.transformed.normalizeConfusion&&e.jsxs("div",{className:"text-green-800",children:[e.jsx("strong",{children:"åˆ¥æ“”å¿ƒï¼š"}),e.jsx("div",{className:"mt-1",children:b(h.transformed.normalizeConfusion)})]}),h.transformed.clearExplanation&&e.jsxs("div",{className:"text-blue-800",children:[e.jsx("strong",{children:"æ­£ç¢ºç†è§£ï¼š"}),e.jsx("div",{className:"mt-1",children:b(h.transformed.clearExplanation)})]})]})]}):e.jsxs("div",{className:"text-slate-500 text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ğŸ”„"}),e.jsx("p",{children:"ä½¿ç”¨ä¸Šæ–¹å°èˆªæ¬„ä¸­çš„ â–¶ï¸ æŒ‰éˆ•ä¾†ç”Ÿæˆå­¸ç”Ÿå‹å¥½çš„å…§å®¹"})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-8 border-t border-slate-200",children:[e.jsxs("button",{onClick:Be,disabled:k===0,className:"flex items-center gap-2 px-6 py-3 bg-slate-500 text-white font-medium rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"ä¸Šä¸€æ­¥"]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-slate-600",children:[k+1," / ",I]})}),e.jsxs("button",{onClick:Fe,disabled:k===f.length-1,className:"flex items-center gap-2 px-6 py-3 bg-indigo-500 text-white font-medium rounded-lg hover:bg-indigo-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["ä¸‹ä¸€æ­¥",e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})]}),he&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"æ¸¬é©—è¨­å®š"}),e.jsx("button",{onClick:()=>H(!1),className:"p-1 hover:bg-slate-100 rounded-full",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"æ˜¯éé¡Œæ•¸é‡"}),e.jsx("input",{type:"number",min:"1",max:"10",value:D.trueFalse,onChange:s=>J(t=>({...t,trueFalse:parseInt(s.target.value)||1})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"é¸æ“‡é¡Œæ•¸é‡"}),e.jsx("input",{type:"number",min:"1",max:"10",value:D.multipleChoice,onChange:s=>J(t=>({...t,multipleChoice:parseInt(s.target.value)||1})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"è¨˜æ†¶å¡éŠæˆ²çµ„æ•¸"}),e.jsx("input",{type:"number",min:"1",max:"3",value:D.memoryCardGame,onChange:s=>J(t=>({...t,memoryCardGame:parseInt(s.target.value)||1})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsx("div",{className:"p-6 border-t bg-slate-50 rounded-b-2xl",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>H(!1),className:"flex-1 px-4 py-2 bg-slate-500 text-white font-medium rounded-lg hover:bg-slate-600 transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>Ne(U,D),disabled:m[U]?.isGeneratingQuiz,className:"flex-1 px-4 py-2 bg-orange-500 text-white font-medium rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50",children:m[U]?.isGeneratingQuiz?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"ç”Ÿæˆä¸­..."]}):"ç”Ÿæˆæ¸¬é©—"})]})})]})}),ge&&y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b p-6 flex items-center justify-between rounded-t-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"ğŸ“ æ¸¬é©—é è¦½"}),e.jsx("button",{onClick:()=>K(!1),className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[y._validationWarnings&&y._validationWarnings.length>0&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"âš ï¸ ç™¼ç¾è¨˜æ†¶å¡å…§å®¹å•é¡Œ"}),e.jsxs("div",{className:"mt-2 text-sm text-yellow-700",children:[e.jsx("ul",{className:"list-disc list-inside space-y-1",children:y._validationWarnings.map((s,t)=>e.jsx("li",{children:s},t))}),e.jsx("p",{className:"mt-2 font-medium",children:"å»ºè­°é‡æ–°ç”Ÿæˆæ¸¬é©—ä»¥ç¢ºä¿å­¸ç”Ÿé«”é©—è‰¯å¥½ï¼"})]})]})]})}),y.trueFalse&&y.trueFalse.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"âœ“"})," æ˜¯éåˆ¤æ–·é¡Œ (",y.trueFalse.length," é¡Œ)"]}),e.jsx("div",{className:"space-y-3",children:y.trueFalse.map((s,t)=>e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"font-medium text-slate-800 mb-2",children:[t+1,". ",s.statement]}),e.jsxs("div",{className:"text-sm text-slate-600",children:[e.jsx("strong",{children:"ç­”æ¡ˆï¼š"})," ",s.isTrue?"æ­£ç¢º":"éŒ¯èª¤"]}),s.explanation&&e.jsxs("div",{className:"text-sm text-slate-600 mt-1",children:[e.jsx("strong",{children:"è§£é‡‹ï¼š"})," ",s.explanation]})]},t))})]}),y.multipleChoice&&y.multipleChoice.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ğŸ“"})," é¸æ“‡é¡Œ (",y.multipleChoice.length," é¡Œ)"]}),e.jsx("div",{className:"space-y-3",children:y.multipleChoice.map((s,t)=>e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"font-medium text-slate-800 mb-2",children:[t+1,". ",s.question]}),e.jsx("div",{className:"ml-4 space-y-1",children:s.options.map((n,a)=>e.jsxs("div",{className:`text-sm ${a===s.correctAnswerIndex?"text-green-700 font-medium":"text-slate-600"}`,children:[String.fromCharCode(65+a),". ",n,a===s.correctAnswerIndex&&" âœ“"]},a))}),s.explanation&&e.jsxs("div",{className:"text-sm text-slate-600 mt-2",children:[e.jsx("strong",{children:"è§£é‡‹ï¼š"})," ",s.explanation]})]},t))})]}),y.memoryCardGame&&y.memoryCardGame.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ğŸ§ "})," è¨˜æ†¶å¡é…å° (",y.memoryCardGame.length," çµ„)"]}),e.jsx("div",{className:"space-y-3",children:y.memoryCardGame.map((s,t)=>e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"font-medium text-slate-800 mb-3",children:["ç¬¬ ",t+1," çµ„ï¼š",s.title||"é…å°éŠæˆ²"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2",children:s.pairs.map((n,a)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"bg-blue-100 px-2 py-1 rounded flex-1",children:n.left}),e.jsx("div",{className:"text-slate-400",children:"âŸ·"}),e.jsx("div",{className:"bg-green-100 px-2 py-1 rounded flex-1",children:n.right})]},a))})]},t))})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-slate-50 p-6 border-t rounded-b-2xl",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>K(!1),className:"flex-1 px-4 py-2 bg-slate-500 text-white font-medium rounded-lg hover:bg-slate-600 transition-colors",children:"é—œé–‰é è¦½"}),e.jsx("button",{onClick:()=>{K(!1),Y(je)},className:"flex-1 px-4 py-2 bg-orange-500 text-white font-medium rounded-lg hover:bg-orange-600 transition-colors",children:"é‡æ–°ç”Ÿæˆ"})]})})]})})]})},Ue=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"}));export{Ue as T,Re as W};
