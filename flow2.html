<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI 學習內容生成系統 — 流程圖與說明</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#6ee7b7;--muted:#94a3b8;--panel:#071020}
    body{font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans CJK TC", "PingFang TP", "Microsoft JhengHei", sans-serif; margin:0; background:linear-gradient(180deg,#071021 0%, #061328 100%); color:#e6eef8}
    .wrap{max-width:1100px;margin:28px auto;padding:28px}
    header{display:flex;align-items:center;gap:16px}
    .hero{background:linear-gradient(90deg, rgba(255,255,255,0.03), transparent);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);}
    h1{margin:0;font-size:20px}
    p.lead{margin:6px 0 0;color:var(--muted)}

    /* layout */
    .content{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:22px}
    .left{padding:16px;background:rgba(255,255,255,0.02);border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .right{padding:16px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:12px;border:1px solid rgba(255,255,255,0.02)}

    /* simple boxes for plain-language description */
    .explain{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;margin-bottom:12px}
    ul.simple{padding-left:18px;margin:8px 0;color:var(--muted)}

    /* diagram area */
    .diagram{background:linear-gradient(180deg,#051022, #061428);padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    svg{width:100%;height:auto}

    /* small cards in right column */
    .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);margin-bottom:12px}
    .muted{color:var(--muted);font-size:13px}

    /* responsive */
    @media (max-width:980px){.content{grid-template-columns:1fr;}.right{order:2}}

    /* accessibility focus */
    .box{fill:#071226;stroke:#144a36;stroke-width:1.4}
    .box-strong{fill:#082229;stroke:#2aa27a;stroke-width:1.6}
    .label{font-size:12px;fill:#e6eef8}
    .small{font-size:11px;fill:#bcdedd}

    .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .legend .item{padding:6px 10px;border-radius:8px;font-size:13px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}

    .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);cursor:pointer;color:var(--accent);font-weight:600}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="hero">
        <h1>AI 學習內容生成系統</h1>
        <p class="lead">把您輸入的主題，透過分支與兩階段（順序 → 並行）呼叫 AI，最後回傳完整的學習內容。</p>
      </div>
    </header>

    <div class="content">
      <div class="left">
        <div class="explain">
          <strong>簡單易懂的步驟說明（口語化）</strong>
          <ul class="simple">
            <li>使用者輸入想學的主題。</li>
            <li>系統先檢查：這個主題是「英語學習」還是「一般主題」。</li>
            <li>如果是英語：會同時蒐集學習程度（CEFR A1–C2）與單字程度；若是一般主題則只收主題與程度。</li>
            <li>階段一（順序）：先向 AI 請求「學習目標（3 個）」，並透過 ProviderManager 選擇要叫哪個 AI 服務（例如 Gemini / OpenRouter）。</li>
            <li>階段二（並行）：拿到學習目標後，對應發出 7 個平行請求（大綱、易混淆點、課堂活動、測驗、對話範例、學習建議、寫作練習），同時收回結果並整合。</li>
            <li>這樣做的好處：並行執行可以大幅縮短等待時間（例如 30–40 秒 vs. 210 秒）。</li>
          </ul>
        </div>

        <div class="diagram" role="img" aria-label="AI 學習內容生成系統流程圖">
          <!-- SVG flowchart that mirrors the ASCII art -->
          <svg viewBox="0 0 1000 820" preserveAspectRatio="xMinYMin meet">
            <!-- header box -->
            <rect x="60" y="10" width="880" height="56" rx="8" class="box-strong"></rect>
            <text x="500" y="36" text-anchor="middle" class="label">AI 學習內容生成系統 / Content Generation Workflow</text>

            <!-- user input -->
            <g>
              <circle cx="500" cy="110" r="14" fill="#0b1220" stroke="#2a9d8f" stroke-width="2"></circle>
              <text x="500" y="108" text-anchor="middle" class="small">⏺</text>
              <text x="500" y="140" text-anchor="middle" class="label">用戶輸入主題</text>
              <line x1="500" y1="160" x2="500" y2="190" stroke="#234" stroke-width="2"/>
            </g>

            <!-- detect box -->
            <rect x="360" y="200" width="280" height="68" rx="8" class="box"></rect>
            <text x="500" y="224" text-anchor="middle" class="label">檢測主題類型</text>
            <text x="500" y="242" text-anchor="middle" class="small">(英語 vs. 一般)</text>

            <!-- split lines -->
            <line x1="360" y1="268" x2="260" y2="330" stroke="#234" stroke-width="2"/>
            <line x1="640" y1="268" x2="740" y2="330" stroke="#234" stroke-width="2"/>

            <!-- Path A box -->
            <rect x="120" y="330" width="260" height="180" rx="8" class="box"></rect>
            <text x="250" y="354" class="label">路徑 A：英語主題</text>
            <rect x="150" y="380" width="200" height="110" rx="6" class="box-strong"></rect>
            <text x="250" y="410" text-anchor="middle" class="label">主題 + 學習程度</text>
            <text x="250" y="430" text-anchor="middle" class="small">+ 單字程度 (CEFR A1–C2)</text>

            <!-- Path B box -->
            <rect x="620" y="330" width="260" height="140" rx="8" class="box"></rect>
            <text x="750" y="354" class="label">路徑 B：一般主題</text>
            <rect x="650" y="380" width="200" height="70" rx="6" class="box-strong"></rect>
            <text x="750" y="420" text-anchor="middle" class="label">主題 + 學習程度</text>

            <!-- converge -->
            <line x1="235" y1="510" x2="500" y2="580" stroke="#234" stroke-width="2"/>
            <line x1="750" y1="470" x2="500" y2="580" stroke="#234" stroke-width="2"/>

            <!-- Phase 1 box -->
            <rect x="140" y="590" width="720" height="160" rx="10" class="box"></rect>
            <text x="500" y="618" text-anchor="middle" class="label">【階段一：順序執行】</text>
            <text x="500" y="638" text-anchor="middle" class="small">向 AI 發送第一個請求 → generateLearningObjectives(...) </text>

            <!-- provider stack -->
            <rect x="240" y="660" width="220" height="48" rx="6" class="box-strong"></rect>
            <text x="350" y="693" text-anchor="middle" class="small">callProviderSystem(prompt, apiKey)</text>
            <text x="350" y="709" text-anchor="middle" class="small">ProviderManager 選擇 AI Provider</text>

            <rect x="540" y="660" width="220" height="48" rx="6" class="box-strong"></rect>
            <text x="650" y="693" text-anchor="middle" class="small">發送 AI 請求</text>
            <text x="650" y="709" text-anchor="middle" class="small">Prompt 範例: "Generate 3 learning objectives..."</text>

            <!-- arrow down to return -->
            <line x1="500" y1="820" x2="500" y2="760" stroke="#234" stroke-width="2"/>

            <!-- return result box (inside Phase1) -->
            <rect x="320" y="720" width="360" height="72" rx="6" class="box"></rect>
            <text x="500" y="748" text-anchor="middle" class="small">✓ 返回學習目標（3 個）JSON 格式</text>

            <!-- connector to phase 2 -->
            <line x1="500" y1="750" x2="500" y2="780" stroke="#234" stroke-width="2"/>

            <!-- Phase 2 -->
            <rect x="80" y="800" width="840" height="200" rx="10" class="box"></rect>
            <text x="500" y="830" text-anchor="middle" class="label">【階段二：並行執行】 Promise.all([...7個請求...])</text>

            <!-- seven request boxes -->
            <g>
              <rect x="110" y="860" width="160" height="60" rx="8" class="box-strong"></rect>
              <text x="190" y="892" text-anchor="middle" class="small">請求 #1: 內容大綱</text>

              <rect x="290" y="860" width="160" height="60" rx="8" class="box-strong"></rect>
              <text x="370" y="892" text-anchor="middle" class="small">請求 #2: 易混淆點</text>

              <rect x="470" y="860" width="160" height="60" rx="8" class="box-strong"></rect>
              <text x="550" y="892" text-anchor="middle" class="small">請求 #3: 課堂活動</text>

              <rect x="650" y="860" width="160" height="60" rx="8" class="box-strong"></rect>
              <text x="730" y="892" text-anchor="middle" class="small">請求 #4: 線上測驗</text>

              <rect x="110" y="940" width="160" height="60" rx="8" class="box-strong"></rect>
              <text x="190" y="972" text-anchor="middle" class="small">請求 #5: 對話範例</text>

              <rect x="290" y="940" width="160" height="60" rx="8" class="box-strong"></rect>
              <text x="370" y="972" text-anchor="middle" class="small">請求 #6: 學習建議</text>

              <rect x="470" y="940" width="160" height="60" rx="8" class="box-strong"></rect>
              <text x="550" y="972" text-anchor="middle" class="small">請求 #7: 寫作練習</text>
            </g>

            <text x="500" y="1020" text-anchor="middle" class="small">⏱ 預估時間：並行 30–40 秒 vs. 順序 210 秒</text>
          </svg>
        </div>

        <div style="margin-top:12px" class="card">
          <strong>使用說明</strong>
          <p class="muted">將此檔案另存為 <code>workflow.html</code>，在瀏覽器開啟即可看到流程圖與說明。視窗縮放時，圖會自動調整。</p>
          <div class="legend">
            <div class="item">簡短口語化說明</div>
            <div class="item">SVG 流程圖</div>
            <div class="item">可直接複製或嵌入到設計稿</div>
          </div>
        </div>

      </div>

      <aside class="right">
        <div class="card">
          <strong>重點速覽（一句話版）</strong>
          <p class="muted">先檢查主題類型 → 先順序拿到學習目標 → 再用學習目標同時發出多個請求 (7 個) → 整合結果並回傳。</p>
        </div>

        <div class="card">
          <strong>階段差異</strong>
          <p class="muted">順序：步步等待（較慢）。並行：同時處理多個請求（較快）。</p>
        </div>

        <div class="card">
          <strong>技術提示</strong>
          <ul class="muted" style="margin:8px 0 0;padding-left:18px;line-height:1.6">
            <li>ProviderManager 可切換不同 AI 提供者（容錯與擴充）。</li>
            <li>第一階段建議回傳 JSON，方便做資料驗證與後續處理。</li>
            <li>並行請求可使用 Promise.all 或等效的併發機制。</li>
          </ul>
        </div>

        <div class="card">
          <strong>下載說明</strong>
          <p class="muted">如需我把此 HTML 轉成可下載檔案或包成 ZIP，告訴我，我可以幫你準備。</p>
          <div style="margin-top:8px"><button class="btn" onclick="copyHTML()">複製 HTML 到剪貼簿</button></div>
        </div>

        <script>
          function copyHTML(){
            const html = `<!doctype html>\n${document.documentElement.outerHTML.replace(/`/g,'\\`')}`
            navigator.clipboard.writeText(html).then(()=>{
              alert('已複製完整 HTML 到剪貼簿，開啟文字編輯器貼上並存檔為 .html 即可。')
            }).catch(()=>alert('複製失敗，請手動複製此頁內容。'))
          }
        </script>
      </aside>
    </div>
  </div>
</body>
</html>
